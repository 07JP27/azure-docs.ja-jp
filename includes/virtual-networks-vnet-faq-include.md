## Virtual Network の基礎

### Azure Virtual Network (VNet) とは何ですか?

VNet を使用すると、Azure で仮想プライベート ネットワーク (VPN) をプロビジョニングおよび管理できるほか、必要に応じて、Azure で VNet を他の VNet や、オンプレミス IT インフラストラクチャに接続することで、ハイブリッド ソリューションまたはクロスプレミス ソリューションを作成できます。作成したそれぞれの VNet には独自の CIDR ブロックがあり、CIDR ブロックが競合しない限り、他の VNet やオンプレミス ネットワークに接続することができます。VNet の DNS サーバー設定と、VNet のサブネット単位の分割も制御できます。

VNet を使用すると、次のことを実行できます。

- 専用プライベート クラウドのみの仮想ネットワークを作成する
									
	場合によっては、ソリューションにはクロスプレミス構成は必要ありません。VNet を作成すると、ご使用のサービスと VNet 内の VMが、クラウド内で相互に直接かつ安全に通信することができます。これによって、VNet 内のトラフィックをセキュリティ保護できる一方で、 VM と、ソリューションの一部としてインターネット通信を必要とするサービスとのエンドポイント接続を構成できます。

- データ センターを安全に拡張する
									
	VNet を使用すると、従来のサイト間 (S2S) VPN を構築できるため、データ センターの容量を安全に拡張できます。S2S VPN では、IPSEC を使用して、社内の VPN ゲートウェイと Azure 間の安全な接続を作成できます。

- ハイブリッド クラウドのシナリオを有効にする
									
	VNet には柔軟性があるため、さまざまなハイブリッド クラウド シナリオに対応できます。クラウド ベースのアプリケーションを、メインフレームや Unix システムなど、どんな種類のオンプレミス システムにでも安全に接続できます。

### どうしたら仮想ネットワークが必要かどうかがわかりますか?

[Virtual Network の概要](http://go.microsoft.com/fwlink/?LinkId=296649)にアクセスし、最適なネットワーク設計オプションの決定に役立つディシジョン テーブルを参照してください。

### 開始するには?

[Virtual Network ドキュメント](http://azure.microsoft.com/documentation/services/virtual-network/)にアクセスして開始します。このページには、一般的な構成手順だけでなく、仮想ネットワークを設計する際に考慮する必要がある内容を理解するのに役立つ情報へのリンクが含まれます。

### VNet でどのようなサービスを使用できますか?

VNet では、Cloud Services (PaaS)、Virtual Machines、Web Apps など、さまざまな異なる Azure サービスを使用できます。ただし、VNet でサポートされていないサービスがいくつかあります。使用したい特定のサービスをチェックし、サービスに対応しているかを確認してください。

### クロスプレミス接続を使用しないで VNet を使用できますか?

はい。サイト間接続を使用せずに VNet を使用することができます。これは、Azure でドメイン コントローラーと SharePoint ファームを実行する場合に特に便利です。

## Virtual Network の構成

### VNet の作成にはどのようなツールを使用しますか?

仮想ネットワークを作成または構成するには、次のツールを使用できます。

- 管理ポータルを使用できます。[Virtual Network (VNet) のプロパティの管理方法](virtual-networks-settings.md)を参照してください。

- ネットワーク構成ファイル (netcfg) を使用できます。[ネットワーク構成ファイルを使用した仮想ネットワークの構成](virtual-networks-using-network-configuration-file.md)を参照してください。

### VNet でどのアドレス範囲が使用できますか?

パブリック IP アドレス範囲、および [RFC 1918](http://tools.ietf.org/html/rfc1918) で定義されている任意の IP アドレス範囲を使用できます。

### VNet 内でパブリック IP アドレスを使用できますか?

はい。パブリック IP アドレス範囲の詳細については、[Virtual Network (VNet) でのパブリック IP アドレス空間](virtual-networks-public-ip-within-vnet.md)を参照してください。パブリック IP へは、インターネットから直接アクセスできないので注意してください。

### 仮想ネットワーク内で使用できるサブネット数に制限はありますか?

VNet 内で使用できるサブネットの数に制限はありません。すべてのサブネットは仮想ネットワーク アドレス空間に完全に含める必要があるほか、互いに重複しないようにしてください。

### これらのサブネット内の IP アドレスの使用に制限はありますか?

Azure では、各サブネット内で一部の IP アドレスがを予約されます。サブネットの最初と最後の IP アドレスは、Azure サービスで使用される他の 2 つのアドレスと共に、プロトコル準拠のために予約されています。

### VNet およびサブネットの最小規模および最大規模はどれくらいですか？

サポートされる最小規模のサブネットは /29 、最大規模は /8 です (CIDR サブネット定義を使用)。

### VNet を使用して、VLAN を Azure に接続できるでしょうか?

いいえ。VNet はレイヤー 3 のオーバーレイです。Azure では、任意のレイヤー 2 のセマンティクスはサポートされません。

### VNet とサブネットでカスタム ルーティング ポリシーを指定できますか?

はい。ユーザー定義のルーティング (UDR) を使用できます。UDR の詳細については、[ユーザー定義のルートと IP 転送](virtual-networks-udr-overview.md)を参照してください。

### VNet ではマルチキャストやブロードキャストがサポートされますか?

いいえ。マルチキャストやブロードキャストはサポートされていません。

### VNet 内ではどのようなプロトコルを使用できますか?

VNet 内では、標準 IP ベースのプロトコルを使用できます。ただし、マルチキャスト、ブロードキャスト、IP-in-IP のカプセル化されたパケット、Generic Routing Encapsulation (GRE) のパケットは、VNet 内でブロックされます。使用できる標準プロトコルは、次のとおりです。

- TCP
- UDP
- ICMP

### VNet 内で、既定ルーターを ping できますか?

いいえ。

### tracert を使用して、接続を診断できますか?

いいえ。

### VNet を作成した後にサブネットを追加できますか?

はい。サブネット アドレスが VNet 内の別のサブネットの一部でない限り、サブネットをいつでも VNet に追加できます。

### VNet の作成後、VNet のサイズを変更できますか?

PowerShell コマンドレットまたは NETCFG ファイルを使用してデプロイされた VM やサービスがサブネット内になければ、サブネットを追加、削除、展開または圧縮できます。VM やサービスを含むサブネットが変更の影響を受けなければ、プレフィックスも追加、削除、展開、圧縮できます。

### サブネットを作成後に変更できますか?

はい。VNet で使用される CIDR ブロックは追加、削除、変更することができます。

### VNet でサービスを実行している場合、インターネットに接続できますか?

はい。VNet 内にデプロイされているすべてのサービスは、インターネットに接続できます。Azure にデプロイされたすべてのクラウド サービスには、パブリックにアドレス指定可能な VIP が割り当てられています。これらのサービスがインターネットからの接続を承諾できるように、PaaS ロールの入力エンドポイントと仮想マシンのエンドポイントを定義する必要があります。

### VNet では IPv6 がサポートされていますか?

いいえ。現在、VNet では IPv6 を使用できません。

### VNet は複数リージョンをまたがって使用できますか?

いいえ。 VNet は、1 つのリージョンに制限されます。

### VNet を Azure の別の VNet に接続できますか?

はい。REST API または Windows PowerShell を使用すると、VNet 間の通信を作成できます。[VNet 間の接続の構成](virtual-networks-configure-vnet-to-vnet-connection.md)を参照してください。

## VM とロール インスタンスの名前解決

### VNet にはどんな DNS オプションがありますか?

[VM とロール インスタンスの名前解決](https://msdn.microsoft.com/library/azure/jj156088.aspx)ページのディシジョン テーブルで、使用できるすべての DNS オプションを参照できます。

### VNet の DNS サーバーを指定できますか?

はい。DNS サーバーの IP アドレスを VNet 設定で指定できます。このアドレスは、VNet 内のすべての VM の既定 DNS サーバーとして適用されます。

### いくつの DNS サーバーを指定できますか?

最大 12 個の DNS サーバーを指定できます。

### ネットワークを作成した後に、DNS サーバーを変更できますか?

はい。VNet の DNS サーバーの一覧はいつでも変更できます。DNS サーバーの一覧を変更する場合、新しい DNS サーバーが取得されるように VNet 内の各 VM を再起動する必要があります。


### Azure で提供される DNS とは何ですか? それを VNet で使用できますか?

Azure で提供される DNS は、Microsoft が提供するマルチ テナント DNS サービスです。Azure では、このサービス内のすべての VM とロール インスタンスが登録されます。このサービスでは、同じクラウド サービス内に含まれる VM とロール インスタンスのホスト名によって、または同じ VNet 内の VM とロール インスタンスの FQDN によって名前が解決されます。

> [AZURE.NOTE]現在、Azure で提供される DNS を使用してテナント間の名前を解決できるのは、仮想ネットワーク内の最初の 100 個のクラウド サービスに限定されています。独自の DNS サーバーを使用している場合は、この制限は適用されません。

### VM あるいはサービスごとに DNS 設定を上書きできますか?

はい。クラウド サービスごとに、既定のネットワーク設定が上書きされるように DNS サーバーを設定できます。ただし、できるだけネットワーク全体の DNS を使用することをお勧めします。

### 独自の DNS サフィックスを使用できますか?

いいえ。VNet ではカスタム DNS サフィックスを指定できません。

## VNet および VM

### VNet に VM をデプロイできますか?

はい。

### VNet に Linux VM をデプロイできますか?

はい。Azure でサポートされている Linux のすべてのディストリビューションをデプロイできます。

### パブリック VIP と内部 IP アドレスの違いは何ですか?

- 内部 IP アドレスは、DHCP によって VNet 内の各 VM に割り当てられる IP アドレスです。一般向けではありません。VNet を作成した場合は、ご使用の VNet のサブネット設定で指定した範囲から内部 IP アドレスが割り当てられます。ご使用されている VNet がない場合でも、内部 IP アドレスは割り当てられます。内部 IP アドレスは、VM が割り当て解除されない限り、VM で使用され続けます。

- パブリック VIP とは、クラウド サービスまたはロード バランサーに割り当てられるパブリック IP アドレスです。VM の NIC には直接割り当てられません。VIP は、クラウド サービス内のすべての VM が割り当て解除または削除されるまで、割り当てられたクラウド サービスで使用され続けます。すべての VM が割り当て解除または削除されると、VIP は解放されます。

### VM に割り当てられのはどの IP アドレスですか?

- **内部 IP アドレス -** VM を VNet にデプロイする場合は、VM は、指定した内部 IP アドレスのプールから内部 IP アドレスを受け取ります。VM は、内部 IP アドレスを使用して VNet 内で相互に通信します。Azure では動的内部 IP アドレスが割り当てられますが、ご使用の VM 用に静的アドレスを要求することもできます。静的内部 IP アドレスに関する詳細については、[静的内部 IP アドレスを設定する方法](virtual-networks-reserved-private-ip.md)参照してください。

- **VIP -** VIP は VM に直接割り当てられることはありませんが、VM は VIP にも関連付けられます。VIP は、クラウド サービスに割り当てられるパブリック IP アドレスです。必要に応じて、クラウド サービス用に VIP を予約することができます。[予約済みパブリック IP](virtual-networks-reserved-public-ip.md) を参照してください。

- **ILPIP -** インスタンスレベル パブリック IP アドレス (ILPIP) を構成することもできます。ILPIP はクラウド サービスではなく、VM に直接関連付けられます。ILPIP に関する詳細については、[インスタンス レベル パブリック IP の概要](virtual-networks-instance-level-public-ip.md)を参照してください。

### 後で作成する VM のために内部 IP アドレスを予約できますか?

いいえ。内部 IP アドレスを予約することはできません。内部 IP アドレスが使用可能な場合は、DHCP サーバーによって、VM またはロール インスタンスに割り当てられます。その VM は、内部 IP アドレスを割り当てたいマシンでない場合もあります。ただし、すでに作成済みの VM の内部 IP アドレスを、使用可能な内部 IP アドレスに変更することはできます。

### VNet 内にある VM の内部 IP アドレスが変更になることはありますか?

はい。内部 IP アドレスは、VM が割り当て解除されない限り、同じ VM で使用され続けます。VM が割り当て解除されると、VM に静的内部 IP アドレスを定義しない限り、その内部 IP アドレスは解放されます。VM が単に停止している場合 (**停止 (割り当て解除)**状態になっていない)、IP アドレスはその VM に割り当てられたままです。

### 手動で IP アドレスを VM の NIC に割り当てられますか?

いいえ。VM のインターフェイス プロパティは変更しないでください。いかなる変更も、VM への接続が失われる可能性があります。

### VM をシャットダウンしたら、IP アドレスはどうなりますか?

何も起こりません。IP アドレス (パブリック VIP と内部 IP アドレスの両方) は、クラウド サービスまたは VM で引き続き使用できます。

> [AZURE.NOTE]単に VM をシャットダウンする場合、管理ポータルを使用しないでください。現時点では、シャットダウン ボタンをクリックすると、仮想マシンの割り当てが解除されます。

### VNet 内で、VM を再デプロイせずに 1 つのサブネットからもう 1 つのサブネットに移動できますか?

はい。詳細については、[こちら](virtual-networks-move-vm-role-to-subnet.md)を参照してください。

### VM に静的な MAC アドレスを構成できますか?

いいえ。 MAC アドレスを静的に構成することはできません。

### MAC アドレスは、一度作成されたら、VM で引き続き維持されますか?

いいえ。 VM の MAC アドレスは、さまざまな理由で変更される場合があります。VM のステータスが停止 (割り当て解除) になった場合や、VM のサイズを変更したり、ホストサーバーで回復中のサービスや計画されたメンテナンスがあると、MAC アドレスは保持されません。

### VNet 内の VM からインターネットに接続できますか?

はい。VNet 内にデプロイされているすべてのサービスは、インターネットに接続できます。また、Azure にデプロイされたすべてのクラウド サービスには、パブリックにアドレス指定可能な VIP が割り当てられています。これらのサービスがインターネットからの接続を承諾できるように、PaaS ロールの入力エンドポイントと VM のエンドポイントを定義する必要があります。

## VNet とサービス

### VNet でどのようなサービスを使用できますか?

VNet 内のコンピューティング サービスのみを使用できます。コンピューティング サービスは、クラウド サービス (Web ロールと　Worker ロール) および VM に限定されます。

### Web Apps を Virtual Network に使用できますか?

いいえ。VNet に Azure Web App をデプロイすることはできません。ただし、VNet にポイント対サイトが構成されていれば、Web Apps から、Azure VNet のリソースに安全に接続してアクセスできます。詳細については、次のトピックを参照してください。

- [Web Apps Virtual Network Integration (Web Apps と Virtual Network の統合)](http://azure.microsoft.com/blog/2014/09/15/azure-websites-virtual-network-integration/)

- [Using VNet Integration and Hybrid Connections with Web Apps (Web Apps に対する VNet 統合とハイブリッド接続の使用)](http://azure.microsoft.com/blog/2014/10/30/using-vnet-or-hybrid-conn-with-websites/)

- [Web アプリを Azure Virtual Network に統合する](web-sites-integrate-with-vnet.md)


### Web ロールと Worker ロール (PaaS) を含むクラウド サービスを VNet にデプロイできますか?

はい。VNet に PaaS サービスをデプロイすることができます。

### VNet にどうやって PaaS ロールをデプロイするのですか?

サービス構成のネットワーク構成セクションで、VNet の名前、およびロールとサブネットのマッピングを指定することでデプロイできます。いずれのバイナリも更新する必要はありません。

### サービスを VNet 内外で移動できますか?

いいえ。サービスを VNet 内外で移動することはできません。サービスを別の VNet に移動するには、サービスを削除して再デプロイする必要があります。

## VNet とセキュリティ

### VNet のセキュリティ モデルは何ですか?

VNet は、それぞれ完全に独立しており、Azure インフラストラクチャでホストされている他のサービスからも完全に分離しています。VNet は信頼の境界です。

### VNet で、ACL または NSG を定義できますか?

いいえ。ACL または NSG を VNet に関連付けることはできません。ただし、ACL は VNet にデプロイされている VM の入力エンドポイントで定義可能で、NSG はサブネットまたは NIC に関連付けられます。

### VNet セキュリティに関するホワイト ペーパーはありますか。

はい。[こちら](http://go.microsoft.com/fwlink/?LinkId=386611)からダウンロードできます。

## API、スキーマ、およびツール

### VNet をコードから管理できますか?

はい。REST API を使用すると、VNet およびクロスプレミス接続を管理することができます。詳細については、[こちら](http://go.microsoft.com/fwlink/?LinkId=296833)で確認できます。

### VNet に対するツール サポートはありますか。

はい。各種プラットフォームで PowerShell とコマンド ライン ツールを使用することができます。詳細については、[こちら](http://go.microsoft.com/fwlink/?LinkId=317721)で確認できます。

<!---HONumber=July15_HO4-->