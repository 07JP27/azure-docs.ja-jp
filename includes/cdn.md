# Windows Azure 用 CDN の使用

Windows Azure のコンテンツ配信ネットワーク (CDN) は、米国、欧州、アジア、オーストラリア、および南米にある物理ノードで、コンピューティング インスタンスの BLOB と静的コンテンツをキャッシュすることで、高帯域幅コンテンツを配信するグローバル ソリューションを開発者に提供します。現在の CDN ノードの場所の一覧については、[Windows Azure CDN ノードの場所に関するページ]を参照してください。

このタスクの手順は次のとおりです。

* [ステップ 1: ストレージ アカウントを作成する](#Step1)
* [ステップ 2: ストレージ アカウントに対する新しい CDN エンドポイントを作成する](#Step2)
* [ステップ 3: CDN コンテンツにアクセスする](#Step3)
* [ステップ 4: CDN コンテンツを削除する](#Step4)

CDN を使用して Windows Azure データをキャッシュすることには、次のような利点があります。

-   コンテンツ ソースから遠く離れた場所にいる、コンテンツの読み込みに数多くの "インターネット トリップ" が必要なアプリケーションを使用するエンド ユーザーに対する、パフォーマンスとユーザー エクスペリエンスの向上
-   製品発表イベントの開始時のような、瞬間的高負荷を処理しやすくする大規模な配信スケール

既存の CDN の顧客は、[Windows Azure の管理ポータル]で Windows Azure CDN を使用できます。CDN はサブスクリプションのアドオン機能であり、別の[お支払いプラン]があります。

<a id="Step1"> </a>
<h2>ステップ 1: ストレージ アカウントを作成する</h2>

Windows Azure サブスクリプションの新しいストレージ アカウントを作成するには、次のステップに従います。ストレージ アカウントを使用すると、Windows Azure のストレージ サービスにアクセスできます。ストレージ アカウントは、BLOB サービス、キュー サービス、およびテーブル サービスという Windows Azure の各ストレージ サービス コンポーネントへのアクセスに使用する最高レベルの名前空間です。Windows Azure のストレージ サービスの詳細については、「[Windows Azure のストレージ サービスの使用]」を参照してください。

ストレージ アカウントを作成するには、関連付けられているサブスクリプションのサービス管理者または共同管理者であることが必要です。

<div class="dev-callout">
<strong>注</strong>
<p>Windows Azure サービス管理 API を使用してこの操作を実行する方法については、<a href="http://msdn.microsoft.com//library/windowsazure/hh264518.aspx">ストレージ アカウントの作成に関する</a>リファレンス トピックを参照してください。</p>
</div>

**Windows Azure サブスクリプションのストレージ アカウントを作成するには**

1. [Windows Azure の管理ポータル]にログインします。
2. 左下隅で **[新規]** をクリックし、**[ストレージ]** をクリックします。
3. **[簡易作成]** をクリックします。

    **[ストレージ アカウントの作成]** ダイアログ ボックスが表示されます。

    ![ストレージ アカウントの作成][create-new-storage-account]

4. **[URL]** フィールドにサブドメイン名を入力します。文字数は 3 ～ 24 文字とし、アルファベット小文字と数字を使用できます。

    この名前は、対応するサブスクリプションの BLOB リソース、キュー リソース、またはテーブル リソースのアドレス指定に使用される URL のホスト名になります。BLOB サービスでコンテナー リソースをアドレス指定するには、次の形式の URI を使用します。*&lt;StorageAccountLabel&gt;* は、**[URL を入力してください]** に入力した値を表します。

    http://*&lt;StorageAcountLabel&gt;*.blob.core.windows.net/*&lt;mycontainer&gt;*

    **重要:** この URL は、ストレージ アカウントの URI のサブドメインとなるため、Windows Azure のすべてのホステッド サービスで一意である必要があります。

	この値は、このストレージ アカウントの名前として、ポータルやプログラムでこのアカウントにアクセスするときにも使用されます。

5. **[リージョン/アフィニティ グループ]** ボックスの一覧で、ストレージ アカウントの場所を選択します。または、アフィニティ グループを使用します。アフィニティ グループを作成する手順については、[Windows Azure でアフィニティ グループを作成する方法に関するページ]を参照してください。
6. **[サブスクリプション]** ボックスの一覧で、ストレージ アカウントを使用するサブスクリプションを選択します。
7. **[ストレージ アカウントの作成]** をクリックします。ストレージ アカウントを作成するプロセスは、完了までに数分かかる場合があります。
8. ストレージ アカウントが正常に作成されたことを確認するには、アカウントが **[ストレージ]** の一覧に表示され、状態が **[オンライン]** になっていることを確かめます。

<a id="Step2"> </a>
<h2>ステップ 2: ストレージ アカウントに対する新しい CDN エンドポイントを作成する</h2>

ストレージ アカウントまたはホステッド サービスへの CDN アクセスを有効にすると、パブリックにアクセスできるオブジェクトは CDN エッジ キャッシュの対象になります。CDN で現在キャッシュされているオブジェクトを変更する場合、キャッシュされたコンテンツの有効期限終了時に CDN によりそのコンテンツが更新されるまでは、CDN を通じて新しいコンテンツを使用することはできません。

**ストレージ アカウントに対する新しい CDN エンドポイントを作成するには**

1. [Windows Azure の管理ポータル]のナビゲーション ウィンドウで、**[CDN]** をクリックします。

2. リボンで、**[新規]** をクリックします。**[新規]** ダイアログで、**[アプリケーション サービス]**、**[CDN]**、**[簡易作成]** の順に選択します。

3. **[元のドメイン]** ボックスで、前のセクションで作成したストレージ アカウントを、利用可能なストレージ アカウントの一覧から選択します。

4. **[作成]** ボタンをクリックして、新しいエンドポイントを作成します。

5. エンドポイントが作成されると、サブスクリプションのエンドポイントの一覧に表示されます。一覧には、キャッシュされたコンテンツへのアクセスに使用する URL と元のドメインが表示されます。

	元のドメインは、CDN がコンテンツをキャッシュする場所です。元のドメインは、ストレージ アカウントまたはクラウド サービスのどちらかになります。この例では、ストレージ アカウントが使用されます。ストレージ コンテンツは、指定したキャッシュ制御の設定またはキャッシュ ネットワークの既定のヒューリスティックに従って末端サーバーにキャッシュされます。詳細については、「[BLOB コンテンツの有効期限を管理する方法](http://msdn.microsoft.com/ja-jp/library/gg680306.aspx)」を参照してください。


    <div class="dev-callout">
    <strong>メモ</strong>
    <p>エンドポイントのために作成された構成は、すぐには使用できません。CDN ネットワークを通じて伝播する登録などのために最大 60 分かかります。CDN ドメイン名を直ちに使用しようとするユーザーは、CDN を経由してコンテンツを取得できるようになるまでは状態コード 400 (正しくない要求) を受け取る場合があります。</p>
    </div>

<a id="Step3"> </a>
<h2>ステップ 3: CDN コンテンツにアクセスする</h2> 

CDN にキャッシュされたコンテンツにアクセスするには、ポータルで提供される CDN URL を使用します。キャッシュされた BLOB のアドレスは、次のようになります。

http://<*CDNNamespace*\>.vo.msecnd.net/<*myPublicContainer*\>/<*BlobName*\>

<a id="Step4"> </a>
<h2>ステップ 4: CDN からコンテンツを削除する</h2>

Windows Azure のコンテンツ配信ネットワーク (CDN) にオブジェクトをキャッシュする必要がなくなった場合は、次のいずれかの手順を実行できます。

-   Windows Azure BLOB の場合は、パブリック コンテナーから BLOB を削除できます。
-   コンテナーをパブリックではなくプライベートに設定できます。詳細については、「[コンテナーと BLOB へのアクセスの制限](http://msdn.microsoft.com/ja-jp/library/dd179354.aspx」を参照してください。
-   管理ポータルを使用して CDN エンドポイントを無効化または削除できます。
-   オブジェクトの要求に応答しなくなるようにホステッド サービスを変更できます。

CDN に既にキャッシュされているオブジェクトは、オブジェクトの有効期限が切れるまでキャッシュに残ったままとなります。有効期限が切れると、CDN エンドポイントがまだ有効で、オブジェクトがまだ匿名アクセス可能かどうかが CDN によって確認されます。CDN エンドポイントが無効になり、オブジェクトに匿名でアクセスできなくなった場合、オブジェクトはキャッシュされなくなります。

現時点では、Windows Azure CDN で使用できる明示的な "パージ" ツールはありません。

## その他のリソース

-   [Windows Azure でアフィニティ グループを作成する方法]
-   [方法: Windows Azure サブスクリプションのストレージ アカウントを管理する]
-   [サービス管理 API について]
-   [CDN コンテンツをカスタム ドメインにマッピングする方法]

  [ストレージ アカウントの作成]: http://msdn.microsoft.com/ja-jp/library/windowsazure/hh264518.aspx
  [Windows Azure CDN ノードの場所]: http://msdn.microsoft.com/ja-jp/library/windowsazure/gg680302.aspx
  [Windows Azure の管理ポータル]: https://manage.windowsazure.com/
  [お支払いプラン]: /ja-jp/pricing/calculator/?scenario=full
  [Windows Azure のストレージ サービスの使用]: http://msdn.microsoft.com/ja-jp/library/windowsazure/ee924681.aspx
  [カスタム サブドメイン名を登録して Windows Azure の BLOB にアクセスする方法]: http://msdn.microsoft.com/ja-jp/library/windowsazure/ee795179.aspx
  [Windows Azure でアフィニティ グループを作成する方法]: http://msdn.microsoft.com/ja-jp/library/windowsazure/hh531560.aspx
  [Windows Azure CDN の概要]: http://msdn.microsoft.com/ja-jp/library/windowsazure/ff919703.aspx
  [方法: Windows Azure サブスクリプションのストレージ アカウントを管理する]: http://msdn.microsoft.com/ja-jp/library/windowsazure/hh531567.aspx
  [サービス管理 API について]: http://msdn.microsoft.com/ja-jp/library/windowsazure/ee460807.aspx
  [CDN コンテンツをカスタム ドメインにマッピングする方法]: http://msdn.microsoft.com/ja-jp/library/windowsazure/gg680307.aspx


[create-new-storage-account]: ./media/cdn/CDN_CreateNewStorageAcct.png
[Previous Management Portal]: ../../Shared/Media/previous-portal.png


