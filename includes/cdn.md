# Azure 用 CDN の使用

Azure Content Delivery Network (CDN) は、米国、欧州、アジア、オーストラリア、および南米にある物理ノードで、コンピューティング インスタンスの BLOB と静的コンテンツをキャッシュすることで、高帯域幅コンテンツを配信するグローバル ソリューションを開発者に提供します。現在の CDN ノードの 場所の一覧については、[Azure CDN ノードの場所に関するページ][Azure CDN ノードの場所に関するページ]を参照してください。

このタスクの手順は次のとおりです。

-   [手順 1.ストレージ アカウントを作成する][手順 1.ストレージ アカウントを作成する]
-   [手順 2.ストレージ アカウントに対する新しい CDN エンドポイントを作成する][手順 2.ストレージ アカウントに対する新しい CDN エンドポイントを作成する]
-   [手順 3.CDN コンテンツにアクセスする][手順 3.CDN コンテンツにアクセスする]
-   [手順 4.CDN コンテンツを削除する][手順 4.CDN コンテンツを削除する]

CDN を使用して Azure データをキャッシュすることには、次のような利点があります。

-   コンテンツ ソースから遠く離れた場所にいる、コンテンツの読み込みに数多くの "インターネット トリップ" が必要なアプリケーションを使用するエンド ユーザーに対する、パフォーマンスとユーザー エクスペリエンスの向上 製品発表イベントの開始時のような、瞬間的高負荷を処理しやすくする大型の配信スケール

既存の CDN のお客様は、[Azure 管理ポータル][Azure 管理ポータル]で Azure CDN を使用できます。CDN はサブスクリプションのアドオン機能であり、別の[お支払いプラン][お支払いプラン]があります。

<span id="Step1"></span> </a>

## 手順 1.ストレージ アカウントの作成

</p>
Azure サブスクリプションの新しいストレージ アカウントを作成するには、次のステップに従います。ストレージ アカウントを使用すると、Azure のストレージ サービスにアクセスできます。ストレージ アカウントは、Azure のストレージ サービス コンポーネントの それぞれにアクセスするための最高レベルの 名前空間を表します。BLOB サービス、キュー サービス、およびテーブル サービスの各ストレージ サービス コンポーネントへのアクセスに使用する最高レベルの名前空間です。Azure ストレージ サービスの詳細については、[Azure Storage サービスの使用] を参照してください。

ストレージ アカウントを作成するには、関連付けられている サブスクリプションのサービス管理者または共同管理者であることが必要です。

<div class="dev-callout">
<strong>注</strong>
<p>Azure サービス管理 API を使用してこの操作を実行する方法については、
<a href="http://msdn.microsoft.com/ja-jp/library/windowsazure/hh264518.aspx">ストレージ アカウントの作成</a>に関するリファレンス トピックを参照してください。</p>
</div>

**Azure サブスクリプションのストレージ アカウントを作成するには**

1.  [Azure の管理ポータル][Azure 管理ポータル]にログインします。
2.  左下隅で **[新規]** をクリックし、**[ストレージ]** をクリックします。
3.  **[簡易作成]** をクリックします。

    **[ストレージ アカウントの作成]** ダイアログ ボックスが表示されます。

    ![ストレージ アカウントの作成][1]

4.  **[URL]** フィールドにサブドメイン名を入力します。文字数は 3 ～ 24 文字とし、アルファベット小文字と数字を使用できます。

    この値は、対応するサブスクリプションの BLOB リソース、キュー リソース、またはテーブル リソースのアドレス指定に使用される URL のホスト名になります。
    BLOB サービスでコンテナー リソースをアドレス指定するには、次の形式の URI を使用します。*\<StorageAccountLabel\>* は **[URL を入力してください]** に入力した値を表します:

    <http://>*\<StorageAcountLabel\>*.blob.core.windows.net/*\<mycontainer\>*

    **重要:** この URL は、ストレージ アカウントの URI のサブドメインとなるため、Azure のすべてのホステッド サービスで一意である必要があります。

    この値は、このストレージ アカウントの名前として、ポータルやプログラムでこのアカウントにアクセスするときにも使用されます。

5.  **[リージョン/アフィニティ グループ]** ボックスの一覧で、ストレージ アカウントのリージョンまたはアフィニティ グループを選択します。使用している他の Windows Azure サービスと同じデータ センターにストレージ サービスを配置する場合は、リージョンの代わりにアフィニティ グループを選択します。これによりパフォーマンスが向上し、送信料金も発生しません。

    **注:** アフィニティ グループを作成するには、管理ポータルの **[設定]** 領域を開き、**[アフィニティ グループ]** をクリックして、**[新しいアフィニティ グループの追加]** または **[追加]** をクリックします。また、Windows Azure サービス管理 API を使用してアフィニティ グループを作成し管理することもできます。詳細については、「[アフィニティ グループに対する操作][アフィニティ グループに対する操作]」を参照してください。

6.  **[サブスクリプション]** ボックスの一覧で、ストレージ アカウントを使用するサブスクリプションを選択します。
7.  **\[ストレージ アカウントの作成]** をクリックします。ストレージ アカウントを作成するプロセスは、完了までに数分かかる場合があります。
8.  ストレージ アカウントが正常に作成されたことを確認するには、アカウントが **[ストレージ]** の一覧に表示され、状態が **[オンライン]** になっていることを確かめます。

<span id="Step2"></span> </a>

## 手順 2.ストレージ アカウントに対する新しい CDN エンドポイントを作成する


ストレージ アカウントまたはホステッド サービスへの CDN アクセスを有効にすると、パブリックにアクセスできるオブジェクトは CDN エッジ キャッシュの対象になります。CDN で現在キャッシュされているオブジェクトを変更する場合、キャッシュされたコンテンツの有効期限終了時に CDN によりそのコンテンツが更新されるまでは、CDN を通じて新しいコンテンツを使用することはできません。

**ストレージ アカウントに対する新しい CDN エンドポイントを作成するには**

1.  [Azure 管理ポータル][Azure 管理ポータル]のナビゲーション ウィンドウで、**[CDN]** をクリックします。

2.  リボンで、**[新規]** をクリックします。**[新規]** ダイアログで、**[アプリケーション サービス]**、**[CDN]**、**[簡易作成]** の順に選択します。

3.  **[元のドメイン]** ボックスで、前のセクションで作成したストレージ アカウントを、利用可能なストレージ アカウントの一覧から選択します。

4.  **[作成]** ボタンをクリックして、新しいエンドポイントを作成します。

5.  エンドポイントが作成されると、サブスクリプションのエンドポイントの一覧に表示されます。一覧には、キャッシュされたコンテンツへのアクセスに使用する URL と元のドメインが表示されます。

    元のドメインは、CDN がコンテンツをキャッシュする場所です。元のドメインは、ストレージ アカウントまたはクラウド サービスのどちらかになります。この例では、ストレージ アカウントが使用されます。ストレージ コンテンツは、指定したキャッシュ制御の設定またはキャッシュ ネットワークの既定のヒューリスティックに従って末端サーバーにキャッシュされます。詳細については、「[BLOB コンテンツの有効期限を管理する方法][BLOB コンテンツの有効期限を管理する方法]」を参照してください。

    <div class="dev-callout">
<strong>注</strong>
<p>エンドポイント用に作成された構成は、
すぐには使用できません。CDN ネットワークを通じて伝播する
登録のために、最大で 60 分かかる場合があります。CDN ドメイン名を
直ちに使用しようとするユーザーは、CDN を経由してコンテンツを取得できるように
なるまでは、状態コード 400 (正しくない要求) を受け取ります。</p>
</div>

<span id="Step3"></span> </a>

## 手順 3.CDN コンテンツにアクセスする

</p>
CDN にキャッシュされたコンテンツにアクセスするには、ポータルで提供される CDN URL を使用します。キャッシュされた BLOB のアドレスは、次のようになります。

<http://>\<*CDNNamespace*\>.vo.msecnd.net/\<*myPublicContainer*\>/\<*BlobName*\>

<span id="Step4"></span> </a>

## 手順 4.CDN からコンテンツを削除する

</p>
Azure Content Delivery Network (CDN) にオブジェクトをキャッシュする必要がなくなった場合は、次のいずれかの手順を実行できます。

-   Azure BLOB の場合は、パブリック コンテナーから BLOB を
    削除できます。
-   コンテナーをパブリックではなくプライベートに設定できます。詳細については、「[コンテナーと BLOB へのアクセスの制限][コンテナーと BLOB へのアクセスの制限]」を参照してください。
-   管理ポータルを使用して CDN エンドポイントを無効化または削除できます。
-   オブジェクトの要求に応答しなくなるようにホステッド サービスを変更できます。

CDN に既にキャッシュされているオブジェクトは、オブジェクトの有効期限が切れるまでキャッシュに残ったままとなります。有効期限が切れると、CDN エンドポイントがまだ有効で、オブジェクトがまだ匿名アクセス可能かどうかが CDN によって確認されます。CDN エンドポイントが無効になり、オブジェクトに匿名でアクセスできなくなった場合、オブジェクトはキャッシュされなくなります。

現時点では、Azure CDN で使用できる明示的な "パージ" ツールはありません。

## その他のリソース

-   [Azure でアフィニティ グループを作成する方法]
-   [方法: Azure サブスクリプションのストレージ アカウントの管理][方法: Azure サブスクリプションのストレージ アカウントの管理]
-   [サービス管理 API について][サービス管理 API について]
-   [CDN コンテンツをカスタム ドメインにマッピングする方法][CDN コンテンツをカスタム ドメインにマッピングする方法]

  [Azure CDN ノードの場所に関するページ]: http://msdn.microsoft.com/ja-jp/library/windowsazure/gg680302.aspx
  [手順 1.ストレージ アカウントを作成する]: #Step1
  [手順 2.ストレージ アカウントに対する新しい CDN エンドポイントを作成する]: #Step2
  [手順 3.CDN コンテンツにアクセスする]: #Step3
  [手順 4.CDN コンテンツを削除する]: #Step4
  [Azure 管理ポータル]: https://manage.windowsazure.com/
  [お支払いプラン]: /ja-jp/pricing/calculator/?scenario=full
  [ストレージ アカウントの作成]: http://msdn.microsoft.com/ja-jp/library/windowsazure/hh264518.aspx
  [1]: ./media/cdn/CDN_CreateNewStorageAcct.png
  [アフィニティ グループに対する操作]: http://msdn.microsoft.com/library/azure/ee460798.aspx
  [BLOB コンテンツの有効期限を管理する方法]: http://msdn.microsoft.com/ja-jp/library/gg680306.aspx
  [コンテナーと BLOB へのアクセスの制限]: http://msdn.microsoft.com/ja-jp/library/dd179354.aspx
  [方法: Azure サブスクリプションのストレージ アカウントの管理]: http://msdn.microsoft.com/ja-jp/library/windowsazure/hh531567.aspx
  [サービス管理 API について]: http://msdn.microsoft.com/ja-jp/library/windowsazure/ee460807.aspx
  [CDN コンテンツをカスタム ドメインにマッピングする方法]: http://msdn.microsoft.com/ja-jp/library/windowsazure/gg680307.aspx
