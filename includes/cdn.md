# Azure 用 CDN の使用

Azure コンテンツ配信ネットワーク (CDN) は、
高帯域幅コンテンツを配信するためのグローバル ソリューションを開発者に提供します。
そのために、コンピューティング インスタンスの BLOB および静的コンテンツを米国、
ヨーロッパ、アジア、オーストラリア、および南米の物理ノードにキャッシュします。現在の CDN ノードの場所の一覧
[については、Azure CDN ノードの場所に関するページを参照してください][]。

このタスクの手順は次のとおりです。

* [手順 1:ストレージ アカウントを作成する](#Step1)
* [手順 2: ストレージ アカウントに対する新しい CDN エンドポイントを作成する](#Step2)
* [手順 3: CDN コンテンツにアクセスする](#Step3)
* [手順 4: CDN コンテンツを削除する](#Step4)

CDN を使用して Azure データをキャッシュすることには、次のような利点があります。

-   コンテンツ ソースから遠く離れた場所にいる、コンテンツの読み込みに数多くの 'internet trips'が必要なアプリケーションを使用するエンド ユーザーに対する、パフォーマンスとユーザー エクスペリエンスの向上
-   製品発表イベントの開始時のような、瞬間的高負荷を処理しやすくする大型の配信スケール

既存の CDN のお客様は、[Azure 管理ポータル][]で Azure CDN を使用できます。CDN はサブスクリプションのアドオン機能であり、別の[お支払いプラン]があります。

<a id="Step1"> </a>
<h2>手順 1:ストレージ アカウントを作成する</h2>

Azure サブスクリプションの新しいストレージ アカウントを作成するには、
次の手順に従います。ストレージ アカウントによって、 
Azure ストレージ サービスにアクセスできます。ストレージ
 アカウント
は、BLOB サービス、キュー サービス、およびテーブル サービスのそれぞれの Azure ストレージ サービス コンポーネントにアクセスするために使用する最高レベルの名前空間を表します。Azure ストレージ サービスの
詳細については、「[
Azure ストレージ サービスの使用](http://msdn.microsoft.com/library/azure/gg433040.aspx)」を参照してください。

ストレージ アカウントを作成するには、
関連付けられているサブスクリプションのサービス管理者または共同管理者であることが必要です。

> [AZURE.NOTE] Azure サービス管理 API を使用してこの操作を実行する方法については、
[ストレージ アカウントの作成に関するリファレンス トピック](http://msdn.microsoft.com/library/windowsazure/hh264518.aspx)を参照してください。

**Azure サブスクリプションのストレージ アカウントを作成するには**

1.  [Azure 管理ポータル]にログインします。
2.  左下隅にある **[新規]** をクリックします。**[新規]** ダイアログ ボックスで、**[データ サービス]** を選択し、**[ストレージ]**、**[簡易作成]**の順にクリックします。

    **[ストレージ アカウントの作成]** ダイアログ ボックスが表示されます。

    ![ストレージ アカウント ][create-new-storage-account] を作成する

4. **[URL]** フィールドにサブドメイン名を入力します。文字数は 3 ～ 24 文字とし、アルファベット小文字と数字を使用できます。

    この値は、対応するサブスクリプションの
    BLOB リソース、キュー リソース、またはテーブル リソースのアドレス指定に使用される URI 内でホスト名になります。BLOB 
    サービスでコンテナー リソースをアドレス指定するには、
    次の形式の URI を使用します。*&lt;StorageAccountLabel&gt;* は、
    **[URL を入力してください]** に入力した値を表します。

    http://*&lt;StorageAcountLabel&gt;*.blob.core.windows.net/*&lt;mycontainer&gt;*

    **重要:**この URL は、ストレージ アカウントの
    URI のサブドメインとなるため、Azure のすべてのホステッド サービスで一意である必要が 
    あります。

	この値は、このストレージ アカウントの名前として、ポータルやプログラムでこのアカウントにアクセスするときにも使用されます。

5.  **[リージョン/アフィニティ グループ]** ボックスの一覧で、ストレージ アカウントのリージョンまたはアフィニティ グループを選択します。使用している他の Windows Azure サービスと同じデータ センターにストレージ サービスを配置する場合は、リージョンの代わりにアフィニティ グループを選択します。これによりパフォーマンスが向上し、送信料金も発生しません。  

    **注:**アフィニティ グループを作成するには、管理ポータルの **[設定]** 領域を開き、**[アフィニティ グループ]** をクリックして、**[新しいアフィニティ グループの追加]** または **[追加]** をクリックします。また、Windows Azure サービス管理 API を使用してアフィニティ グループを作成し管理することもできます。詳細については、「[アフィニティ グループに対する操作]」を参照してください。

6. **[サブスクリプション]** ボックスの一覧で、ストレージ アカウントを使用するサブスクリプションを選択します。
7.  **[ストレージ アカウントの作成]** をクリックします。ストレージ アカウントを作成するプロセスは、完了までに数分かかる場合があります。
8.  ストレージ アカウントが正常に作成されたことを確認するには、アカウントが **[ストレージ]** の一覧に表示され、状態が **[オンライン]** になっていることを確かめます。

<a id="Step2"> </a>
<h2>手順 2:ストレージ アカウントに対する新しい CDN エンドポイントを作成する</h2>

ストレージ アカウントまたはホステッド サービスへの CDN アクセスを有効にすると、
公的にアクセスできるすべてのオブジェクトは CDN エッジ キャッシュを行う資格を持つようになります。CDN 
で現在キャッシュされているオブジェクトを変更する場合、
キャッシュされたコンテンツの生存期間終了時に CDN によりそのコンテンツが更新されるまでは、
新しいコンテンツは CDN を通じて使用できません。

**ストレージ アカウントに対する新しい CDN エンドポイントを作成するには**

1. [Azure 管理ポータル]のナビゲーション ウィンドウで、**[CDN]** をクリックします。

2. リボンで、**[新規]** をクリックします。**[新規]** ダイアログで、**[アプリケーション サービス]**、**[CDN]**、**[簡易作成]** の順に選択します。

3. **[元のドメイン]** ボックスで、前のセクションで作成したストレージ アカウントを、利用可能なストレージ アカウントの一覧から選択します。 

4. **[作成]** ボタンをクリックして、新しいエンドポイントを作成します。

5. エンドポイントが作成されると、サブスクリプションのエンドポイントの一覧に表示されます。一覧には、キャッシュされたコンテンツへのアクセスに使用する URL と元のドメインが表示されます。 

	元のドメインは、CDN がコンテンツをキャッシュする
    場所です。元のドメインは、ストレージ アカウントまたはクラウド サービスのどちらかになります。この例では、ストレージ アカウントが使用されます。ストレージ コンテンツは、指定したキャッシュ制御の設定またはキャッシュ ネットワークの既定のヒューリスティックに従って末端サーバーにキャッシュされます。詳細については、「[BLOB コンテンツの有効期限を管理する方法](http://msdn.microsoft.com/library/gg680306.aspx)」を参照してください。 


    > [AZURE.NOTE] エンドポイント用に作成された構成は、
    すぐには使用できません。CDN ネットワークを通じて伝播する
    登録のために、最大で 60 分かかる場合があります。CDN ドメイン名を
    直ちに使用しようとするユーザーは、CDN を経由してコンテンツを取得できるように
    なるまでは、状態コード 400 (正しくない要求) を受け取ります。

<a id="Step3"> </a>
<h2>手順 3:CDN コンテンツにアクセスする</h2> 

CDN にキャッシュされたコンテンツにアクセスするには、ポータルで提供される CDN URL を使用します。キャッシュされた BLOB のアドレスは、次のようになります。

http://<*CDNNamespace*\>.vo.msecnd.net/<*myPublicContainer*\>/<*BlobName*\>

<a id="Step4"> </a>
<h2>手順 4:CDN からコンテンツを削除する</h2>

Azure コンテンツ配信ネットワーク (CDN) にオブジェクトをキャッシュする必要がなくなった場合は、
次のいずれかの手順を実行できます。

-   Azure BLOB の場合は、パブリック コンテナーから BLOB を削除
    できます。
-   コンテナーをパブリックではなくプライベートに設定できます。詳細については、「[コンテナーと BLOB へのアクセスの制限](http://msdn.microsoft.com/library/dd179354.aspx)」を参照してください。
-   管理ポータルを使用して CDN エンドポイントを無効にしたり削除したり
    できます。
-   オブジェクトの要求に応答しなくなるようにホステッド サービスを変更
    できます。

CDN に既にキャッシュされているオブジェクトは、オブジェクトの有効期限が切れるまで
キャッシュに残ったままとなります。有効期限が切れると、
CDN エンドポイントがまだ有効で、
オブジェクトがまだ匿名アクセス可能かどうかが CDN によって確認されます。そうでない場合、
オブジェクトはキャッシュされなくなります。

コンテンツを即座に消去する機能は、Azure の管理ポータルで現在サポートされていません。コンテンツを即座に消去する必要がある場合は、[Azure サポート](http://azure.microsoft.com/support/options/)にお問い合わせください。 

## その他のリソース

-   [Azure でアフィニティ グループを作成する方法]
-   [方法: Azure サブスクリプションのストレージ アカウントの管理]
-   [サービス管理 API について]
-   [CDN コンテンツをカスタム ドメインにマッピングする方法]

  [ストレージ アカウントを作成する]: http://msdn.microsoft.com/library/windowsazure/hh264518.aspx
  [については、Azure CDN ノードの場所に関するページを参照してください]: http://msdn.microsoft.com/library/windowsazure/gg680302.aspx
  [Azure 管理ポータル]: https://manage.windowsazure.com/
  [お支払いプラン]: /pricing/calculator/?scenario=full
  [カスタム サブドメイン名を登録して Azure の BLOB にアクセスする方法]: http://msdn.microsoft.com/library/windowsazure/ee795179.aspx
  [Azure でアフィニティ グループを作成する方法]: http://msdn.microsoft.com/library/azure/ee460798.aspx
  [Azure CDN の概要]: http://msdn.microsoft.com/library/windowsazure/ff919703.aspx
  [方法: Azure サブスクリプションのストレージ アカウントの管理]: http://msdn.microsoft.com/library/windowsazure/hh531567.aspx
  [サービス管理 API について]: http://msdn.microsoft.com/library/windowsazure/ee460807.aspx
  [CDN コンテンツをカスタム ドメインにマッピングする方法]: http://msdn.microsoft.com/library/windowsazure/gg680307.aspx


[create-new-storage-account]: ./media/cdn/CDN_CreateNewStorageAcct.png
[以前の管理ポータル]: ../../Shared/Media/previous-portal.png

<!--HONumber=49-->