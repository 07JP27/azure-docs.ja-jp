

## メモリ保護更新

Microsoft Azure の更新のクラスの場合、実行中の仮想マシンに何らかの影響があってもお客様にはわかりません。これらの更新の多くは、実行中のインスタンスに干渉することがなく更新可能なコンポーネントまたはサービスを対象にしています。これらの更新の一部は、ホスト オペレーティング システムのプラットフォーム インフラストラクチャに対する更新であり、仮想マシンの完全な再起動を必要とせずに適用できます。

これらの更新は、インプレース ライブ移行 ("メモリ保護" 更新とも呼ばれます) を実現するテクノロジによって達成されます。更新時、仮想マシンは "一時停止" 状態になり、RAM 内のメモリは保護されます。この状態で、基礎となるホスト オペレーティング システムが必要な更新プログラムと修正プログラムを受信します。仮想マシンは、30 秒以内の一時停止で再開されます。再開後、仮想マシンのクロックは自動的に同期されます。

このメカニズムを使用してすべての更新をデプロイできるわけではありませんが、一時停止の期間が短い場合、この方法で更新をデプロイすることにより、仮想マシンへの影響が大幅に軽減されます。

複数インスタンスの更新 (可用性セット内の仮想マシンの場合) が、一度に 1 つの更新ドメインに適用されます。

## 仮想マシンの構成

仮想マシンの構成には、マルチインスタンスと単一インスタンスの 2 種類があります。マルチインスタンス構成では、1 つの可用性セットに似たような仮想マシンが複数配置されます。

マルチインスタンス構成を使用すると、物理コンピューター、電源、ネットワークの冗長性が得られます。アプリケーションの可用性を確保するために、この構成の使用をお勧めします。可用性セットのすべての仮想マシンは、アプリケーションに対する目的が同じである必要があります。

高可用性を達成するための仮想マシン構成の詳細については、「[Virtual Machines の可用性管理](../articles/virtual-machines/virtual-machines-windows-manage-availability.md)」または「[Linux 仮想マシンの可用性管理](../articles/virtual-machines/virtual-machines-linux-manage-availability.md)」を参照してください。

対照的に、可用性セットに配置されていないスタンドアロンの仮想マシンに対しては、単一インスタンス構成が使用されます。これらの仮想マシンは、同一の可用性セットに複数の仮想マシンがデプロイされていることを必要とするサービス レベル アグリーメント (SLA) の対象になりません。

SLA の詳細については、「[サービス レベル アグリーメント](https://azure.microsoft.com/support/legal/sla/)」の「Cloud Services、Virtual Machines、Virtual Network」のセクションを参照してください。


## マルチインスタンス構成の更新

計画的なメンテナンス時に、Azure プラットフォームは最初に仮想マシンのセットを更新します。これらの仮想マシンは、マルチインスタンス構成でホストされているため、これにより、仮想マシンが再起動され、約 15 分間のダウンタイムが発生します。

マルチインスタンス構成の更新では、仮想マシンは、それぞれがセット内の他のマシンと同様の機能を提供していると仮定し、更新プロセス全体にわたって可用性が維持されるように更新されます。

基盤となる Azure プラットフォームにより、可用性セット内の各仮想マシンに更新ドメインと障害ドメインが割り当てられます。各更新ドメインは同じ時間帯に再起動される仮想マシンのグループです。また、各障害ドメインは共通の電源とネットワーク スイッチを使用する仮想マシンのグループです。

更新ドメインと障害ドメインの詳細については、「[冗長性実現のために複数の仮想マシンを可用性セット内に構成する](../articles/virtual-machines/virtual-machines-windows-manage-availability.md#configure-multiple-virtual-machines-in-an-availability-set-for-redundancy)」を参照してください。

更新ドメインが同時にオフラインにならないように、メンテナンスは、更新ドメイン内のそれぞれの仮想マシンをシャットダウンし、ホスト コンピューターに更新を適用した後、仮想マシンを再起動して、次の更新ドメインに移るという流れで進行します。すべての更新ドメインが更新されると、計画的メンテナンス イベントは終了します。

計画的なメンテナンス中に更新ドメインが順番に再起動されるとは限りませんが、一度に 1 つの更新ドメインのみが再起動されます。現在、Azure では、マルチインスタンス構成の仮想マシンの計画的メンテナンスが行われる 1 週間前に通知されます。

仮想マシンが復元されると、Windows イベント ビューアーに次のような情報が表示される場合があります。

<!--Image reference-->
![][image2]

ビューアーを使用して、Azure ポータル、Azure PowerShell、または Azure CLI を使ってマルチインスタンス構成で構成されている仮想マシンを確認します。たとえば、マルチインスタンス構成の仮想マシンを確認するには、仮想マシン参照ダイアログに追加された [可用性セット] 列を含む仮想マシンの一覧を参照します。次の例では、仮想マシン Example-VM1 と Example-VM2 がマルチインスタンス構成です。

<!--Image reference-->
![][image4]

## 単一インスタンス構成の更新

マルチインスタンス構成の更新完了後に、Azure は単一インスタンス構成の更新を実行します。この更新によって、可用性セットで実行していない仮想マシンも再起動されます。

可用性セットで 1 つのインスタンスしか実行していなくても、Azure プラットフォームはそのインスタンスをマルチインスタンス構成の更新として扱います。

単一インスタンス構成の仮想マシンは、仮想マシンをシャットダウンし、ホスト コンピューターに更新を適用した後、仮想マシンを再起動することで更新されます。このとき、約 15 分間ダウンします。こうした更新は、1 つのリージョンの 1 つのメンテナンス期間に含まれるすべての仮想マシンに対して実行されます。

この計画的メンテナンス イベントは、この種の仮想マシン構成を使用するアプリケーションの可用性に影響を及ぼします。Azure では、単一インスタンス構成内の仮想マシンに対する計画的なメンテナンスについて、1 週間前に通知します。

### 電子メール通知

単一インスタンスとマルチインスタンスの仮想マシンの構成に限り、Azure では計画的なメンテナンスが近づいていることを注意喚起するために電子メールを事前に送信します (1 週間前)。この電子メールは、サブスクリプションに設定されているサービス管理者と共同管理者の電子メール アカウントに送信されます。この電子メールの例を次に示します。

<!--Image reference-->
![][image1]

## リージョンのペア

メンテナンスでは、リージョン ペアの一方のリージョンの仮想マシン インスタンスだけが更新されます。たとえば、米国中北部の Virtual Machines が更新されるとき、同時に米国中南部の Virtual Machines が更新されることはありません。リージョン間のフェールオーバーまたは負荷分散が可能なように、時間をずらしてスケジュールされます。ただし、北ヨーロッパなどのその他のリージョンは、米国東部と同時にメンテナンスされる可能性があります。

現在のリージョン ペアについては、次の表を参照してください。

リージョン 1 | リージョン 2
:----- | ------:
米国中北部 | 米国中南部
米国東部 | 米国西部
米国東部 2 | 米国中央部
北ヨーロッパ | 西ヨーロッパ
東南アジア | 東アジア
中国東部 | 中国北部
東日本 | 西日本
ブラジル南部 | 米国中南部
オーストラリア南東部 | オーストラリア東部
米国政府アイオワ州 | 米国政府バージニア州

<!--Anchors-->
[image1]: ./media/virtual-machines-common-planned-maintenance/vmplanned1.png
[image2]: ./media/virtual-machines-common-planned-maintenance/EventViewerPostReboot.png
[image3]: ./media/virtual-machines-planned-maintenance/RegionPairs.PNG
[image4]: ./media/virtual-machines-common-planned-maintenance/AvailabilitySetExample.png


<!--Link references-->
[Virtual Machines Manage Availability]: ../articles/virtual-machines/virtual-machines-windows-hero-tutorial.md

[Understand planned versus unplanned maintenance]: ../articles/virtual-machines/virtual-machines-windows-manage-availability.md#Understand-planned-versus-unplanned-maintenance/

<!---HONumber=AcomDC_0330_2016------>
