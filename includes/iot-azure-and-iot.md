# Azure とモノのインターネット

Microsoft Azure とモノのインターネット (IoT) にようこそこの記事では、Azure のサービスを使用してデプロイする IoT ソリューションの一般的な特性を記述する IoT ソリューション アーキテクチャについて説明します。IoT ソリューションでは、デバイス間の安全な双方向通信、場合によっては何百万にもなる番号付け、および自動化された予測分析を使用してデバイスからクラウドへのイベント ストリームから実態を明らかにするといったことを行うソリューション バックエンドが必要です。

Azure IoT Hub は、Azure のサービスを使用してこの IoT ソリューション アーキテクチャを実装する場合の主要な構成要素であり、IoT Suite は、特定の IoT シナリオに対して、このアーキテクチャの完全なエンドツーエンドの実装を提供します。たとえば、 *リモート監視*ソリューションでは、自動販売機などのデバイスの状態を監視することができ、 *予測メンテナンス*ではリモートのポンプ場にあるポンプなど、デバイスのメンテナンスのニーズを予測でき、予定外のダウンタイムを回避しやすくなります。

## IoT ソリューションのアーキテクチャ

次の図は、一般的な IoT ソリューションのアーキテクチャを示しています。特定の Azure サービス名は含まれずに、一般的な IoT ソリューションのアーキテクチャの主な要素が記されていることに注意してください。このアーキテクチャでは、IoT デバイスはクラウド ゲートウェイに送信するデータを収集します。クラウド ゲートウェイは、データを他のバックエンド サービスが処理できるようにします。データはバックエンド サービスから他の基幹業務アプリケーション、またはダッシュ ボードやその他のプレゼンテーション デバイスを通じて人間のオペレーターに送られます。

![IoT ソリューションのアーキテクチャ][img-solution-architecture]

> [AZURE.NOTE] IoT アーキテクチャの詳細については、「[Microsoft Azure IoT Reference Architecture (Microsoft Azure IoT リファレンスアーテクチャ)][lnk-refarch]」を参照してください。

### デバイスの接続性

この IoT ソリューション アーキテクチャでは、デバイスが、テレメトリ (ポンプ場のセンサー測定値など) を格納と処理のためにクラウド エンドポイントに送信します。予測メンテナンスのシナリオでは、バック エンドでセンサー データのストリームを使用して、特定のポンプのメンテナンスが必要な時期を判断することがあります。デバイスは、クラウドからデバイスへのコマンドを受信し、クラウド エンドポイントからのメッセージを読み取り、コマンドに応答することもできます。たとえば、予測メンテナンスのシナリオでは、メンテナンス エンジニアが到着してすぐにメンテナンスを開始できるように、ソリューションのバック エンドでポンプ場のその他のポンプにコマンドを送信してメンテナンスの開始予定直前にフローの再ルーティングを開始することがあります。

IoT プロジェクトが直面する最も大きな課題の 1 つは、ソリューション バック エンドにデバイスを確実かつ安全に接続して、デバイスでテレメトリを送信し、コマンドを取得する方法です。IoT デバイスには、ブラウザーやモバイル アプリなどの他のクライアントとは異なる特性があります。IoT デバイスの特性は次のとおりです。

- 多くの場合、人間が操作することのない組み込みシステムです。
- 物理アクセスに大きなコストがかかる離れた場所にデプロイされている場合があります。
- ソリューション バック エンド経由でしか到達できない場合があります。デバイスとやり取りする他の方法はありません。
- 電源や処理リソースが限られている場合があります。
- ネットワーク接続が断続的に切れたり、遅かったり、高コストである場合があります。
- 専用、カスタム、または業界固有のアプリケーション プロトコルを使用することが必要な場合があります。
- 一般的なハードウェアおよびソフトウェア プラットフォームを多数使用して作成できます。

上記の要件に加え、IoT ソリューションはスケール、セキュリティ、および信頼性を提供する必要もあります。そのため、一連の接続要件は、Web コンテナーやメッセージング ブローカーなどの従来のテクノロジを使用して実装するのが難しく、時間がかかります。Azure IoT Hub と IoT Device SDK を利用すると、これらの要件を満たすソリューションの実装が簡単になります。

デバイスは、クラウド ゲートウェイ エンドポイントと直接通信できます。または、クラウド ゲートウェイがサポートする通信プロトコルをデバイスが使用できない場合は、プロトコル変換を実行する中間ゲートウェイ ([IoT Hub プロトコル ゲートウェイ][lnk-protocol-gateway]など) を介して接続できます。たとえば、Common Industrial Protocol (CIP) から AMQPS などです。

### データ処理と分析

クラウドでは、IoT ソリューション バックエンドでソリューションのデータ処理のほとんど (具体的にはテレメトリのフィルター処理と集計、テレメトリの他のサービスへのルーティング) が行われます。IoT ソリューション バックエンドでは以下が行われます。

- デバイスから大量のテレメトリを受信し、そのデータを処理および格納する方法を決定します。 
- クラウドから特定のデバイスにコマンドを送信できることもあります。
- デバイスをプロビジョニングし、インフラストラクチャへの接続が許可されるデバイスを制御できるようにする、デバイス登録機能を提供します。
- デバイスの状態を追跡し、そのアクティビティを監視できます。

予測メンテナンスのシナリオでは、特定のポンプでメンテナンスが予定されていることを示すパターンを見つけるために、ソリューションのバック エンドで、テレメトリ データを受信すると同時に、パターンを識別してテレメトリを分析するために使用する履歴のテレメトリ データを格納します。

IoT ソリューションには、自動フィードバックのループが含まれる場合があります。たとえば、バックエンドの分析モジュールは、テレメトリから特定のデバイスの温度が通常の運用レベルを超過していることを判別し、そのデバイスにコマンドを送信して是正措置を実行するよう指示します。

### プレゼンテーションおよびビジネスの接続性

プレゼンテーションおよびビジネスの接続性レイヤーでは、エンド ユーザーが IoT ソリューションおよびデバイスとやり取りできます。このレイヤーによって、ユーザーが、デバイスから収集されたデータを表示して分析することができます。これらのビューは、履歴データとほぼリアルタイムのデータの両方を表示できる、ダッシュボードまたは BI レポートの形式をとることができます。たとえば、オペレーターは、特定のポンプ場の状態を確認し、システムによって生成されるアラートを参照できます。また、このレイヤーによって、IoT ソリューション バックエンドと既存の基幹業務アプリケーションの統合が可能になり、企業のビジネス プロセスやワークフローと結びつけることができます。たとえば、予測メンテナンス ソリューションは、ソリューションでメンテナンスを必要とするポンプ が特定されたときに、エンジニアのポンプ場訪問を予約するスケジューリング システムと統合することができます。

![IoT ソリューションのダッシュボード][img-dashboard]

[img-solution-architecture]: ./media/iot-azure-and-iot/iot-reference-architecture.png
[img-dashboard]: ./media/iot-azure-and-iot/iot-suite.png

[lnk-machinelearning]: http://azure.microsoft.com/services/machine-learning/
[Azure IoT Suite]: http://azure.microsoft.com/solutions/iot
[lnk-protocol-gateway]: ../articles/iot-hub/iot-hub-protocol-gateway.md
[lnk-refarch]: http://download.microsoft.com/download/A/4/D/A4DAD253-BC21-41D3-B9D9-87D2AE6F0719/Microsoft_Azure_IoT_Reference_Architecture.pdf

<!---HONumber=AcomDC_0413_2016-->