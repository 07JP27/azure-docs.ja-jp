# Azure のネットワーク

Azure のアプリケーションおよびデータに最も簡単に接続する方法は、通常のインターネット接続を使用する方法です。ただし、この簡単なソリューションが常に最良のアプローチであるとは限りません。Azure には、Azure データセンターにユーザー接続するためのテクノロジも用意されています。この記事では、これらのテクノロジを見ていきます。

## 目次

-   [Azure 仮想ネットワーク][Azure 仮想ネットワーク]
-   [Azure の Traffic Manager][Azure の Traffic Manager]

<a name="Vnet"></a>

## Azure 仮想ネットワーク

Azure を使用すると、Microsoft データセンターで実行可能な仮想マシン (VM) を作成できます。自分の会社で、従業員が使用するエンタープライズ アプリケーションやその他のソフトウェアを実行するために、このような VM を使用する場合を考えてみましょう。たとえば、SharePoint ファームをクラウドに作成したり、在庫管理アプリケーションを実行したりする必要があるかもしれません。また、社内のユーザーができるだけ仕事をしやすいように、これらのアプリケーションには自社のデータセンターで実行されているかのようにアクセスできる必要があります。

このような種類の問題には、仮想プライベート ネットワーク (VPN) を作成するという標準的なソリューションがあります。今日では、あらゆる規模の組織でこのソリューションが使用され、たとえば、支社のコンピューターを本社データセンターにリンクするために使用されています。これと同じアプローチを、図 1 で示すように、Azure の VM で実現することもできます。

<a name="Fig1"></a>

![01\_Networking][01\_Networking]

**図 1: Azure の仮想ネットワークでは、内部設置型データセンターに接続されている仮想ネットワークをクラウド内に作成できる。**

図で示すように、Azure の Virtual Network を使用すると、Azure データセンター内の *"仮想ネットワーク" または "VNET"*と呼ばれる VM のグループの周囲に論理境界を作成できます。これにより、この VNET とローカル ネットワークの間の IPsec 接続を確立できます。VNET 内の VM は、Azure Virtual Machines または Azure Cloud Services、あるいはその両方を使用して作成できます。つまり、これらの VM は、Azure のサービスとしてのインフラストラクチャ (IaaS) テクノロジまたはサービスとしてのプラットフォーム (PaaS) テクノロジを使用して作成できます。
どちらを選ぶ場合でも、IPsec 接続を作成するには、ローカル ネットワークに接続された特殊なハードウェアである VPN ゲートウェイ デバイスが必要になります。また、ネットワーク管理者による作業も必要です。この接続が確立すると、VNET で実行されている Azure VM は、単純に組織のネットワークの一部として扱うことができるようになります。

[図 1][図 1] に示すように、Azure VM の IP アドレスは、自社ネットワークで使用しているものと同じ IP アドレス空間から割り当てます。ここで示されているプライベート IP アドレスを使用するシナリオでは、クラウド内の VM は、単にもう 1 つの IP サブネットです。ローカル ネットワーク上で実行中のソフトウェアは、従来の VPN で使用している場合と同様に、これらの VM がまるでローカルであるかのように認識します。さらに、この接続は IP レベルで確立されるため、両側の仮想マシンと物理マシンでは、どのようなオペレーティング システムが実行されている可能性もある点に注意が必要です。Windows Server または Linux を実行中の Azure VM は、Windows、Linux、またはその他のシステムを実行している内部設置型のマシンと対話できます。また、クラウド VM およびその VM に含まれるアプリケーションを管理するために、System Center などの広く使用されている管理ツールを使用することもできます。

Azure の Virtual Network の使用は、さまざまな状況で役立ちます。既に説明したとおり、このアプローチでは、エンタープライズ ユーザーがクラウド アプリケーションに簡単にアクセスできます。この使いやすさの重要な側面として、Azure VM を既存の内部設置型 Active Directory ドメインの一部にすることで、実行するアプリケーションへのシングル サインオンをユーザーに提供できることが挙げられます。また、必要に応じて、クラウド内に Active Directory ドメインを作成し、このドメインを内部設置型ネットワークに接続することもできます。

Azure データセンターに VNET を作成することで、オンデマンド リソースの大規模なプールに効率的にアクセスできます。VM はオンデマンドで作成し、使用時間分の料金を支払い、不要になったら削除できます。削除後は課金されません。これは、新しいソフトウェアを作成中の開発チームなどで、事前に構成済みのマシンにすばやくアクセスする必要があるシナリオに便利です。ローカル管理者が必要なリソースを設定するのを待つのではなく、自分達でパブリック クラウド内にこれらのリソースを作成できます。

仮想ネットワークでは Azure VM が内部設置型のリソースに対してローカルとして識別されますが、その逆も同じです。ローカル ネットワークで実行中のソフトウェアは、Azure VNET で実行中のアプリケーションに対してローカルとして識別されます。たとえば、クラウドで運用した方が費用を抑えられるため、既存の内部設置型アプリケーションを Azure に移行する場合を考えてみます。ここで、アプリケーションが使用するデータが、法的に、内部設置型での保存を規定されている場合はどうでしょうか。このような状況でも、仮想ネットワークを使用することで、クラウド アプリケーションは内部設置型データベース システムがローカルであるように認識するため、システムへのアクセスは容易です。どのようなシナリオでも、結果は同じです。Azure を自社のデータセンターの延長として扱うことができます。

<a name="TrafficMngr"></a>

## Azure の Traffic Manager

Azure アプリケーションの作成に成功したとします。そのアプリケーションは、世界中のさまざまな国の多くの人々によって使用されます。これはすばらしいことですが、多くの場合そうであるように、成功は新しい問題を引き起こします。たとえば、アプリケーションが、世界に散在する複数の Azure データセンターで実行される可能性が高くなります。常に最適なユーザー エクスペリエンスを提供できるように、これらのデータセンター間でインテリジェントにユーザー要求のトラフィックを転送するにはどうしたらよいでしょうか。

Azure の Traffic Manager は、このような問題を解決するためにあります。図 2 に、そのしくみを示します。

<a name="Fig3"></a>

![03\_TrafficManager][03\_TrafficManager]

**図 2: Azure Traffic Manager が、異なる Azure データセンターで実行されているアプリケーションのインスタンス全体にいるユーザーからの要求をインテリジェントに管理する。**

この例では、お客様のアプリケーションは、アメリカ合衆国内に 2 つ、ヨーロッパに 1 つ、アジアに 1 つある 4 つのデータセンターに散在する VM で実行されています。ベルリンのユーザーがアプリケーションにアクセスする場合を考えてみましょう。トラフィック マネージャーを使用している場合は次のようになります。

通常どおり、ユーザーのシステムは、アプリケーションの DNS 名を検索します (ステップ 1)。このクエリは、Azure DNS システムに転送されます (ステップ 2)。ここで、このアプリケーションに対する Traffic Manager ポリシーが検索されます。各ポリシーは、グラフィック インターフェイスまたは REST API を使用して個別の Azure アプリケーションの所有者によって作成されています。どのように作成された場合でも、ポリシーでは次の 3 つの負荷分散オプションのいずれかが指定されています。

-   **パフォーマンス:** ユーザー システムから待機時間が最も短いデータセンターにすべての要求が送信されます。
-   **フェールオーバー:** すべての要求が、このポリシーの作成者によって指定されたデータセンターが使用できない場合を除き、そのデータセンターに送信されます。ポリシーの作成者によって定義された優先順位に基づいて、他のデータセンターに要求が転送されます。
-   **ラウンド ロビン:** すべての要求が、アプリケーションを実行中のすべてのデータセンターで均等に配分されます。

適切なポリシーがある場合、トラフィック マネージャーは、3 つのオプションのうちいずれが指定されているかによって、要求をどのデータセンターに送信するかを判断します (ステップ 3)。選択したデータセンターの場所をトラフィック マネージャーがユーザーに返し (ステップ 4)、アプリケーションのそのインスタンスにユーザーがアクセスします (ステップ 5)。

このしくみが機能するには、各データセンターで実行中のアプリケーション インスタンスをトラフィック マネージャーが把握している必要があります。これを可能にするため、トラフィック マネージャーは、HTTP GET を使用してアプリケーションの各コピーを定期的に ping し、応答を受信したかどうかを記録しています。アプリケーションのインスタンスが応答を停止した場合、Traffic Manager は、ping への応答が再開されるまで、そのインスタンスへのユーザーの転送を停止します。

すべてのアプリケーションが、トラフィック マネージャーを必要とするほど大規模またはグローバルであるわけではありませんが、該当するアプリケーションに対しては、Traffic Manager は非常に役立つサービスです。

  [Azure 仮想ネットワーク]: #Vnet
  [Azure の Traffic Manager]: #TrafficMngr
  [01\_Networking]: ./media/azure-networking/Networking_01Networking.png
  [図 1]: #Fig1
  [03\_TrafficManager]: ./media/azure-networking/Networking_03TrafficManager.png
