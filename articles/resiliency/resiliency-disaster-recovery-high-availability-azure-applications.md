---
title: "Azure アプリケーションの障害復旧と高可用性 | Microsoft Docs"
description: "Microsoft Azure で可用性が高く、障害復旧機能を備えたアプリケーションを設計し、構築するための方法に関する技術的概要と詳細"
services: 
documentationcenter: na
author: adamglick
manager: saladki
editor: 
ms.assetid: e13d5f49-2b91-44ba-829a-1e0f1fceaae8
ms.service: resiliency
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/18/2016
ms.author: aglick
translationtype: Human Translation
ms.sourcegitcommit: 0c23ee550d8ac88994e8c7c54a33d348ffc24372
ms.openlocfilehash: ee3e7103bd647c2d8651ec912fbb764a342781e2


---
# <a name="disaster-recovery-and-high-availability-for-applications-built-on-microsoft-azure"></a>Microsoft Azure 上に構築されたアプリケーションの障害復旧と高可用性
## <a name="introduction"></a>はじめに
この記事では、Azure で実行されるアプリケーションの高可用性について説明します。 高可用性の全体的方針には、障害復旧の領域も含まれています。 クラウドのエラーや障害に備えるには、障害を短時間で見分ける能力が必要です。 その後、アプリケーションのダウンタイムの許容範囲に一致する方針を導入します。 また、復元したときにデータが失われていても、どの程度であれば業務アプリケーションに支障がないかを考慮する必要があります。

ほとんどの会社は、大規模な障害が一時的に発生した場合に対する備えができていると答えます。 しかしながら、その問いに答える前に考えてください。あなたの会社はそのような障害をリハーサルしますか。 データベースの復元を試し、正しいプロセスが配置されていることを確認しますか。 答えはおそらく「いいえ」でしょう。 適切な障害復旧を配置するには、プロセスを実装するためにさまざまな事項を計画し、設計する必要があります。 セキュリティなど、他の非機能的要件の多くと同様に、障害復旧が前もって分析されたり、必要な時間が割り当てられたりすることはほとんどありません。 また、ほとんどの会社は、地理的に分散しており、使われていないキャパシティのあるリージョンに対して予算を用意しません。 結果的に、ミッション クリティカルなアプリケーションであっても正式な障害復旧計画から除外されることが多々あります。

Azure のようなクラウド プラットフォームでは、リージョンが世界中に分散されます。 クラウド プラットフォームにはまた、可用性と多様な障害復旧シナリオをサポートする機能があります。 障害に耐えるシステムを構築するとき、すべてのミッション クリティカルなクラウド アプリケーションを十分に考慮することができます。 Azure では、そのサービスの多くに回復性と障害復旧が組み込まれています。 これらのプラットフォーム機能を慎重に研究し、アプリケーション固有の方針で補完する必要があります。

この記事では、障害に耐える Azure デプロイを実現するために必要なアーキテクチャ上の手順について説明します。 これを読めば、さらに規模の大きい事業継続プロセスを実装できます。 事業継続計画は、逆境の下で業務を継続するためのロードマップです。 逆境とは、技術的な障害 (サービスの停止) や自然災害 (嵐や停電) を意味します。 アプリケーションの耐障害性は、大きな障害復旧プロセスの一部に過ぎません。大きな障害復旧プロセスの詳細は、NIST 文書の「[Contingency Planning Guide for Information Technology Systems (IT システムのための緊急時対応計画ガイド)](https://www.fismacenter.com/sp800-34.pdf)」にあります。

次のセクションでは、さまざまなレベルの障害、それに対処するための技法、その技法を支えるアーキテクチャについて説明します。 この情報からあなたが構築する障害復旧のプロセスと手順が見えてきます。適切かつ効率的な方法で障害復旧方針を実践できます。

## <a name="characteristics-of-resilient-cloud-applications"></a>耐障害性クラウド アプリケーションの特性
アプリケーションが適切に設計されると、戦術レベルで機能的な障害に耐えることができます。また、リージョン レベルでシステム全体の戦術的な障害に耐えることができます。 次のセクションでは、文書全体で使用され、耐障害性クラウド サービスのさまざまな側面を表す用語を定義します。

### <a name="high-availability"></a>高可用性
可用性の高いクラウド アプリケーションは、クラウド プラットフォームが提供する管理対象サービスなど、依存関係の機能停止を緩和する方針を実行します。 クラウド プラットフォームの機能が停止しても、高い可用性により、システムの機能的特性と非機能的特性が維持されます。 これについては、チャネル 9 の動画シリーズ「 [Failsafe: Guidance for Resilient Cloud Architectures (フェールセーフ: 回復力のあるクラウド アーキテクチャに関するガイダンス)](https://channel9.msdn.com/Series/FailSafe)」で詳しく取り上げられています。

アプリケーションを実装するとき、機能停止の可能性を考慮する必要があります。 また、実装戦略に移る前に、ビジネスの観点から機能停止がアプリケーションに与える影響を考慮します。 ビジネスに与える影響と危険な状態になる可能性を十分に考慮しないと、余計に高額な実装になることがあります。

自動車を例に高可用性について考えてください。 部品の質が高く、工学技術に優れていても、時折の失敗を防ぐことはできません。 たとえば、車はパンクしても走り続けますが、性能を落として走ります。 パンクの可能性を考慮して設計していれば、修理工場に到着するまでリムの薄いスペアタイヤを使用することもできます。 そのスペアタイヤでは速く走れませんが、タイヤを交換するまで車を走らせることができます。 同様に、機能停止を予測してクラウド サービスを計画すれば、比較的軽い問題でアプリケーション全体を停止させることはありません。 性能を落としてクラウド サービスを実行しなければならない場合も、車と同様です。

可用性の高いクラウド サービスには重要な特徴がいくつかあります。可用性、拡張性、耐障害性です。 これらの特性は相互に関係するものですが、それぞれの特性とそれがソリューション全体の可用性に及ぼす影響を理解することが重要です。

### <a name="availability"></a>可用性
アプリケーションの可用性には、その基礎となるインフラストラクチャと従属サービスの可用性が関与します。 可用性のあるアプリケーションであれば、1 箇所が故障しても、冗長性と耐障害性でそれを切り抜けます。 範囲を広げて、Azure の可用性について考えた場合、プラットフォームの効果的な可用性という概念を理解することが重要です。 効果的な可用性では、従属サービスごとのサービス レベル アグリーメント (SLA) とシステムの総合可用性の累積的効果が考慮されます。

システムの可用性は、システムの運用時間枠に対する割合で測定されます。 たとえば、Azure の Web または worker ロールの少なくとも 2 つのインスタンスの可用性 SLA は 99.95% (100% 中) です。 これらのロールで実行されているサービスの性能や機能は測定されません。 ただし、クラウド サービスの効果的な可用性は、他の従属サービスのさまざまな SLA の影響も受けます。 システム内の可動部品が多ければ、エンド ユーザーの可用性要件をアプリケーションの耐障害性で満たすために必要な考慮事項がそれだけ多くなります。

Azure サービス (Compute、Azure SQL Database、Azure Storage) を使用する Azure サービスの次の SLA を考慮します。

| Azure サービス | SLA | 月 (30 日) の潜在的なダウンタイム (分) |
|:--- |:--- |:---:|
| 計算 |99.95% |21.6 分 |
| SQL Database |99.99% |4.3 分 |
| Storage |99.90% |43.2 分 |

異なる時間帯に停止する可能性のあるあらゆるサービスを対象に計画する必要があります。 この単純な例では、アプリケーションに潜在的に予想される月あたりのダウンタイム合計は 108 分です。 1 か月を 30 日とすると、総計は 43,200 分になります。 108 分は月 30 日の合計 (43,200 分) の 25% です。 クラウド サービスの効果的な可用性は 99.75% ということになります。

ただし、この記事で紹介する可用性手法を採用すれば、この数字を改善できます。 たとえば、SQL Database が停止しても実行を続けるアプリケーションを設計すれば、108 分のダウンタイムをなくすることも可能です。 つまり、性能を落としても実行を続けるアプリケーションを設計できるということです。それには、ビジネス上の要件を考慮する必要もあります。 Azure SLA の完全な一覧については、「[サービス レベル アグリーメント](https://azure.microsoft.com/support/legal/sla/)」を参照してください。

### <a name="scalability"></a>拡張性
拡張性は可用性に直接影響を与えます。 負荷が増えたためにアプリケーションが停止し、利用できなくなることがあります。 スケーラブルなアプリケーションは要求の増加に対応し、時間枠を常に許容範囲に収めます。 システムがスケーラブルであれば、水平または垂直に拡張でき、負荷の増加に対処したり、一貫した性能を維持したりすることができます。 基本的に、水平拡張とは、同じサイズ (プロセッサ、メモリ、帯域幅) のコンピューターを追加することであり、垂直拡張とは、既存コンピューターのサイズを増やすことです。 Azure では、コンピューティングにさまざまなコンピューター サイズを選択し、垂直方向に拡張できます。 ただし、コンピューターのサイズを変更する場合、再デプロイが必要になります。 そのため、水平方向の拡張で、最も柔軟なソリューションを設計できます。 Web や worker ロールの実行インスタンスは簡単に増やせるので、コンピューティングとしては正しい考えです。 増やしたインスタンスが、Azure Web ポータル、PowerShell スクリプト、コードを介し、増えたトラフィックを処理します。 これは特定の監視対象指標に基づいて決定します。 このシナリオでは、負荷の下で、ユーザー パフォーマンスまたは指標に目立った低下はありません。 一般的に、Web と worker ロールは状態を外部に保存します。 それにより、負荷が柔軟に分散され、インスタンス数の変更がグレースフルに (性能を落とすことなく) 処理されます。 水平方向の拡張は、垂直方向の拡張のための階層を提供しない Azure Storage などのサービスに適しています。

クラウド デプロイはスケール ユニットの集まりとして見るべきです。 それにより、アプリケーションはエンド ユーザーのスループット ニーズに対して柔軟にサービスを提供できます。 スケール ユニットは、Web とアプリケーション サーバーのレベルで簡単に視覚化できます。 それは、Azure が Web ロールと worker ロールを介してステートレス コンピューティング ノードを提供するためです。 コンピューティングのスケール ユニットをデプロイに追加しても、アプリケーションの状態管理に副作用を及ぼすことはありません。コンピューティングのスケール ユニットがステートレスであるためです。 ストレージのスケール ユニットは、(構造化または非構造化) データのパーティション管理を担当します。 ストレージのスケール ユニットには、たとえば、Azure テーブル パーティション、Azure BLOB コンテナー、Azure SQL Database があります。 複数の Azure Storage アカウントを使用しても、アプリケーションの拡張性に直接影響を与えます。 複数のストレージ スケール ユニットを組み込むには、非常にスケーラブルなクラウド サービスを設計する必要があります。 たとえば、アプリケーションでリレーショナル データを使用する場合、複数の SQL データベースをまたいでデータをパーティション分割します。 それにより、ストレージは柔軟なコンピューティング スケール ユニット モデルに対応できます。 同様に、Azure Storage で、コンピューティング層のスループット ニーズを満たす設計を必要とするデータ パーティション分割スキームが可能になります。 スケーラブルなクラウド サービスの設計に関するベスト プラクティスの一覧については、[Azure Cloud Services で大規模なサービスを設計するためのベスト プラクティス](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/)に関するブログを参照してください。

### <a name="fault-tolerance"></a>フォールト トレランス
アプリケーションでは、あらゆる従属クラウドの機能がある時点で停止することがあり、また、停止するものであると想定する必要があります。 フォールト トレラントなアプリケーションは、構成要素の障害を検出し、それを回避し、動作を続け、特定の時間枠内で正しい結果を返します。 一時的なエラー状態に関しては、フォールト トレラントなシステムは再試行ポリシーを採用します。 障害がもっと深刻な場合、アプリケーションは問題を検出し、修復されるまで、代替ハードウェアまたは緊急時対応策にフェールオーバーします。 信頼性の高いアプリケーションでは、1 つまたは複数のパーツに問題が発生しても、適切に処理し、運用を続けます。 フォールト トレラントなアプリケーションでは、冗長性、レプリケーション、機能低下などの設計戦略を 1 つまたは複数採用できます。

## <a name="disaster-recovery"></a>障害復旧
従属サービスや基礎インフラストラクチャのシステムが停止すると、クラウド デプロイが機能しなくなることがあります。 そのような事態が発生すると、ビジネス継続計画が障害復旧プロセスを始動させます。 このプロセスには、通常、利用可能なリージョンでアプリケーションを再有効化する目的で、運用担当者と自動プロシージャの両方が関与します。 アプリケーションのユーザー、データ、サービスを新しいリージョンに転送する必要があります。 バックアップ メディアやレプリケーションを利用することもあります。

前のセクションで、スペアタイヤを利用してパンクに対応するという車の例で高可用性を説明しました。 それとは対照的に、障害復旧とは、車が事故を起こし、動かなくなった後の手順に例えられます。 事故を起こしてしまった場合、最良の解決策は、効率的な方法で別の車を手配することです。旅行代理店や知人に電話するなどです。 このシナリオでは、帰途に就くまでだいぶ時間がかかりそうです。 車を修理し、元の状態に戻す過程もまた、より複雑になります。 同様に、別のリージョンへの障害復旧は複雑な作業であり、一般的に、いくらかのダウンタイムが発生し、データが失われることもあります。 障害復旧方針をよりよく理解し、評価するためには、2 つの項目を定義することが重要です。目標復旧時間 (RTO) と目標復旧時点 (RPO) です。

### <a name="recovery-time-objective"></a>目標復旧時間
RTO とは、アプリケーションの機能を復旧させるために割り当てられる最大時間です。 これはビジネス要件に基づき、アプリケーションの重要性に関連します。 重大なビジネス アプリケーションの場合、RTO が低くなります。

### <a name="recovery-point-objective"></a>目標復旧時点
RPO とは、復旧プロセスに起因して失われたデータの許容時間枠です。 たとえば、RPO が 1 時間の場合、少なくとも 1 時間おきにデータを完全にバックアップまたは複製する必要があります。 代替リージョンでアプリケーションを起動したとき、最大 1 時間分のデータがバックアップされていなくてもそれは許容されます。 RTO と同様に、重大なアプリケーションの場合、目標とする RPO を低めに設定します。

## <a name="checklist"></a>チェック リスト
この記事 (と Azure アプリケーションの[高可用性](resiliency-high-availability-azure-applications.md)と[障害復旧](resiliency-disaster-recovery-azure-applications.md)に関する記事) で取り上げた要点を整理しましょう。 このまとめは、可用性と障害復旧を自分で計画するとき、考慮事項のチェックリストとして利用できます。 ソリューションを真剣に成功させたいお客様にとって役立つベスト プラクティスになっています。

1. アプリケーションごとにリスクを評価します。アプリケーションごとに要件が異なるためです。 一部のアプリケーションは他のアプリケーションより重要であり、障害復旧の設計に追加費用がかかっても当然と見なされます。
2. この情報を使用し、アプリケーションごとの RTO と RPO を定義してください。
3. 障害に備えて設計するとき、アプリケーションのアーキテクチャから始めます。
4. コスト、複雑性、リスクをバランス良く考慮しながら、高可用性のベスト プラクティスを実行します。
5. 障害回復の計画とプロセスを実装します。
   * クラウドの完全停止に至るまで、モジュール レベル全体で障害を考慮します。
   * すべての参照データとトランザクション データのバックアップ方針を確立します。
   * 複数サイトの障害復旧アーキテクチャを選択します。
6. 障害復旧のプロセス、自動化、試験に特定の所有者を定義します。 その所有者がプロセス全体を管理し、所有します。
7. 簡単に再現できるようにプロセスを文書に記録します。 所有者は 1 人ですが、複数の人間が緊急時のプロセスを理解し、実行できなければなりません。
8. プロセスを実行できるようにスタッフをトレーニングします。
9. プロセスのトレーニングと検証の両方に通常の障害シミュレーションを利用します。

## <a name="summary"></a>概要
Azure 内でハードウェアまたはアプリケーションに障害が発生したとき、それに対処するための手法と方針は、オンプレミス システムで障害が発生したときのそれとは異なります。 その主な理由は、Azure リージョン全体で分散され、個別のサービスとして管理されているインフラストラクチャに対する依存性がクラウド ソリューションの場合は通常大きいためです。 高可用性手法を利用し、部分的な障害に対処する必要があります。 災害など、もっと深刻な障害に対処するには、障害復旧方針を利用します。

Azure はさまざまな障害を検出し、処理しますが、アプリケーション固有の方針を必要とする障害も多くあります。 アプリケーション、サービス、データの障害に対して前もって備え、対応する必要があります。

アプリケーションの可用性と障害復旧の計画を作成するとき、アプリケーションの障害が業務に与える影響を考慮します。 大惨事の後で重大なシステムを復旧するためのプロセス、ポリシー、プロシージャの定義には、時間、計画、専心が求められます。 計画を立てても、それで終わりではありません。 アプリケーション ポートフォリオ、ビジネス ニーズ、利用可能な手法に基づき、計画を定期的に分析し、試験し、継続的に改善する必要があります。 Azure は、新しい機能を提供し、障害に耐える堅牢なアプリケーションを作成するという新たな課題を生み出しています。

## <a name="additional-resources"></a>その他のリソース
[Microsoft Azure 上に構築されたアプリケーションの高可用性](resiliency-high-availability-azure-applications.md)

[Microsoft Azure 上に構築されたアプリケーションの障害復旧](resiliency-disaster-recovery-azure-applications.md)

[Azure の回復性技術ガイダンス](resiliency-technical-guidance.md)

[概要: SQL Database を使用したクラウド ビジネス継続性とデータベース障害復旧](../sql-database/sql-database-business-continuity.md)

[Azure 仮想マシンにおける SQL Server の高可用性と障害復旧](../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md)

[フェールセーフ: 回復力のあるクラウド アーキテクチャに関するガイダンス](https://channel9.msdn.com/Series/FailSafe)

[Azure Cloud Services で大規模なサービスを設計するためのベスト プラクティス](https://azure.microsoft.com/blog/best-practices-for-designing-large-scale-services-on-windows-azure/)

## <a name="next-steps"></a>次のステップ
この記事は、Azure アプリケーションの障害復旧と高可用性に関する一連の記事に属しています。 このシリーズの次の記事は、「 [Microsoft Azure 上に構築されたアプリケーションの高可用性](resiliency-high-availability-azure-applications.md)」です。




<!--HONumber=Jan17_HO2-->


