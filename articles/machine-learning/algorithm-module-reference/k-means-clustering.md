---
title: 'K-Means Clustering (K-Means クラスタリング): モジュール リファレンス'
titleSuffix: Azure Machine Learning service
description: Azure Machine Learning service で K-Means Clustering (K-Means クラスタリング) モジュールを使用して、クラスタリング モデルをトレーニングする方法について学習します。
services: machine-learning
ms.service: machine-learning
ms.subservice: core
ms.topic: reference
author: xiaoharper
ms.author: zhanxia
ms.date: 05/06/2019
ROBOTS: NOINDEX
ms.openlocfilehash: 29aeb460581655190b7c3f4256647059f4642d3e
ms.sourcegitcommit: 4b9c06dad94dfb3a103feb2ee0da5a6202c910cc
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/02/2019
ms.locfileid: "65027833"
---
# <a name="k-means-clustering"></a>K-Means Clustering (K-Means クラスタリング)

この記事では、Azure Machine Learning Studio で **K-Means Clustering (K-Means クラスタリング)** モジュールを使用して、トレーニングされていない K-Means クラスタリング モデルを作成する方法について説明します。 
 
K-Means は、最もシンプルで最もよく知られた*教師なし*学習アルゴリズムの 1 つであり、[異常なデータの検出](https://msdn.microsoft.com/magazine/jj891054.aspx)、テキスト ドキュメントのクラスタリング、その他の分類メソッドや回帰メソッドを使用する前のデータセットの分析など、さまざまな機械学習タスクに使用できます。 クラスタリング モデルを作成するには、このモジュールを実験に追加し、データセットに接続して、予想されるクラスターの数、クラスターの作成に使用するために距離メトリックなど、パラメーターを設定します。 
  
モジュール ハイパーパラメーターを構成した後、K-Means アルゴリズムは教師なし学習メソッドであるため (ラベル列は省略可能)、トレーニングされていないモデルを [Train Clustering Model (クラスタリング モデルのトレーニング)](train-clustering-model.md) に接続します。 

+ データにラベルが含まれる場合は、ラベルの値を使用して、クラスターの選択を示し、モデルを最適化することができます。 

+ データにラベルがない場合、アルゴリズムによって、データのみに基づいて可能なカテゴリを表すクラスターが作成されます。  
  

  
##  <a name="understanding-k-means-clustering"></a>K-Means クラスタリングを理解する
 
一般に、クラスタリングでは、反復的な技術を使用して、データセットのケースを同様の特性を含むクラスターにグループ化します。 これらのグループ化は、データを探索して、データ内の異常を識別し、最終的に予測を行うために便利です。 クラスタリング モデルは、参照またはシンプルな監視によって論理的に派生する可能性がないデータセットで、リレーションシップを識別するのにも役立ちます。 これらの理由から、クラスタリングは、データの詳細を確認し、予期しない相関を検出するために、機械学習タスクの初期フェーズで使用されることが多いです。  
  
 K-Means メソッドを使用してクラスタリング モデルを構成する場合、モデルで必要な*重心*の数を示す、ターゲット数 *k* を指定する必要があります。 重心は、各クラスターの代表的なポイントです。 K-Means アルゴリズムでは、クラスター内の平方和を最小限にすることで、クラスターのいずれかに各受信データ ポイントを割り当てます。 
 
トレーニング データを処理していると、K-Means アルゴリズムがクラスターごとの開始点として機能するランダムに選択された重心の初期セットで開始され、Lloyd のアルゴリズムを適用して重心の場所を繰り返し絞り込みます。 次の条件の 1 つまたは複数に合致するときに、K-Means アルゴリズムによってクラスターのビルドと絞り込みが停止されます。  
  
-   重心が固定されている。つまり、個別のポイントへのクラスターの割り当てはこれ以上変更されることはなく、アルゴリズムはソリューションに集中しているということです。  
  
-   アルゴリズムによって、指定されたイテレーションの数の実行が完了している。  
  
 トレーニング フェーズが完了したら、K-Means アルゴリズムによって見付けられたクラスターの 1 つに新しいケースを割り当てるために、[Assign Data to Clusters (クラスターにデータを割り当て)](assign-data-to-clusters.md) モジュールを使用します。 クラスターの割り当ては、新しいケースと各クラスターの重心の距離を計算することで実行されます。 新しいケースはそれぞれ、最も近い重心を持つクラスターに割り当てられます。  

## <a name="how-to-configure-k-means-clustering"></a>K-Means Clustering (K-Means クラスタリング) を構成する方法
  
1.  **K-Means Clustering (K-Means クラスタリング)** モジュールを自分の実験に追加します。  
  
2.  **[Create trainer mode]\(トレーナー モードの作成\)** オプションを設定して、モデルのトレーニング方法を指定します。  
  
    -   **Single Parameter (単一パラメーター)**: クラスタリング モデルで使用する正確なパラメーターを把握している場合は、特定の値のセットを引数として指定できます。  
  
   
  
3.  **[Number of Centroids]\(重心の数\)** には、アルゴリズムを開始するクラスターの数を入力します。  
  
     モデルでは、正確にこのクラスターの数が生成されることが保証されるわけではありません。 アルゴリズムはこのデータ ポイントの数で開始され、最適な構成を見つけるまで繰り返されます。  
  
     
  
4.  **[Initialization]\(初期化\)** プロパティは、クラスターの初期構成の定義に使用されるアルゴリズムを指定するために使用されます。  
  
    -   **最初の N**: データ ポイントの初期設定値は、データ セットから選択され、初期平均値として使用されます。  
  
         *Forgy メソッド*とも呼ばれます。  
  
    -   **ランダム**: アルゴリズムによって、クラスターにデータ ポイントがランダムに配置され、クラスターのランダムに割り当てられたポイントの重心になる初期平均値が計算されます。  
  
         *ランダム パーティション* メソッドとも呼ばれます。  
  
    -   **K-Means++**: これは、クラスターの初期化に対する既定のメソッドです。  
  
         **K-Means ++** アルゴリズムは、標準の K-Means アルゴリズムによって適切でないクラスタリングを避けるために、2007 年に David Arthur と Sergei Vassilvitskii によって提案されました。 **K-Means ++** では、初期クラスターの中心を選ぶために別のメソッドを使用することで、標準の K-Means が改善されます。  
  
    
5.  **[Random number seed]\(乱数シード\)** には、クラスターの初期化にシードとして使用する値を必要に応じて入力します。 この値は、クラスターの選択に大きな影響を及ぼすことがあります。  
  
    
  
6.  **[Metric]\(メトリック\)** で、クラスター ベクター間、または新しいデータ ポイントとランダムに選択された重心の間の距離を測定するために使用する関数を選びます。 Azure Machine Learning は、次のクラスターの距離のメトリックをサポートしています。  
  
    -   **ユークリッド**: ユークリッド距離は、一般的に K-Means クラスタリング用のクラスター散布図のメジャーとして使用されます。 ポイントと重心の間の平均距離が最小になるため、このメトリックが推奨されます。
  

  
7.  **[Iterations]\(イテレーション\)** には、重心の選択を確定する前に、アルゴリズムがトレーニング データを反復させる必要がある回数を入力します。  
  
     このパラメーターを調整して、精度とトレーニングの時間の差を調整します。  
  
8.  **[Assign label mode]\(ラベル モードの割り当て\)** で、ラベル列 (データセットに存在する場合) が処理される方法を指定するオプションを選びます。  
  
     K-Means クラスタリングは教師なしの機械学習メソッドのため、ラベルは省略可能です。 しかし、データセットに既にラベル列がある場合は、それらの値を使用してクラスターの選択を示したり、値を無視するように指定したりすることができます。  
  
    -   **Ignore label column (ラベル列を無視する)**: ラベル列の値は無視され、モデルのビルドには使用されません。
  
    -   **Fill missing values (欠落値を入力する)**: ラベル列の値は、クラスターのビルドに役立つフィーチャーとして使用されます。 任意の行にラベルが不足している場合は、その値はその他のフィーチャーを使用することで補完されます。  
  
    -   **Overwrite from closest to center (中心に最も近い値から上書きする)**: ラベル列の値は、現在の重心に最も近いポイントのラベルを使用して、予測ラベル値に置き換えられます。  

8.  トレーニング前にフィーチャーを正規化する場合は、**[Normalize features]\(フィーチャーの正規化\)** オプションを選択します。
  
     正規化を適用する場合、トレーニング前に、データ ポイントは MinMaxNormalizer によって `[0,1]` に正規化されます。

10. モデルをトレーニングします。  
  
    -   **[Create trainer mode]\(トレーナー モードの作成\)** を **[Single Parameter]\(単一パラメーター\)** に設定した場合、[Train Clustering Model (クラスタリング モデルのトレーニング)](train-clustering-model.md) モジュールを使用することで、タグ付けしたデータセットを追加してモデルをトレーニングします。  
  

### <a name="results"></a>結果

モデルの構成とトレーニングが完了したら、スコアの生成に使用できるモデルができます。 しかし、モデルのトレーニングには複数の方法があり、結果を表示して使用するには複数の方法があります。 

#### <a name="capture-a-snapshot-of-the-model-in-your-workspace"></a>ワークスペースでモデルのスナップショットをキャプチャする

+ [Train Clustering Model (クラスタリング モデルのトレーニング)](train-clustering-model.md) モジュールを使用した場合
    1. [Train Clustering Model (クラスタリング モデルのトレーニング)](train-clustering-model.md) モジュールを右クリックします。
    2. **[Trained model]\(トレーニングされたモデル\)** を選択して、**[Save as Trained Model]\(トレーニングされたモデルとして保存\)** をクリックします。


保存されたモデルは、モデルを保存したときのトレーニング データを表します。 実験で使用したトレーニング データを後で更新する場合、保存されたモデルは更新されません。 



#### <a name="see-the-clustering-result-dataset"></a>クラスタリングの結果のデータセットを表示する 

+ [Train Clustering Model (クラスタリング モデルのトレーニング)](train-clustering-model.md) モジュールを使用した場合
    1. [Train Clustering Model (クラスタリング モデルのトレーニング)](train-clustering-model.md) モジュールを右クリックします。
    2. **[Results dataset]\(結果のデータセット\)** を選択して、**[Visualize]\(可視化\)** をクリックします。


### <a name="tips-for-generating-the-best-clustering-model"></a>最適なクラスタリング モデルを生成するためのヒント  

クラスタリング中に使用される**シード処理**プロセスが、モデルに大きく影響することが知られています。 シード処理は、可能性がある重心へのポイントの初期配置を意味します。
 
たとえば、データセットに多くの外れ値が含まれ、外れ値がクラスターをシードするために選択された場合、その他のデータ ポイントがそのクラスターにうまく適合することはなく、クラスターはシングルトンになる可能性があります。つまり、1 つのポイントのみのクラスターになります。  
  
この問題を回避するには、さまざまな方法があります。  
  
-   重心の数を変更して、複数のシード値を試します。  
  
-   メトリックを変えるか、さらに反復処理して、複数のモデルを作成します。  
  
  
一般に、クラスタリング モデルを使用すると、任意の指定された構成は、ローカルで最適化されたクラスターのセットになる可能性があります。 つまり、モデルで返されたクラスターのセットは、現在のデータ ポイントのみに適し、その他のデータに対して汎化可能ではありません。 別の初期構成を使用する場合、K-Means メソッドは別の (上位である可能性がある) 構成であることに気付くことがあります。 
