<properties
	pageTitle="Machine Learning モデルが実験から運用可能な Web サービスになるまでの過程 | Microsoft Azure"
	description="Azure Machine Learning モデルが開発中の実験から運用可能な Web サービスになるまでにたどる過程の概要を説明します。"
	services="machine-learning"
	documentationCenter=""
	authors="garyericson"
	manager="paulettm"
	editor="cgronlun"/>

<tags
	ms.service="machine-learning"
	ms.workload="data-services"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="05/02/2016"
	ms.author="garye"/>


# Machine Learning モデルが実験から運用可能な Web サービスになるまでの過程

***実験***は、予測分析モデルを作成するときに対話形式で開発、実行、テスト、反復処理できる Azure Machine Learning Studio のキャンバスです。さまざまなモジュールを利用して、実験へのデータの取り込み、データの操作、機械学習アルゴリズムを使用したモデルのトレーニング、モデルのスコア付け、結果の評価、最終的な値の出力を行えます。

実験で問題がなければ、ユーザーが新しいデータを送信して折り返し結果を受信できるように、***Azure Web サービス***としてデプロイできます。

この記事では、Machine Learning モデルが開発中の実験から運用可能な Web サービスになるまでにたどる過程について、概要を説明します。

>[AZURE.NOTE] 機械学習モデルを開発し、デプロイする方法はほかにもありますが、この記事では Machine Learning Studio を使用する方法に焦点を当てています。R を使用して予測 Web サービスを作成する方法の詳細については、[RStudio と Azure ML を使用した予測 Web アプリの開発とデプロイ](http://blogs.technet.com/b/machinelearning/archive/2015/09/25/build-and-deploy-a-predictive-web-app-using-rstudio-and-azure-ml.aspx)に関するブログ記事を参照してください。

Azure Machine Learning Studio は主に*予測分析モデル*の開発とデプロイを目的に設計されていますが、予測分析モデルを含まない実験の開発に使用することもできます。たとえば、データを入力して操作し、結果を出力するだけの実験などです。この非予測実験は、予測分析実験と同様に、Web サービスとしてデプロイすることができますが、この実験では機械学習モデルのトレーニングやスコア付けが実施されないため、より簡単なプロセスになります。これは Studio の一般的な使用方法ではありません。一般的な使用方法については以下で説明し、Studio の機能を網羅することにします。

## 予測 Web サービスの開発とデプロイ

Machine Learning Studio を使用して予測 Web サービスを開発し、デプロイする場合、一般的なソリューションがたどる段階は次のようになります。

![](media\machine-learning-model-progression-experiment-to-web-service\model-stages-from-experiment-to-web-service.png)

*図 1 - 一般的な予測分析モデルの段階*

### トレーニング実験

***トレーニング実験***は、Machine Learning Studio の最初の実験キャンバスです。トレーニング実験の目的は、機械学習モデルの開発、テスト、反復処理、そしてトレーニングの場所を提供することです。最適なソリューションを見つけるために複数のモデルを同時にトレーニングすることもできますが、実験が終わったら、トレーニング済みのモデルを 1 つ選択し、残りのモデルを実験から除外することになります。予測分析実験の開発の例については、「[信用リスク評価のための予測分析ソリューションを Azure Machine Learning で開発する](machine-learning-walkthrough-develop-predictive-solution.md)」を参照してください。

### 予測実験

トレーニング実験でモデルをトレーニングした後で、Machine Learning Studio で **[Web サービスの設定]** をクリックすると、トレーニング実験を***予測実験***に変換する処理が実行されます。予測実験の目的は、トレーニング済みのモデルを使用して新しいデータにスコアを付け、最終的に Azure Web サービスとして運用できる状態にすることです。

この変換は、次の手順で行われます。

-   トレーニングに使用したモジュールのセットを単一のモジュールに変換し、トレーニング済みのモデルとして保存する

-   スコア付けに関係しない余分なモジュールをすべて除外する

-   最終的な Web サービスで使用する入力ポートと出力ポートを追加する

予測実験を Web サービスとしてデプロイできる状態にするには、さらに変更が必要になることがあります。たとえば、Web サービスから結果のサブセットのみを出力するには、出力ポートの前にフィルター処理モジュールを追加します。

この変換プロセスでは、トレーニング実験は破棄されません。このプロセスが完了すると、2 つのタブが Studio に表示されます。1 つがトレーニング実験用で、もう 1 つが予測実験用です。このように、Web サービスをデプロイする前に、トレーニング実験に変更を加えて予測実験を再構築できます。また、トレーニング実験のコピーを保存しておいて、新たに別の実験を始めることもできます。

>[AZURE.NOTE] **[Web サービスの設定]** をクリックすると、トレーニング実験を予測実験に変換する自動処理が開始されます。ほとんどの場合、この方法を利用できます。トレーニング実験が複雑な場合 (結合するトレーニングのパスが複数ある場合など) は、この変換を手動で実行した方が良いこともあります。この変換処理の機能の詳細については、「[Machine Learning のトレーニング実験から予測実験に変換する](machine-learning-convert-training-experiment-to-scoring-experiment.md)」を参照してください。

### Web サービス

予測実験の準備ができたら、**[Web サービスのデプロイ]** をクリックし、***Azure Web サービス***としてデプロイすることでモデルを運用可能にします。ユーザーは、Web サービス REST API を使用してモデルにデータを送信し、折り返し結果を受信できるようになりました。この方法の詳細については、「[Machine Learning の実験からデプロイされた Azure Machine Learning Web サービスを使用する方法](machine-learning-consume-web-services.md)」を参照してください。

Web サービスをデプロイした後も予測実験と Web サービスは接続されたままなので、これらの間を行き来できます。

|***元のページ***|***クリック***|***移動先のページ***|
| ------------------- | --------------- | ---------------------- |
|Studio の実験キャンバス|**[Web サービスに移動]**|Studio の Web サービス構成|
|Studio の Web サービス構成|**最新の表示**|Studio の実験キャンバス|
|Studio の Web サービス構成|**エンドポイントの管理...**|Azure クラシック ポータルのエンドポイント管理|
|Azure クラシック ポータルのエンドポイント管理|**Studio で編集**|Studio の実験キャンバス|

![](media\machine-learning-model-progression-experiment-to-web-service\connections-between-experiment-and-web-service.png)

*図 2 - 実験と Web サービスの接続*

## 一般的でないケース: 非予測 Web サービスの作成

実験で予測分析モデルをトレーニングしない場合、トレーニング実験とスコア付け実験の両方を作成する必要はありません。実験は 1 つのみになり、この実験を Web サービスとしてデプロイすることができます (Machine Learning Studio は、使用したモジュールを分析することで、実験に予測モデルが含まれるかどうかを検出します)。

実験を反復処理して問題がなければ、次の手順に従います。

1.  **[Web サービスの設定]** をクリックします。入力ノードと出力ノードが自動的に追加されます。

2.  **[実行]** をクリックします。

3.  **[Web サービスのデプロイ]** をクリックします。

これで Web サービスがデプロイされます。予測 Web サービスと同様に、アクセスして管理することができます。

## Web サービスのボタン

Machine Learning Studio では、Web サービスのボタン (**[Web サービスの設定]** と **[Web サービスのデプロイ]**) は、その時点の開発プロセスの段階に応じて名前と機能が変わります。

**実験に予測モデルが含まれる場合**

実験で予測モデルをトレーニングしてスコアを付ける場合、Web サービスのボタンでは次の機能が実行されます。

|**実験の種類**|**ボタン**|**説明**|
| -------------------- | -------- | -------------- |
|開発中の実験|**Web サービスの設定**|2 つのオプションが表示されます。|
|&nbsp;|- **予測 Web サービス**|実験をトレーニング実験とスコア付け実験の両方に変換します。|
|&nbsp;|- **Web サービスの再トレーニング**|実験を再トレーニング実験に変換します (以下の「更新」セクションを参照してください)。|
|トレーニング実験|**Web サービスの設定**|2 つのオプションが表示されます。|
|&nbsp;|- **予測実験の更新**|トレーニング実験に加えた変更内容で、関連する予測実験を更新します。|
|&nbsp;|- **Web サービスの再トレーニング**|トレーニング実験を再トレーニング実験に変換します (以下の「更新」セクションを参照してください)。|
|&nbsp;|- *または* - **Web サービスのデプロイ**|デプロイ用に再トレーニング実験を設定した場合は、再トレーニング実験が Web サービスとしてデプロイされます。|
|予測実験|**Web サービスのデプロイ**|Web サービスとして予測実験をデプロイします。|

**実験に予測モデルが*含まれない*場合**

実験で予測モデルのトレーニングとスコア付けを実施しない場合、Web サービスのボタンは大幅に簡略になります。

|**実験の種類**|**ボタン**|**説明**|
| -------------------- | -------- | -------------- |
|開発中の実験|**Web サービスの設定**|Web サービスとしてデプロイするために実験を準備します。|
|デプロイの準備が整った実験|**Web サービスのデプロイ**|Web サービスとして実験をデプロイし、Web サービスの構成のページを開きます。|

## Web サービスの更新

これで、実験が Web サービスとしてデプロイされました。更新するにはどうすればよいでしょうか。

その方法は更新する対象によって異なります。

**入力または出力を変更する場合や、Web サービスでデータを操作する方法を変更する場合**

モデルは変更せず、Web サービスでのデータの処理方法だけを変更する場合は、予測実験を編集して、**[Web サービスのデプロイ]** をもう一度クリックします。Web サービスが停止し、更新済みの予測実験がデプロイされ、Web サービスが再び開始されます。

たとえば、入力データ行全体と予測の結果を返す予測実験があるとします。Web サービスから結果のみを返すことに決まりました。結果以外の列を除外するには、予測実験の出力ポートの直前に**データセット内の列の選択**モジュールを追加します。もう一度 **[Web サービスのデプロイ]** をクリックすると、Web サービスが更新されます。

**新しいデータでモデルを再トレーニングする必要がある場合**

機械学習モデルを維持したまま新しいデータで再トレーニングする必要がある場合、選択肢は 2 つあります。

1.  **Web サービスの実行中にモデルを再トレーニングする**: 予測 Web サービスの実行中にモデルを再トレーニングするには、トレーニング実験にいくつか変更を加えて***再トレーニング実験***にすることで実行できます。さらにそれを***再トレーニング Web* サービス**としてデプロイできます。この方法の手順については、「[プログラムによる Machine Learning のモデルの再トレーニング](machine-learning-retrain-models-programmatically.md)」を参照してください。

2.  **元のトレーニング実験に戻り、さまざまなトレーニング データを使用してモデルを開発する**: 予測実験は Web サービスにリンクされますが、この方法では、トレーニング実験は直接リンクされません。元のトレーニング実験を変更し、**[Web サービスの設定]** をクリックすると、*新しい*予測実験が作成されます。これをデプロイすると、*新しい* Web サービスが作成されます。単に元の Web サービスを更新するのではありません。

    トレーニング実験を変更する必要がある場合は、トレーニング実験を開き、**[名前を付けて保存]** をクリックしてコピーを作成します。これにより、元のトレーニング実験、予測実験、Web サービスはそのままの状態で維持されます。そのうえで、変更を加えることにより、新しい Web サービスを作成できます。新しい Web サービスをデプロイした後で、前の Web サービスを停止するか、新しい Web サービスと共に実行し続けるかを決定できます。

**別のモデルをトレーニングする必要がある場合**

別の機械学習アルゴリズムを選択する、別のトレーニング方法を試行するなど、元の予測実験を変更するには、前に説明したモデルの再トレーニングの 2 つ目の手順を実行する必要があります。トレーニング実験を開き、**[名前を付けて保存]** をクリックしてコピーを作成したうえで、新たにモデルを開発し、予測実験を作成して Web サービスをデプロイします。これにより、元の予測実験と関係のない新しい Web サービスが作成されます。どちらか一方を実行するか、両方を実行し続けるかを決定できます。

## 参考資料

このプロセスの詳細については、以下の記事を参照してください。

-   実験の変換: [Machine Learning のトレーニング実験から予測実験に変換する](machine-learning-convert-training-experiment-to-scoring-experiment.md)

-   Web サービスのデプロイ: [Azure Machine Learning Web サービスをデプロイする](machine-learning-publish-a-machine-learning-web-service.md)

-   モデルの再トレーニング: [プログラムによる Machine Learning のモデルの再トレーニング](machine-learning-retrain-models-programmatically.md)

プロセス全体の例については、以下を参照してください。

-   [Machine Learning のチュートリアル: Azure Machine Learning Studio で初めての実験を作成する](machine-learning-create-experiment.md)

-   [チュートリアル: 信用リスク評価のための予測分析ソリューションを Azure Machine Learning で開発する](machine-learning-walkthrough-develop-predictive-solution.md)

<!---HONumber=AcomDC_0608_2016-->