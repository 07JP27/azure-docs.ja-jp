---
title: 入力ディレクトリと出力ディレクトリで、ストレージ制限を回避し、待機時間を実験する
description: この記事では、ストレージ制限エラーを回避し、待機時間を実験するために、実験で入力ファイルをどこに保存し、出力ファイルをどこに書き込むかについて説明します。
services: machine-learning
author: rastala
ms.author: roastala
manager: danielsc
ms.reviewer: jmartens, jasonwhowell, mldocs
ms.service: machine-learning
ms.component: core
ms.workload: data-services
ms.topic: article
ms.date: 05/28/2019
ms.openlocfilehash: b9357c18784b0d731876d136f48d332191f054d1
ms.sourcegitcommit: 8e76be591034b618f5c11f4e66668f48c090ddfd
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/29/2019
ms.locfileid: "66355969"
---
# <a name="where-to-save-and-write-files-for-azure-machine-learning-experiments"></a>Azure Machine Learning の実験でファイルを保存する場所と書き込む場所

この記事では、ストレージ制限エラーを回避し、待機時間を実験するために、実験で入力ファイルをどこに保存し、出力ファイルをどこに書き込むかについて説明します。

[コンピューティング ターゲット](how-to-set-up-training-targets.md)でトレーニング実行を起動すると、外部環境から分離されます。 この設計の目的は、実行の再現性と移植性を確保することです。 同一または別のコンピューティング ターゲットで、同じスクリプトを 2 回実行すると、同じ結果が得られます。 この設計により、コンピューティング ターゲットを、完了後に実行されるジョブとのアフィニティがないステートレスな計算リソースとして扱うことができます。

## <a name="where-to-save-input-files"></a>入力ファイルを保存する場所

コンピューティング ターゲットまたはローカル マシンで実験を開始する前に、コードの実行に必要な依存関係ファイルやデータ ファイルなどの必要なファイルが、そのコンピューティング ターゲットに存在することを確認する必要があります。

Azure Machine Learning では、スクリプト フォルダー全体をターゲットのコンピューティング コンテキストにコピーすることで、トレーニング スクリプトが実行されます。 このため、トレーニングの実行に必要な実験ファイルを保存するために次の方法が推奨されます。

* **小さいデータ ファイルおよび依存関係ファイルの場合:** トレーニング スクリプトと同じフォルダー ディレクトリにファイルを配置します。 このフォルダーを `source_directory` ディレクトリとして、トレーニング スクリプトで直接指定するか、またはトレーニング スクリプトを呼び出すコードで指定します。

* **大きいデータ ファイルおよび依存関係ファイルの場合:** Azure Machine Learning の[データストア](https://docs.microsoft.com/python/api/azureml-core/azureml.data?view=azure-ml-py)にファイルを格納します。  これにより、リモート コンピューティング ターゲットからのデータ アクセスの利点が得られます。つまり、認証やマウントなどが Azure Machine Learning service で管理されます。 データストアをソース ディレクトリとして指定し、データストアにファイルをアップロードする方法の詳細については、[データストアからデータにアクセスする](how-to-access-data.md)方法に関する記事を参照してください。

<a name="limits"></a>

### <a name="storage-limits-of-experiment-snapshots"></a>実験スナップショットのストレージ制限

実験では、Azure Machine Learning により、実行の構成時に提案したディレクトリに基づいてコードの実験スナップショットも作成されます。 これには、合計 300 MB または 2000 ファイルの制限があります。 この制限を超えると、次のエラーが表示されます。

```Python
While attempting to take snapshot of .
Your total snapshot size exceeds the limit of 300.0 MB
```

エラーを解決するには、次のいずれかの解決策を試してください。

実験 &nbsp;要件|ストレージ制限の解決策
---|---
ファイルが非常に大きい場合| 実行時にスクリプト フォルダーがコンピューティング ターゲット環境にコピーされるときに待機時間に関する問題を回避するために、ファイルをデータストアに移動し、データストアを source_directory として指定します。
ファイルが多いまたは大きいが、データストアを使用しない場合| SNAPSHOT_MAX_SIZE_BYTES を実験で必要なサイズに設定することで、制限をオーバーライドします。 <br> `azureml._restclient.snapshots_client.SNAPSHOT_MAX_SIZE_BYTES = 'insert_desired_size'`
特定のスクリプト ディレクトリを使用する必要がある場合| 無視ファイル (`.gitignore` または `.amlignore`) を作成して、実際にはソース コードの一部ではないファイルが、実験スナップショットに含まれないようにします。 このファイルをディレクトリに配置し、無視するファイルの名前をその中に追加します。 `.amlignore` ファイルには、`.gitignore` ファイルと同じ構文とパターンが使用されます。 両方のファイルが存在する場合、`.amlignore` ファイルが優先されます。
パイプライン|ステップごとに異なるサブディレクトリを使用するか、または無視ファイルを作成します。
Jupyter Notebook| 300 MB 以上に相当するデータまたはファイルを含むディレクトリを使用している可能性があります。 次の手順に従って、Jupyter Notebook を新しい空のサブディレクトリに移動します。  <br> 1.新しいフォルダーを作成します。<br> 2.Jupyter Notebook を空のフォルダーに移動します。 <br> 手順 3.コードを再度実行します。

## <a name="where-to-write-files"></a>ファイルを書き込む場所

トレーニング実験は分離されているため、実行時に発生したファイルへの変更が、必ずしも環境の外部で保持されるとは限りません。
スクリプトによって計算用にローカル ファイルが変更された場合、それらの変更は次回の実行では保持されず、クライアント コンピューターに自動的に反映されることもありません。 そのため、最初の実験実行時に行われた変更が、2 回目の実行での変更に影響を与えることはなく、また与えてはなりません。

次のいずれかにファイルを書き込みます。
>[!Important]
> *outputs* と *logs* の 2 つのフォルダーは、Azure Machine Learning によって特別に扱われます。 トレーニング中に `./outputs` フォルダーと `./logs` フォルダーにファイルを書き込んだ場合、それらのファイルは実行履歴に自動的にアップロードされて、実行が完了すると、それらのファイルにアクセスできるようになります。

 1. 小さいファイルの場合は、実行履歴に成果物として保持されるよう、"./outputs" フォルダーにファイルを書き込みます。 "./outputs" フォルダーに大きいファイルを書き込んだ場合、フォルダーの内容が実行履歴にアップロードされるときに待機時間が発生します。

 1. 大きいファイルの場合は、Azure Machine Learning のデータストアにファイルを書き込みます。 [データストアからデータにアクセスする](how-to-access-data.md)方法に関する記事を参照してください。

 1. "./logs" フォルダーにファイルを書き込んで、実行履歴にログとして保存します。 この方法は、ログがリアルタイムでアップロードされるため、リモート実行からのライブ更新ストリーミングに適しています。

## <a name="next-steps"></a>次の手順

* [データストアからデータにアクセスする](how-to-access-data.md)方法に関する詳細を確認します。

* [トレーニング ターゲットのセットアップ方法](how-to-set-up-training-targets.md)に関する詳細を確認します。
