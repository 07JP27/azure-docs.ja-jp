<properties 
   pageTitle="Azure リソース マネージャーを使用してカスタム プローブ用のアプリケーション ゲートウェイを構成する | Microsoft Azure"
   description="このページでは、Azure リソース マネージャー テンプレートを使用して、Azure Application Gateway でカスタム プローブを構成する方法について説明します"
   documentationCenter="na"
   services="application-gateway"
   authors="joaoma"
   manager="carmonm"
   editor="tysonn"/>
<tags 
   ms.service="application-gateway"
   ms.devlang="na"
   ms.topic="article" 
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services" 
   ms.date="11/24/2015"
   ms.author="joaoma"/>

# 正常性の監視とカスタム プローブ 


Azure Application Gateway はバック エンド プールにあるすべてのリソースの状態を監視して、異常とみなしたリソースをプールから自動的に削除します。

既定の正常性プローブとカスタム プローブの 2 種類のプローブを使用して、正常性の監視を構成します。

## 既定の正常性プローブ

カスタム プローブ構成を設定しない場合、アプリケーション ゲートウェイにより既定の正常性プローブが自動で構成されます。監視の動作は、バック エンド プールに構成された IP アドレスと、アプリケーション ゲートウェイのバック エンドの HTTP 設定で構成されたポートに HTTP 要求をすることによって機能します。

たとえば、バック エンド サーバー A、B、C を使用して ポート 80 で HTTP ネットワーク トラフィックを受信するように、アプリケーション ゲートウェイを構成したとします。既定の正常性監視では、30 秒ごとにこれら 3 つのサーバーに対して HTTP 応答が正常であるかどうかがテストされます。正常な HTTP 応答の[状態コード](https://msdn.microsoft.com/library/aa287675.aspx) は、200 から 399 の間です。

サーバー A に対する既定のプローブ チェックが失敗した場合、アプリケーション ゲートウェイはサーバー A をバックエンド プールから削除するため、ネットワーク トラフィックがこのサーバーに送られなくなります。既定のプローブは、削除後もサーバー A を 30 秒ごとにチェックし続けます。サーバー A は、既定の正常性プローブからの要求に正常に応答するようになるとバック エンド プールに「正常」として戻され、このサーバーへのトラフィックの送信が再開されます。

既定のプローブは、IP アドレスのみを使用して、状態を確認します。URL への接続をテストして正常性を確認する場合は、カスタム プローブを使用する必要があります。


## カスタム プローブ 

カスタム プローブを使用すると、正常性監視をより細かく制御できます。カスタム プローブを使用する場合、プローブのチェック間隔、テスト対象の URL とパス、バックエンド プール インスタンスを「異常」とマークするまでの応答の失敗回数を構成することができます。


カスタム プローブの設定:

- **[プローブの間隔]** - プローブのチェック間隔を秒単位で指定します。
- **[プローブのタイムアウト]** - プローブの HTTP 応答チェックのタイムアウト期間を定義します。
- **[異常しきい値]** -インスタンスに異常のフラグを設定するために必要な、失敗した要求の数を指定します。  
- **[ホスト名とパス]** -Web サイトまたは Web ファームに、IP アドレスに対してだけの HTTP 応答がない場合は、プローブ ホスト名と正常な状態の有効な HTTP 応答のパスを構成する必要があります。例: http://contoso.com/ という Web サイトがあり、有効な HTTP 応答が生成されないとします。Web サーバー インスタンスが正常であることを検証するには、有効で正常な HTTP 応答を提供するようにホスト名とパスを構成する必要があります。この場合、HTTP 応答が正常かどうかをプローブでチェックするためには、カスタム プローブを "http://contoso.com/path/custompath.htm" に対して構成します。 



>[AZURE.NOTE] カスタム プローブは、PowerShell を使用した場合にのみ構成可能

<!---HONumber=AcomDC_0128_2016-->