<properties 
   pageTitle="VM とロール インスタンスの解決"
   description="Azure IaaS、ハイブリッド ソリューション、異なるクラウド サービス間、Active Directory、および独自 DNS サーバーの使用に関係する名前解決シナリオです"
   services="virtual-network"
   documentationCenter="na"
   authors="joaoma"
   manager="jdial"
   editor="tysonn" />
<tags 
   ms.service="virtual-network"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="06/30/2015"
   ms.author="joaoma" />

# VM とロール インスタンスの名前解決

Azure を使用して IaaS、PaaS、ハイブリッド ソリューションをホストする方法によっては、作成する VM およびロール インスタンスに他の VM およびロール インスタンスとの通信を許可することが必要になる場合があります。IP アドレスを使用してこの通信を行うこともできますが、簡単に記憶できるホスト名を使用する方がはるかに簡単です。ただし、通信を確立するためには、これらのホスト名を何らかの方法で IP アドレスに解決する必要があります。

Azure でホストされているロール インスタンスと VM がホスト名とドメイン名を内部 IP アドレスに解決する必要がある場合、つぎの 2 つの方法のいずれかを使用できます。

- [Azure で提供される名前解決](azure-provided-name-resolution)

- [独自の DNS サーバーを使用する名前解決](name-resolution-using-your-own-DNS-server)

どちらの名前解決方法を使用するかは、VM およびロール インスタンスが必要とするクラウド サービス内および他のクラウド サービスとの間での通信方法によって決まります。

**次の表では、シナリオと対応する名前解決の方法を示します。**

| **シナリオ** | **名前解決の方法:** | **詳細情報:** |
|------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 同じクラウド サービス内に存在するロール インスタンスまたは VM の間での名前解決 | Azure で提供される名前解決 | [Azure で提供される名前解決](#azure-provided-name-resolution) |
| 同じ仮想ネットワーク内に存在する VM およびロール インスタンス間での名前解決 | Azure 提供の名前解決 – 独自の DNS サーバーを使用した FQDNorName 解決を使用 | - [Azure で提供される名前解決](#azure-provided-name-resolution) - [独自の DNS サーバーを使用する名前解決](#name-resolution-using-your-own-dns-server) - [DNS サーバーの要件](#dns-server-requirements) |
| 異なる仮想ネットワーク内に存在する VM およびロール インスタンス間での名前解決 | 独自 DNS サーバー使用の名前解決 | [独自の DNS サーバーを使用する名前解決](#name-resolution-using-your-own-dns-server) - [DNS サーバーの要件](#dns-server-requirements) |
| クロスプレミス: Azure 内のロール インスタンスまたは VM とオンプレミス コンピューターの間の名前解決 | 独自 DNS サーバー使用の名前解決 | [独自の DNS サーバーを使用する名前解決](#name-resolution-using-your-own-dns-server) - [DNS サーバーの要件](#dns-server-requirements) |
| 内部 IP の逆引き参照 | 独自 DNS サーバー使用の名前解決 | [独自の DNS サーバーを使用する名前解決](#name-resolution-using-your-own-dns-server) - [DNS サーバーの要件](#dns-server-requirements) |
| カスタム ドメインの名前解決 (例: Active Directory ドメイン、ユーザー登録のドメイン) | 独自 DNS サーバー使用の名前解決 | [独自の DNS サーバーを使用する名前解決](#name-resolution-using-your-own-dns-server) - [DNS サーバーの要件](#dns-server-requirements) |
| 仮想ネットワーク内ではなく、異なるクラウド サービスに存在するロール インスタンス間での名前解決 | 適用不可。異なるクラウド サービス内にある VM とロール インスタンス間の接続は、仮想ネットワークの外側ではサポートされません。 | 適用不可。 |

> [AZURE.NOTE]インターネット上のコンピューターとパブリック エンドポイントの間での名前解決は、Azure によって自動的に提供され、構成は必要ありません。

## Azure で提供される名前解決

パブリック インターネット ドメインの解決と共に、Azure では、同じクラウド サービス内に存在する VM とロール インスタンスのホスト名を使用したホスト名名前解決、および同じ仮想ネットワーク上に存在する異なるクラウド サービス内の VM とロール インスタンスの間の FQDN を使用した名前解決が提供されます。Azure 提供の名前解決ではどのような構成も不要ありませんが、前の表で示すように、すべてのデプロイ シナリオに適しているわけではありません。

> [AZURE.NOTE]Web ロールおよびワーカー ロールの場合は、Azure Service Management REST API を使用して、ロール名とインスタンス番号に基づいてロール インスタンスの内部 IP アドレスにアクセスすることもできます。詳細については、「[サービス管理 REST API リファレンス](https://msdn.microsoft.com/library/azure/ee460799.aspx)」を参照してください。

### 機能と注意事項

**機能:**

- 使いやすさ: Azure 提供の DNS サービスを使用するための構成は必要はありません。

- 同じクラウド サービス内に存在するロール インスタンスまたは VM の間のホスト名解決が提供されます。

- 名前解決は、同じ仮想ネットワークに存在するロール インスタン間および VM 間で提供されますが、異なるクラウド サービスの場合は、対象のロール インスタンスまたは VM の FQDN を使用して行われます。

- 自動生成される名前を使用するのではなく、デプロイの内容がよくわかるホスト名を作成できます。

- パブリック ドメイン名を解決するための標準 DNS 参照がサポートされます。

**考慮事項:**

- 仮想ネットワークの間での名前解決は使用できません。

- Azure Virtual Network に追加される最初の 180 個のクラウド サービスに存在する VM とロール インスタンスについてのみ、ホスト名と FQDN を登録できます。クラウド サービスが 180 個より多い場合は、各サービス内の VM およびロール インスタンスの数に関係なく、名前解決用に独自の DNS サーバーを用意する必要があります。

- 同じ仮想マシンまたはロール インスタンスに対する複数のホスト名の使用はサポートされません。

- クロスプレミスの名前解決は使用できません。

- Azure によって作成される DNS サフィックスは変更できません。

- Azure 提供の DNS に独自のレコードを手動で登録することはできません。

- WINS と NetBIOS はサポートされません (Windows エクスプローラーのネットワーク ブラウザーで仮想マシンを一覧表示することはできません)。

- ホスト名は DNS 互換である必要があります (使用できる文字は 0 ～ 9、a ～ z、'-' のみであり、最初または最後の文字として '-' は使用できません。RFC 3696 セクション 2 を参照してください)。

- DNS クエリ トラフィックは VM ごとに調整されます。アプリケーションが複数のターゲット名で頻繁に DNS クエリを実行する場合、一部のクエリがタイムアウトする可能性があります。これを避けるため、クライアント キャッシュを使用することをお勧めします。

## 独自 DNS サーバー使用の名前解決

Azure によって提供される機能では名前解決の要件に対応できない場合は、独自の DNS サーバーを使用できます。独自の DNS サーバーを使用する場合は、クラウド サービスに必要なレコードをユーザーが管理する必要があります。

> [AZURE.NOTE]デプロイ シナリオで必要な場合を除き、外部 DNS サーバーは使用しないことをお勧めします。

## DNS サーバーの要件

Azure によって提供されない名前解決を使用する場合は、指定する DNS サーバーが以下の要件をサポートしている必要があります。DNS サーバーは、Dynamic DNS (DDNS) による動的な DNS 登録を受け付ける必要があります。

- DNS サーバーではレコードの清掃をオフにする必要があります。Azure の IP アドレスはリース期間が長く、清掃中に DNS サーバーでレコードが削除される可能性があります。

- DNS サーバーでは、再帰を有効にして外部ドメイン名の解決を可能にする必要があります。

- DNS サーバーには、名前解決を要求するクライアント、および名前を登録するサービスと仮想マシンから、(TCP/UDP ポート 53 で) アクセスできる必要があります。

- また、多くのボットが開いている再帰 DNS リゾルバーをスキャンしているので、インターネットからのアクセスに対して DNS サーバーをセキュリティで保護することをお勧めします。


## DNS サーバーの指定

VM およびロール インスタンスで使用するように複数の DNS サーバーを指定できます。ただし、その場合は、DNS サーバーは (ラウンド ロビン方式ではなく) フェールオーバー方式で指定されている順序で使用されます。DNS クエリごとに、クライアントはまず優先 DNS サーバーを試みた後、優先サーバーが応答しない場合にのみ代替サーバーを試みます。このため、環境に適した正しい順序で DNS サーバーがリストされていることを確認してください。

> [AZURE.NOTE]既にデプロイされている仮想ネットワークのネットワーク構成ファイルで DNS の設定を変更した場合、変更を有効にするには各 VM を再起動する必要があります。

### 管理ポータルを使用した DNS サーバーの指定

管理ポータルを使用して仮想ネットワークを作成するとき、使用する DNS サーバー (1 台または複数台) の IP アドレスと名前を指定できます。デプロイに使用する DNS サーバーを指定していない場合、仮想ネットワークが作成されると、仮想ネットワークにデプロイした仮想マシンとロール インスタンスは、指定した DNS 設定で自動的に構成されます。Azure Virtual Network の設定の構成に関して詳しくは、「[管理ポータルでの仮想ネットワークの設定について](https://msdn.microsoft.com/library/azure/jj156074.aspx)」をご覧ください。

> [AZURE.NOTE]使用できる DNS サーバーは最大 9 個までです。

### 構成ファイルを使用した DNS サーバーの指定

*ネットワーク構成*ファイルおよび*サービス構成*ファイルの 2 種類の構成ファイルを使用して、DNS の設定を指定できます。

ネットワーク構成ファイルは、Azure に追加する仮想ネットワークごとに作成されます。サービス構成ファイルで独自の DNS 設定が指定されている場合を除き、ロール インスタンスまたは VM を仮想ネットワークのクラウド サービスに追加すると、ネットワーク構成ファイルの DNS 設定がロール インスタンスまたは VM に適用されます。

サービス構成ファイルは、Azure に追加するクラウド サービスごとに作成されます。ロール インスタンスまたは VM をクラウド サービスに追加すると、サービス構成ファイルの DNS 設定が、ロール インスタンスまたは VM に適用されます。

> [AZURE.NOTE]サービス構成ファイルの設定は、ネットワーク構成ファイルの設定を上書きします。たとえば、仮想ネットワークの一部であるクラウド サービスに VM を追加した場合、ネットワーク構成ファイルとサービス構成ファイルの両方に DNS の設定があると、サービス構成ファイルの DNS 設定が VM に適用されます。


## 関連項目

[Azure サービスの構成スキーマ (.cscfg ファイル)](https://msdn.microsoft.com/library/azure/ee758710) [Azure 仮想ネットワークの構成スキーマ](https://msdn.microsoft.com/library/azure/jj157100) [管理ポータルでの仮想ネットワークの設定について](https://msdn.microsoft.com/library/azure/jj156074.aspx) [ネットワーク構成ファイルを使用した仮想ネットワークの構成](https://msdn.microsoft.com/library/azure/jj156097.aspx) [仮想ネットワークの構成タスク](https://msdn.microsoft.com/library/azure/jj156206.aspx)

<!---HONumber=July15_HO2-->