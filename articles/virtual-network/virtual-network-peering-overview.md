<properties
   pageTitle="Azure の仮想ネットワーク ピアリング | Microsoft Azure"
   description="Azure の VNet ピアリングについて説明します。"
   services="virtual-network"
   documentationCenter="na"
   authors="narayanannamalai"
   manager="jefco"
   editor="tysonn" />
<tags
   ms.service="virtual-network"
   ms.devlang="na"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="07/28/2016"
   ms.author="narayan" />

# VNet ピアリング

VNET ピアリングとは、同じリージョンに存在する 2 つの仮想ネットワークを Azure のバックボーン ネットワークを介して接続する機構です。ピアリングされた 2 つの仮想ネットワークは、あらゆる接続において、見かけ上 1 つのネットワークとして機能します。これらの VNet はあくまで個別のリソースとして管理されますが、そこに存在する仮想マシンは互いに、プライベート IP アドレスを使用して直接通信を行うことができます。ピアリングされた VNet に存在する仮想マシン間のトラフィックは Azure インフラストラクチャを介し、同一 VNet 内の VM 間のトラフィックと同じようにルーティングされます。以下、VNet ピアリングを使う利点をいくつか挙げます。

- 異なる VNet 内のリソース間の低待機時間かつ広帯域幅の接続が可能である。
- ピアリングされた VNet 内のリソース (ネットワーク仮想アプライアンスなど) や VPN ゲートウェイを使用できる (トランジット)。
- Resource Manager VNet をクラシック VNet に接続し、それらの VNet 内のリソース間に完全な接続を確保する。

VNet ピアリングの要件と主な特徴は次のとおりです。

- ピアリングする 2 つの仮想ネットワークは、同じ Azure リージョンにあることが必要です。
- IP アドレス空間に重複のある VNet どうしをピアリングすることはできません。
- VNet ピアリングは、あくまで 2 つの仮想ネットワーク間の関係です。そこから派生した推移的な関係は存在しません。たとえば VNet A が VNet B とピアリングされ、VNet B が VNet C とピアリングされている場合、VNet A が VNet C とピアリングされていることにはなりません。
- ピアリングは 2 つの異なるサブスクリプションの仮想ネットワーク間で確立できますが、そのためには、それぞれのサブスクリプションの特権ユーザーがピアリングを承認していることが必要となります。
- Resource Manager VNet を別の Resource Manager VNet またはクラシック VNet との間でピアリングすることはできますが、2 つのクラシック VNet どうしをピアリングすることはできません。
- ピアリングされた VNet 内の仮想マシンどうしで行われる通信には帯域幅の制限はありませんが、VM サイズに基づく帯域幅の上限は依然として適用されます。


![VNet Peering Basic](./media/virtual-networks-peering-overview/figure01.png)

## 接続 
2 つの VNet をピアリングすると、一方の VNet 内の仮想マシン (Web ロール/worker ロール) が、ピアリングされているもう一方の VNet 内の他の仮想マシンと直接接続できるようになります。両者間には、IP レベルの完全な接続が確立されます。ピアリングされた VNet に存在する 2 つの仮想マシン間のネットワーク ラウンド トリップの待ち時間は、ローカル VNet 内と変わりません。ネットワーク スループットは、仮想マシンに許可された帯域幅を基準としています。許可されている帯域幅は、仮想マシンのサイズに比例するものであり、それ以外の制限は一切ありません。ピアリングされた VNet に存在する仮想マシン間のトラフィックは、ゲートウェイを介さず、Azure のバックエンド インフラストラクチャを介して直接ルーティングされます。

VNet 内の仮想マシンは、ピアリングされた VNet にある内部負荷分散エンドポイント (ILB) にアクセスすることができます。どちらかの VNet にネットワーク セキュリティ グループを適用すれば、もう一方の VNet やサブネットへのアクセスを適宜ブロックすることができます。ユーザーはピアリングを構成する際に、VNet 間のネットワーク セキュリティ グループの規則に関して開放するか閉じるかを選択できます。ピアリングされた VNet 間で完全な接続 (既定の選択肢) を開くように選択した場合、特定のサブネットまたは仮想マシンに NSG を使用して、特定のアクセスをブロック (拒否) することができます。

Azure には、仮想マシンに対する内部的な DNS 名前解決の機構が備わっていますが、その名前解決は、ピアリングされた VNet 越しには機能しません。仮想マシンの内部 DNS 名を解決できるのは、ローカルの仮想ネットワーク内に限られます。ただし、ピアリングされた VNet 内で実行される仮想マシンを仮想ネットワークの DNS サーバーとして構成することはできます。

## サービス チェイニング
ユーザーは、ピアリングされた VNet 内の仮想マシンを指すユーザー定義ルート テーブルを次ホップとして構成することができます (下図参照)。これを利用すると、一方の VNet からのトラフィックを、ユーザー定義ルート テーブルを介し、ピアリングされた VNet で実行される仮想アプライアンスにリダイレクトする手段としてのサービス チェイニングを実現できます。また事実上、ハブ アンド スポーク型の環境を構築することもできます。この場合、ハブでインフラストラクチャ コンポーネント (ネットワーク仮想アプライアンスなど) をホストし、すべてのスポーク VNet がハブとピアリングの関係を結ぶことによって、そのトラフィックの一部をハブ VNet で実行されているアプライアンスにリダイレクトすることができます。つまり、ピアリングされた VNet 内の仮想マシンに、"ユーザー定義ルート テーブル" 上の次ホップ IP アドレスを割り当てることができます。

## ゲートウェイとオンプレミスの接続
すべての仮想ネットワークは、別の VNet とピアリングされているかどうかに関係なく独自のゲートウェイを持っており、そのゲートウェイを使用してオンプレミスに接続することができます。ゲートウェイを使用して VNet 対 VNet 接続を構成 (リンクを提供) するときに、それらの VNet がピアリングされていてもかまいません。VNet 間の接続に両方の方法が構成されているときは、ピアリング構成を介して (つまり Azure バックボーンを介して) VNet 間のトラフィックが流れます。

VNet がピアリングされているとき、そのピアリングされた VNet のゲートウェイを、オンプレミスへのトランジット ポイントとして使用するように構成することもできます。この場合、リモート ゲートウェイを使用する VNet が、その独自のゲートウェイを持つことはできません。単純化するために、1 つの VNet が所有できるゲートウェイは 1 つに限られています。それは下の図に示すように、ローカル ゲートウェイと (ピアリングされた VNet の) リモート ゲートウェイのどちらでもかまいません。Resource Manager VNet とクラシック VNet との間では、ゲートウェイ転送がサポートされません。ゲートウェイ転送が正しく機能するためには、ピアリング関係で結ばれた両方の VNet が Resource Manager VNet であることが必要です。1 本の ExpressRoute 回線を共有する VNet どうしをピアリングした場合、両者間のトラフィックは、そのピアリング関係を通過することになります (つまり Azure バックボーン ネットワークが使用されます)。それでも、各 VNet のローカル ゲートウェイを使用してオンプレミス回線に接続するか、共有ゲートウェイを使用してオンプレミス接続用のトランジットを構成することは可能です。

![VNet Peering Transit](./media/virtual-networks-peering-overview/figure02.png)

## プロビジョニング
VNet ピアリングは、特権の下で許可される操作であり、Virtual Network 名前空間に独立した機能として存在します。ユーザーに特定の権限を付与することによってピアリングを承認することができます。VNet に対する読み取り/書き込みアクセス権を持つユーザーには、この権限が自動的に継承されます。VNet に対するピアリング操作は、管理者権限を持つユーザーまたはピアリング機能の特権を与えられたユーザーが開始できます。対応するピアリング要求がもう一方の側に存在し、その他各種の要件が満たされた場合にピアリングは確立されます。

2 つの仮想ネットワーク間に VNet ピアリングを確立する方法について詳しくは、具体的な方法を取り上げた記事をご覧ください。

## 制限
1 つの仮想ネットワークに許可されるピアリング数には制限があります。詳細については、[Azure ネットワークの制限](../azure-subscription-service-limits.md#networking-limits)に関するセクションを参照してください。

## 価格
評価期間中は VNet ピアリングに料金は発生しません。一般公開用にリリースされると、ピアリングを利用するイグレス トラフィックとエグレス トラフィックに少額の料金が発生します。詳細については、[価格のページ](https://azure.microsoft.com/pricing/details/virtual-network)をご覧ください。


## 次のステップ
- [仮想ネットワーク間のピアリングのセットアップ](virtual-networks-create-vnetpeering-arm-portal.md)。
- [NSG](virtual-networks-nsg.md) について。
- [ユーザー定義のルートと IP 転送](virtual-networks-udr-overview.md)の概要。

<!---HONumber=AcomDC_0803_2016-->