<properties
	pageTitle="Azure Search でクエリとインデックス作成のワークロードに応じてリソース レベルをスケールする |Microsoft Azure"
	description="Azure Search の容量計画は、パーティションとレプリカのコンピューティング リソースの組み合わせに基づいており、各リソースは課金対象の検索単位で価格設定されます。"
	services="search"
	documentationCenter=""
	authors="HeidiSteen"
	manager="paulettm"
	editor=""
    tags="azure-portal"/>

<tags
	ms.service="search"
	ms.devlang="NA"
	ms.workload="search"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.date="05/25/2016"
	ms.author="heidist"/>

# Azure Search でクエリとインデックス作成のワークロードに応じてリソース レベルをスケールする

Azure Search では、クエリを強化してインデックス作成のパフォーマンスを向上させるため、ストレージと IO、またはレプリカがさらに必要な場合にパーティションを増やすことで、特定のコンピューティング リソースの容量を段階的に調整できます。

[Basic レベル](http://aka.ms/azuresearchbasic)または [Standard レベル](search-limits-quotas-capacity.md)のいずれかでサービスをプロビジョニングすると、スケーラビリティが実現します。

課金対象のすべてのレベルでは、容量は*検索単位* (SU) ごとに購入します。各パーティションとレプリカは 1 SU としてカウントします。

- Basic では、サービスごとに最大 3 SU を提供します。
- Standard では、サービスごとに最大 36 SU を提供します。

レベルの制限を下回っているパーティションとレプリカの組み合わせを必ず選択してください。ポータルを利用してスケールアップする場合、ポータルによって、利用可能な組み合わせに制限が適用されます。

原則として、検索アプリケーションで必要なレプリカ数はパーティション数よりも多くなります。この理由は、次の[高可用性](#HA)に関するセクションで説明します。

<a id="HA"></a>
## 高可用性のためのリソース割り当て

通常、簡単かつ比較的速くスケールアップできるため、1 つのパーティションと 1 ～ 2 つのレプリカで開始し、クエリ数の増加に合わせてスケールアップルすことをお勧めします。多くのデプロイについて、1 つのパーティションで十分なストレージと IO が提供されます (パーティションあたり 1,500 万個のドキュメント)。

ただし、クエリのワークロードは主にレプリカ上で実行されます。スループットまたは高可用性を高める必要がある場合は、レプリカを追加できます。

高可用性のための一般的な推奨事項は次のとおりです。

- 読み取り専用ワークロード (クエリ) の高可用性を実現するには 2 つのレプリカ
- 読み取り/書き込みワークロード (クエリとインデックス作成) の高可用性を実現するには 3 つ以上のレプリカ

## 障害復旧

現時点では、障害復旧のための組み込みのメカニズムはありません。追加のパーティションまたはレプリカは、障害復旧の目標を達成する手段として適切ではありません。最も一般的なアプローチでは、別のリージョンにもう 1 つの検索サービスをプロビジョニングすることで、そのサービス レベルに冗長性を追加します。

> [AZURE.NOTE] サービス レベル アグリーメントとスケーラビリティは、Basic レベルと Standard レベルのサービスの機能であることを思い出してください。無料のサービスのリソース レベルは固定であり、レプリカとパーティションを複数のサブスクライバーで共有します。無料のサービスで開始し、アップグレードが必要になった場合は、新しい Azure Search サービスを Basic レベルか Standard レベルで作成し、インデックスとデータを新しいサービスに再読み込みする必要があります。サービス プロビジョニングについては、「[Create an Azure Search service in the portal (ポータルで Azure Search サービスを作成する)](search-create-service-portal.md)」を参照してください。

## 用語: パーティションとレプリカ

**パーティション**では、ストレージと IO が提供されます。1 つの Search サービスは最大 12 個のパーティションを持つことができます。各パーティションには、1,500 万個のドキュメントまたは 25 GB のストレージのいずれか (先に達したほう) のハード制限があります。パーティションを追加すれば、Search サービスでさらにドキュメントを読み込めます。たとえば、最初に最大 25 GB のデータを格納する 1 つのパーティションのあるサービスに 2 つ目のパーティションを追加すると、50 GB 格納できるようになります。

**レプリカ**は、検索エンジンのコピーです。1 つの Search サービスは最大 12 個のレプリカを持つことができます。最低 2 つのレプリカが読み取り (クエリ) 可能で、最低 3 つのレプリカが読み取り/書き込み (クエリ、インデックス作成) 可能である必要があります。

## レプリカでクエリ パフォーマンスを向上させる

クエリの遅延は、追加のレプリカが必要かどうかのインジケーターとなります。通常、クエリ パフォーマンスを向上させるには、まずレプリカを追加します。

各インデックスのコピーは、各レプリカで実行されます。レプリカを追加すると、インデックスの追加のコピーがオンラインになって、より多くのクエリ ワークロードに対応し、複数のレプリカ全体の要求を負荷分散できるようになります。たとえば、インデックスが 6 個、レプリカが 3 個あった場合、各レプリカには 6 個すべてのインデックスのコピーが作成されます。

クエリ パフォーマンスは、クエリの複雑さや競合するワークロードに左右されるため、1 秒あたりのクエリ数 (QPS) を正確に提示できません。平均して、レプリカで約 15 個の QPS を実現できますが、クエリの複雑さ (ファセット クエリはさらに複雑です) やネットワーク待機時間によってはスループットがこれより幾分多く、または少なくなります。また、レプリカを追加するとスケールとパフォーマンスは間違いなく拡張されますが、最終的な結果は厳密に直線的な拡張にはなりません。3 つのレプリカを追加しても、スループットが 3 倍になるとは限りません。

ワークロードの QPS を見積もる方法などの、QPS の詳細については、[検索サービスの管理](search-manage.md)に関する記事を参照してください。

## パーティションでインデックス作成のパフォーマンスを向上させる

ほぼリアルタイムのデータ更新を要求する検索アプリケーションでは、レプリカよりも多くのパーティションが比例して必要になります。パーティションを追加すると、読み取り/書き込み操作がより多くのコンピューティング リソースに分散されます。また、追加のインデックスとドキュメントを格納するためのディスク領域も増加します。

インデックスが大きくなると、クエリの実行に時間がかかります。そのため、パーティションで段階的な増加が発生するたびに、レプリカでは小規模であるが比例的な増加が必要となる場合があります。前述のように、クエリの複雑さとボリュームは、クエリの実行が完了するまでの速度の要因となります。

## Basic レベル: パーティションとレプリカの組み合わせ

Basic サービスは、3 SU の上限に対して 1 個のパーティションと最大 3 つのレプリカを持つことができます。

<a id="chart"></a>
## Standard レベル: パーティションとレプリカの組み合わせ

次の表は、36 検索単位 (SU) の制限のもとで、レプリカとパーティションの組み合わせをサポートするために必要な検索単位を示しています。

- |- |- |- |- |- |- |
---|----|---|---|---|---|---|
**12 レプリカ**|12 SU|24 SU|36 SU|該当なし|該当なし|該当なし|
**6 つのレプリカ**|6 SU|12 SU|18 SU|24 SU|36 SU|該当なし|
**5 つのレプリカ**|5 SU|10 SU|15 SU|20 SU|30 SU|該当なし|
**4 つのレプリカ**|4 SU|8 SU<|12 SU|16 SU|24 SU|N/|
**3 つのレプリカ**|3 SU|6 SU|9 SU|12 SU|18 SU|36 SU|
**2 つのレプリカ**|2 SU|4 SU|6 SU|8 SU|12 SU|24 SU|
**1 つのレプリカ**|1 SU|2 SU|3 SU|4 SU|6 SU|12 SU|
該当なし|**1 個のパーティション**|**2 個のパーティション**|**3 個のパーティション**<|**4 個のパーティション**|**6 個のパーティション**|**12 個のパーティション**|


検索単位、価格、および容量の詳細については、Azure Web サイトをご覧ください。詳細については、「[料金の詳細」](https://azure.microsoft.com/pricing/details/search/)をご覧ください。

> [AZURE.NOTE] レプリカとパーティションの数は、均等に 12 分割される必要があります (具体的には、1、2、3、4、6、12)。これは、Azure Search では各インデックスがパーティション全体に分散されるように 12 のシャードに事前に分割されるためです。たとえば、サービスに 3 つのパーティションがあり、新しいインデックスを作成する場合、各パーティションにはインデックスの 4 つのシャードを含めます。Azure Search でインデックスがどのようにシャードされるかは実装の問題であり、今後のリリースで変更される場合があります。今日 12 個であっても、今後も必ず 12 個になるとは限りません。

## 特定のリソース割り当ての組み合わせに対応する検索単位数を R X P = SU により計算する

必要な SU 数の計算式は、レプリカの数にパーティションの数を掛けたものです。たとえば、3 個のレプリカに 3 個のパーティションを掛けた値は 9 つの検索単位として課金されます。

両方のレベルは、1 つの検索単位 (SU) としてカウントされる、1 つのレプリカと 1 個のパーティションから始まります。これは、レプリカとパーティションの両方が 1 つの検索単位としてカウントされる唯一の事例です。リソースを追加するごとに、レプリカまたはパーティションのいずれであっても、独自の SU としてカウントされます。

SU あたりのコストはレベルによって決定されます。SU あたりのコストは、Standard レベルより Basic レベルの方が安価です。各レベルの価格は、「[Search の価格](https://azure.microsoft.com/pricing/details/search/)」を参照してください。

<!---HONumber=AcomDC_0601_2016-->