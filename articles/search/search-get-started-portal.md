<properties 
	pageTitle="Azure Search の使用 | Microsoft Azure | クラウド検索サービス | DocumentDB" 
	description="Azure Search ソリューションを初めて作成する方を対象としたチュートリアルです。DocumentDB データを使用して Azure Search インデックスを作成する方法について説明します。ここで説明している手順はポータルからデータのインポート ウィザードを使った方法であり、コーディングは不要です。" 
	services="search" 
	documentationCenter="" 
	authors="HeidiSteen" 
	manager="mblythe" 
	editor=""
    tags="azure-portal"/>

<tags 
	ms.service="search" 
	ms.devlang="na" 
	ms.workload="search" 
	ms.topic="hero-article" 
	ms.tgt_pltfrm="na" 
	ms.date="02/10/2016" 
	ms.author="heidist"/>

# Azure ポータルから Azure Search を使用する

カスタム アプリケーションには、Microsoft Azure Search クラウド サービスを使って検索機能を追加することができます。このサービスは、データのストレージおよび検索エンジンとして機能し、Azure ポータル、.NET SDK、REST API のいずれかからアクセスして管理できます。

この記事では、ポータルに組み込まれている機能を使い、コーディングなしで Azure Search を利用する方法を紹介しています。このチュートリアルは、[サンプルの Azure DocumentDB データベース](#apdx-sampledata)を前提に説明しています。こちらで用意したサンプル データと手順を使ってデータベースは簡単に作成できますが、既にお持ちのデータ (DocumentDB または SQL Database) に同じワークフローを適用してもかまいません。

> [AZURE.NOTE] このチュートリアルには [Azure サブスクリプション](../includes/free-trial-note.md)と [Azure Search サービス](search-create-service-portal.md)が必要です。試用版サブスクリプションにサインアップする準備がまだできていない場合は、このチュートリアルをスキップし、代わりに [Azure App Service を試用](search-tryappservice.md)してください。この代替オプションの場合、Azure Search で ASP.NET Web アプリを無料で使用でき (セッションごとに 1 時間)、サブスクリプションは不要です。
 
## サービスの検索

1. [Azure ポータル](https://portal.azure.com)にサインインします。

2. Azure Search サービスのサービス ダッシュボードを開きます。ダッシュボードを見つけるには、次のいくつかの方法があります。
	- ジャンプバーで **[Search サービス]** をクリックします。ジャンプバーには、ご利用のサブスクリプションにプロビジョニングされているすべてのサービスが一覧表示されます。Search サービスが定義済みである場合、**[Search サービス]** が一覧に表示されます。
	- ジャンプバーで **[参照]** をクリックし、検索ボックスに「search」と入力すると、ご利用のサブスクリプションで作成されたすべての検索サービスが一覧表示されます。

## 領域の確認

多くのユーザーが最初に利用するのは、無料版のサービスです。このバージョンは、インデックス、データ ソース、インデクサーがそれぞれ 3 つに限定されています。十分な領域があることを確認してからこのチュートリアルを開始してください。このチュートリアルでは、それぞれのオブジェクトを 1 つ作成します。

## インデックスの作成とデータの読み込み

検索クエリは、*インデックス*を反復処理します。インデックスには、検索可能なデータやメタデータのほか、特定の検索の動作を最適化することを目的とした構造が含まれています。そこで最初にインデックスを定義してデータを投入する必要があります。

インデックスはいくつかの方法で作成できます。利用できる自動処理と連携機能の度合いによって、その方法は異なります。Azure SQL Database、Azure VM 上の SQL Server、DocumentDB など、Azure Search でクロールできるデータ ストアに実際のデータがあれば、インデクサーを使用してごく簡単にインデックスを作成し、データを投入することができます。

この作業をわかりやすく説明するために、Azure Search に用意されている*インデクサー*と**データのインポート** ウィザードを使い、Azure Search でクロールできる特定のデータ ソースを想定して話を進めたいと思います。

このチュートリアルで使用する[サンプル DocumentDB データベース](#apdx-sampledata)は簡単に作成できます。または独自のデータを使って以降の手順を実行してもかまいません。

<a id="defineDS"></a>
#### 手順 1: データ ソースを定義する

1. インデックスの作成とデータ投入はどちらもウィザードで実行できます。Azure Search サービス ダッシュボードで、コマンド バーの **[データのインポート]** をクリックしてウィザードを開始してください。

2. **[データ ソース]**、**[DocumentDB]**、**[名前]** の順にクリックし、データ ソースの名前を入力します。データ ソースは、Azure Search の接続オブジェクトとして、他のインデクサーと組み合わせて使用することができます。データ ソースを作成すると、ご利用のサービスから "既存のデータ ソース" として使用できるようになります。

3. 既にある DocumentDB アカウントを選択し、データベースとコレクションを選択します。このチュートリアル用にあらかじめ用意したサンプル データを使用する場合、データ ソースの定義は次のようになります。

  ![][2]

クエリが省略されていることに注目してください。今回はデータセットの変更追跡は実装しないので、これで問題ありません。レコードがいつ更新されたかを追跡するフィールドがデータセットに含まれている場合は、変更の追跡機能を使用してインデックスに対して選択的に更新を行うよう Azure Search インデクサーを構成することができます。

**[OK]** をクリックして、ウィザードのこの手順を完了します。

#### 手順 2: インデックスを定義する

引き続きウィザードで **[インデックス]** をクリックし、Azure Search インデックスを作成するためのデザイン画面を表示します。インデックスには少なくとも、名前とフィールド コレクションが必要です。加えて、1 つのフィールドがドキュメント キーとしてマークされている必要があります。ここでは DocumentDB データセットを使用しているため、フィールドはウィザードによって自動的に検出されます。インデックスにはフィールドが事前に読み込まれ、データ型が割り当てられます。

  ![][3]

フィールドとデータ型は構成されますが、属性の割り当ては手動で行う必要があります。フィールドがどのように使用されるかは、インデックスの属性によって制御されます。フィールド一覧の上部に並んだチェック ボックスが*インデックスの属性*です。

- **[取得可能]** は、そのフィールドが検索結果のリストに現れることを意味します。フィルター式でのみ使用されているフィールドなど、検索結果から抑制するフィールドを個別に指定できます。 
- **[フィルター可能]**、**[ソート可能]**、**[ファセット可能]** は、フィルタリング、並べ替え、ファセットのナビゲーション構造にフィールドを使用できるかどうかを決定します。 
- **[検索可能]** は、フィールドがフルテキスト検索の対象となることを意味します。数値フィールドとブール型フィールドは通常、検索対象外として指定されます。 

このページから移動する前に、インデックス内のフィールドで以下のオプション ([取得可能]、[検索可能] など) を使用するように指定してください。ほとんどのフィールドは "取得可能" です。また、文字列フィールドは大半が "検索可能" です ([key] を [検索可能] にする必要はありません)。いくつかのフィールド (genre、orderableOnline、rating、tags) については、[フィルター可能]、[ソート可能]、[ファセット可能] も選択します。
	
フィールド | 型 | オプション |
------|------|---------|
key | Edm.String | |
albumTitle | Edm.String | 取得可能、検索可能 |
albumUrl | Edm.String | 取得可能、検索可能 |
genre | Edm.String | 取得可能、検索可能、フィルター可能、ソート可能、ファセット可能 |
genreDescription | Edm.String | 取得可能、検索可能 |
artistName | Edm.String | 取得可能、検索可能 |
orderableOnline | Edm.Boolean | 取得可能、フィルター可能、ソート可能、ファセット可能 |
tags | Collection(Edm.String) | 取得可能、フィルター可能、ファセット可能 |
price | Edm.Double | 取得可能、フィルター可能、ファセット可能 |
margin | Edm.Int32 | |
評価 | Edm.Int32 | 取得可能、フィルター可能、ソート可能、ファセット可能 |
inventory | Edm.Int32 | Retrievable |
lastUpdated | Edm.DateTimeOffset | |

以下は、前掲の表に従って設定したインデックスのスクリーンショットです。こちらを参考に設定を確認してください。

 ![][4]

**[OK]** をクリックして、ウィザードのこの手順を完了します。

#### 手順 3: インデクサーを定義する

引き続き**データのインポート** ウィザードで、**[インデクサー]**、**[名前]** の順にクリックし、インデクサーの名前を入力します。それ以外の値はすべて既定値を使用してください。このオブジェクトによって、実行可能なプロセスが定義されます。作成したオブジェクトを定期的なスケジュールに設定することもできますが、ここでは、**[OK]** をクリックした直後にインデクサーが一度だけ実行されるよう、既定のオプションを使用します。

インポート データの項目をすべて入力し、準備を整えます。

  ![][5]

ウィザードを実行するために、**[OK]** をクリックしてインポートを開始し、ウィザードを閉じます。

## 進行状況の確認

進行状況を確認するためにサービス ダッシュボードに移動し、**[インデクサー]** タイルをダブルクリックしてインデクサーの一覧を開きます。先ほど作成したインデクサーが一覧に表示されていることがわかります。また、"進行中" や "成功" といったステータスに加え、Azure Search に対してインデックスが作成されたドキュメントの数が表示されます。

  ![][6]

## インデックスのクエリを実行する

以上で検索インデックスの設定は完了しました。インデックスを使ってクエリを実行することができます

**Search エクスプローラー**は、ポータルに組み込まれたクエリ ツールです。検索ボックスが備わっており、入力した検索から適切なデータが返されるかどうかを確認することができます。

1. コマンド バーの **[Search エクスプローラー]** をクリックします。
2. どのインデックスがアクティブになっているかを確認します。先ほど作成したインデックスではない場合、コマンド バーの **[インデックスの変更]** をクリックして目的のインデックスを選択します。
2. 検索ボックスを空にした状態で **[検索]** ボタンをクリックすると、すべてのドキュメントを返すワイルドカード検索が実行されます。
3. フルテキスト検索クエリをいくつか入力します。ワイルドカード検索の結果を見て、検索対象となるアーティスト、アルバム、ジャンルを確認できます。
4. [この記事の最後に紹介されている例](https://msdn.microsoft.com/library/azure/dn798927.aspx)を参考にクエリを調整し、インデックスに存在しそうな検索文字列を使用しながら、他のクエリ構文を試すなどして応用してみてください。

## 次のステップ

ウィザードを 1 回実行したら、最初に戻って個々のコンポーネント (インデックス、インデクサー、データ ソース) を表示したり変更を加えたりすることができます。インデックスでは一部の編集 (フィールドのデータ型の変更など) が禁止されていますが、ほとんどのプロパティおよび設定は変更を加えることができます。個々のコンポーネントを表示するには、**[インデックス]**、**[インデクサー]**、**[データ ソース]** のいずれかのタイルをダッシュボードでクリックしてください。既存のオブジェクトの一覧が表示されます。

この記事で触れられている他の機能について詳しくは、以下のリンクをクリックしてください。

- [インデクサー](search-indexer-overview.md)
- [Create Index (インデックスの作成)(インデックスの属性についての詳しい説明を含む)](https://msdn.microsoft.com/library/azure/dn798941.aspx)
- [Search エクスプローラー](search-explorer.md)
- [Search Documents (ドキュメントの検索)(クエリ構文の例を含む)](https://msdn.microsoft.com/library/azure/dn798927.aspx)

Azure 仮想マシン上の Azure SQL Database または SQL Server などその他のデータ ソースについても、データのインポート ウィザードを使った同じワークフローを利用できます。

> [AZURE.NOTE] インデクサーが新たに Azure Blob Storage のクロールに対応した旨が発表されましたが、これはプレビュー段階の機能であり、ポータルから利用することはできません。そのインデクサーを試すには、コードを記述する必要があります。詳細については、「[Azure Blob Storage 内ドキュメントのインデックスを Azure Search で作成する](search-howto-indexing-azure-blob-storage.md)」を参照してください。<a id="apdx-sampledata"></a>


## 付録: DocumentDB データベースからサンプル データを取得する

このセクションでは、このチュートリアルの作業用の小さなデータベースを DocumentDB に作成します。

以降の手順は一般的な手引きであり、細かな手順には触れていません。DocumentDB ポータルのナビゲーションやタスクに関してさらに詳しい情報が必要な場合は、DocumentDB のドキュメントを参照してください。ただし、必要となるコマンドの大半は、ダッシュボード上部またはデータベース ブレードに表示されるサービスのコマンド バーから利用できます。

  ![][1]

このデータセット用に 246 の JSON ドキュメントが用意されています。ドキュメント エクスプローラーのアップロード要件を満たすには、これらのドキュメントを数回 (100 個未満) に分けてアップロードする必要があります。

[ここをクリック](https://github.com/HeidiSteen/azure-search-get-started-sample-data)すると、"musicstore" という名前の JSON データ ファイルがいくつかあるので、それらをダウンロードしてください。

1. DocumentDB をご利用のサブスクリプションに追加し、サービス ダッシュボードを開きます。
2. **[データベースの追加]** をクリックして、`musicstoredb` という ID の新しいデータベースを作成します。作成後にデータベースの一覧 (ページの下の方) に表示されます。
2. データベース名をクリックして、データベース ブレードを開きます。
3. **[コレクションの追加]** をクリックして、`musicstorecoll` という ID のコレクションを作成します。
3. **[ドキュメント エクスプローラー]** をクリックします。
4. **[ドキュメントの追加]** をクリックします。
5. **[ドキュメントの追加]** で JSON ファイルをアップロードします。
	- 386\.json
	- 387\.json
	- . . .
6. **[クエリ エクスプローラー]** をクリックし、データがアップロードされたことを確認します。
7. ファイル数は合計 300 個未満なので、上位 300 件を選択するように既定のクエリを変更するか、「`select * from musicstorecoll`」というクエリを作成して **[クエリの実行]** をクリックすると簡単に確認できます。

ドキュメント番号 386 から始まり 669 で終わる JSON 出力が返されます。データが読み込まれたら、Azure Search **インポート ウィザード**で[そのデータを使用し、こちらのチュートリアルの手順を開始](#defineDS)できます。


<!--Image references-->
[1]: ./media/search-get-started-portal/AzureSearch-GetStart-Docdbmenu1.png
[2]: ./media/search-get-started-portal/AzureSearch-GetStart-DataSource.png
[3]: ./media/search-get-started-portal/AzureSearch-GetStart-DefaultIndex.png
[4]: ./media/search-get-started-portal/AzureSearch-GetStart-FinishedIndex.png
[5]: ./media/search-get-started-portal/AzureSearch-GetStart-ImportReady.png
[6]: ./media/search-get-started-portal/AzureSearch-GetStart-IndexerList.png

<!---HONumber=AcomDC_0211_2016-->