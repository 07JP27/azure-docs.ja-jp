<properties 
	pageTitle="Microsoft Azure で検索サービスを管理する" 
	description="Microsoft Azure で検索サービスを管理する" 
	services="search" 
	documentationCenter="" 
	authors="HeidiSteen" 
	manager="mblythe" 
	editor=""/>

<tags 
	ms.service="search" 
	ms.devlang="rest-api" 
	ms.workload="search" 
	ms.topic="article" 
	ms.tgt_pltfrm="na" 
	ms.date="01/16/2015" 
	ms.author="heidist"/>

# Microsoft Azure で検索サービスを管理する


[WACOM.INCLUDE [この記事では、Azure プレビュー ポータルを使用します。](../../includes/preview-portal-note.md)]

Azure Search は、カスタム検索アプリケーションで使用できるクラウドベースのサービスと HTTP ベースの API です。この検索サービスでは、全文検索テキスト分析のためのエンジン、高度な検索機能、検索データ ストレージ、クエリ コマンド構文が用意されています。 

この記事では、新しい [Azure プレビュー ポータル](https://portal.azure.com)で検索サービスを管理する方法について説明します。

または、管理 REST API を使用することができます。詳細については、「[Get started with Azure Search Management REST API (Azure Search 管理 REST API の使用)](http://azure.microsoft.com/documentation/articles/search-get-started-management-api/)」と「[Azure Search Management REST API reference (Azure Search REST API リファレンス)](http://msdn.microsoft.com/library/azure/dn832684.aspx)」を参照してください。

<!--TOC-->

+ [サブスクリプションに検索サービスを追加する](#sub-1)
+ [管理タスク](#sub-2)
+ [サービス URL](#sub-3)
+ [API キーを管理する](#sub-4)
+ [リソース使用量を監視する](#sub-5)
+ [拡大または縮小](#sub-6)
+ [サービスを開始または停止する](#sub-7)
+ [管理アクセスを制御するロールを設定する](#sub-8)

<h2 id="sub-1">サブスクリプションに検索サービスを追加する</h2>

管理者が検索サービスを設定する際には、最初に価格レベルの選択を決定します。オプションには、無料と標準の価格レベルがあります。

既存のサブスクライバーは、課金なしで共有サービスを使用できます。学習目的、概念実証のテスト、小規模な開発用プロジェクトの場合に適しています。共有サービスでは、ストレージが最大 50 MB、インデックスが最大 3 つ、ハードウェアの上限としてドキュメント数が 10,000 個 (ストレージの使用が許容最大限の 50 MB に達していない場合であっても) という制約があります。共有サービスではパフォーマンスは保証されないため、運用検索アプリケーションを構築する場合は標準検索を検討してください。

サブスクリプションのみで使用される専用のリソースとインフラストラクチャにサインアップするため、標準検索は課金の対象です。標準検索は、パーティション (ストレージ) とレプリカ (サービス ワークロード) のユーザー定義バンドルで割り当てられ、検索単位ごとに価格設定されます。パーティションまたはレプリカで個別に規模を拡大して、必要とされるリソースを追加することができます。

容量を考慮して計画し、課金の影響を理解するには、以下のリンクをお勧めします。

+	[Limits and constraints (Azure Search API) (制限と制約 (Azure Search API))](http://msdn.microsoft.com/library/dn798934.aspx)
+	[Pricing Details (料金の詳細)](http://go.microsoft.com/fwlink/p/?LinkdID=509792)

サインアップの準備ができたら、「[Azure Search の使用](search-get-started.md)」を参照してください。


<h2 id="sub-2">管理タスク</h2>

共同管理者に対応したサービスもありますが、Azure Search サービスの管理者はサブスクリプションごとに 1 人です。このセクションで概説したタスクを実行するには、管理者となる必要があります。
検索をサブスクリプションに追加するだけでなく、管理者は次の追加タスクも行います。

+	サービス URL (サービス プロビジョニング中に定義される) を配布する。
+	API キーを管理し配布する。
+	リソース使用量を監視する
+	規模を拡大または縮小する (標準検索のみに適用)
+	サービスを開始または停止する
+	管理アクセスを制御するロールを設定する

<h2 id="sub-3">サービス URL</h2>

サービス URL は、サービスを作成するときに固定プロパティとして定義され、後で変更することはできません。 

検索アプリケーションを構築する開発者は、HTTP 要求のためのサービス URL を知っている必要があります。サービス URL をすばやく見つけるには、サービス ダッシュボードを使用します。

サービス ダッシュボードからサービス URL を取得するには:

1.	[Azure プレビュー ポータル](https://portal.azure.com)にサインインします。
2.	**[参照]**、**[すべて]**、**[検索サービス]** の順にクリックします。
3.	目的の検索サービスの名前をクリックして、ダッシュボードを開きます。
4.	**[プロパティ]** をクリックしてプロパティ ページを開きます。ページの上部にサービス URL が表示されています。後ですばやくアクセスできるように、このページを固定できます。

    ![][8]

開発者から API バージョンに関する問い合わせがある可能性もあります。Azure Search API のコーディング要件として、要求では常に API バージョンを指定する必要があります。これは、開発者が以前のバージョンを引き続き使用して、適時に新しいバージョンに移行できるようにするための要件です。

API バージョンはポータル ページに表示されないため、管理者はこの情報を提供できません。現在および以前の API バージョンについては、「[Azure Search REST API (Azure Search REST API)](http://go.microsoft.com/fwlink/p/?LinkdID=509922)」を参照してください。


<!---->
<h2 id="sub-4">API キーを管理する</h2>

検索アプリケーションを構築する開発者は、検索にアクセスするために API キーが必要です。検索サービスへのすべての HTTP 要求には、対象のサービス用に生成された API キーが必要です。この API キーは、検索サービス URL に対する認証のための唯一のメカニズムです。

検索サービスへのアクセスには 2 種類のキーが使用されます。

+	管理 (すべての操作に有効)
+	クエリ (クエリ要求に対してのみ有効)

管理 API キーは、サービスで作成されます。プライマリ キーとセカンダリ キーがあります。どちらかのアクセスのレベルが高いということはなく、対等に使用できるため、キーをロール オーバーする場合に便利です。どちらの管理キーも再生成できますが、管理キーの合計数は追加できません。検索サービスごとに最大 2 個の管理キーを保持できます。

クエリ キーは、検索を直接呼び出すクライアント アプリケーションで使用するように設計されています。クエリ キーは最大 50 個まで作成できます。

API キーを取得または再生成するには、サービス ダッシュボードを開きます。**[キー]** をクリックし、キー管理ページを開きます。キーの再生成または作成のコマンドがページ上部にあります。

 ![][9]


<!---->
<h2 id="sub-5">リソース使用量を監視する</h2>

このパブリック プレビューでは、監視リソースの対象が、サービス ダッシュボードに表示される情報と、サービスのクエリで取得できるいくつかのメトリックに限定されます。

サービス ダッシュボードの [使用] セクションで、パーティション リソース レベルが自分のアプリケーションに適しているかどうかをすばやく決定できます。

Search サービス API を使用して、ドキュメントとインデックスの数を取得できます。料金レベルに基づいて、これらの数に関連付けられたハードウェアの制限があります。詳細については、「[Limits and constraints (Azure Search API) (制限と制約 (Azure Search API))](http://msdn.microsoft.com/library/dn798934.aspx)」を参照してください。 

+	[Get Index Statistics (Azure Search API) (インデックス統計の取得 (Azure Search API))](http://msdn.microsoft.com/library/dn798942.aspx)
+	[Count Documents (Azure Search) (ドキュメントのカウント (Azure Search))](http://msdn.microsoft.com/library/dn798924.aspx)

> [WACOM.NOTE] キャッシング動作により、一時的に制限を超える場合があります。たとえば、共有サービスの使用時に、ドキュメント数がハードウェアの制限である 10,000 個を超える場合があります。この超過は一時的であり、次の制限強制チェックで検出されます。 


<!---->
<h2 id="sub-6">拡大または縮小</h2>

 すべての検索サービスは、最小限の 1 つのレプリカと 1 つのパーティションで開始されます。標準の価格レベルを使用して専用のリソースにサインアップした場合は、サービス ダッシュボードの **[規模の設定]** タイルをクリックして、サービスで使用するパーティションとレプリカの数を再調整できます。

いずれかのリソースを追加すると、それらは自動的にサービスに使用されます。それ以外のアクションは必要ありませんが、新しいリソースの影響が現れるまでわずかに遅延が発生します。追加のリソースのプロビジョニングには 15 分以上かかる場合があります。

 ![][10]

<h3>レプリカの追加</h3>

1 秒あたりのクエリ (QPS) の増加や高可用性の実現は、レプリカの追加により達成できます。各レプリカにはインデックスのコピーが 1 つあるため、レプリカを 1 つ追加することは、サービス クエリ要求で使用できるインデックスを 1 つ追加することです。現在、一般的には、高可用性のために少なくとも 3 つのレプリカが必要です。 

より多くのレプリカを持つ検索サービスでは、より多くのインデックスに対してクエリ要求を負荷分散できます。特定のクエリの数量のレベルで、要求のサービスで利用できるインデックスのコピーが多いほど、クエリ スループットはより高速になります。クエリの遅延が発生した場合は、追加のレプリカをオンラインにすることでパフォーマンスの向上が期待できます。

レプリカを追加するとクエリのスループットは向上しますが、サービスにレプリカを追加することにより厳密に 2 倍や 3 倍になるわけではありません。すべての検索アプリケーションは、クエリ パフォーマンスに影響を与える外部要因の影響を受けます。クエリの応答時間を変動させる 2 つの要因として、複雑なクエリおよびネットワークの遅延があります。

<h3>パーティションの追加</h3>

ほとんどのサービス アプリケーションには、パーティション数ではなくレプリカ数の増加への固有のニーズがあります。検索を使用するアプリケーションの大半は、最大 1,500 万個のドキュメントをサポートできる単一のパーティションに容易に収まるためです。 

このようにドキュメント数を増やす必要がある状況で、パーティションを追加できます。パーティションが 12 の倍数 (具体的には、1、2、3、4、6、12) で追加されることに注意してください。これはシャーディングに起因するものです。インデックスは 12 個のシャードで作成され、これらはすべて 1 個のパーティションまたは均等に 2、3、4、6、12 個のパーティションに格納されます (パーティションごとに 1 つのシャード)。

<h3>レプリカの削除 </h3>

クエリの数量が多い期間の後 (たとえば、休日のセールの終了後) には、ほとんどの場合、検索クエリの負荷が正常化した時点でレプリカを削除します。

そのためには、レプリカ スライダーを少ない数の方に動かします。それ以外の手順は必要ありません。レプリカの数を減らすと、データ センター内の仮想マシンが解放されます。クエリとデータ インジェストの操作は、以前よりも少ない数の VM で実行されます。最小数は 1 つのレプリカです。

<h3>パーティションの削除</h3>

追加の手順を必要としないレプリカの削除に比べ、削除できる量よりも多くのストレージを使用している場合の手順は少し複雑です。たとえば、3 つのパーティションを使用しているソリューションでは、パーティションを 1 つまたは 2 つに減らしたときに、それらのパーティションで格納できる量よりも多くのストレージ領域を使用している場合はエラーが生成されます。その場合は、インデックスまたは関連付けられたインデックス内のドキュメントを削減して領域を解放するか、現在の構成を維持するかを選択できます。

特定のパーティションにどのインデックス シャードが格納されているかを検出する方法はありません。各パーティションで約 25 GB のストレージが提供されるため、現在のパーティションの数で対応できるサイズまでストレージを削減する必要があります。1 つのパーティションに戻す場合は、12 個のシャードをすべて収める必要があります。

将来の計画を立てるには、ストレージをチェックして (「[Get Index Statistics (Azure Search API) (インデックス統計の取得 (Azure Search API))](http://msdn.microsoft.com/library/dn798942.aspx)」を使用) 実際にどのくらい使用したか確認します。 


<!---->
<h2 id="sub-7">サービスを開始または停止する</h2>

サービス ダッシュボードのコマンドを使用して、サービスの開始と停止だけでなく削除も行うことができます。

 ![][11]


サービスの停止または開始により、課金がなくなるわけではありません。課金されないようにするには、サービスを削除する必要があります。サービスを廃止すると、サービスに関連付けられたデータはすべて削除されます。

<!---->
<h2 id="sub-8">管理アクセスのロールを設定する</h2>

Azure は、カスタム管理ツールを使用している場合、プレビュー ポータルで、または、Azure リソース マネージャー API で管理するすべてのサービスに対して、グローバルなロールベースの承認モデルを用意しています。所有者、共同作成者、および閲覧者のロールは、各ロールに割り当てる Active Directory のユーザー、グループ、およびセキュリティ プリンシパルに対するサービス管理レベルを設定します。ロール メンバーシップの詳細については、「[Role-based access control in Azure Preview Portal (Azure プレビュー ポータルのロール ベースのアクセス制御)](http://azure.microsoft.com/updates/role-based-access-control-in-azure-preview-portal/)」を参照してください。

Azure Search の観点から、ロールベースのアクセス制御は次の管理タスクを決定します。

<table>
<tr>
<td>所有者</td>
<td>
サービスを開始、停止、または削除します。</br>
管理キーとクエリ キーを生成し、表示します。</br>
インデックス数、インデックス名、ドキュメント数、およびストレージ サイズを含む、サービスの状態を表示します。</br>
ロール メンバーシップを追加または削除します (所有者のみがロール メンバーシップを管理できます)。</br>
</br>
サブスクリプションおよびサービス管理者は、所有者ロールに自動的なメンバーシップを持ちます。
</td>
</tr>
<tr>
<td>共同作成者</td>	
<td>ロール管理を除き、アクセス レベルは所有者と同じです。たとえば、共同作成者は `api-key` を再生成できますが、ロール メンバーシップは変更できません。
</td>
</tr>
<tr>
<td>閲覧者</td>
<td>サービスの状態とクエリのキーを表示します。このロールのメンバーは、サービスの開始または停止ができず、管理キーの表示もできません。
</td>
</tr>
</table>

ロールは、サービス エンドポイントへのアクセス権を付与しないことに注意してください。インデックスの管理、インデックスの作成、検索データのクエリなど、検索サービスの操作は、ロールではなく API キーによって制御されます。詳細については、「[Role-based access control in Azure Preview Portal Azure (Azure プレビュー ポータルのロール ベースのアクセス制御)](http://azure.microsoft.com/updates/role-based-access-control-in-azure-preview-portal/)」で「管理のための承認とデータ操作」を参照してください。

ロールは、サービスが作成された後のアクセス制御を行います。サブスクリプションの管理者だけが、サブスクリプションに検索サービスを追加できます。


<!--Anchors-->
[サブスクリプションに検索サービスを追加する]: #sub-1
[管理タスク]: #sub-2
[サービス URL]: #sub-3
[API キーを管理する]: #sub-4
[リソース使用量を監視する]: #sub-5
[拡大または縮小]: #sub-6
[サービスを開始または停止する]: #sub-7
[管理アクセスを制御するロールを設定する]: #sub-8


<!--Image references-->
[8]: ./media/search-manage/Azure-Search-Manage-1-URL.png
[9]: ./media/search-manage/Azure-Search-Manage-2-Keys.png
[10]: ./media/search-manage/Azure-Search-Manage-3-ScaleUp.png
[11]: ./media/search-manage/Azure-Search-Manage-4-StartStop.png


<!--Link references-->
[Azure Search の使用]: ../search-get-started/
[Azure Search 開発ワークフロー]: ../search-workflow/
[最初の Azure Search ソリューションを作成する]: ../search-create-first-solution/


<!--HONumber=46--> 
 