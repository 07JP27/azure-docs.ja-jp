<properties urlDisplayName="How to scale" pageTitle="クラウド サービスのスケールの設定方法 - Azure" metaKeywords="Azure link resource, scaling cloud service" description="Azure でクラウド サービスおよびリンク済みリソースのスケールを設定する方法について説明します。" metaCanonical="" services="cloud-services" documentationCenter="" title="アプリケーションのスケールの設定方法" authors="davidmu" solutions="" manager="timlt" editor="" />

<tags ms.service="cloud-services" ms.workload="tbd" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="10/21/2014" ms.author="davidmu" />

# アプリケーションのスケールの設定方法

Azure の管理ポータルの [スケール] ページで、アプリケーションのスケールを手動で設定するか、パラメーターを指定して自動的にスケールを設定することができます。Web ロール、ワーカー ロール、または仮想マシンを実行しているアプリケーションのスケールを設定できます。Web ロールまたは Worker ロールのインスタンスを実行しているアプリケーションのスケールを設定するには、ロール インスタンスを追加または削除してワーク ロードを調整します。

仮想マシンを実行しているアプリケーションのスケールを増減しても、マシンが新たに作成されたり削除されたりすることはなく、以前に作成された仮想マシンの可用性セットでオン/オフされるだけです。平均 CPU 使用率 (%)、またはキュー内のメッセージの数に基づいてスケールの設定を指定できます。

アプリケーションのスケールの設定を構成する前に、以下に示す情報を考慮してください。

-   仮想マシンを使用するアプリケーションのスケールを設定するには、作成するマシンを可用性セットに追加する必要があります。追加する仮想マシンは最初はオンでもオフでもかまいませんが、スケールアップ操作ではオンに、スケールダウン操作ではオフに設定されます。仮想マシンと可用性セットの詳細については、「[Manage the Availability of Virtual Machines (仮想マシンの可用性の管理)][Manage the Availability of Virtual Machines (仮想マシンの可用性の管理)]」を参照してください。
-   スケール設定はコア使用量の影響を受けます。より大きいロール インスタンスまたは仮想マシンは、より多くのコアを使用します。アプリケーションのスケールの設定は、サブスクリプションのコア数の制限内でのみ行うことができます。たとえば、サブスクリプションにコア数 20 の制限があり、アプリケーションを 2 つの中スケールの仮想マシンで実行している場合 (合計 4 コア)、サブスクリプション内の他のクラウド サービスの展開は 16 コアまでしかスケールアップできません。アプリケーションのスケールの設定に使用される可用性セット内のすべての仮想マシンは、同じサイズである必要があります。コア使用量とマシンのサイズの詳細については、「[Virtual Machine and Cloud Service Sizes for Azure (Azure の仮想マシンおよびクラウド サービスのサイズ)][Virtual Machine and Cloud Service Sizes for Azure (Azure の仮想マシンおよびクラウド サービスのサイズ)]」を参照してください。
-   メッセージのしきい値に基づいてアプリケーションのスケールを設定する前に、キューを作成してロールまたは可用性セットに関連付ける必要があります。詳細については、「[How to use the Queue Storage Service (キュー ストレージ サービスの使用方法)][How to use the Queue Storage Service (キュー ストレージ サービスの使用方法)]」を参照してください。
-   クラウド サービスにリンクされたリソースのスケールを設定できます。リソースのリンクの詳細については、「[方法: クラウド サービスに対するリソースのリンク」][方法: クラウド サービスに対するリソースのリンク」]を参照してください。
-   アプリケーションの高可用性を可能にするには、アプリケーションを 2 つ以上のロール インスタンスまたは仮想マシンと共に展開する必要があります。詳細については、「[サービス レベル アグリーメント][サービス レベル アグリーメント]」を参照してください。

クラウド サービスに対して次のスケール設定操作を実行できます。

-   [Web ロールまたはワーカー ロールを実行しているアプリケーションのスケールの手動設定][Web ロールまたはワーカー ロールを実行しているアプリケーションのスケールの手動設定]
-   [Web ロール、ワーカー ロール、または仮想マシンを実行しているアプリケーションのスケールの自動設定][Web ロール、ワーカー ロール、または仮想マシンを実行しているアプリケーションのスケールの自動設定]
-   [リンク済みリソースのスケールの設定][リンク済みリソースのスケールの設定]
-   [アプリケーションのスケールのスケジュール][アプリケーションのスケールのスケジュール]

## <span id="manualscale"></span></a>Web ロールまたはワーカー ロールを実行しているアプリケーションのスケールの手動設定

[スケール] ページで、クラウド サービスで実行中のインスタンスの数を手動で増減できます。

1.  [管理ポータル][管理ポータル]で、**[クラウド サービス]** をクリックし、クラウド サービスの名前をクリックしてダッシュボードを開きます。

2.  **[スケール]** をクリックします。既定では、すべてのロールに対して自動スケールの設定は無効になっていますが、アプリケーションで使用するインスタンスの数を手動で変更できます。

    ![[スケール] ページ][]

3.  クラウド サービス内の各ロールには、使用するインスタンスの数を変更するスライダーがあります。ロール インスタンスを追加するには、垂直バーを右にドラッグします。インスタンスを削除するには、バーを左にドラッグします。

    ![ロールのスケールの設定][ロールのスケールの設定]

    増やすことができるのは、インスタンスをサポートするために適切な数のコアを使用できる場合に使用されるインスタンスの数だけです。スライダーの色は、サブスクリプションで使用しているコアと使用できるコアを表します。

    -   ブルーは、選択したロールで使用されているコアを表します
    -   ダーク グレーは、サブスクリプションのすべてのロールと仮想マシンで使用されているコアを表します
    -   ライト グレーは、スケールの設定に使用できるコアを表します
    -   ピンクは、保存されていない変更を表します

4.  **[保存]** をクリックします。選択に応じて、ロール インスタンスが追加または削除されます。

## <span id="autoscale"></span></a>Web ロール、ワーカー ロール、または仮想マシンを実行しているアプリケーションのスケールの自動設定

[スケール] ページで、アプリケーションで使用するインスタンスまたは仮想マシンの数を自動的に増減するようにクラウド サービスを構成できます。以下のパラメーターに基づいて、スケールの設定を構成できます。

-   [平均 CPU 使用率][平均 CPU 使用率] - 平均 CPU 使用率 (%) が指定されたしきい値を上回った場合、または下回った場合に、ロール インスタンスが作成または削除されるか、可用性セットで仮想マシンがオンまたはオフになります。
-   [キュー メッセージ][キュー メッセージ] – キュー内のメッセージの数が指定されたしきい値を上回った場合、または下回った場合に、ロール インスタンスが作成または削除されるか、可用性セットで仮想マシンがオンまたはオフになります。

### <span id="averagecpu"></span></a>平均 CPU 使用率

1.  [管理ポータル][管理ポータル]で、**[クラウド サービス]** をクリックし、クラウド サービスの名前をクリックしてダッシュボードを開きます。
2.  **[スケール]** をクリックします。
3.  ロールまたは可用性セットのセクションにスクロールし、**[CPU]** をクリックします。これで、アプリケーションが使用する CPU リソースの平均パーセンテージに基づいて、アプリケーションは自動スケールに設定されます。

    ![スケールの自動設定オン][スケールの自動設定オン]

4.  各ロールまたは可用性セットには、使用できるインスタンスの数を変更するスライダーがあります。使用できるインスタンスの最大数を設定するには、右側のバーを右にドラッグします。使用できるインスタンスの最小数を設定するには、左側のバーを左にドラッグします。

    **注:** [スケール] ページの **[インスタンス]** は、ロール インスタンスまたは仮想マシンのインスタンスを表します。

    ![インスタンス範囲][インスタンス範囲]

    インスタンスの最大数は、サブスクリプションで使用できるコア数で制限されます。スライダーの色は、サブスクリプションで使用しているコアと使用できるコアを表します。

    -   ブルーは、ロールが使用できる最大コア数を表します。
    -   ダーク グレーは、サブスクリプションのすべてのロールと仮想マシンで使用されているコアを表しますこの値がロールで使用するコア数と重なると、色はダーク ブルーに変わります。
    -   ライト グレーは、スケールの設定に使用できるコアを表します。
    -   ピンクは、保存されていない変更を表します。

5.  スライダーが、平均 CPU 使用率 (%) の範囲を指定するために使用されます。平均 CPU 使用率 (%) が最大設定を上回った場合、より多くのロール インスタンスが作成されるか、仮想マシンがオンになります。平均 CPU 使用率 (%) が最小設定を下回った場合、ロール インスタンスが削除されるか、仮想マシンがオフになります。平均 CPU 使用率の最大値を設定するには、右側のバーを右にドラッグします。平均 CPU 使用率の最小値を設定するには、左側のバーを左にドラッグします。

    ![ターゲット CPU][ターゲット CPU]

6.  アプリケーションがスケールアップされるたびに追加またはオンにするインスタンスの数を指定できます。アプリケーションがスケールアップしたときに作成またはオンにするインスタンスの数を増やすには、バーを右にドラッグします。数を減らすには、バーを左にドラッグします。

    ![CPU のスケールアップ][CPU のスケールアップ]

7.  最後のスケール設定操作と次のスケールアップ操作の間の待機時間 (分) を設定します。最後のスケール設定操作は、スケールアップまたはスケールダウンです。

    ![稼働時間][稼働時間]

    平均 CPU 使用率 (%) の計算時にはすべてのインスタンスが含まれ、平均はその前の 1 時間の使用状況に基づきます。アプリケーションで使用しているインスタンスの数によっては、待機時間が非常に低く設定されている場合、スケール設定操作が行われるまでに指定した待機時間よりも長い時間がかかることがあります。スケール設定操作の間の最小時間は 5 分です。いずれかのインスタンスが移行中の状態にある場合、スケール設定操作は実行できません。

8.  アプリケーションがスケールダウンしたときに削除またはオフにするインスタンスの数も指定できます。アプリケーションがスケールダウンしたときに削除またはオフにするインスタンスの数を増やすには、バーを右にドラッグします。数を減らすには、バーを左にドラッグします。

    ![CPU のスケールダウン][CPU のスケールダウン]

    アプリケーションで CPU 使用率の突然の増加がある場合は、インスタンスの最低数がそれらを処理するために十分であることを確認する必要があります。

9.  最後のスケール設定操作と次のスケールダウン操作の間の待機時間 (分) を設定します。最後のスケール設定操作は、スケールアップまたはスケールダウンです。

    ![休止時間][休止時間]

10. **[保存]** をクリックします。スケール設定操作は、終了までに最大で 5 分かかります。

### <span id="queuemessages"></span></a>キュー メッセージ

1.  [管理ポータル][管理ポータル]で、**[クラウド サービス]** をクリックし、クラウド サービスの名前をクリックしてダッシュボードを開きます。
2.  **[スケール]** をクリックします。
3.  ロールまたは可用性セットのセクションにスクロールし、**[キュー]** をクリックします。これで、キュー メッセージの目標数に基づいて、アプリケーションは自動スケールに設定されます。

    ![キューのスケールの設定][キューのスケールの設定]

4.  クラウド サービス内の各ロールまたは可用性セットには、使用できるインスタンスの数を変更するスライダーがあります。使用できるインスタンスの最大数を設定するには、右側のバーを右にドラッグします。使用できるインスタンスの最小数を設定するには、左側のバーを左にドラッグします。

    ![キューの範囲][キューの範囲]

    **注:** [スケール] ページの **[インスタンス]** は、ロール インスタンスまたは仮想マシンのインスタンスを表します。

    インスタンスの最大数は、サブスクリプションで使用できるコア数で制限されます。スライダーの色は、サブスクリプションで使用しているコアと使用できるコアを表します。

    -   ブルーは、ロールが使用できる最大コア数を表します。
    -   ダーク グレーは、サブスクリプションのすべてのロールと仮想マシンで使用されているコアを表しますこの値がロールで使用するコア数と重なると、色はダーク ブルーに変わります。
    -   ライト グレーは、スケールの設定に使用できるコアを表します。
    -   ピンクは、保存されていない変更を表します。

5.  使用するキューに関連付けられたストレージ アカウントを選択します。

    ![ストレージ名][ストレージ名]

6.  キューを選択します

    ![キュー名][キュー名]

7.  各インスタンスがサポートするメッセージ数を指定します。インスタンスは、マシンあたりの目標メッセージ数で割られた合計メッセージ数に基づいてスケールが設定されます。

    ![メッセージ数][メッセージ数]

8.  アプリケーションがスケールアップされるたびに追加またはオンにするインスタンスの数を指定できます。アプリケーションがスケールアップしたときに追加またはオンにするインスタンスの数を増やすには、バーを右にドラッグします。数を減らすには、バーを左にドラッグします。

    ![CPU のスケールアップ][CPU のスケールアップ]

9.  最後のスケール設定操作と次のスケールアップ操作の間の待機時間 (分) を設定します。最後のスケール設定操作は、スケールアップまたはスケールダウンです。

    ![稼働時間][稼働時間]

    スケール設定操作の間の最小時間は 5 分です。いずれかのインスタンスが移行中の状態にある場合、スケール設定操作は実行できません。

10. アプリケーションがスケールダウンしたときに削除するインスタンス、または使用しないインスタンスの数も指定できます。スライダーを使用して、スケール設定の増分を指定します。アプリケーションがスケールダウンしたときに削除するインスタンス、または使用しないインスタンスの数を増やすには、バーを右にドラッグします。数を減らすには、バーを左にドラッグします。

    ![CPU のスケールダウン][CPU のスケールダウン]

11. 最後のスケール設定操作と次のスケールダウン操作の間の待機時間 (分) を設定します。最後のスケール設定操作は、スケールアップまたはスケールダウンです。

    ![休止時間][休止時間]

12. **[保存]** をクリックします。スケール設定操作は、終了までに最大で 5 分かかります。

## <span id="scalelink"></span></a>リンク済みリソースのスケールの設定

多くの場合、ロールのスケールを設定するときに、アプリケーションが使用しているデータベースのスケールもあわせて変更するのが得策です。データベースをクラウド サービスにリンクする場合、[スケール] ページで SQL データベースのエディションを変更し、データベースのスケールを変更します。

1.  [管理ポータル][管理ポータル]で、**[クラウド サービス]** をクリックし、クラウド サービスの名前をクリックしてダッシュボードを開きます。
2.  **[スケール]** をクリックします。
3.  [リンク済みリソース] セクションで、データベースに使用するエディションを選択します。

    ![リンク済みリソース][リンク済みリソース]

4.  データベースのサイズを選択します。
5.  **[保存]** をクリックして、リンクされたリソースを更新します。

## <span id="schedule"></span></a>アプリケーションのスケールのスケジュール

さまざまな時間のスケジュールを構成することで、アプリケーションの自動スケールをスケジュールできます。自動スケールでは、次のオプションを使用できます。

-   **スケジュールなし**: これは既定のオプションで、常に同じ方法でアプリケーションを自動的にスケール設定できるようにします。

-   **昼夜**: このオプションを使用すると、昼夜の特定の時刻にスケール設定を指定できます。

**注:** 仮想マシンを使用するアプリケーションには、現在のところスケジュールを使用できません。

1.  [管理ポータル][管理ポータル]で、**[クラウド サービス]** をクリックし、クラウド サービスの名前をクリックしてダッシュボードを開きます。
2.  **[スケール]** をクリックします。
3.  [スケール] ページで、**[スケジュール時間の設定]** をクリックします。

    ![スケールのスケジュール][スケールのスケジュール]

4.  設定するスケール スケジュールの種類を選択します。

5.  昼の開始時刻と終了時刻を指定し、タイム ゾーンを設定します。昼夜スケジュールの場合、これらの時刻は昼の開始と終了を表し、残りの時間は夜を表します。

6.  ページの下部にあるチェック マークをオンにして、スケジュールを保存します。

7.  スケジュールは、保存すると一覧に表示されます。使用する時間スケジュールを選択すると、スケール設定を変更できます。スケール設定は、選択したスケジュール中のみ適用されます。スケジュールは、**[スケジュール時間の設定]** をクリックすることで編集できます。

  [Manage the Availability of Virtual Machines (仮想マシンの可用性の管理)]: http://www.windowsazure.com/ja-jp/manage/windows/common-tasks/manage-vm-availability/
  [Virtual Machine and Cloud Service Sizes for Azure (Azure の仮想マシンおよびクラウド サービスのサイズ)]: http://msdn.microsoft.com/ja-jp/library/dn197896.aspx
  [How to use the Queue Storage Service (キュー ストレージ サービスの使用方法)]: http://www.windowsazure.com/ja-jp/develop/net/how-to-guides/queue-service
  [方法: クラウド サービスに対するリソースのリンク」]: http://www.windowsazure.com/ja-jp/manage/services/cloud-services/how-to-manage-a-cloud-service/#linkresources
  [サービス レベル アグリーメント]: https://www.windowsazure.com/ja-jp/support/legal/sla/
  [Web ロールまたはワーカー ロールを実行しているアプリケーションのスケールの手動設定]: #manualscale
  [Web ロール、ワーカー ロール、または仮想マシンを実行しているアプリケーションのスケールの自動設定]: #autoscale
  [リンク済みリソースのスケールの設定]: #scalelink
  [アプリケーションのスケールのスケジュール]: #schedule
  [管理ポータル]: https://manage.windowsazure.com/
  [[スケール] ページ]: ./media/cloud-services-how-to-scale/CloudServices_ManualScaleRoles.png
  [ロールのスケールの設定]: ./media/cloud-services-how-to-scale/CloudServices_SliderRole.png
  [平均 CPU 使用率]: #averagecpu
  [キュー メッセージ]: #queuemessages
  [スケールの自動設定オン]: ./media/cloud-services-how-to-scale/CloudServices_AutoscaleOn.png
  [インスタンス範囲]: ./media/cloud-services-how-to-scale/CloudServices_InstanceRange.png
  [ターゲット CPU]: ./media/cloud-services-how-to-scale/CloudServices_TargetCPURange.png
  [CPU のスケールアップ]: ./media/cloud-services-how-to-scale/CloudServices_ScaleUpBy.png
  [稼働時間]: ./media/cloud-services-how-to-scale/CloudServices_ScaleUpWaitTime.png
  [CPU のスケールダウン]: ./media/cloud-services-how-to-scale/CloudServices_ScaleDownBy.png
  [休止時間]: ./media/cloud-services-how-to-scale/CloudServices_ScaleDownWaitTime.png
  [キューのスケールの設定]: ./media/cloud-services-how-to-scale/CloudServices_QueueScale.png
  [キューの範囲]: ./media/cloud-services-how-to-scale/CloudServices_QueueRange.png
  [ストレージ名]: ./media/cloud-services-how-to-scale/CloudServices_StorageAccountName.png
  [キュー名]: ./media/cloud-services-how-to-scale/CloudServices_QueueName.png
  [メッセージ数]: ./media/cloud-services-how-to-scale/CloudServices_TargetMessageNumber.png
  [リンク済みリソース]: ./media/cloud-services-how-to-scale/CloudServices_ScaleLinkedResources.png
  [スケールのスケジュール]: ./media/cloud-services-how-to-scale/CloudServices_SetUpSchedule.png
