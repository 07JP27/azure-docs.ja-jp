<properties title="Step 3: Create a new Azure Machine Learning experiment" pageTitle="Step 3: Create a new Machine Learning experiment | Azure" description="Step 3: Create a new training experiment in Azure Machine Learning Studio" metaKeywords="" services="" solutions="" documentationCenter="" authors="garye" videoId="" scriptId="" />

<tags ms.service="machine-learning" ms.workload="tbd" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/01/1900" ms.author="garye" />

これは、チュートリアル「[Azure Machine Learning を使用した予測ソリューションの開発][Azure Machine Learning を使用した予測ソリューションの開発]」の 3 番目の手順です。

1.  [ML ワークスペースを作成する][ML ワークスペースを作成する]
2.  [既存のデータをアップロードする][既存のデータをアップロードする]
3.  **新しい実験を作成する**
4.  [モデルをトレーニングして評価する][モデルをトレーニングして評価する]
5.  [Web サービスを発行する][Web サービスを発行する]
6.  [Web サービスにアクセスする][Web サービスにアクセスする]

------------------------------------------------------------------------

# 手順 3.Azure Machine Learning の新しい実験を作成する

アップロードしたデータセットを使用する実験を ML Studio で作成する必要があります。

1.  ML Studio で、ウィンドウの下部にある **[+新規]** をクリックします。
2.  **[実験]** を選択します。
3.  実験キャンバスの左側にあるモジュール パレットの **[保存されたデータセット]** を展開します。
4.  作成したデータセットを見つけ、キャンバスにドラッグします。パレットの上にある **[検索]** ボックスに名前を入力してデータセットを見つけることもできます。

## データを準備する

データセットの出力ポートを右クリックして **[視覚化]** を選択すると、データの最初の 100 行とデータセット全体の統計情報を表示できます。各列のデータ型は、ML Studio によってこの時点で特定されています。また、データ ファイルには列見出しが含まれていないため、汎用の見出しも追加されています。

列見出しは絶対に必要なものではありませんが、モデルのデータを操作する際に便利です。また、最終的にモデルを Web サービスに公開する際に、見出しが設定されていることによってサービスのユーザーが列を見つけやすくなります。

列見出しを追加するには、**メタデータ エディター** モジュールを使用します。

1.  モジュール パレットの **[検索]** ボックスに「メタデータ」と入力します。モジュールの一覧に**メタデータ エディター**が表示されます。
2.  **メタデータ エディター** モジュールをクリックしてキャンバスにドラッグし、データセットの下にドロップします。
3.  データセットを**メタデータ エディター**に接続します。データセットの出力ポートをクリックして**メタデータ エディター**の入力ポートにドラッグし、マウス ボタンを離します。これで、マウスをキャンバス上でどこに移動しても、データセットとモジュールが接続されたままになります。
4.  キャンバスの右側にある **[プロパティ]** ウィンドウで **[列セレクターの起動]** をクリックします。
5.  ドロップダウンで [すべての列] が選択されていることを確認して、**[OK]** をクリックします。これによって**メタデータ エディター**の作業がデータのすべての列に対して実行されるようになります。
6.  **[新しい列名]** パラメーターに、コンマ区切りで列の順番通りに、データセットの 21 列分の名前を入力します。列名は、UCI Web サイトのデータセットに関するドキュメントから入手できます。または、以下に用意された名前をコピーして貼り付けることができます。

    当座預金の状態、期間月数、信用履歴、目的、クレジット金額、普通預金/債権、現在の雇用状態、可処分所得に対する割賦率のパーセンテージ、身分および性別、他の債務者、現在の住所、財産、年齢、他の割賦方式、住宅、既存のクレジット数、職業、生計を扶助している人数、電話番号、外国人労働者、信用リスク


[プロパティ] ウィンドウは以下のようになります。

![Properties for Metadata Editor][Properties for Metadata Editor]

> ヒント - 列見出しを検証する場合は、実験を実行 (実験キャンバスの下にある **[実行]** をクリック) し、**メタデータ エディター** モジュールの出力ポートを右クリックして **[視覚化]** を選択します。すべてのモジュールで、この方法によって実験データの進捗状況を確認することができます。

実験は以下のようになっているはずです。

![Adding Metadata Editor][Adding Metadata Editor]

## トレーニング用およびテスト用のデータセットを作成する

実験の次のステップでは、モデルのトレーニングとテストに使用するデータセットをそれぞれ生成します。これには**分割**モジュールを使用します。

1.  **分割**モジュールを見つけてキャンバスにドラッグし、最後に使用した**メタデータ エディター** モジュールに接続します。
2.  既定では、分割比が 0.5 で、**[ランダム分割]** パラメーターが設定されます。これは、データの半分がランダムに抽出されて**分割**モジュールの 1 つのポートから出力され、残りの半分がもう 1 つのポートから出力されるという意味です。比率は調整できます。また、**[ランダム シード]** パラメーターを使用することによって、トレーニング データとスコア付けデータ間の比率を変更できます。この例では設定はそのままにしておきます。 ヒント - 分割比とは、左側にある出力ポートから出力されるデータ量を決定するためのものです。たとえば、比率を 0.7 に設定すると、データの 70% が左側のポートから、30% が右側のポートから出力されます。

これらの**分割**モジュールの出力の用途は自由ですが、ここでは左側の出力をトレーニング データ、右側の出力をスコア付けデータとして使用します。

UCI での説明のとおり、高い信用リスクを誤って低リスクと分類すると、低い信用リスクを誤って高リスクと分類した場合の 5 倍のコストが発生します。これに対応するため、このコストの特徴を反映した新しいデータセットを生成します。この新しいデータセットでは、高リスクの例を 5 回重複させ、低リスクの例は重複させません。

この重複は、R コードを使用して以下の手順で実行します。

1.  **R スクリプトの実行**モジュールを見つけて実験キャンバスにドラッグし、**分割**モジュールの左側の出力ポートに接続します。
2.  **[プロパティ]** ウィンドウの **[分割]** パラメーターの既定の文字列を削除し、以下のスクリプトを入力します。

        dataset1 <- maml.mapInputPort(1)
        data.set<-dataset1[dataset1[,21]==1,]
        pos<-dataset1[dataset1[,21]==2,]
        for (i in 1:5) data.set<-rbind(data.set,pos)
        maml.mapOutputPort("data.set")

**[分割]** モジュールの各出力について同様の重複操作を設定する必要があります。これによって、トレーニング データとスコア付けデータのコスト調整が等しくなります。

1.  **R スクリプトの実行**モジュールを右クリックして **[コピー]** を選択します。
2.  実験キャンバスを右クリックして **[貼り付け]** を選択します。
3.  この **R スクリプトの実行**モジュールを、**分割**モジュールの右側の出力ポートに接続します。

> ヒント - R スクリプトの実行モジュールのコピーには、元のモジュールと同じスクリプトが格納されています。モジュールをコピーしてキャンバスに貼り付けた場合、モジュールのコピーには元のモジュールのすべてのプロパティが保持されています。
>
> 現在、実験は以下のようになっているはずです。

![Adding Split module and R scripts][Adding Split module and R scripts]

  [Azure Machine Learning を使用した予測ソリューションの開発]: ../machine-learning-walkthrough-develop-predictive-solution/
  [ML ワークスペースを作成する]: ../machine-learning-walkthrough-1-create-ml-workspace/
  [既存のデータをアップロードする]: ../machine-learning-walkthrough-2-upload-data/
  [モデルをトレーニングして評価する]: ../machine-learning-walkthrough-4-train-and-evaluate-models/
  [Web サービスを発行する]: ../machine-learning-walkthrough-5-publish-web-service/
  [Web サービスにアクセスする]: ../machine-learning-walkthrough-6-access-web-service/
  [Properties for Metadata Editor]: ./media/machine-learning-walkthrough-3-create-new-experiment/create1.png
  [Adding Metadata Editor]: ./media/machine-learning-walkthrough-3-create-new-experiment/create2.png
  [Adding Split module and R scripts]: ./media/machine-learning-walkthrough-3-create-new-experiment/create3.png
