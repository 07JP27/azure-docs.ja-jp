<properties 
	pageTitle="クラウド サービスの監視方法 - Azure" 
	description="Azure の管理ポータルを使用してクラウド サービスを監視する方法について説明します。" 
	services="cloud-services" 
	documentationCenter="" 
	authors="rboucher" 
	manager="jwhit" 
	editor=""/>

<tags 
	ms.service="cloud-services" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="10/23/2014" 
	ms.author="robb"/>


# クラウド サービスの監視方法

[AZURE.INCLUDE [disclaimer](../includes/disclaimer.md)]

クラウド サービスの主要パフォーマンス メトリックは Azure の管理ポータルで監視できます。監視レベルは、サービス ロールごとに最小および詳細に設定でき、監視画面をカスタマイズできます。詳細監視データはストレージ アカウントに保存され、ポータル外からもアクセスできます。 

管理ポータルの監視画面は非常に自由に設定できます。**[監視]** ページでメトリック一覧から監視するメトリックを選択でき、**[監視]** ページとダッシュボードのメトリック チャートにプロットするメトリックを選択できます。 

## 目次##
* [概念](#concepts)
* [方法:クラウド サービスの監視の構成](#verbose)
* [方法:クラウド サービスのメトリックに関するアラートの受信](#receivealerts)
* [方法:メトリック テーブルへのメトリックの追加](#addmetrics)
* [方法:メトリック チャートのカスタマイズ](#customizechart)
* [方法:管理ポータル外で詳細監視データにアクセス](#accessverbose)

<h2><a id="concepts"></a>概念</h2>

既定では、新しいクラウド サービス用に最小監視が用意されており、ロール インスタンス (仮想マシン) のホスト オペレーティング システムから収集したパフォーマンス カウンターが使用されます。最小メトリックは、CPU 使用率、受信データ、送信データ、ディスク読み取りのスループット、およびディスク書き込みのスループットに限定されます。詳細監視を構成することで、仮想マシン (ロール インスタンス) 内のパフォーマンス データに基づいた追加のメトリックが使用できます。詳細メトリックを使用すると、アプリケーションの操作中に発生する問題を詳しく分析できます。

> [AZURE.NOTE]
> 詳細監視を使用した場合、ロール インスタンスの起動時に、診断構成ファイルを使用して、さらに多くのパフォーマンス カウンターを追加できます。管理ポータルでこれらのメトリックを監視するには、詳細監視を構成する前にパフォーマンス カウンターを追加する必要があります。詳細については、「 <a href="http://azure.microsoft.com/ documentation/articles/cloud-services-dotnet-diagnostics/">Azure のクラウド サービスおよび仮想マシンの診断機能</a>」を参照してください。

既定では、ロール インスタンスから得られるパフォーマンス カウンター データは、3 分間隔でサンプリングされてロール インスタンスから転送されます。詳細監視を有効にすると、生のパフォーマンス カウンター データが、5 分、1 時間、および 12 時間間隔で、ロール インスタンスごとに、および各ロールのロール インスタンス全体で集計されます。集計されたデータは 10 日後に消去されます。

詳細監視を有効にすると、集計された監視データはストレージ アカウントのテーブルに保存されます。ロールの詳細監視を有効にするには、ストレージ アカウントにリンクする診断接続文字列を構成する必要があります。異なるロールには異なるストレージ アカウントを使用できます。

詳細監視を有効にすると、データ ストレージ、データ転送、およびストレージ トランザクションに関連したストレージ コストが増加することに注意してください。最小監視の場合、ストレージ アカウントは不要です。最小監視レベルで公開されるメトリック用のデータは、監視レベルを詳細に設定した場合でも、ストレージ アカウントには保存されません。


<h2><a id="verbose"></a>方法:クラウド サービスの監視の構成</h2>

以下の手順を使用して、管理ポータルの詳細監視または最小監視を構成します。詳細監視を有効にする前に、Azure 診断を有効にし、診断接続文字列を設定して、Azure 診断がストレージ アカウントにアクセスして詳細監視データを保存できるようにしておく必要があります。

### 開始する前に###

- 監視データを保存するストレージ アカウントを作成します。異なるロールには異なるストレージ アカウントを使用できます。詳細については、**ストレージ アカウント**のヘルプを参照するか、「[How To Create a Storage Account (ストレージ アカウントの作成方法)](/ja-jp/manage/services/storage/how-to-create-a-storage-account/)」を参照してください。


- クラウド サービス ロールの Azure 診断を有効にします。 <br /><br />詳細については、「[Azure のクラウド サービスおよび仮想マシンの診断機能](/ja-jp/documentation/articles/cloud-services-dotnet-diagnostics/)」を参照してください。

管理ポータルで、詳細監視データを保存するストレージ アカウントに Azure 診断がアクセスするときに使用する診断接続文字列を追加または修正でき、監視レベルを詳細または最小に設定できます。詳細監視データはストレージ アカウントに保存されるため、監視レベルを詳細に設定する前に、診断接続文字列を構成する必要があります。

### 詳細監視用の診断接続文字列を構成するには###

1. 詳細監視データの保存に使用するストレージ アカウント用のストレージ アクセス キーをコピーします。[Azure の管理ポータル](https://manage.windowsazure.com/)で、**[ストレージ アカウント]** ページの **[キーの管理]** を使用します。詳細については、「[クラウド サービスの管理方法](/ja-jp/documentation/articles/cloud-services-how-to-manage/)」を参照するか、**[ストレージ アカウント]** ページのヘルプを参照してください。 

2. **[クラウド サービス]** を開きます。次に、構成するクラウド サービスの名前をクリックして、ダッシュボードを開きます。

3. **[運用]** または **[ステージング]** をクリックして、構成する展開を表示します。

4. **[構成]** をクリックします。

	下図に示すように、**[構成]** ページの上部で **[監視]** 設定を編集できます。クラウド サービス用に Azure 診断を有効にしていない場合は、**[レベル]** オプションが使用できません。データ保持ポリシーは変更できません。クラウド サービス用の詳細監視データは 10 日間保存されます。

	![Monitoring options](./media/cloud-services-how-to-monitor/CloudServices_MonitoringOptions.png)

5. **[診断接続文字列]** で、詳細監視の対象とする各ロールの診断接続文字列を指定します。
	
	接続文字列の形式は次のとおりです(この例は、既定のエンドポイントを使用するクラウド サービス用です)。接続文字列を更新するには、有効なストレージ アカウント名と、使用するストレージ アカウント用のストレージ アクセス キーを入力します。
         
 	DefaultEndpointsProtocol=https;AccountName=StorageAccountName;AccountKey=StorageAccountKey  

6. **[保存]** をクリックします。

詳細監視を有効にする場合は、サービス ロール用の診断接続文字列を構成した後、次のステップを実行します。 


### 監視レベルを詳細または最小に変更するには###

1. [管理ポータル](https://manage.windowsazure.com/)で、クラウド サービスの展開の **[構成]** ページを開きます。

2. **[レベル]** で、**[詳細]** または **[最小]** をクリックします。 

3. **[保存]** をクリックします。

詳細監視を有効にした後、1 時間以内に管理ポータルに監視データが表示され始めます。

生のパフォーマンス カウンター データと集計した監視データは、ストレージ アカウントのテーブルに保存され、テーブル名はロールの展開 ID で修飾されます。 

<h2><a id="receivealerts"></a>方法:クラウド サービスのメトリックに関するアラートの受信</h2>

クラウド サービスの監視メトリックに基づいてアラートを受け取ることができます。Azure の管理ポータルの **[管理サービス]** ページで、選択したメトリックが指定した値に達したときにアラートをトリガーするルールを作成できます。アラートがトリガーされたときに電子メールが送信されるように指定することもできます。詳細については、「[方法:Receive Alert Notifications and Manage Alert Rules in Azure (Azure でアラート通知を受け取り、アラート ルールを管理する)](http://go.microsoft.com/fwlink/?LinkId=309356)」を参照してください。

<h2><a id="addmetrics"></a>方法:メトリック テーブルへのメトリックの追加</h2>

1. [管理ポータル](http://manage.windowsazure.com/)で、クラウド サービスの **[監視]** ページを開きます。

	既定で、メトリック テーブルには使用可能なメトリックのサブセットが表示されます。図はクラウド サービス用の既定の詳細メトリックを示しています。これは "メモリ/利用可能な MB" パフォーマンス カウンターに限定されており、データはロール レベルで集計されます。**[メトリックの追加]** を使用して、管理ポータルで監視する追加の集計およびロール レベル メトリックを選択します。

	![Verbose display](./media/cloud-services-how-to-monitor/CloudServices_DefaultVerboseDisplay.png)
 
2. メトリック テーブルにメトリックを追加するには、以下の手順を実行します。

	a. **[メトリックの追加]** をクリックすると、下図のような **[メトリックの選択]** ダイアログ ボックスが開きます。
	最初に利用可能なメトリックは展開され、利用可能なオプションが表示されています。メトリックごとに、一番上のオプションはすべてのロールの集計監視データを表示します。さらに、データを表示する個々のロールを選択することもできます。

	![Add metrics](./media/cloud-services-how-to-monitor/CloudServices_AddMetrics.png)


	b. 表示するメトリックを選択するには、以下を実行します。

	- メトリックの横にある下向き矢印をクリックして、監視オプションを展開します。
	- 表示する各監視オプションのチェック ボックスをオンにします。

	メトリック テーブルには最大 50 個のメトリックを表示できます。

	> [AZURE.TIP 詳細監視の場合、メトリック一覧に数十個のメトリックが表示されることがあります。スクロールバーを表示するには、ダイアログ ボックスの右側をポイントします。一覧を絞り込むには、検索アイコンをクリックして、下図の検索ボックスにテキストを入力します。
 
	![Add metrics search](./media/cloud-services-how-to-monitor/CloudServices_AddMetrics_Search.png)

3. メトリックの選択が終了したら [OK] (チェックマーク) をクリックします。

	下図のように、選択したメトリックがメトリック テーブルに追加されます。

	![monitor metrics](./media/cloud-services-how-to-monitor/CloudServices_Monitor_UpdatedMetrics.png)

 
4. メトリック テーブルからメトリックを削除するには、メトリックをクリックして選択し、**[メトリックの削除]** をクリックします(**[メトリックの削除]** が表示されるのは、メトリックを選択しているときだけです)。


<h2><a id="customizechart"></a>方法:メトリック チャートのカスタマイズ</h2>

1. メトリック テーブルで、メトリック チャートにプロットするメトリックを最大 6 個選択します。メトリックを選択するには、メトリックの左側にあるチェック ボックスをオンにします。メトリック チャートからメトリックを削除するには、メトリック テーブルのチェック ボックスをオフにします。

	メトリック テーブルでメトリックを選択すると、そのメトリックがメトリック チャートに追加されます。幅の狭い画面では、**[残り n 項目]** ドロップダウン リストに、画面におさまりきらなかったメトリックのヘッダーが表示されます。

 
2. 相対値 (最終値は各メトリックにだけ) と絶対値 (Y 軸を表示) の表示を切り替えるには、チャートの上部で [相対] または [絶対] をクリックします。

	![Relative or Absolute](./media/cloud-services-how-to-monitor/CloudServices_Monitor_RelativeAbsolute.png)

3. メトリック チャートに表示する期間を変更するには、チャートの上部で 1 時間、24 時間、または 7 日を選択します。

	![Monitor display period](./media/cloud-services-how-to-monitor/CloudServices_Monitor_DisplayPeriod.png)

	ダッシュボードのメトリック チャートでは、メトリックのプロット方法が異なります。メトリックの標準セットが使用でき、メトリックのヘッダーを選択することでメトリックを追加または削除できます。

### ダッシュボードでメトリック チャートをカスタマイズするには###

1. クラウド サービスのダッシュボードを開きます。

2. チャートのメトリックを追加または削除します。

	- 新しいメトリックをプロットするには、チャートのヘッダー部でメトリックのチェック ボックスをオンにします。幅の狭い画面では、**[残り *n*?? 項目]** ボックスの横にある下向き矢印をクリックして、チャートのヘッダー部に表示できないメトリックをプロットします。

	- チャートにプロットされているメトリックを削除するには、そのヘッダーにあるチェック ボックスをオフにします。

3. **[相対]** 表示と **[絶対]** 表示を切り替えます。

4. 表示するデータの期間を 1 時間、24 時間、または 7 日に設定します。

<h2><a id="accessverbose"></a>方法:管理ポータル外で詳細監視データにアクセス</h2>

詳細監視データは、各ロールに指定したストレージ アカウントのテーブルに保存されます。クラウド サービス展開ごとに、ロールに対して 6 つのテーブルが作成されます。間隔 (5 分、1 時間、および 12 時間) のそれぞれにテーブルが 2 つ作成されます。片方のテーブルはロール レベルの集計を保存し、もう片方のテーブルはロール インスタンスごとの集計を保存します。 

テーブル名は次の形式です。

	WAD*deploymentID*PT*aggregation_interval*[R|RI]Table

各値の説明:

- *deploymentID* は、クラウド サービス デプロイに割り当てた GUID です。

- *aggregation_interval* = 5M、1H、または 12H

- ロール レベルの集計 = R

- ロール インスタンスの集計 = RI

たとえば、次のテーブルには 1 時間間隔で集計された詳細監視データが保存されます。

	WAD8b7c4233802442b494d0cc9eb9d8dd9fPT1HRTable (hourly aggregations for the role)

	WAD8b7c4233802442b494d0cc9eb9d8dd9fPT1HRITable (hourly aggregations for role instances)


<!--HONumber=45--> 
