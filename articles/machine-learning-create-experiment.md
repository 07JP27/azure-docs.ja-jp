<properties title="Create a simple experiment in Azure Machine Learning Studio" pageTitle="Create a simple experiment in Machine Learning Studio | Azure" description="How to create an experiment to train and test a simple model in Azure Machine Learning Studio" metaKeywords="" services="machine-learning" solutions="" documentationCenter="" authors="garye" videoId="" scriptId="" />

<tags ms.service="machine-learning" ms.workload="tbd" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/01/1900" ms.author="garye"></tags>

# Azure Machine Learning Studio での簡単な実験の作成

予測分析の実験の中心となるのは、*モデルの作成*、*モデルのトレーニング*、および*モデルのスコア付けとテスト*です。これらを組み合わせて実験を作成して、データを取得し、データに対してモデルをトレーニングできます。また、モデルを新しいデータに適用できます。また、データを前処理して特徴を選択し、データをトレーニング セットとテスト セットに分割することもできます。さらに、モデルの品質を評価または相互検証したりするモジュールを追加することもできます。

この記事では、Microsoft Azure Machine Learning Studio を使用して、簡単な予測分析の実験を開発し、繰り返します。

## 実験を作成する 5 つの手順

ML Studio で実験を構築する以下の 5 つの基本的な手順に従うと、モデルを作成し、トレーニングできます。また、モデルにスコアを付けることができます。

-   モデルの作成

    -   [手順 1.データを取得する][]
    -   [手順 2.データを前処理する][]
    -   [手順 3.特徴を定義する][]
-   モデルのトレーニング

    -   [手順 4.学習アルゴリズムを選択して、適用する][]
-   モデルへのスコア付けとテスト

    -   [手順 5.新しいデータについて予測する][]

この例では、サンプルの自動車データを使用して、回帰モデルを作成する方法を説明します。目標は、製造仕様と技術仕様などのさまざまな変数を使用して、自動車の価格を予測することです。

### 手順 1.データを取得する

ML Studio には、多数のサンプル データセットが含まれており、多様なソースからデータをインポートできます。この例では、含まれているサンプル データセット **"自動車価格データ (未加工)"** を使用します。このデータ セットは自動車の価格データを表しています。

1.  [ML Studio] ウィンドウのページの下部にある **[+新規]** をクリックし、**[実験]** を選択して、新しい実験を開始します。実験の名前を "無題" から、"自動車価格の予測" のような意味のある名前に変更します。

2.  実験キャンバスの左側には、データセットとモジュールのパレットがあります。このパレットの上部にある検索ボックスに「自動車」と入力し、**"自動車価格データ (未加工)"** というラベルが付いたデータセットを検索します。

    ![Palette search][]

3.  実験キャンバスにデータセットをドラッグします。

    ![Dataset][]

このデータの外観を確認するには、自動車データセットの下部にある出力ポートをダブルクリックし、**[視覚化]** を選択します。データセットの変数が列として表示され、自動車の各インスタンスが行として表示されます。最も右側の列 "価格" (列 26) が、予想の対象となる変数です。

![Dataset visualization][]

右上隅の "**x**" をクリックして、視覚化ウィンドウを閉じます。

### 手順 2.データを前処理する

通常データセットには、分析前にある程度の前処理が必要です。さまざまな行に、値が見つからない列があります。データを分析するには、このような見つからない値を整理する必要があります。この例では、値が見つからない行をすべて削除します。また、見つからない値の大部分は、"正規化された損失" 列にあります。よって、モデルからこの列も一緒に除外します。

> **ヒント** - 見つからない値を入力データから整理することが、ほとんどのモジュールの前提条件となっています。

まず、"正規化された損失" 列を削除してから、見つからないデータがある列をすべて削除します。

1.  **"プロジェクト列"** モジュールを実験キャンバスにドラッグし、**"自動車価格データ (未加工)"** データセットの出力ポートに接続します。このモジュールを使用すると、モデルに含める、またはモデルから除外するデータの列を選択できます。

2.  **"プロジェクト列"** モジュールを選択し、プロパティ ウィンドウの **[列セレクターの起動]** をクリックします。

    -   フィルターのドロップダウン **[が次の値で始まる]** で、**[すべての列]** が選択されていることを確認します。これにより、**"プロジェクト列"**では、(これから除外する列を除き) すべての列がフィルターされます。
    -   次の行で、**[除外]** と **[列名]** を選択し、テキスト ボックスの内側をクリックします。列の一覧が表示されます。"正規化された損失" を選択すると、その列がテキスト ボックスに追加されます。
    -   チェック マーク **[OK]** ボタンをクリックして、列セレクターを閉じます。

    ![Select columns][]

    **"プロジェクト列"** のプロパティ ウィンドウに、"正規化された損失" 以外のすべての列がデータセットからフィルターされることが示されます。

    ![Project Columns properties][]

    > **ヒント** - モジュールをダブルクリックして、テキストを入力すると、モジュールにコメントを追加できます。これで、実験でモジュールがどのような処理をするのかがひとめでわかります。この例では、**"プロジェクト列"** モジュールをダブルクリックして、「正規化された損失を除外する」というコメントを入力します。

3.  **"不足値スクラブ"** モジュールを実験キャンバスにドラッグして、**"プロジェクト列"** モジュールに接続します。プロパティ ウィンドウで、**[見つからない値に対する処理]** の下にある **[行全体を削除]** を選択し、値が見つからない列を削除してデータを整理します。モジュールをダブルクリックして、「値が見つからない行を削除する」というコメントを入力します。

    ![Missing Values Scrubber properties][]

4.  実験キャンバスの下にある **[実行]** をクリックして、実験を実行します。

実験が終了したら、すべてのモジュールに緑色のチェック マークが付けられ、正常に完了したことがわかります。右上隅にも "実行が完了しました" というステータスが表示されます。

![First experiment run][]

この時点までに、データを整理する実験はすべて終了しました。整理したデータセットを表示するには、**"不足値スクラブ"** モジュールの出力ポートをダブルクリックして、**[視覚化]** を選択します。"正規化された損失" 列が、もう含まれていないことと、見つからない値がなくなったことが確認できます。

データが整理できたので、予測モデルで使用する特徴を指定する準備が整いました。

### 手順 3.特徴を定義する

機械学習において*特徴*とは、関心のある項目を個別に測定できるプロパティです。この例のデータセットでは、各行が 1 つの車種を表し、各列がその車種の特徴に対応します。分析モデルの作成に役立つ特徴を見つけるには、目の前の問題に関する実験と知識が必要です。一部の特徴は、他よりも対象を予測することに優れています。また、特徴によっては、たとえば市内での燃費と高速道路での燃費のように、他の特徴との強い相関がある場合があります。したがって、このような特徴はモデルに新しい情報をそれほど多く追加しないので、削除できます。

ここでは、データセット内の特徴のサブセットを使用するモデルを構築します。この手順に戻って別の特徴を選択し、もう一度実験を実行して、より優れた結果が得られるかどうかを確認できます。最初に推測で、**"プロジェクト列"** モジュールを使用して、以下の特徴 (列) を選択します。モデルをトレーニングするために、予測する*価格*の値を含める必要があることに注意してください。

    make, body-style, wheel-base, engine-size, horsepower, peak-rpm, highway-mpg, price

1.  別の **"プロジェクト列"** モジュールを実験キャンバスにドラッグして、**"不足値スクラブ"** モジュールに接続します。モジュールをダブルクリックして、「予測対象の特徴を選択する」と入力します。

2.  プロパティ ウィンドウで、**[列セレクターの起動]** をクリックします。

3.  列セレクターで、**[が次の値で始まる]** で **[列なし]** を選択し、フィルター行で **[含む]** と **[列名]** を選択します。列名の一覧を入力します。これにより、モジュールでは、指定する列のみがフィルターされます。

    > **ヒント** - この時点までに実行した実験により、データに対する列の定義が、**"不足値スクラブ"** モジュールを介して元のデータセットから渡されました。**"プロジェクト列"** を **"不足値スクラブ"** に接続すると、**"プロジェクト列"** モジュールによって、データ内の列の定義が認識されるようになります。列名ボックスをクリックすると、列の一覧が表示され、一覧に追加する列を一度に複数選択できます。

4.  **[OK]** をクリックします。

![Select columns][1]

これで、次の手順の学習アルゴリズムで使用するデータセットが作成されます。後でこの手順に戻り、別の特徴を選択して再度実行することができます。

### 手順 4.学習アルゴリズムを選択して、適用する

データが準備できると、分析モデルの構築に必要なのは、トレーニングとテストになります。*分類*と*回帰*は、2 種類の管理された機械学習の手法です。分類は、色 (赤、青、または緑) のような定義された一連の値から予測するために使用します。回帰は、人の年齢のような連続した一連の値から予測するために使用します。

ここでは、自動車の価格を予測するため、任意の値にすることができます。よって、回帰モデルを使用します。この例では、簡単な*線形回帰*モデルをトレーニングし、次の手順でこのモデルをテストします。

1.  データをトレーニング セットとテスト セットに分割します。**"分割"** モジュールを選択して実験キャンバスにドラッグし、最後の **"プロジェクト列"** モジュールの出力に接続します。**[最初の出力データセットにおける列の割合]** を 0.75 に設定します。このようにして、データの 75% をモデルのトレーニングに使用し、25% をテスト用に保持しておきます。

    > **ヒント** - **"ランダム シード"** パラメーターを変更して、トレーニングおよびテスト用に異なるランダムなサンプルを作成できます。このパラメーターでは、擬似乱数ジェネレーターによる生成を制御できます。

2.  実験を実行します。これで、**"プロジェクト列"** モジュールと **"分割"** モジュールにより、次に追加するモジュールに定義を渡すことができます。

3.  学習アルゴリズムを選択するには、キャンバスの左側にあるモジュールのパレットの **[Machine Learning]** カテゴリを展開してから、**[モデルを初期化]** を展開します。これにより、学習アルゴリズムの初期化に使用できるモジュールのカテゴリが複数表示されます。

    この実験例では、**[回帰]** カテゴリで **"線形回帰"** モジュールを選択し (パレットの検索ボックスで「線形回帰」と入力してもモジュールを見つけることができます)、実験キャンバスにドラッグします。

4.  **"モデルのトレーニング"** モジュールを見つけて、実験にドラッグします。**[列セレクターの起動]** をクリックし、*"価格"* 列を選択します。これが、作成しているモデルで予測する値です。

    ![Select "price" column][]

5.  左側の入力ポートを **"線形回帰"** モジュールの出力と接続し、右側の入力ポートを **"分割"** モジュールのトレーニング データの出力 (左側のポート) と接続します。

6.  実験を実行します。

結果として、トレーニングされた回帰モデルが作成され、新しいサンプルにスコアを付けて予測するのに使用できます。

![Applying the learning algorithm][]

### 手順 5.新しいデータについて予測する

モデルをトレーニングしたので、残りの 25% のデータにスコアを付け、モデルの機能の効果を確認します。

1.  **"モデルのスコア付け"** モジュールを見つけて、実験キャンバスにドラッグします。左側の入力ポートを **"モデルのトレーニング"** モジュールの出力に接続し、右側の入力ポートを **"分割"** モジュールのテスト データの出力 (右側のポート) に接続します。

    ![Score Model module][]

2.  実験を実行して、**"モデルのスコア付け"** モジュールの出力を表示します (出力ポートをダブルクリックして、**[視覚化]** を選択します)。出力に、予測された価格の値と、テスト データから既知の値が表示されます。

3.  最後に、結果の品質をテストするために、**"モデルの評価"** モジュールを選択して、実験キャンバスにドラッグします。左側の入力ポートを **"モデルのスコア付け"** モジュールの出力に接続します (**"モデルの評価"** モジュールは 2 つのモデルの比較に使用できるため、2 つの入力ポートを備えています)。

4.  実験を実行して、**"モデルの評価"** モジュールの出力を表示します (出力ポートをダブルクリックして、**[視覚化]** を選択します)。作成したモデルに対して、以下の統計値が表示されます。

    -   **平均絶対誤差** (MAE) - 絶対誤差の平均です (*誤差*とは、予測された値と実際の値との差です)。
    -   **二乗平均平方根誤差** (RMSE) - テスト データセットに対して実行した予測の二乗誤差平均の平方根です。
    -   **相対絶対誤差** - 実際の値とすべての実際の値の平均との絶対差を基準にした絶対誤差の平均です。
    -   **相対二乗誤差** - 実際の値とすべての実際の値の平均との二乗差を基準にした二乗誤差の平均です。
    -   **決定係数** - "R-2 乗値" ともいいます。どの程度モデルが高い精度でデータと適合するかを示す統計指標です。

    各誤差の統計値は、小さいほど優れています。つまり値が小さくなるほど、予測が実際の値に近くなることを意味します。**決定係数**では、値が 1 (1.0) に近づくほど、予測の精度が高くなります。

    ![Evaluation results][]

最終的な実験の表示は次のようになります。

![Complete experiment][]

### 次の手順

実験を設定したら、実験を繰り返してモデルを改良できます。たとえば、予測で使用する特徴を変更できます。または、**線形回帰**アルゴリズムのプロパティを変更するか、別のアルゴリズムを一緒に試すことができます。**"モデルの評価"** モジュールを使用すれば、複数のアルゴリズムを同時に実験に追加して、(2 つ同時に) 比較することもできます。

> **ヒント** - 実験キャンバスの下にある **[名前を付けて保存]** ボタンを使用して、繰り返す実験をコピーできます。キャンバスの下にある **[実行履歴を表示]** をクリックすると、繰り返す実験をすべて表示できます。詳細については、ML Studio のヘルプ トピック「**Viewing Run History (実行履歴の表示)**」を参照してください。

作成したモデルが期待どおりであれば、Web サービスとして公開し、新しいデータを使用した自動車価格の予測に使用できます。詳細については、ML Studio のヘルプ トピック「**Publishing Experiments (実験の公開)**」を参照してください。

予測モデルの作成、トレーニング、スコア付け、および公開の広範囲にわたる詳しい手順については、「[チュートリアル: Azure Machine Learning を使用した予測ソリューションの開発][]」を参照してください。

<!-- Images -->

  [手順 1.データを取得する]: #step-1-get-data
  [手順 2.データを前処理する]: #step-2-pre-process-data
  [手順 3.特徴を定義する]: #step-3-define-features
  [手順 4.学習アルゴリズムを選択して、適用する]: #step-4-choose-and-apply-a-learning-algorithm
  [手順 5.新しいデータについて予測する]: #step-5-predict-over-new-data
  [Palette search]: ./media/machine-learning-create-experiment/screen1a.png
  [Dataset]: ./media/machine-learning-create-experiment/screen1.png
  [Dataset visualization]: ./media/machine-learning-create-experiment/screen1b.png
  [Select columns]: ./media/machine-learning-create-experiment/screen3.png
  [Project Columns properties]: ./media/machine-learning-create-experiment/screen4.png
  [Missing Values Scrubber properties]: ./media/machine-learning-create-experiment/screen4a.png
  [First experiment run]: ./media/machine-learning-create-experiment/screen5.png
  [1]: ./media/machine-learning-create-experiment/screen6.png
  [Select "price" column]: ./media/machine-learning-create-experiment/screen7.png
  [Applying the learning algorithm]: ./media/machine-learning-create-experiment/screen8.png
  [Score Model module]: ./media/machine-learning-create-experiment/screen8a.png
  [Evaluation results]: ./media/machine-learning-create-experiment/screen9.png
  [Complete experiment]: ./media/machine-learning-create-experiment/screen10.png
  [チュートリアル: Azure Machine Learning を使用した予測ソリューションの開発]: http://azure.microsoft.com/en-us/documentation/articles/machine-learning-walkthrough-develop-predictive-solution/
