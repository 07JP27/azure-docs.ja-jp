---
title: "Azure Monitor でのログ アラート - Alerts (プレビュー) | Microsoft Docs"
description: "Azure Alerts (プレビュー) に関して指定した複合クエリ条件が満たされたときに、電子メール、通知、Web サイト URL (webhook)の呼び出し、またはオートメーションをトリガーします。"
author: msvijayn
manager: kmadnani1
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: f7457655-ced6-4102-a9dd-7ddf2265c0e2
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/12/2017
ms.author: vinagara
ms.openlocfilehash: 99d222102ab0245c7c4dc8603eaedcfc88ae7a66
ms.sourcegitcommit: b7adce69c06b6e70493d13bc02bd31e06f291a91
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/19/2017
---
# <a name="log-alerts-in-azure-monitor---alerts-preview"></a>Azure Monitor でのログ アラート - Alerts (プレビュー)
この記事では、Analytics クエリのアラート ルールが Azure Alerts (プレビュー) でどのように機能するかについて詳しく紹介し、また各種ログ アラートの相違点について説明します。
現在 Azure Alerts (プレビュー) は、[新しい Log Analytics クエリ言語](../log-analytics/log-analytics-log-search-upgrade.md)で書かれた [Azure Log Analytics](../log-analytics/log-analytics-tutorial-viewdata.md) からのクエリでのログ アラートのみをサポートしています。

> [!WARNING]
> Azure Alerts (プレビュー) - ログ アラートは現在、クロス ワークスペースまたはクロス アプリのクエリをサポートしていません。 

## <a name="log-alert-rules"></a>ログ アラート ルール

Azure Alerts (プレビュー) で作成されたアラートは自動的に、一定間隔でログ クエリを実行します。  ログ クエリの結果が特定の条件に一致すると、アラート レコードが作成されます。 次に、このルールでは、[アクション グループ](monitoring-action-groups.md)を使用して、事前にアラートを通知したり、Runbook の実行のような別のプロセスを呼び出したりする、1 つ以上のアクションを自動的に実行できます。  この分析では、アラート ルールの種類に応じてさまざまなロジックが使用されます。

警告ルールは次の内容で定義されます。

- **ログ クエリ**:  警告ルールが実行されるたびに実行されるクエリ。  このクエリから返されるレコードは、アラートを作成するかどうかの決定に使用されます。
- **時間枠**:   クエリの時間範囲を指定します。  クエリでは、現在の時刻に先立つ指定の時間範囲の間に作成されたレコードだけを返します。  時間枠には、5 分から 1440 分 (24 時間) の範囲内で任意の値を指定できます。 たとえば、時間枠が 60 分に設定されていて、クエリが午後 1 時 15 分に実行された場合は、午後 12 時 15 分から午後 1 時 15 分までの間に作成されたレコードだけが返されます。
- **[頻度]**:   クエリの実行頻度を指定します。 5 分から 24 時間までの値を指定できます。 この値は、時間枠の値以下にする必要があります。  この値が時間枠の値よりも大きい場合、レコードを見落とすおそれがあります。<br>たとえば、時間枠が 30 分、頻度が 60 分であるとします。  クエリが午後 1 時に実行された場合、午後 12 時 30 分から午後 1 時までの間のレコードが返されます。  次回クエリが実行されるのは午後 2 時であり、このときには午後 1 時 30 分から午後 2 時までの間のレコードが返されます。  つまり、午後 1 時から午後 1 時 30 分までの間に作成されたレコードは評価されないことになります。
- **しきい値**:   ログ検索の結果を評価し、アラートの生成が必要であるかどうかを判定するための値です。  しきい値は、アラート ルールの種類によって異なります。

Log Analytics の警告ルールはいずれも、2 種類のどちらかに該当します。  どちらについても、後のセクションで詳しく説明します。

- **[結果の数](#number-of-results-alert-rules)**。 ログ検索によって返されるレコードの数が指定された数を超えた場合に、アラートが 1 回生成されます。
- **[メトリック測定](#metric-measurement-alert-rules)**。  ログ検索の結果の値が指定されたしきい値を超えた場合に、オブジェクトごとにアラートが生成されます。

この 2 種類のアラート ルールの違いは次のとおりです。

- **結果の数**アラート ルールは常に 1 つのアラートを作成するのに対し、**メトリック測定**アラート ルールはしきい値を超えたオブジェクトごとにアラートを作成します。
- **結果の数**の警告ルールでは、1 回しきい値を超えた時点で警告が生成されます。 これに対して、**メトリック測定**のアラート ルールでは、一定期間内にしきい値を一定回数超過した場合に、アラートが生成されます。

## <a name="number-of-results-alert-rules"></a>結果の数のアラート ルール
**結果の数**のアラート ルールでは、検索クエリによって返されるレコード数が指定されたしきい値を超えた場合に、1 回だけアラートが生成されます。

**しきい値**: **結果の数**アラート ルールのしきい値は、特定の値より大きいか小さいかです。  ログ検索によって返されるレコード数がこの条件を満たしたときに、アラートが生成されます。

### <a name="scenarios"></a>シナリオ

#### <a name="events"></a>イベント
この種類の警告ルールは、Windows イベント ログ、Syslog、カスタム ログのようなイベントでの使用に最適です。  特定のエラー イベントが作成されたとき、または特定の時間枠内に複数のエラー イベントが作成されたときなどに、アラートを作成することができます。

単一イベントに対してアラートを行うには、結果の数を 0 より大きく設定し、頻度と時間枠の両方を 5 分に設定します。  これにより、クエリが 5 分ごとに実行され、前回のクエリ実行後に作成された単一イベントの発生が検査されます。  頻度の値を大きくすると、イベントが収集されてアラートが作成される間隔が長くなります。

一部のアプリケーションでは、必ずしもアラートを発生させない偶発的なエラーが記録される場合もあります。  たとえば、エラー イベントを作成したプロセスをアプリケーションが再試行し、次回は成功する場合などがあります。  このような場合は、特定の時間枠内に複数のイベントが作成されない限り、アラートを作成しないようにできます。  

また、イベントが発生しないときにアラートを作成する場合もあります。  たとえば、正しく動作していることを示すために定期的なイベントを記録するプロセスがあります。  そのようなプロセスが特定の時間枠内にそれらのイベントを記録しなかった場合には、アラートを作成する必要があります。  この場合、しきい値を **1 より小さく**設定します。

## <a name="metric-measurement-alert-rules"></a>メトリック測定のアラート ルール

**メトリック測定**のアラート ルールでは、クエリの対象となったオブジェクトが分析され、特定の値が指定されたしきい値を上回っているオブジェクトについて、それぞれ別個にアラートが生成されます。  **結果の数**のアラート ルールとは、以下の点が明確に異なります。

**集計関数**: 実行する計算と、集計対象になる可能性のある数値フィールドを決定します。  たとえば、**count()** であれば、クエリで指定したレコードの件数が返されます。**avg(CounterValue)** であれば、一定期間内の CounterValue フィールドの平均値が返されます。

**グループ フィールド**: このフィールドのインスタンスごとに値を集計したレコードが作成されます。アラートは、それぞれのインスタンスについて生成されます。  たとえば、コンピューターごとにアラートを生成する場合は、**by Computer** を使用します。   

**間隔**:  データを集計する間隔を定義します。  たとえば、**5 分**を指定した場合には、アラートに対して指定した期間にわたり、グループ フィールドの各インスタンスについて、5 分間隔でレコードが作成されます。

**しきい値**: メトリック測定アラート ルールのしきい値は、集計値と違反数によって定義されます。  ログ検索でいずれかのデータ ポイントが一定の値を超えると、抵触が 1 回発生したと判定されます。  そして、結果に含まれるオブジェクトの抵触の発生回数が指定された値を超えたときに、そのオブジェクトについて警告が生成されます。

#### <a name="example"></a>例
いずれかのコンピューターでプロセッサの使用率が 90% を超える状態が 30 分間に 3 回発生した場合にアラートを生成するシナリオを考えてみましょう。  以下のような詳細情報を使用してアラート ルールを作成します。  

**クエリ:** Perf | where ObjectName == "Processor" and CounterName == "% Processor Time" | summarize AggregatedValue = avg(CounterValue) by bin(TimeGenerated, 5 m), Computer<br>
**時間枠:** 30 分<br>
**アラート頻度:** 5 分<br>
**集計値:** 90 より大<br>
**アラートをトリガーする基準:** 違反総数が 5 より大<br>

このクエリは、各コンピューターの平均値を 5 分間隔で算出します。  このクエリは過去 30 分間に収集されたデータを対象に、5 分ごとに実行されます。  コンピューターが 3 台の場合、サンプル データは以下のようになります。

![サンプル クエリの結果](../log-analytics/media/log-analytics-alerts/metrics-measurement-sample-graph.png)

この例では、指定された期間内に srv02 と srv03 の 2 台がしきい値 (90 %) に合計 3 回抵触しています。このため、この 2 台について個別にアラートが生成されます。  **[アラートをトリガーする基準]** を **[Consecutive (連続)]** に変更した場合、3 回連続でしきい値に違反した srv03 についてのみアラートが生成されます。


## <a name="next-steps"></a>次の手順
* [Azure Alerts (プレビュー) の概要を確認](monitoring-overview-unified-alerts.md)します。 
* [Azure Alerts (プレビュー) の使用方法](monitor-alerts-unified-usage.md)について学習します。
* [Log Analytics](../log-analytics/log-analytics-overview.md) についてさらに学習します。    
