---
title: "Azure Application Insights のトランザクションの診断 | Microsoft Docs"
description: "Application Insights のエンド ツー エンドのトランザクションの診断"
services: application-insights
documentationcenter: .net
author: SoubhagyaDash
manager: victormu
ms.service: application-insights
ms.workload: TBD
ms.tgt_pltfrm: ibiza
ms.devlang: multiple
ms.topic: article
ms.date: 01/19/2018
ms.author: sdash
ms.openlocfilehash: 1c7eaafe99717324ad03287a1f1e0699d77cc74f
ms.sourcegitcommit: eeb5daebf10564ec110a4e83874db0fb9f9f8061
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/03/2018
---
# <a name="unified-cross-component-transaction-diagnostics"></a>統合されたコンポーネント間のトランザクションの診断

*このエクスペリエンスは現在プレビュー段階であり、サーバー側の要求、依存関係、および例外に対する既存の診断ブレードを置き換えます。*

プレビューでは、Application Insights に監視されるすべてのコンポーネントからのサーバー側テレメトリを単一ビューに関連付ける、新しい統合診断エクスペリエンスが導入されます。 インストルメンテーション キーが個別に設定されたリソースが複数あっても問題ありません。 Application Insights によって基になる関係が検出されるため、トランザクションの速度低下または障害の原因となったアプリケーション コンポーネント、依存関係、または例外を簡単に診断することができます。

## <a name="what-is-a-component"></a>コンポーネントとは

コンポーネントは、分散/マイクロサービス アプリケーションの、個別にデプロイできる部分です。 開発者と運用チームには、これらのアプリケーション コンポーネントによって生成されたテレメトリに対して、コード レベルの可視性またはアクセスがあります。

* コンポーネントは、チームや組織が (コードやテレメトリに) アクセスできない可能性がある SQL や EventHub などの "観察される" 外部依存関係とは異なります。
* コンポーネントは、任意の数のサーバー/ロール/コンテナーのインスタンス上で実行されます。
* コンポーネントは、個別の Application Insights インストルメンテーション キーである場合も (サブスクリプションが異なる場合も)、単一の Application Insights インストルメンテーション キーにレポートするさまざまなロールである場合もあります。 新しいエクスペリエンスでは、その設定方法に関係なく、すべてのコンポーネントの詳細が表示されます。

> [!NOTE]
> * **関連項目のリンクが見つからない場合**: サーバー側の要求、依存関係、および例外に関連するテレメトリはすべて、左側の[上部](#cross-component-transaction-chart)セクションと[下部](#all-telemetry-related-to-the-selected-component-operation)セクションにあります。 
> * [上部](#cross-component-transaction-chart)セクションは、すべてのコンポーネントのトランザクションに関連しています。 最良の結果を得るには、すべてのコンポーネントが最新の Application Insights の安定板 SDK でインストルメント化されていることを確認します。 別の Application Insights リソースがある場合は、そのテレメトリを表示する適切な権限があることを確認します。
> * 左側の[下部](#all-telemetry-related-to-the-selected-component-operation)セクションには、選択したコンポーネントからの要求に関連するトレースとイベントを含む**すべて**のテレメトリが表示されます。

## <a name="enable-transaction-diagnostics-experience"></a>トランザクションの診断エクスペリエンスの有効化
[プレビューの一覧](app-insights-previews.md)から [Unified details: E2E Transaction Diagnostics]\(詳細の一覧: E2C トランザクションの診断\) を有効化します

![プレビューの有効化](media/app-insights-e2eTxn-diagnostics/previews.png)

現在、このプレビューはサーバー側の要求、依存関係、例外に対して使用可能です。 **[検索結果]**、**[パフォーマンス]**、または **[失敗]** トリアージ エクスペリエンスから新しいエクスペリエンスにアクセスできます。 プレビューでは対応する従来の詳細ブレードが置き換えられます。

![パフォーマンスのサンプル](media/app-insights-e2eTxn-diagnostics/performanceSamplesClickThrough.png)

## <a name="transaction-diagnostics-experience"></a>トランザクションの診断エクスペリエンス
このビューには 3 つの重要な部分があります。コンポーネント間のトランザクションのグラフ、特定のコンポーネント操作から送信されるすべてのテレメトリの時系列順の一覧、左側で選択されたテレメトリ項目の詳細ウィンドウです。

![重要な部分](media/app-insights-e2eTxn-diagnostics/3partsCrossComponent.png)

## <a name="cross-component-transaction-chart"></a>コンポーネント間のトランザクションのグラフ

このグラフでは、タイムラインに要求の継続時間を表す横棒と、コンポーネント間の依存関係が示されます。 また、収集されたすべての例外も、タイムライン上でマークされます。

* グラフの一番上の行はエントリ ポイント、すなわち、このトランザクションで呼び出される最初のコンポーネントに対する受信要求を表します。 継続時間は、トランザクションが完了するまでにかかる合計時間です。
* 外部依存関係の呼び出しは、すべてシンプルな折りたたみ不可の行で表され、アイコンは依存関係の種類を表します。
* その他のコンポーネントの呼び出しは、折りたたみ可能な行で表されます。 各行は、コンポーネントで呼び出される特定の操作に対応します。
* 既定では、最初に選択した要求、依存関係、例外がグラフに表示されます。
* 行を選択すると、その[詳細が右側に](#details-of-the-selected-telemetry)表示されます。 

> [!NOTE]
その他のコンポーネントの呼び出しは 2 つの行で表されます。呼び出しコンポーネントからの送信呼び出し (依存関係) を表す行と、呼び出されたコンポーネントの受信要求に対応する行です。 先頭のアイコンと継続時間バーの個別のスタイルは、これらを区別するのに役立ちます。

## <a name="all-telemetry-related-to-the-selected-component-operation"></a>選択したコンポーネント操作に関するすべてのテレメトリ

コンポーネント間のトランザクションのグラフで選択されている任意の行は、特定のコンポーネントで呼び出される操作に関連します。 この選択したコンポーネント操作は、下部のセクションのタイトルに反映されます。 このセクションを開くと、その特定の操作に関連するすべてのテレメトリのフラットな時系列が表示されます。 この一覧の任意のテレメトリ項目を選択して、対応する[詳細を右側に](#details-of-the-selected-telemetry)表示できます。

![すべてのテレメトリの時系列](media/app-insights-e2eTxn-diagnostics/allTelemetryDrawerOpened.png)

## <a name="details-of-the-selected-telemetry"></a>選択したテレメトリの詳細

このウィンドウでは、左側の 2 つのセクションのいずれかから選択された項目の詳細が表示されます。 [すべて表示] では、収集されたすべての標準属性が一覧表示されます。 カスタム属性は標準セットの下に個別に一覧表示されます。 対応する詳細ウィンドウで、[Open profiler traces]\(Profiler トレースを開く\) または [デバッグ スナップショットを開く] をクリックして、コード レベルの診断を行います。

![例外の詳細](media/app-insights-e2eTxn-diagnostics/exceptiondetail.png)

## <a name="profiler-and-snapshot-debugger"></a>Profiler とスナップショット デバッガー

[Application Insights Profiler](app-insights-profiler.md) または[スナップショット デバッガー](app-insights-snapshot-debugger.md)は、パフォーマンスと障害の問題をコード レベルで診断するのに役立ちます。 このエクスペリエンスを使用して、任意のコンポーネントからの Profiler トレースやスナップショットをシングル クリックで表示できます。

プロファイラーが機能しない場合は、**serviceprofilerhelp@microsoft.com** までお問い合わせください。

スナップショット デバッガーが機能しない場合は、**snapshothelp@microsoft.com** までお問い合わせください。

![デバッガーの統合](media/app-insights-e2eTxn-diagnostics/debugSnapshot.png)

## <a name="faq"></a>FAQ

*グラフに 1 つのコンポーネントしか表示されず、その他のコンポーネントは外部依存関係として表示されるのみで、これらのコンポーネント間で発生したことの詳細が表示されません。*

次の理由が考えられます。

* その他のコンポーネントは Application Insights を使用してインストルメント化されましたか。
* それらには Application Insights SDK の最新の安定バージョンが使用されていますか。
* これらのコンポーネントが個別の Application Insights リソースである場合、これらのテレメトリへのアクセスを要求しましたか。

アクセス権を持っていて、コンポーネントが最新の Application Insights SDK でインストルメント化されている場合は、右上のフィードバック チャネルからお知らせください。

*外部依存関係しかありません。このプレビューの必要性はありますか?*

はい。 新しいエクスペリエンスでは、すべての関連するサーバー側テレメトリが、単一ビューに統合されます。 古い詳細ブレードは今後このエクスペリエンスによって置き換えられる予定なので、実際に使用してみてフィードバックをお寄せください。 単一コンポーネントのトランザクションの外観は、次のようになります。

![単一コンポーネントのエクスペリエンス](media/app-insights-e2eTxn-diagnostics/singleComponent.png)

*依存関係の行が重複しています。これは期待される動作ですか?*

現時点では、送信依存関係呼び出しと受信要求は区別して表示されます。 通常、2 つの呼び出しは、ネットワーク ラウンド トリップのために継続時間の値が異なる以外は、まったく同一に見えます。 先頭のアイコンと継続時間バーの個別のスタイルは、これらを区別するのに役立ちます。 このデータの表示方法はわかりにくいですか。 フィードバックをお待ちしております。

*異なるコンポーネント インスタンス間のクロック スキューはどのように処理されますか?*

タイムラインはトランザクションのグラフでクロック スキューに対して調整されます。 詳細ウィンドウか、または Analytics を使用することで、正確なタイムスタンプを確認できます。

*関連項目のクエリのほとんどが、新しいエクスペリエンスからなくなっているのはなぜですか?*

これは設計によるものです。 コンポーネント全体に渡って、関連項目はすべて左側 (上部と下部セクション) から既に利用可能です。 新しいエクスペリエンスの左側で扱われない関連項目が 2 つあります。このイベントの 5 分前後からのすべてのテレメトリと、ユーザー タイムラインです。

*古いブレードでとても気に入っていた機能が、なぜ新しいエクスペリエンスではなくなってしまったのですか?*

ぜひご意見をお聞かせください。 このエクスペリエンスを一般公開する前に、皆さんの懸念事項に対処する所存です。一般公開時には、古いビューは廃止される予定です。 現時点では、プレビューを無効にして古いブレードに戻ることができます。

## <a name="known-issues"></a>既知の問題

* アプリケーション マップからの障害の例が、古い詳細ブレードにリンクされる。
* 検索結果の自動クラスター ベースの洞察が、古い詳細ブレードにリンクされる。
* 新しいエクスペリエンスで作業項目の統合を利用できない。
