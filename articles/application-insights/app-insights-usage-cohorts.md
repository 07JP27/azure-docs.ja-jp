---
title: Azure Application Insights の使用のコーホート | Microsoft Docs
description: 共通点を持つさまざまなユーザー セット、セッション セット、イベント セット、または操作セットを分析します。
services: application-insights
documentationcenter: ''
author: mrbullwinkle
manager: carmonm
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: multiple
ms.topic: article
ms.date: 04/10/2018
ms.author: mbullwin ; daviste
ms.openlocfilehash: 68453499cc6477cc079a342906614e6873938fc8
ms.sourcegitcommit: 9cdd83256b82e664bd36991d78f87ea1e56827cd
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/16/2018
---
# <a name="application-insights-cohorts"></a>Application Insights コーホート

コーホートとは、共通点を持つユーザー セット、セッション セット、イベント セット、または操作セットのことです。 Azure Application Insights では、コーホートは分析クエリによって定義されます。 特定のユーザー セットまたはイベント セットを繰り返し分析していることに気づいた場合、コーホートを使用することで、より柔軟性の高い方法で目的のセットを正確に表現することができます。

![[コーホート] ウィンドウ](.\media\app-insights-usage-cohorts\001.png)

## <a name="cohorts-versus-basic-filters"></a>コーホート対基本的なフィルター

コーホートはフィルターと同じように使用されます。しかし、コーホートの定義はカスタムの分析クエリから作成されるため、コーホートはフィルターよりもはるかに適応性があり複雑なものとなります。 フィルターとは異なり、コーホートの場合はチームの他のメンバーも再利用できるように保存することができます。

アプリの新機能を試してみたすべてのユーザーのコーホートを定義するとします。 このコーホートを Application Insights のリソースに保存すると、その後この特定のユーザー グループの分析を 1 クリックで実行できるようになります。

> [!NOTE]
> コーホートが作成されると、ユーザー、セッション、イベント、ユーザー フローの各ツールから利用できます。

## <a name="example-engaged-users"></a>例: 関心度の高いユーザー

チームでは、特定の月間に対象のアプリを 5 回以上使用したユーザーを関心度の高いユーザーとして定義しています。 このような関心度の高いユーザーのコーホートを定義してみましょう。

1. **[コーホート]** ツールを開きます。

2. **[テンプレート ギャラリー]** タブをクリックします。ここには、さまざまなコーホート用テンプレートのコレクションがあります。

3. **[関心度の高いユーザー]** (利用日数による) を選択します。

    このコーホートに対しては 3 つのパラメーターがあります。
      * **アクティビティ**: "使用" としてカウントするイベントおよびページ ビューを選択できます。
      * **期間**: 月の定義です。
      * **UsedAtleastCustom**: 関心度の高いユーザーとしてカウントするために、ユーザーが期間内に何かを使用する必要がある回数。

4. **UsedAtleastCustom** を "5 日以上" に変更し、**[期間]** を既定値の 28 日のままとします。

    ![イメージ](.\media\app-insights-usage-cohorts\003.png)

    これで、このコーホートでは過去 28 日での個別の 5 日において、任意のカスタム イベントまたはページ ビューと共に送信されたすべてのユーザー ID を表すようになりました。

5. **[Save]** をクリックします。

   > [!TIP]
   >  作成したコーホートに "関心度の高いユーザー (5 日以上)" のような名前を付け、"個人用レポート" または "共有レポート" に保存します。どちらにするかは、この Appication Insights リソースへのアクセス権を有する他のユーザーにもこのコーホートを表示するかどうかによって決まります。

6. **[ギャラリーに戻る]** をクリックします。

### <a name="what-can-you-do-with-this-cohort"></a>このコーホートで行えること

**[ユーザー]** ツールを開き、**[表示]** ドロップダウンから、**[Users who belong to…]\(...に属するユーザー\)** で作成したコーホートを選択します。

これで、ユーザー ツールはフィルター処理され、ユーザーに関するこのコーホートだけが表示されます。

![特定のコーホートを表示するようにフィルター処理された [ユーザー] ウィンドウ](.\media\app-insights-usage-cohorts\004.png)

注意すべき重要な点をいくつか次に示します。
   * これは、通常のフィルターでは作成できなかったセットです。 日付のロジックがより具体的になっています。
   * ユーザー ツールでは通常のフィルターを使用してこのコーホートをさらにフィルター処理することができます。 したがって、コーホートは 28 日の期間に定義されていますが、ユーザー ツール内では時間の範囲を 30 日、60 日、または 90 日に調整することができます。 

これにより、_過去 28 日の間に使用したユーザーの場合、過去 60 日間を見てみるとどうか?_ といったより高度な問い合わせを行うことができます。通常これをクエリ ビルダーによって表現することはできません。

## <a name="example-events-cohort"></a>例: イベントのコーホート

イベントのコーホートを作成することもできます。 イベントとページ ビューのコーホートを定義してから、他のツールでそれらを使用する方法を説明します。 これは、チームによって_アクティブな使用_と見なされるイベント セットを定義する場合、または特定の新機能に関連するイベント セットを定義する場合に便利です。

1. **[コーホート]** ツールを開きます。

2. **[テンプレート ギャラリー]** タブをクリックします。ここには、さまざまなコーホート用テンプレートのコレクションがあります。

3. **[Events Picker]\(イベント ピッカー\)** を選択します。

    ![[Events Picker]\(イベント ピッカー\) のスクリーン ショット](.\media\app-insights-usage-cohorts\006.png)

4. **[アクティビティ]** ドロップダウンで、コーホート内に含めるイベントを選択します。

5. コーホートを保存し、名前を付けます。

## <a name="example-active-users-where-you-modify-query"></a>例: クエリを修正するアクティブ ユーザー

前の 2 つコーホートは、ドロップダウンを使用して定義されました。 ただし、全体的な柔軟性を高めるために分析クエリでコーホートを定義することもできます。 英国からユーザーのコーホートを作成する方法を説明します。

![コーホート ツールの使い方を順を追って示すアニメーション画像](.\media\app-insights-usage-cohorts\cohorts0001.gif)

1. **[コーホート]** ツールを開き、**[テンプレート ギャラリー]** タブをクックし、**[Blank Users cohort]\(空白のユーザー コーホート\)** を選択します。

    ![空白のユーザー コーホート](.\media\app-insights-usage-cohorts\001.png)

    次の 3 つのセクションがあります。
       * Markdown テキスト セクション: チームの他のユーザーのためにコーホートの詳細を記述することができます。

       * パラメーター セクション: 前述の 2 つの例からの **[アクティビティ]** およびその他のドロップダウンのような独自のパラメーターを作成する場合に使用できます。

       * クエリ セクション: 分析クエリを使用してコーホートを定義する場合に使用します。

    クエリ セクションでは、定義するコーホートが説明された特定の行セットを選択する[分析クエリを書き込みます](https://docs.loganalytics.io/index)。 コーホート ツールによって、“| summarize by user_Id” 句が暗黙的にクエリに追加されます。 これはテーブル内のクエリの下にプレビュー表示されるので、クエリが結果を返していることを確認できます。

    > [!NOTE]
    > クエリが表示されない場合は、セクションの高さを高くしてクエリが表示されるようにサイズ調整を行います。 このセクションの先頭にあるアニメーション .gif に、サイズ変更の操作が示されています。

2. 次の内容をクエリ エディターにコピーして貼り付けます。

    ```KQL
    union customEvents, pageViews
    | where client_CountryOrRegion == "United Kingdom"
    ```

3. **[クエリの実行]** をクリックします。 テーブルにユーザー ID が表示されるはずです。 表示されない場合は、アプリケーションのユーザーがいる国に変更します。

4. コーホートを保存して名前を付けます。

## <a name="frequently-asked-questions"></a>よく寄せられる質問

_特定の国からのユーザーのコーホートを定義しました。ユーザー ツールでのこのコーホートを、ユーザー ツールでその国に対してフィルターを設定しただけの場合と比較すると、異なる結果が表示されます。なぜですか?_

コーホートとフィルターは異なります。 英国からのユーザーのコーホートが存在し (上の例のように定義された)、その結果を “Country or region = United Kingdom” というフィルターを設定した場合と比較するとします。

* コーホートの結果には、現在の時間の範囲において英国から少なくとも 1 つのイベントを送信したユーザーからのすべてのイベントが表示されます。 国または地域で分割した場合は、多くの国や地域が表示される可能性が高くなります。
* フィルターの結果には、英国からのイベントのみが表示されます。 一方、国または地域で分割した場合は、英国だけ表示されます。

## <a name="learn-more"></a>詳細情報
- [Analytics クエリ言語](https://go.microsoft.com/fwlink/?linkid=856587)
- [ユーザー、セッション、イベント](app-insights-usage-segmentation.md)
- [ユーザー フロー](app-insights-usage-flows.md)
- [利用状況の概要](app-insights-usage-overview.md)