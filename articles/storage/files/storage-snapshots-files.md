---
title: "Azure ファイル共有スナップショット (プレビュー) の概要 | Microsoft Docs"
description: "Azure ファイル共有スナップショットは、ある時点で作成された読み取り専用の Azure ファイル共有です。 作成された共有スナップショットは、読み取り、コピー、削除はできますが、変更はできません。 共有スナップショットを使用すると、共有をある時点での表示内容のままバックアップできます。"
services: storage
documentationcenter: .net
author: renash
manager: aungoo
editor: tysonn
ms.assetid: edabe3ee-688b-41e0-b34f-613ac9c3fdfd
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/04/2017
ms.author: renash
ms.openlocfilehash: 70b7fec318b527c6c67bd281892c10814712bbc6
ms.sourcegitcommit: 51ea178c8205726e8772f8c6f53637b0d43259c6
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/11/2017
---
# <a name="azure-files-share-snapshot-preview-overview"></a>Azure ファイル共有スナップショット (プレビュー) の概要
Azure Files には、ファイル共有の共有スナップショットを作成する機能があります。 共有スナップショット (プレビュー) は、その時点の共有状態をキャプチャします。 この記事では、共有スナップショットで提供される機能と、それらをカスタムのユース ケースに活用する方法を説明します。


## <a name="when-to-use-share-snapshots"></a>共有スナップショットを使用する目的

### <a name="protection-against-application-error-and-data-corruption"></a>アプリケーション エラーとデータの破損からの保護
-------------------------------------------------------------------------

Azure ファイル共有を使用するアプリケーションでは、書き込み、読み取り、格納、送信、処理などのさまざまな操作を実行します。 アプリケーションが正しく構成されていない場合や、意図的でないバグが組み込まれる場合があり、それによっていくつかのブロックが誤って上書きされたり破損したりすることがあります。 このようなシナリオを防ぐために、新しいアプリケーション コードをデプロイする前に共有スナップショットを作成し、新しいデプロイにバグまたはアプリケーション エラーが組み込まれている場合に、そのファイル共有上に存在する以前のバージョンのデータに戻すことができます。 

### <a name="protection-against-accidental-deletions-or-unintended-changes"></a>誤った削除や意図しない変更からの保護
----------------------------------------------------------------------------------------------

ファイル共有に存在するテキスト ファイルをユーザーが操作しているとしましょう。 テキスト ファイルが閉じられると、変更を元に戻せなくなります。 このような場合は、以前のバージョンのファイルを復旧する必要があります。 共有スナップショットを使用すると、ファイルを誤って名前変更したり削除したりした場合に以前のバージョンを復旧することができます。

### <a name="general-backup-purposes"></a>一般的なバックアップ目的
---------------------------

Azure ファイル共有を作成した後で、Azure ファイル共有の共有スナップショットを定期的に作成してデータのバックアップに使用することができます。 共有スナップショットを定期的に作成すると、将来の監査要件やディザスター リカバリーに使用できる以前のバージョンのデータを維持できます。

## <a name="share-snapshot-capabilities"></a>共有スナップショットの機能

共有スナップショットは、特定の時点のデータの読み取り専用コピーです。 REST API を使用してスナップショットを作成、削除、管理することができます。 同じ機能をクライアント ライブラリ、CLI、Azure Portal でも使用できます。 共有スナップショットの Powershell 統合も近日中に利用できるようになります。 REST API と SMB の両方を使用して、共有のスナップショットを表示することができます。 お客様はディレクトリまたはファイルのバージョンの一覧を取得することができ、特定のバージョンをドライブとして直接マウントすることもできます。 作成された共有スナップショットは、読み取り、コピー、削除はできますが、変更はできません。 共有スナップショット全体を別のストレージ アカウントにコピーすることはできず、azcopy またはその他のコピー メカニズムを使用してファイルごとにコピーする必要があります。

共有スナップショット機能はファイル共有レベルで提供されますが、取得は個々のファイルを復元できるように個々のファイル レベルで提供されます。 SMB、REST API、ポータル、クライアント ライブラリ、または PowerShell/CLI ツールを使用して完全なファイル共有を復元できます。

共有スナップショットが作成された日時を示す **DateTime** 値が共有の URI に追加される点を除き、ファイル共有の共有スナップショットはベース ファイル共有とまったく同じです。 たとえば、ファイル共有の URI が http://storagesample.core.file.windows.net/myshare の場合、共有スナップショット URI は次のようになります
```
http://storagesample.core.file.windows.net/myshare?snapshot=2011-03-09T01:42:34.9360000Z.
```

共有スナップショットは、明示的に削除されるまで保持されます。 共有スナップショットは、ベース ファイル共有よりも長く保持することはできません。 ベース ファイル共有に関連付けられたスナップショットを列挙して、現在のスナップショットを追跡できます。 ファイル共有の共有スナップショットを作成するときに、共有のシステム プロパティに存在するファイルが共有スナップショットに同じ値でコピーされます。 また、共有スナップショットの作成時に別のメタデータを指定しない限り、ベース ファイルとファイル共有のメタデータも共有スナップショットにコピーされます。

共有スナップショットを持つ共有は、最初にすべての共有スナップショットを削除してからでないと削除できません。


## <a name="share-snapshot-space-usage"></a>共有スナップショット領域の使用 

共有スナップショットは増分的な性質を持ちます。つまり、最新の共有スナップショットより後に変更されたデータのみが保存されます。 これにより、共有スナップショットの作成に必要な時間が最小限に抑えられ、ストレージ コストが削減されます。 オブジェクトへの書き込み操作またはプロパティやメタデータの更新操作は「コンテンツの変更」としてカウントされ、共有スナップショットに格納されます。 

領域を節約するために、チャーンが最も高かった期間中の共有スナップショットを削除できます。

共有スナップショットは増分的に保存されますが、共有スナップショットの削除プロセスは、共有を復元するために保持する必要があるのが最新の共有スナップショットのみになるように設計されています。 共有スナップショットを削除すると、その共有スナップショットに固有のデータのみが削除されます。 アクティブなスナップショットには、(共有スナップショットが作成された時点の) データを参照して元の場所または別の場所に復元するために必要な情報がすべて含まれます。 復元は項目レベルで実行できます。

スナップショットは、5 TB の共有制限に対してカウントされません。 合計領域のうち共有スナップショットが占有する領域に制限はありません。 ストレージ アカウントの制限は依然として適用されます。

## <a name="limits"></a>制限

Azure Files で現在許可されている共有スナップショットの最大数は 200 です。 200 個の共有スナップショットの作成後、新しい共有スナップショットを作成するためには以前の共有スナップショットをユーザーが削除する必要があります。 共有スナップショットを作成するための同時呼び出しに制限はありません。
特定のファイル共有の共有スナップショットが利用できる領域の量に制限はありません。 

## <a name="copy-data-back-to-a-share-from-share-snapshot"></a>共有スナップショットから共有へのデータのコピー

ファイルや共有スナップショットに関連するコピー操作は次のルールに従います。

ファイル共有スナップショットの個々のファイルは、ベース共有またはその他の任意の場所にコピーできます。 ファイルの以前のバージョンを復元したり、共有スナップショットからファイルごとにコピーして完全なファイル共有を復元したりすることができます。 共有スナップショットはベース共有にレベル上げされません。 共有スナップショットはコピー後もそのまま残りますが、ベース ファイル共有は、共有スナップショットで使用可能だったデータのコピーで上書きされます。 復元されたファイルはすべて「変更されたコンテンツ」としてカウントされます。

共有スナップショット内のファイルを別の名前でコピー先にコピーできます。 結果として得られるコピー先ファイルは書き込み可能なファイルであり、共有スナップショットではありません。

コピー先ファイルをコピーで上書きしても、元のコピー先ファイルに関連付けられた共有スナップショットは元の状態のままになります。

## <a name="general-best-practices"></a>一般的なベスト プラクティス 

Azure でインフラストラクチャを実行するときには、可能な限りデータ復旧用のバックアップを自動化します。 自動化されたアクションは手動のプロセスより信頼性が高く、データ保護と回復性の向上に役立ちます。 自動化には REST API、クライアント SDK またはスクリプトを使用することができます。

不要な共有スナップショットに対する課金を避けるために、共有スナップショット スケジューラをデプロイする前に、共有スナップショットの頻度とリテンション期間の設定を慎重に検討してください。

共有スナップショットはファイル レベルの保護のみを提供し、共有スナップショットではタイプミスによるファイル共有またはストレージ アカウントの削除からは保護されません。 ストレージ アカウントを誤って削除しないようにするために、ストレージ アカウントまたはリソース グループをロックできます。

## <a name="next-steps"></a>次のステップ
* [Azure ファイル共有スナップショットの操作](storage-how-to-use-files-snapshots.md)
* [共有スナップショットに関してよく寄せられる質問](storage-files-faq.md)

