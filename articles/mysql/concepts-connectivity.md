---
title: Azure Database for MySQL の一時的な接続エラーに対処する | Microsoft Docs
description: Azure Database for MySQL の一時的な接続エラーに対処する方法を説明します。
keywords: mysql 接続,接続文字列,接続の問題,一時的なエラー,接続エラー
services: mysql
author: janeng
ms.author: janeng
manager: kfile
editor: jasonwhowell
ms.service: mysql
ms.topic: article
ms.date: 11/09/2018
ms.openlocfilehash: 1944b30e5c658f1df896050d0ff43f1058d5dd32
ms.sourcegitcommit: ba4570d778187a975645a45920d1d631139ac36e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/08/2018
ms.locfileid: "51285454"
---
# <a name="handling-of-transient-connectivity-errors-for-azure-database-for-mysql"></a>Azure Database for MySQL の一時的な接続エラーに対処する

この記事では、Azure Database for MySQL への接続時に遭遇する一時的なエラーへの対処方法を説明します。

## <a name="transient-errors"></a>一時的なエラー

一時的なエラーとは自然に解決するエラーのことで、一過性の障害とも呼ばれます。 データベース サーバーへの接続が切断される症状として現れるのが、最も典型的なケースです。 また、サーバーへの新しい接続を開くことができないこともあります。 たとえばハードウェアやネットワークに障害が起こると、一時的なエラーが発生することがあります。 また、新しいバージョンの PaaS サービスがロールアウトされていると、やはり発生の原因となることがあります。こうした事象の大半は、システムにより、60 秒かからず自動的に緩和されます。 クラウドのアプリケーショでは、一時的なエラーを想定することが、設計と開発のベスト プラクティスとなります。 どのコンポーネントでも常に起こりうると想定し、そうした状況に対処するための適切なロジックを設けるのです。

## <a name="handling-transient-errors"></a>一時的エラーの処理

一時的なエラーは、再試行ロジックを使用して処理する必要があります。 考慮に入れるべき状況は以下のとおりです。

* 接続を開こうとするときにエラーが発生する
* アイドル接続がサーバー側で切断される。 コマンドを発行しようとしても実行できない
* 現在コマンドを実行しているアクティブな接続が切断される。

1 つ目と 2 つ目は、かなり対処しやすいケースです。 もう一度接続を開くことを試みます。 成功するようなら、一時的なエラーがシステム側で既に緩和されています。 再び Azure Database for MySQL を使用することができます。 接続を再試行する前に待ち時間を設けることをお勧めします。 初回再試行に失敗した場合は、バック オフを行います。 そうすることで、システムは利用可能なすべてのリソースを使用してエラー状態を克服することができます。 推奨されるパターンを次に示します。

* 初回再試行の前には 5 秒間待機します。
* 以降再試行するたびに、60 秒を上限として、待ち時間を指数関数的に増やします。
* 操作が失敗したとアプリケーションが見なす最大再試行回数を設定します。

アクティブなトランザクションが進行している接続でエラーが発生した場合、回復に向けた正しい対処への難易度が上がります。 2 つのケースがあります。トランザクションが本質的に読み取り専用である場合は、接続を再度開いてトランザクションを再試行するのが安全です。 一方、データベースへの書き込みも伴うトランザクションの場合は、そのトランザクションがロールバックされたかどうかや、一時的なエラーが発生する前に成功したかどうかを判断しなければなりません。 このケースでは、データベース サーバーからコミットの確認を受け取っていないだけかもしれません。

その判断を行う 1 つの方法として、すべての再試行に使用される一意の ID をクライアントで生成することが考えられます。 この一意の ID をトランザクションの一部としてサーバーに渡し、一意制約のある列に格納します。 こうすることで、トランザクションを安全に再試行することができます。 前のトランザクションがロールバックされ、なおかつクライアントで生成された一意の ID がまだシステムに存在しなければ、これは成功します。 一意の ID が既に格納されている場合は、前回のトランザクションは正常に完了していることになるので、再試行は失敗し、キーが重複している旨の違反が表示されます。

ご使用のプログラムがサード パーティのミドルウェアを介して Azure Database for MySQL と通信する場合、一時エラーに対応した再試行ロジックがそのミドルウェアに備わっているかどうかをベンダーに確認してください。

再試行ロジックは必ずテストしてください。 たとえば、Azure Database for MySQL サーバーのコンピューティング リソースをスケールアップまたはスケールダウンしているときに、実際のコードを実行してみましょう。 この操作中に発生した短時間のダウンタイムには、アプリケーションで問題なく対処する必要があります。

## <a name="next-steps"></a>次の手順

* [Azure Database for MySQL への接続に関する問題のトラブルシューティング](howto-troubleshoot-common-connection-issues.md)
