<properties linkid="" urlDisplayName="" pageTitle="" metaKeywords="" description="" metaCanonical="" services="" documentationCenter="" title="Traffic Manager の設定の構成方法" authors="" solutions="" manager="" editor="" />


#トラフィック マネージャーの設定の構成方法#
Azure のトラフィック マネージャーを使用すると、Azure ホステッド サービスへのユーザー トラフィックの振り分けを制御できます。

トラフィック マネージャーは、会社のメイン ドメイン名に対する DNS クエリにインテリジェントなポリシー エンジンを適用することで機能します。会社が所有する DNS リソース レコードは、会社のドメインで Traffic Manager ドメインが参照されるように更新する必要があります。それらのドメインに接続されているトラフィック マネージャー ポリシーに基づいて、会社のメイン ドメイン名に対する DNS クエリが、トラフィック マネージャー ポリシー内の特定の Azure ホステッド サービスの IP アドレスに解決されます。詳細については、[Azure のトラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/hh744833.aspx)を参照してください。

##目次

* [方法: 会社のインターネット ドメインでトラフィック マネージャー ドメインが参照されるようにする](#howto_point_company)
* [方法: ポリシーをテストする](#howto_test)
* [方法: ポリシーとホステッド サービスを一時的に無効にする](#howto_temp_disable)
* [方法: ポリシーを編集する](#howto_edit_policy)
* [方法: トラフィックを一連のホステッド サービスに均等に負荷分散する](#howto_load_balance)
* [方法: フェールオーバー ポリシーを作成する](#howto_create_failover)
* [方法: ネットワーク パフォーマンスに基づいて受信トラフィックをホステッド サービスに振り分ける](#howto_direct)


<h2><a id="howto_point_company"></a>方法: 会社のインターネット ドメインでトラフィック マネージャー ドメインが参照されるようにする</h2>

会社のドメイン名で Traffic Manager ドメインが参照されるようにするには、CNAME を使用して DNS サーバー上の DNS リソース レコードを編集します。

たとえば、会社のメイン ドメイン **www.contoso.com** で **contoso.trafficmanager.net** という名前のトラフィック マネージャー ドメインが参照されるようにするには、DNS リソース レコードを次のように更新します。
``www.contoso.com IN CNAME contoso.trafficmanager.net``

これで、*www.contoso.com* へのすべてのトラフィックが *contoso.trafficmanager.net* にリダイレクトされるようになります。使用するドメインは、すべてのトラフィックをトラフィック マネージャーにリダイレクトする必要のあるドメインにしてください。

<h2><a id="howto_test"></a>方法: ポリシーをテストする</h2>

ポリシーをテストする最良の方法は、複数のクライアントを設定し、ポリシー内のサービスを一度に 1 つずつダウンさせることです。以下に、トラフィック マネージャー ポリシーをテストするために役立つヒントを示します。

- **DNS TTL を非常に短い時間に設定**して、変更がすぐに反映されるようにします。たとえば 30 秒に設定します。

- **テストするポリシー内の Azure ホステッド サービスの IP アドレスを確認**します。この情報は Azure 管理ポータルから取得できます。サービスの運用環境のデプロイをクリックします。右側のプロパティ ウィンドウで、最後のエントリがそのホステッド サービスの VIP (仮想 IP アドレス) になります。

	![ホステッド サービスの IP の場所][0]

	**図 1** -  ホステッド サービスの IP の場所

- **DNS 名を IP アドレスに解決**してそのアドレスを表示できるツールを使用します。会社のドメイン名がポリシー内のホステッド サービスの IP アドレスに解決されることを確認します。その名前解決は Traffic Manager ポリシーと同じ負荷分散方式で行われる必要があります。Windows システム上では、CMD ウィンドウから nslookup コマンドを使用できます (後で説明)。他にも、インターネット上には IP アドレスを調べることができるツールがあり、すぐに使用できる状態で公開されています。

- **nslookup コマンドを使用してトラフィック マネージャー ポリシーを確認**します**。

> **nslookup コマンドを使用してトラフィック マネージャー ポリシーを確認するには**

>1. **[スタート]、[ファイル名を指定して実行]** の順にクリックし、「**CMD**」と入力して、CMD ウィンドウを起動します。

>2. DNS リゾルバー キャッシュをフラッシュするために、「``ipconfig /flushdns``」と入力します。

>3. コマンド「``nslookup <your traffic manager domain>``」を入力します。
 たとえば、``nslookup myapp.contoso.trafficmanager.net`` というコマンドは、プレフィックスが *myapp.contoso* のドメインを確認します。

>>通常、結果として次の情報が表示されます。

>> - このトラフィック マネージャー ドメインを解決するためにアクセスされる DNS サーバーの DNS 名と IP アドレス。

>> - コマンド ラインで "nslookup" の後に入力したトラフィック マネージャー ドメイン名と、そのトラフィック マネージャー ドメインから解決された IP アドレス。
この 2 番目の IP アドレスを確認することが重要です。この IP アドレスが、テスト対象のトラフィック マネージャー ポリシー内のいずれかのホステッド サービスの VIP に一致する必要があります。

>>![nslookup コマンドの例][1]

>>**図 2** - nslookup コマンドの例

- **そのほかにも、次に示しているようなテスト方法があります。**テスト対象の負荷分散方式に適した方法を選択します。

###パフォーマンス ポリシー###

ドメインを効果的にテストするには、世界中のさまざまな地域にあるクライアントが必要になります。1 つの方法として、Azure 上にクライアントを作成し、それらのクライアントから会社のドメイン名を使用してサービスの呼び出しをテストできます。または、世界各国に事業所がある会社の場合は、他の国の地域にあるクライアントにリモート ログインし、そらのクライアントからテストを行うことができます。

無料で利用できる Web ベースの nslookup および dig サービスがあります。これらのサービスの中には、さまざまな場所から DNS 名前解決を確認できるものもあります。たとえば、nslookup に基づいた検索が可能です。さらに、Gomez や Keynote のようなサード パーティ製ソリューションもあります。このようなソリューションを使用して、トラフィックがポリシーに基づいて予期したとおりに振り分けられることを確認できます。

###フェールオーバー ポリシー###

1. すべてのサービスを稼働状態にします。

2. 1 つのクライアントを使用します。

3. ping または同様のユーティリティを使用して、会社のドメインの DNS 解決を要求します。

4. 取得した IP アドレスがプライマリ ホステッド サービスの IP アドレスに一致することを確認します。

5. プライマリ サービスをダウンさせるか監視ファイルを削除して、トラフィック マネージャーでそのサービスがダウンしていると認識されるようにします。

6. 少なくとも 2 分待ちます。

7. DNS 解決を要求します。

8. 取得した IP アドレスが、[トラフィック マネージャー ポリシーの編集] ダイアログ ボックスのサービス一覧内の 2 番目のホステッド サービスの IP アドレスに一致することを確認します。

9. 2 番目のサービスをダウンさせて、次は 3 番目のサービスをダウンさせてという具合に、ここまでの手順を繰り返します。毎回、DNS 解決によって一覧内の次のサービスの IP アドレスが返されることを確認します。すべてのサービスをダウンさせたら、プライマリ ホステッド サービスの IP アドレスが再度返されます。

###ラウンド ロビン ポリシー###

1. すべてのサービスを稼働状態にします。

2. 1 つのクライアントを使用します。

3. トップ レベル ドメインの DNS 解決を要求します。

4. 取得した IP アドレスが一覧内の IP アドレスのいずれかに一致することを確認します。

5. ここまでの手順を繰り返します。DNS TTL が経過すると、新しい IP アドレスが返されます。各ホステッド サービスの IP アドレスが順番に返されます。このような処理が繰り返されます。


<h2><a id="howto_temp_disable"></a>方法: ポリシーとホステッド サービスを一時的に無効にする</h2>

以前に作成したトラフィック マネージャー ポリシーを無効にして、それらのポリシーに基づいてトラフィックが振り分けられないようにできます。Traffic Manager ポリシーを無効にしても、ポリシーの情報は元のままで、Traffic Manager インターフェイスで編集可能です。ポリシーは簡単に再度有効にでき、トラフィックの振り分けが再開されます。

また、トラフィック マネージャー ポリシー内の個々のホステッド サービスを無効にすることもできます。この方法では、無効にしたホステッド サービスはポリシー内に残りますが、そのホステッド サービスが削除されたかのようにポリシーは機能します。この方法が便利なのは、メンテナンス モードのホステッド サービスや、再デプロイされて不安定なホステッド サービスを一時的に削除する場合です。そのホステッド サービスが稼働状態に戻ったら、再度有効にできます。

**注**  
ホステッド サービスを無効にしても、Azure でのそのサービスの展開状態に影響はありません。正常なサービスは、Traffic Manager で無効になっていても、稼働状態のままでトラフィックを受信できます。また、ポリシー内でホステッド サービスを無効にしても、別のポリシー内でのそのサービスの状態に影響はありません。

###ポリシーを無効にするには###

1. トラフィック マネージャー インターフェイス ツリーで、有効になっているポリシーを選択します。

2. 上部のツール バーで **[ポリシーの無効化]** をクリックします。既に無効になっているポリシーを選択すると、このボタンは淡色表示されることに注意してください。

###ポリシーを有効にするには###

1. トラフィック マネージャー インターフェイス ツリーで、無効になっているポリシーを選択します。

2. 上部のツール バーで **[ポリシーの有効化]** をクリックします。既に有効になっているポリシーを選択すると、このボタンは淡色表示されることに注意してください。

###ホステッド サービスを無効にするには###

1. トラフィック マネージャー インターフェイスで、ポリシー内で有効になっているホステッド サービスを選択します。ポリシー内のホステッド サービスを表示するには、そのポリシーを展開する必要があります。

2. 上部のツール バーで **[サービスのポリシーの無効化]** をクリックします。既に無効になっているホステッド サービスを選択すると、このボタンは淡色表示されることに注意してください。

3. そのホステッド サービスへのトラフィックの振り分けが、ポリシー内のトラフィック マネージャー ドメインに設定された DNS TTL に基づいて停止されます。詳細については、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/5229dd1c-5a91-4869-8522-bed8597d9cf5#BKMK_Monitoring)で、Azure トラフィック マネージャーでのホステッド サービスの監視に関するセクションを参照してください。

###ホステッド サービスを有効にするには###

1. トラフィック マネージャー インターフェイスで、ポリシー内で無効になっているホステッド サービスを選択します。ポリシー内のホステッド サービスを表示するには、そのポリシーを展開する必要があります。

2. 上部のツール バーで **[サービスのポリシーの有効化]** をクリックします。既に有効になっているホステッド サービスを選択すると、このボタンは淡色表示されることに注意してください。

3. そのホステッド サービスへのトラフィックの振り分けがポリシーに基づいて再開されます。

<h2><a id="howto_edit_policy"></a>方法: ポリシーを編集する</h2>

ポリシーまたはポリシー内の特定のホステッド サービスを一時的にオフにする必要がある場合は、ポリシーを変更することなく、それらを一時的に無効にできます。

ポリシーを別の種類に変更するには、次の手順を実行します。

1. **管理ポータル ([http://manage.windowsazure.com](http://manage.windowsazure.com)) でトラフィック マネージャー領域にログイン**します。ポータル ページの左下にある **[仮想ネットワーク]** をクリックし、左側のウィンドウのオプションから **[トラフィック マネージャー]** を選択します。

2. **管理ポータルのトラフィック マネージャー画面で、変更するポリシーを選択**します。

3. **上部のメニュー バーで [構成] をクリック**します。

4. **ポリシーに必要な変更を加えます。**負荷分散方法を変更した場合、選択したオプションによっては、**[選択したホステッド サービス]** ボックスの一覧内のホステッド サービスの順序が重要になることに注意してください。

5. **[保存]** をクリックします。

<h2><a id="howto_load_balance"></a>方法: トラフィックを一連のホステッド サービスに均等に負荷分散する</h2>

負荷分散の一般的なパターンは、一連の同じホステッド サービスを用意し、トラフィックをラウンド ロビン方式でそれらの各サービスに送信することです。この記事では、この方式の負荷分散を実行するようにトラフィック マネージャー ドメインとポリシーを設定する手順について概説します。

トラフィック マネージャーに用意されているさまざまな負荷分散方法の詳細については、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/hh744833.aspx)で、Azure トラフィック マネージャーでの負荷分散方法に関するセクションを参照してください。

1. **ホステッド サービスを運用環境に展開**します。ホステッド サービスの開発と展開については、[Azure ホステッド サービスに関するページ](http://msdn.microsoft.com/library/gg432967.aspx)を参照してください。

2. **管理ポータル ([http://manage.windowsazure.com](http://manage.windowsazure.com)) でトラフィック マネージャー領域にログイン**します。ポータル ページの左下にある **[仮想ネットワーク]** をクリックし、左側のウィンドウのオプションから **[トラフィック マネージャー]** を選択します。

3. **[ポリシー] を選択し、[作成] をクリックします。**左側のナビゲーション ツリーから **[ポリシー]** フォルダーを選択して、上部のツール バーの **[作成]** を有効にします。**[作成]** を選択します。**[トラフィック マネージャー ポリシーの作成]** ダイアログ ボックスが表示されます。

	![ポリシーの [作成] ボタン][2]

	**図 1** -  ポリシーの [作成] ボタン

4. **サブスクリプションを選択します。**ポリシーとドメインは 1 つのサブスクリプションに関連付けられます。

5. **[ラウンド ロビン] 負荷分散方式を選択します。**トラフィック マネージャーに用意されているさまざまな負荷分散方法の詳細については、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/hh744833.aspx)で、Azure トラフィック マネージャーでの負荷分散方法に関するセクションを参照してください。

6. **ホステッド サービスを見つけ、ポリシーに追加します。**フィルター ボックスを使用して、ボックスに入力した文字列を含むホステッド サービスを見つけます。ボックスをクリアすると、手順 4. で選択したサブスクリプションについて、運用環境にあるすべてのホステッド サービスが表示されます。矢印ボタンを使用して、ホステッド サービスをポリシーに追加します。この負荷分散方法では、**[選択された DNS 名]** ボックスでの順序は重要ではありません。

7. **監視を設定します。**監視により、オフラインになっているホステッド サービスにトラフィックが送信されなくなります。ホステッド サービスを監視するには、特定のパスとファイル名を指定する必要があります。
詳細については、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/5229dd1c-5a91-4869-8522-bed8597d9cf5#BKMK_Monitoring)で、Azure トラフィック マネージャーでのホステッド サービスの監視に関するセクションを参照してください。

8. **トラフィック マネージャー ドメインに名前を付けます。**ドメインには一意の名前を付けてください。指定できるのはドメイン名のプレフィックスのみです。DNS Time to Live は既定の時間のままにします。
この設定の効果の詳細については、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/5229dd1c-5a91-4869-8522-bed8597d9cf5#BKMK_Monitoring)で、Azure トラフィック マネージャー使用時のホステッド サービスとポリシーのベスト プラクティスに関するセクションを参照してください。


	**[トラフィック マネージャー ポリシーの作成]** ダイアログ ボックスは次の例のようになります。

	![ラウンド ロビン負荷分散方法のダイアログ ボックス][3]

	**図 2** - ラウンド ロビン負荷分散方法のダイアログ ボックス

9. **Traffic Manager ドメインとポリシーをテストします。**手順については、「[方法: Azure トラフィック マネージャー ポリシーをテストする](#howto_test)」を参照してください。

10. **DNS サーバーで Traffic Manager ドメインを参照します。**トラフィック マネージャー ドメインを設定したら、権威 DNS サーバー上の DNS レコードを編集して、会社のドメインでトラフィック マネージャー ドメインが参照されるようにします。
たとえば、次のコマンドでは、**www.contoso.com** へのすべてのトラフィックがトラフィック マネージャー ドメイン **contoso.trafficmanager.net** に振り分けられます。
`` www.contoso.com IN CNAME contoso.trafficmanager.net``
詳細については、「[方法: 会社のインターネット ドメインでトラフィック マネージャー ドメインが参照されるようにする](#howto_point_company)」を参照してください。

<h2><a id="howto_create_failover"></a>方法: フェールオーバー ポリシーを作成する</h2>

多くの場合、組織ではサービスの信頼性を維持する必要があります。そのために、会社のプライマリ サービスがダウンした場合に備えてバックアップ サービスを提供します。サービスのフェールオーバーの一般的なパターンは、一連の同じホステッド サービスを用意し、トラフィックをプライマリ サービスに送信する一方で、その他のホステッド サービスはバックアップとして確保しておくことです。この記事では、このフェールオーバー方式の負荷分散を実行するようにトラフィック マネージャー ポリシーを設定する手順について概説します。

トラフィック マネージャーに用意されているさまざまな負荷分散方法の詳細については、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/hh744833.aspx)で、Azure トラフィック マネージャーでの負荷分散方法に関するセクションを参照してください。

1. **ホステッド サービスを運用環境に展開**します。ホステッド サービスの開発と展開については、[Azure ホステッド サービスに関するページ](http://msdn.microsoft.com/library/gg432967.aspx)を参照してください。

2. **管理ポータル ([http://manage.windowsazure.com](http://manage.windowsazure.com)) でトラフィック マネージャー領域にログイン**します。ポータル ページの左下にある **[仮想ネットワーク]** をクリックし、左側のウィンドウのオプションから **[トラフィック マネージャー]** を選択します。

3. **[ポリシー] を選択し、[作成] をクリックします。**左側のナビゲーション ツリーから **[ポリシー]** フォルダーを選択して、上部のツール バーの **[作成]** を有効にします。**[作成]** を選択します。**[トラフィック マネージャー ポリシーの作成]** ダイアログ ボックスが表示されます。

	![ポリシーの [作成] ボタン][4]

	**図 1** - ポリシーの [作成] ボタン

4. **サブスクリプションを選択します。**ポリシーとドメインは 1 つのサブスクリプションに関連付けられます。

5. **[フェールオーバー ポリシー] 負荷分散方式を選択します。**トラフィック マネージャーに用意されているさまざまな負荷分散方法の詳細については、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/hh744833.aspx)で、Azure トラフィック マネージャーでの負荷分散方法に関するセクションを参照してください。

6. **ホステッド サービスを見つけ、ポリシーに追加します。**フィルター ボックスを使用して、ボックスに入力した文字列を含むホステッド サービスを見つけます。ボックスをクリアすると、手順 4 で選択したサブスクリプションについて、運用環境にあるすべてのホステッド サービスが表示されます。矢印ボタンを使用して、ホステッド サービスをポリシーに追加します。**[フェールオーバー]** 負荷分散方法を選択した場合は、選択したサービスの順序が重要です。プライマリ ホステッド サービスが先頭になります。必要に応じて、上向きと下向きの矢印を使用して順序を変更します。

7. 監視により、オフラインになっているホステッド サービスにトラフィックが送信されなくなります。監視を設定しないでフェールオーバー ポリシーを使用しても意味はありません。プライマリ ホステッド サービスがオフラインになっている場合でも、トラフィックがそのホステッド サービスに送信されるためです。ホステッド サービスを監視するには、特定のパスとファイル名を指定する必要があります。
詳細については、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/5229dd1c-5a91-4869-8522-bed8597d9cf5#BKMK_Monitoring)で、Azure トラフィック マネージャーでのホステッド サービスの監視に関するセクションを参照してください。

8. **トラフィック マネージャー ドメインに名前を付けます。**ドメインには一意の名前を付けてください。指定できるのはドメイン名のプレフィックスのみです。**[DNS Time to Live (TTL)]** は既定の時間のままにします。
この設定の効果の詳細については、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/5229dd1c-5a91-4869-8522-bed8597d9cf5#BKMK_Monitoring)で、Azure トラフィック マネージャー使用時のホステッド サービスとポリシーのベスト プラクティスに関するセクションを参照してください。
 
	**[トラフィック マネージャー ポリシーの作成]** ダイアログ ボックスは次の例のようになります。

	![フェールオーバー負荷分散方式のダイアログ ボックス][5]

	**図 2** - フェールオーバー負荷分散方法のダイアログ ボックス

9. **Traffic Manager ドメインとポリシーをテストします。**詳細については、「[方法: Azure トラフィック マネージャー ポリシーをテストする](#howto_test)」を参照してください。

10. **DNS サーバーで Traffic Manager ドメインを参照します。**トラフィック マネージャー ドメインを設定したら、権威 DNS サーバー上の DNS レコードを編集して、会社のドメインでトラフィック マネージャー ドメインが参照されるようにします。
詳細については、「[方法: 会社のインターネット ドメインでトラフィック マネージャー ドメインが参照されるようにする](#howto_point_company)」を参照してください。
たとえば、次のコマンドでは、**www.contoso.com** へのすべてのトラフィックがトラフィック マネージャー ドメイン **contoso.trafficmanager.net** に振り分けられます。
``www.contoso.com IN CNAME contoso.trafficmanager.net``

<h2><a id="howto_direct"></a>方法: ネットワーク パフォーマンスに基づいて受信トラフィックをホステッド サービスに振り分ける</h2>

世界中のさまざまなデータ センターに配置されているホステッド サービスを負荷分散するために、受信トラフィックを最も近いホステッド サービスに振り分けることができます。"最も近い" というのは、文字どおり地理的距離が最も近い場所に相当する場合もありますが、要求処理までの待機時間が最も短い場所に相当する場合もあります。[パフォーマンス] 負荷分散方式を選択すると、トラフィックを距離や待機時間に基づいて振り分けることはできますが、振り分け時にネットワークの構成や負荷のリアルタイムの変化を考慮することはできません。トラフィック マネージャーに用意されているさまざまな負荷分散方法の詳細については、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/hh744833.aspx)で、Azure トラフィック マネージャーでの負荷分散方法に関するセクションを参照してください。

次の手順では、このプロセスについて説明します。

1. **ホステッド サービスを運用環境に展開**します。詳細については、「[Azure 対応のホステッド サービスの作成](http://msdn.microsoft.com/ja-jp/library/windowsazure/gg432967.aspx)」を参照してください。
また、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/5229dd1c-5a91-4869-8522-bed8597d9cf5#BKMK_Monitoring)で、ホステッド サービスとポリシーのベスト プラクティスに関するセクションも参照してください。

2. **管理ポータル ([http://manage.windowsazure.com](http://manage.windowsazure.com)) でトラフィック マネージャー領域にログイン**します。ポータル ページの左下にある **[仮想ネットワーク]** をクリックし、左側のウィンドウのオプションから **[トラフィック マネージャー]** を選択します。

3. **[ポリシー] を選択し、[作成] をクリックします。**左側のナビゲーション ツリーから **[ポリシー]** フォルダーを選択して、上部のツール バーの **[作成]** を有効にします。**[作成]** を選択します。**[トラフィック マネージャー ポリシーの作成]** ダイアログ ボックスが表示されます。

	![ポリシーの [作成] ボタン][6]
	
	**図 1** - ポリシーの [作成] ボタン

4. **サブスクリプションを選択します。**ポリシーとドメインは 1 つのサブスクリプションに関連付けられます。

5. **[パフォーマンス] 負荷分散方式を選択します。**トラフィック マネージャーに用意されているさまざまな負荷分散方法の詳細については、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/hh744833.aspx)で、Azure トラフィック マネージャーでの負荷分散方法に関するセクションを参照してください。

6. **ホステッド サービスを見つけ、ポリシーに追加します。**フィルター ボックスを使用して、ボックスに入力した文字列を含むホステッド サービスを見つけます。ボックスをクリアすると、手順 4 で選択したサブスクリプションについて、運用環境にあるすべてのホステッド サービスが表示されます。矢印ボタンを使用して、ホステッド サービスをポリシーに追加します。この負荷分散方法では、**[選択された DNS 名]** ボックスでの順序は重要ではありません。

7. **監視を設定します。**監視により、オフラインになっているホステッド サービスにトラフィックが送信されなくなります。ホステッド サービスを監視するには、特定のパスとファイル名を指定する必要があります。
詳細については、[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/5229dd1c-5a91-4869-8522-bed8597d9cf5#BKMK_Monitoring)で、Azure トラフィック マネージャーでのホステッド サービスの監視に関するセクションを参照してください。

8. **トラフィック マネージャー ドメインに名前を付けます。**ドメインには一意の名前を付けてください。指定できるのはドメイン名のプレフィックスのみです。**[DNS Time to Live (TTL)]** は既定の時間のままにします。
この設定の効果の詳細については、「[Azure トラフィック マネージャーの概要に関するページ](http://msdn.microsoft.com/ja-jp/library/windowsazure/5229dd1c-5a91-4869-8522-bed8597d9cf5#BKMK_Monitoring)で、Azure トラフィック マネージャー使用時のホステッド サービスとポリシーのベスト プラクティスに関するセクションを参照してください。
 
	**[トラフィック マネージャー ポリシーの作成]** ダイアログ ボックスは次の例のようになります。

	![パフォーマンス負荷分散方式のダイアログ ボックス][7]

	**図 2** - パフォーマンス負荷分散方法のダイアログ ボックス

9. **Traffic Manager ドメインとポリシーをテストします。**テストの詳細については、「[方法: Azure トラフィック マネージャー ポリシーをテストする](#howto_test)」を参照してください。

10. **DNS サーバーで Traffic Manager ドメインを参照します。**トラフィック マネージャー ドメインを設定したら、権威 DNS サーバー上の DNS レコードを編集して、会社のドメインでトラフィック マネージャー ドメインが参照されるようにします。
たとえば、次のコマンドでは、**www.contoso.com** へのすべてのトラフィックがトラフィック マネージャー ドメイン **contoso.trafficmanager.net** に振り分けられます。
``www.contoso.com IN CNAME contoso.trafficmanager.net``
詳細については、「[方法: 会社のインターネット ドメインでトラフィック マネージャー ドメインが参照されるようにする](#howto_point_company)」を参照してください。

[0]: ./media/traffic-manager-configure-settings/hosted_service_IP_location.png
[1]: ./media/traffic-manager-configure-settings/nslookup_command_example.png
[2]: ./media/traffic-manager-configure-settings/Create_button_for_policies.png
[3]: ./media/traffic-manager-configure-settings/Dialog_box_for_Round_Robin_load_balancing_method.png
[4]: ./media/traffic-manager-configure-settings/Create_button_for_policies.png
[5]: ./media/traffic-manager-configure-settings/Dialog_box_for_Failover_load_balancing_method.png
[6]: ./media/traffic-manager-configure-settings/Create_button_for_policies.png
[7]: ./media/traffic-manager-configure-settings/Dialog_box_for_Performance_load_balancing_method.png

