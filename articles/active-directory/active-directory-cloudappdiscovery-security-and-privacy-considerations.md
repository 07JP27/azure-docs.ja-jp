<properties 
	pageTitle="Cloud App Discovery のセキュリティとプライバシーの考慮事項" 
	description="このトピックでは、Cloud App Discovery に関連するセキュリティとプライバシーの考慮事項について説明します。" 
	services="active-directory" 
	documentationCenter="" 
	authors="markusvi" 
	manager="swadhwa" 
	editor="lisatoft"/>

<tags 
	ms.service="active-directory" 
	ms.workload="identity" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="08/04/2015" 
	ms.author="markusvi"/>

# Cloud App Discovery のセキュリティとプライバシーの考慮事項

Microsoft は、組織のセキュリティの管理に役立つソフトウェアやサービスを提供すると同時に、お客様のプライバシーとデータの保護に努めています。<br>他者にデータを委託する場合、信頼には厳格なセキュリティ エンジニアリングへの投資とそれを裏付ける専門知識が必要であることを把握しております。Microsoft ではセキュリティで保護されたソフトウェア開発ライフサイクルの実践からサービスの運用まで、厳密なコンプライアンスとセキュリティのガイドラインに準拠しています。<br>Microsoft においてデータの保護は最優先事項になります。

このトピックでは、Azure Active Directory Cloud App Discovery でデータを収集、処理、およびセキュリティ保護する方法について説明します。




##概要

Cloud App Discovery は Azure AD の機能であり、Microsoft Azure でホストされます。<br>Cloud App Discovery Endpoint Agent は、IT で管理されているコンピューターからアプリケーション検出データを収集するために使用します。<br>収集したデータは、暗号化されたチャネル経由でセキュリティで保護されて Azure AD Cloud App Discovery サービスに送信されます。<br>その後、組織の Cloud App Discovery データは、Azure ポータルに表示されます。


<center>![How Cloud App Discovery Works](./media/active-directory-cloudappdiscovery-security-and-privacy-considerations/cad01.png)</center>


次のセクションでは、情報のフローに従い、情報が組織から Cloud App Discovery サービスに、最終的には Cloud App Discovery ポータルに移動する際にどのようにセキュリティ保護されるのかについて説明します。



## 組織からのデータの収集

Azure Active Directory の Cloud App Discovery 機能を使用して組織内の従業員が使用するアプリケーションに関する洞察を得るには、まず Azure AD Cloud App Discovery Endpoint Agent を組織のコンピューターにデプロイする必要があります。

Azure Active Directory テナントの管理者 (またはその代理人) は、Azure ポータルから、このエージェントのインストール パッケージをダウンロードできます。エージェントは、手動でインストールすることも、SCCM またはグループ ポリシーを使用して組織内の複数のコンピューターにインストールすることもできます。

デプロイ オプションの詳細については、[Cloud App Discovery のグループ ポリシーのデプロイ ガイドに関するページ](http://social.technet.microsoft.com/wiki/contents/articles/30965.cloud-app-discovery-group-policy-deployment-guide.aspx)をご覧ください。


### エージェントによって収集されたデータ

Web アプリケーションに接続すると、以下の一覧に概要が説明されている情報が、エージェントによって収集されます。情報は、管理者が検出用に構成したアプリケーションについてのみ収集されます。<br>エージェントが監視するクラウド アプリの一覧を編集することができます。そのためには、[Azure ポータル](https://portal.azure.com)の [Cloud App Discovery] ブレードで、**[設定]**、**[データ収集]** の順に選択し、**[アプリ コレクション] ボックスの一覧**を操作します。


> [AZURE.NOTE]詳細については、[Cloud App Discovery の概要](http://social.technet.microsoft.com/wiki/contents/articles/30962.getting-started-with-cloud-app-discovery.aspx)に関するページを参照してください。

**情報カテゴリ**: ユーザー情報<br>**説明**:<br>ターゲットの Web アプリケーションに対する要求を作成したプロセスの Windows ユーザー名 (例: DOMAIN\\username) とそのユーザーの Windows セキュリティ識別子 (SID)


**情報カテゴリ**: プロセス情報<br>**説明**:<br>ターゲットの Web アプリケーションに対する要求を作成したプロセスの名前 (例: "iexplore.exe")

**情報カテゴリ**: コンピューター情報<br>**説明**:<br>エージェントがインストールされているコンピューターの NetBIOS の名前

**情報カテゴリ**: アプリのトラフィック情報<br>**説明**:<br>

接続情報:

- ソース (ローカル コンピューター) と宛先の IP アドレスとポート番号

- 要求送信に使用する組織のパブリック IP アドレス

- 要求時刻

- 送受信されたトラフィックの量

- IP バージョン (4 または 6)

- TLS 接続のみ: Server Name Indication 拡張機能またはサーバー証明書のいずれかのターゲット ホスト名

HTTP 情報:

- メソッド (GET、POST など)

- プロトコル (HTTP/1.1 など)

- ユーザー エージェント文字列

- ホスト名

- ターゲット URI (クエリ文字列を除く)

- コンテンツ タイプ情報

- 参照元 URL 情報 (クエリ文字列を除く)



> [AZURE.NOTE]上記の HTTP 情報は、暗号化されていないすべての接続について収集されます。TLS 接続では、ポータルで「詳細な検査」設定をオンにしているときにのみ、この情報がキャプチャされます。設定は、既定では「オン」です。詳細については、以下の説明と [Cloud App Discovery の概要](http://social.technet.microsoft.com/wiki/contents/articles/30962.getting-started-with-cloud-app-discovery.aspx)に関するページを参照してください。



### エージェントの動作

エージェントのインストールには、次の 2 つのコンポーネントが含まれています。

- ユーザーモード コンポーネント

- カーネルモード ドライバー コンポーネント (Windows フィルタリング プラットフォーム ドライバー)



エージェントは、最初にインストールされたときに、コンピューター上にコンピューター固有の信頼された証明書を格納し、その後、これを使用して Cloud App Discovery サービスとセキュリティで保護された接続を確立します。<br>エージェントは、このセキュリティで保護された接続経由で、定期的に Cloud App Discovery サービスからポリシーの構成を取得します。<br>ポリシーには、監視するクラウド アプリケーション、自動更新を有効にするかどうかなどについての情報が含まれています。

コンピューター上で Chrome、Internet Explorer、または Chrome から Web トラフィックが送受信されると、Cloud App Discovery エージェントがトラフィックを分析し、関連するメタデータ (上記の表を参照) を抽出します。<br>エージェントは、1 分ごとに暗号化されたチャネル経由で、収集したメタデータを Cloud App Discovery サービスにアップロードします。

ドライバー コンポーネントでは、暗号化されたトラフィックをインターセプトし、暗号化されたストリームに挿入します。これは、コンピューター上で自己署名ルート証明書を作成することで実行され、クライアント アプリケーションに Cloud App Discovery エージェントを信頼させます。この自己署名ルート証明書はエクスポートできないとマークされ、管理者の ACL となります。作成元のコンピューター以外の場所では使用されません。


### ユーザーのプライバシーの尊重

私たちの目的は、管理者にアプリケーション使用状況の詳細な把握とユーザーのプライバシーとの間のバランスを組織に合わせて設定できるツールを提供することです。そのために、ポータルの設定ページで次の項目を設定できるようにしました。

- **データ収集**: 管理者は検出データを取得するアプリケーションまたはアプリケーション カテゴリを指定できます。

- **詳細な検査**: 管理者はエージェントが SSL や TLS 接続の HTTP トラフィックを収集するかどうかを指定できます ("**詳細な検査**" といいます)。詳細については、次のセクションで説明します。

- **同意オプション**: 管理者は、エージェントによるデータの収集についてユーザーに通知するかどうか、およびエージェントがユーザー データの収集を開始する前にユーザーの同意を必要とするかどうかを選択できます。

Cloud App Discovery Endpoint Agent は、上の表で説明した情報のみを収集します。



> [AZURE.NOTE]詳細については、[Cloud App Discovery の概要](http://social.technet.microsoft.com/wiki/contents/articles/30962.getting-started-with-cloud-app-discovery.aspx)に関するページを参照してください。

### 暗号化された接続のデータのインターセプト
既に説明したように、管理者は、エージェントを構成して、暗号化された接続のデータを監視することができます ("詳細な検査")。TLS ([トランスポート層セキュリティ](https://msdn.microsoft.com/library/windows/desktop/aa380516%28v=vs.85%29.aspx)) は、インターネット上で現在最も一般的に使用されているプロトコルの 1 つです。TLS で通信を暗号化することにより、クライアントは、Web サーバーとの間にセキュリティで保護されたプライベートな通信チャネルを確立できます。TLS を使うことで、認証用の資格情報を渡すうえで最も重要な保護機能を提供し、機密情報の漏えいを防ぐことができます。

TLS が提供するエンド ツー エンドのセキュリティで保護された暗号化チャネルは重要なセキュリティとプライバシーの保護を実現しますが、このプロトコルは、悪意のある目的や不正な目的に利用されることがあります。そのため、HTTPS は現実に "ユニバーサル ファイアウォール バイパス プロトコル" と呼ばれることもあります。問題の原因は、アプリケーション層のデータが SSL で暗号化されているためにほとんどのファイアウォールで TLS の通信を検査できないことにあります。この点を突いて攻撃を行う攻撃者は、最もインテリジェントなアプリケーション層ファイアウォールでさえも TLS には盲目的であり、ホスト間で TLS の通信を単に中継することしかできないことを確信して、TLS を利用して悪意のあるペイロードをユーザーに送りつけます。エンド ユーザーは、TLS を利用して、企業のファイアウォールとプロキシ サーバーによって適用されるアクセス制御をバイパスすることがあります。具体的には、TLS を利用してパブリック プロキシに接続し、TLS 以外のプロトコルをトンネリングしてファイアウォールを通過させるという方法ですが、これは通常であればポリシーによってブロックされる操作です。

詳細な検査では、Cloud App Discovery エージェントが信頼された仲介者として機能します。HTTPS で保護されたリソースへのアクセス要求が出されると、エージェントは、宛先サーバーへの新しい接続を確立し、その SSL 証明書を取得します。Cloud App Discovery Endpoint Agent は、証明書の情報をコピーし、これらの詳細を使用して独自の証明書を作成してこれをクライアントに渡します。クライアントは、Cloud App Discovery Endpoint Agent のルート証明書を信頼しているため、このプロセスの大部分はエンド ユーザーに対して透過的です。


### 既知の問題と欠点
TLS のインターセプトによってエンド ユーザー エクスペリエンスに影響が及ぶ場合もあります。Extended Validation (EV) 証明書が使用された場合、Web ブラウザーのアドレス バーが緑色で表示されます。これは、信頼済みの Web サイトを訪問していることを視覚的に示すためのものです。TLS の検査では、クライアントに発行する証明書に EV を複製することはできません。したがって、EV 証明書を使用する Web サイトが正常に動作している場合でもアドレス バーは緑色で表示されません。- 公開キーのピン留め ("証明書のピン留め" ともいいます) は、man-in-the-middle 攻撃や偽の証明機関からユーザーを保護することを意図しています。ピン留めされたサイトのルート証明書が既知の適切な CA のいずれかと一致しない場合、ブラウザーは接続を拒否してエラーを返します。TLS のインターセプトは実際には仲介者 (man-in-the-middle) であるため、これらの接続は失敗します。

Microsoft では、これらの問題を減らすために、拡張された検証または公開キーのピン留めを使用することがわかっているアプリを追跡し、暗号化された接続がインターセプトされないよう尽力しています。依然としてこれらのアプリの使用とデータの量に関するレポートも提供されますが、これらの通信はインターセプトされないため、その使用に関する詳細は提供されません。

TLS の検査を有効にすることにより、Cloud App Discovery Endpoint Agent は、TLS で暗号化された通信の暗号化を解除し、検査できます。これにより、サービスは、ノイズを軽減し、暗号化されたクラウド アプリの使用状況に関する情報を提供できます。


### 注意事項
詳細な検査を有効にする前に、法務部門と人事部門にその意図を伝え、同意を得ることを強くお勧めします。エンド ユーザーの個人的な暗号化された通信を検査することは扱いの難しい問題であることは明白です。TLS 検査の実稼働環境へのロールアウトの前に、会社のセキュリティ ポリシーと利用ポリシーが更新され、暗号化された通信が検査の対象となることが明示されていることを確認してください。ユーザーへの通知と機密性が高いと見なされるサイトの除外 (例: 銀行、医療サイト) も必要になる場合があります (これらを監視するように Cloud App Discovery を構成する場合)。


## Cloud App Discovery へのデータの送信

メタデータは、エージェントによって収集された後、最大 1 分間、またはキャッシュ データのサイズが 5 MB に達するまで、コンピューターでキャッシュされます。その後、圧縮され、セキュリティで保護された接続経由で Cloud App Discovery サービスに送信されます。

エージェントが何らかの理由で Cloud App Discovery サービスと通信できない場合は、収集されたメタデータはローカル ファイル キャッシュに格納されます。このキャッシュには、コンピューター上の特権を持つユーザー (Administrators グループなど) のみがアクセスできます。<br>エージェントは、キャッシュしたメタデータが Cloud App Discovery サービスによって正常に受信されるまで、自動的に再送信を試みます。



## サービス エンドでのデータの受信

エージェントは、Cloud App Discovery サービスに対して、上述のコンピューター固有のクライアント認証証明書を使用して、暗号化されたチャネル経由で転送されたデータを認証します。<br>Cloud App Discovery サービスの分析パイプラインは、分析パイプラインのすべての段階でメタデータを論理的に分割することで、メタデータを顧客ごとに個別に処理します。分析されたメタデータは、ポータルのさまざまなレポートで活用されます。

未処理のメタデータと分析されたメタデータは、最大 180 日間保存されます。さらに、お客様は、自分で選択した Azure BLOB ストレージ アカウントに、分析されたメタデータをキャプチャすることができます。これは、メタデータのオフライン分析や、データの保存期間の延長として役立ちます。

## Azure ポータルを使用するデータ アクセス

収集されたメタデータのセキュリティ保護を確保するために、既定では、テナントのグローバル管理者のみが Azure ポータルで Cloud App Discovery 機能にアクセスできます。<br>ただし管理者は、他のユーザーやグループにこのアクセスを委任できます。



> [AZURE.NOTE]詳細については、[Cloud App Discovery の概要](http://social.technet.microsoft.com/wiki/contents/articles/30962.getting-started-with-cloud-app-discovery.aspx)に関するページを参照してください。



ポータルで、データにアクセスするすべてのユーザーは、Azure AD Premium ライセンスをライセンスする必要があります。



**その他のリソース**


* [自分の組織内で使用される承認されていないクラウド アプリを検出する方法](active-directory-cloudappdiscovery-whatis.md)

<!---HONumber=August15_HO6-->