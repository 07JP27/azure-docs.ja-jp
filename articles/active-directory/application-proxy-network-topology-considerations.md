---
title: "Azure AD アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項 | Microsoft Docs"
description: "Azure AD アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項について説明しています。"
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/12/2017
ms.author: kgremban
translationtype: Human Translation
ms.sourcegitcommit: 1fdc00865f31352026a64c2769d9d65047bb2fa6
ms.openlocfilehash: 26ec9167f1f883c3c71947a55142020fb48e206a


---

# <a name="network-topology-considerations-when-using-azure-ad-application-proxy"></a>Azure AD アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項
> [!NOTE]
> アプリケーション プロキシは、Azure Active Directory の Premium または Basic エディションにアップグレードしている場合にのみ利用できる機能です。 詳細については、「 [Azure Active Directory のエディション](active-directory-editions.md)」をご覧ください。
> 

この記事では、アプリケーションをリモートで公開およびアクセスするために Azure AD アプリケーション プロキシを使用する場合のネットワーク トポロジに関する注意事項について説明しています。 

## <a name="traffic-flow"></a>トラフィック フロー

アプリケーションが Azure AD アプリケーション プロキシを通じて公開されると、ユーザーから対象バックエンド アプリケーションへのすべてのトラフィックは、次のホップを経由して送信されます。

* ホップ 1: ユーザーから Azure の Azure AD アプリケーション プロキシ サービスのパブリック エンドポイント
* ホップ 2: アプリケーション プロキシ サービスからコネクタ
* ホップ 3: コネクタから対象アプリケーション

 ![Azure AD IaaS 複数クラウド ベンダー](./media/application-proxy-network-topologies/application-proxy-three-hops.png)

## <a name="tenant-location-and-app-proxy-service"></a>テナントの場所とアプリケーション プロキシ サービス

Azure AD テナントにサインアップすると、指定した国に基づいて、テナントのリージョン (US、EMEA、APAC など) が決まります。 アプリケーション プロキシを有効にすると、テナント用のアプリケーション プロキシ サービス インスタンスは、Azure AD テナントと同じリージョン、またはその最寄りのリージョンに表示されます。 

たとえば、Azure AD テナントのリージョンが欧州連合 (EU) の場合、Azure AD アプリケーション プロキシ コネクタはすべて、EU の Azure データセンターのアプリケーション プロキシ サービス インスタンスに接続されます。 これは、公開されているアプリケーションにユーザーがアクセスしようとすると、すべてこの場所のアプリケーション プロキシ サービス インスタンスを経由することも意味します。

## <a name="considerations-for-reducing-latency"></a>待機時間を削減するための考慮事項

すべてのプロキシ ソリューションには、ネットワーク接続に待機時間が発生します。 リモート アクセス ソリューションとして選択したプロキシや VPN ソリューションに関係なく、ソリューションには、企業ネットワーク内部に接続できるようにする一連のサーバーが必ず含まれます。 

企業では、一般的に、サーバーのエンドポイントをネットワークの非武装地帯 (DMZ) に含めています。 しかし、Azure AD アプリケーション プロキシでは、DMZ は必要ありません。  これは、アプリケーション プロキシを使用すると、トラフィックがクラウドのプロキシ サービス経由で送信されるのに対し、コネクタは企業ネットワーク上に配置されているためです。

### <a name="connector-placement"></a>コネクタの配置

アプリケーション プロキシ サービスでは、テナントの場所に基づいてインスタンスの場所が自動的に選択されます。 そのため、コネクタのインストール場所を決定でき、ネットワーク トラフィックのエンド ツー エンドの待機時間特性を定義することができます。

アプリケーション プロキシ サービスを設定すると、以下のような質問に答える必要があります。

* アプリケーションの場所はどこか。
* アプリケーションにアクセスする大部分のユーザーの場所はどこか。
* アプリケーション プロキシ インスタンスの場所 (テナントに基づきます) はどこか。
* Azure データセンターへの専用のネットワーク接続 (ExpressRoute や類似の VPN セットアップなど) が既にあるか。

コネクタの配置により、ホップ #2 とホップ #3 の待機時間が決まります。 コネクタの配置を評価する際に、次の要因を検討する必要があります。

* バックエンド アプリケーションへのシングル サインオン (SSO) を行う場合は、Kerberos の制約付き委任 (KCD) 操作を実行するために、コネクタからデータセンターへの通信経路が必要です。
* コネクタは、コネクタからアプリケーションまでの時間を短縮するため、通常はアプリケーションに近い場所にインストールされます。

### <a name="general-approach-to-minimize-latency"></a>待機時間を最小限に抑えるための一般的なアプローチ

各ネットワーク ホップを最適化することによってエンド ツー エンドのトラフィック待機時間を最小化することができ、その結果、トラフィックが送信されます。

各ホップは次の方法で最適化できます。

* ホップの両端間の距離を短縮します。
* 経由する適切なネットワークを選択します。 たとえば、パブリック インターネットではなく、プライベート ネットワークを経由した方が、専用リンクのため高速である可能性があります。
 
Azure と企業ネットワークの間に専用の VPN/ExpressRoute リンクがある場合は、これを活用することをお勧めします。

## <a name="focus-your-optimizing-strategy"></a>最適化戦略に焦点を合わせる

ユーザーは、インターネット経由でアプリにリモートでアクセスする場合があるため、ホップ 2 およびホップ 3 の最適化に重点を置く必要があります。 取り入れることができる一般的なパターンの一部を以下に示します。

### <a name="pattern-1-optimize-hop-3"></a>パターン #1: ホップ #3 の最適化

ホップ 3 を最適化するには、コネクタを顧客のネットワークで対象アプリケーションの近くに配置します。 この利点は、前述のとおり、コネクタにはドメイン コントローラーへの通信経路が必要な可能性が高いことです。 通常、ほとんどのお客様やシナリオに対しては、この方法で十分です。 ほとんどのお客様は、このパターンに当てはまります。

 ![Azure AD IaaS 複数クラウド ベンダー](./media/application-proxy-network-topologies/application-proxy-hop3.png)


> [!NOTE]
ホップ #2 およびホップ #3の両方を最適化して、目的の待機時間特性を得る必要があるシナリオがいくつかあります。 たとえば、ネットワークと Azure データセンターの間に VPN または ExpressRoute セットアップがあれば、このシナリオでは、ホップ #3 だけでなくホップ #2 を最適化できます。
>

### <a name="pattern-2-take-advantage-of-expressroute-with-public-peering"></a>パターン #2: パブリック ピアリングを使用した ExpressRoute の活用

パブリック ピアリングを使用した ExpressRoute セットアップがある場合は、ホップ #2 に対して、より高速な ExpressRoute 接続を活用します。 ホップ #3 は、お客様のネットワークのアプリケーションの近くにコネクタが配置され、既に最適化されています。

![Azure AD IaaS 複数クラウド ベンダー](./media/application-proxy-network-topologies/application-proxy-expressroute-public.png)

### <a name="pattern-3-taking-advantage-expressroute-with-private-peering"></a>パターン #3: プライベート ピアリングを使用した ExpressRoute の活用

Azure と、アプリケーションがインストールされている会社のネットワークとの間に、プライベート ピアリングを使用した専用の VPN または ExpressRoute のセットアップがあれば、別の選択肢があります。 この構成では、通常、Azure の仮想ネットワークは企業ネットワークの拡張機能とみなされます。 そのため、Azure データセンターにコネクタをインストールして、ホップ #3 のコネクタ - アプリケーション間接続の低待機時間要件を引き続き満足させることができます。 

専用接続を介して送信されるため、待機時間は損なわれません。 ただし、ホップ #2 の待機時間特性の改善という追加の利点が得られます。 これは、コネクタが AAD テナント (およびそれに伴うアプリケーション プロキシ) の場所に近い Azure データセンターにインストールされており、プロキシ サービス - コネクタ間の接続 (ホップ #2) が、より短いホップであるためです。

![Azure AD IaaS 複数クラウド ベンダー](./media/application-proxy-network-topologies/application-proxy-expressroute-private.png)

### <a name="other-approaches"></a>その他のアプローチ

この記事ではこれまで、コネクタの配置に重点を置いてきました。 しかし、(たとえば、Azure または別のホスト環境へ) アプリケーションを移動させる選択肢が存在する場合、アプリケーションの配置を変更することによって、より優れた遅延特性が得られる可能性があります。 

ホスト環境にネットワークを移動する組織が増えています。 これにより組織は、企業ネットワークの一部でもあり、ドメイン内のままであるホスト環境にアプリケーションを配置できます。 この場合は、アプリケーションの新しい場所に、上記のパターンを適用できます。

別々の場所およびネットワーク内にある対象アプリケーションへのコネクタ グループを使用することを検討してください。 このオプションを検討する場合は、[Azure AD Domain Services](https://azure.microsoft.com/en-us/services/active-directory-ds) に関するページをご覧ください。 

## <a name="common-scenarios"></a>一般的なシナリオ

このセクションでは、いくつかのユース ケースについて説明します。 以下のすべてのユース ケースでは、Azure AD テナント (およびそれに伴うプロキシ サービス エンドポイント) が米国内にあると仮定しています。同じ考慮事項が、通常、世界中の他の地域に適用されます。

### <a name="use-case-1"></a>ユース ケース 1

アプリケーションは顧客のネットワーク (米国内) にあり、ユーザーは同じリージョン内に存在します。 Azure DC と社内ネットワークの間に ExpressRoute または VPN は存在しません。

**推奨事項:** 上記のユース ケース #1 に従います。 待機時間を改善するには、必要に応じて ExpressRoute の活用を検討してください (ユース ケース #3 および #4 参照)。

これは、単純なパターンです。 最も一般的なパターンは、コネクタがアプリケーションの近くに配置されている場合の、ホップ #3 の最適化です。 コネクタは、KCD 操作を実行するために、通常、アプリケーションと DC との通信経路にインストールされるため、これも自然な選択です。
以下では、このユース ケースをパターン #1 とします。

![Azure AD IaaS 複数クラウド ベンダー](./media/application-proxy-network-topologies/application-proxy-pattern1.png)

### <a name="use-case-2"></a>ユース ケース 2

アプリケーションは顧客のネットワーク (米国内) にあり、ユーザーはグローバルに分散しています。 Azure DC と社内ネットワークの間に ExpressRoute または VPN は存在しません。

**推奨事項:** 上記のユース ケース #2 に従います。 待機時間を改善するには、必要に応じて ExpressRoute の活用を検討してください (ユース ケース #3 および #4 参照)。

繰り返しますが、一般的なパターンは、前述の理由によりコネクタがアプリケーションの近くに配置されている場合の、ホップ #3 の最適化です。 ホップ #3 がすべて同じリージョン内にある場合は、通常、高価ではありません。 ただし、すべてのユーザーが米国内のアプリケーション プロキシ インスタンスにアクセスするため、ユーザーの場所によっては、ホップ #1 はより高価になる可能性があります。どのプロキシ ソリューションも、グローバルに分散しているユーザーに関して、これに類似した特性を持つことは注目に値します。

以下では、このユース ケースをパターン #2 とします。

![Azure AD IaaS 複数クラウド ベンダー](./media/application-proxy-network-topologies/application-proxy-pattern2.png)

### <a name="use-case-3"></a>ユース ケース 3

アプリケーションは顧客のネットワーク (米国内) にあります。パブリック ピアリングを使用した ExpressRoute が、Azure と企業ネットワークの間に存在します。

**推奨事項:** コネクタを可能な限りアプリケーションの近くに配置します。 ホップ #2 では、ExpressRoute が自動的に使用されます。 これは、上記で説明したパターン #2 に従います。

ExpressRoute リンクでパブリック ピアリングを使用している場合、プロキシとコネクタの間のトラフィックはそのリンク経由で送信され、ホップ #2 の待機時間が最適化されます。

以下では、このユース ケースをパターン #3 とします。

![Azure AD IaaS 複数クラウド ベンダー](./media/application-proxy-network-topologies/application-proxy-pattern3.png)

### <a name="use-case-4"></a>ユース ケース 4

アプリケーションは顧客のネットワーク (米国内) にあります。 プライベート ピアリングを使用した ExpressRoute が、Azure と企業ネットワークの間に存在します。

**推奨事項:** ExpressRoute プライベート ピアリング経由で企業ネットワークに接続されている Azure DC にコネクタを配置します。 これは、上記で説明したパターン #3 に従います。

コネクタは、Azure DC に配置できます。 プライベート ネットワークを経由しても、アプリケーションと DC との通信経路は保たれるため、ホップ #3 は最適化されたままになります。 それに加えて、このセットアップではホップ #2 もさらに最適化されます。

以下では、このユース ケースをパターン #4 とします。

![Azure AD IaaS 複数クラウド ベンダー](./media/application-proxy-network-topologies/application-proxy-pattern4.png)

### <a name="use-case-5"></a>ユース ケース 5

アプリケーションは顧客のネットワーク (EU 内) にあります。 ほとんどのユーザーは米国内に存在します。

**推奨事項:** コネクタをアプリケーションの近くに配置します。 上記で述べられている理由から、これが最適な選択肢です。 米国のユーザーは、同じリージョンのアプリケーション プロキシ インスタンスにアクセスしていることから、ホップ #1 が高価すぎるということはありません。 ホップ #3 は最適化されています。 ただし、このユース ケースでは通常、ホップ #2 は高価となります。

以下では、このユース ケースをパターン #5a とします。

![Azure AD IaaS 複数クラウド ベンダー](./media/application-proxy-network-topologies/application-proxy-pattern5a.png)

上記のパターン #2 および #3 で述べたように、ExpressRoute の活用を検討してください。 パターン #2 を適用したものを以下に示します。

以下では、このユース ケースをパターン #5b とします。

![Azure AD IaaS 複数クラウド ベンダー](./media/application-proxy-network-topologies/application-proxy-pattern5b.png)

このユース ケースの変化形として、以下の採用を検討できます。

組織内のほとんどのユーザーが米国内に存在する場合に、ネットワークを米国まで '拡張' する可能性もあります。 その場合は、コネクタを米国内に配置でき、EU 内のアプリケーションへの専用の企業内ネットワーク ラインを活用できます。 このようにすると、ホップ #2 と ホップ #3 が最適化されます。

以下では、このユース ケースをパターン #5c とします。

![Azure AD IaaS 複数クラウド ベンダー](./media/application-proxy-network-topologies/application-proxy-pattern5c.png)

## <a name="next-steps"></a>次のステップ
[アプリケーション プロキシを有効にする](active-directory-application-proxy-enable.md)<br>
[シングル サインオンを有効にする](active-directory-application-proxy-sso-using-kcd.md)<br>
[条件付きアクセスを有効にする](active-directory-application-proxy-conditional-access.md)<br>
[アプリケーション プロキシで発生した問題のトラブルシューティングを行う](active-directory-application-proxy-troubleshoot.md)





<!--HONumber=Feb17_HO1-->


