---
title: Azure AD v2.0 エンドポイントと v1.0 エンドポイントの比較 | Microsoft Docs
description: Azure AD v2.0 エンドポイントと v1.0 エンドポイントとの相違点を把握する
services: active-directory
documentationcenter: ''
author: CelesteDG
manager: mtillman
editor: ''
ms.assetid: 5060da46-b091-4e25-9fa8-af4ae4359b6c
ms.service: active-directory
ms.component: develop
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/27/2018
ms.author: andret
ms.reviewer: hirsin, andret
ms.custom: aaddev
ms.openlocfilehash: e393851535c36eb604d57cc4d7c7561a3ebb201b
ms.sourcegitcommit: 5c00e98c0d825f7005cb0f07d62052aff0bc0ca8
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/24/2018
ms.locfileid: "49955445"
---
# <a name="comparing-the-azure-ad-v20-endpoint-with-the-v10-endpoint"></a>Azure AD v2.0 エンドポイントと v1.0 エンドポイントの比較

新しいアプリケーションを開発する場合、v1.0 エンドポイントと v2.0 エンドポイントの相違点を把握しておくことが重要です。 主な相違点と、v2.0 エンドポイントの既存の制限事項をいくつか以下に示します。

> [!NOTE]
> Azure Active Directory (Azure AD) のシナリオおよび機能のすべてが v2.0 エンドポイントでサポートされているわけではありません。 v2.0 エンドポイントを使用する必要があるかどうかを判断するには、 [v2.0 の制限事項](#limitations)に関するページをお読みください。

## <a name="who-can-sign-in"></a>サインインできるユーザー

![v1.0 エンドポイントと v2.0 エンドポイントでサインインできるユーザー](media/azure-ad-endpoint-comparison/who-can-sign-in.png)

* v1.0 エンドポイントでは、職場と学校のアカウント (Azure AD) でのみ、ご利用のアプリケーションにサインインすることができます。

* v2.0 エンドポイントでは、Azure AD からの職場と学校のアカウント、および個人アカウント (MSA) (hotmail.com、outlook.com、msn.com) でサインインできます。

* v1.0 と v2.0 の両方のエンドポイントで、*[シングルテナント](single-and-multi-tenant-apps.md)* として構成されているアプリケーション、またはテナント固有のエンドポイント (`https://login.microsoftonline.com/{TenantId_or_Name}`) を指すように構成されている*マルチテナント* アプリケーションに対する Azure AD ディレクトリの*[ゲスト ユーザー](https://docs.microsoft.com/azure/active-directory/b2b/what-is-b2b)* によるサインインも受け入れられます。

v2.0 エンドポイントでは、個人アカウントおよび職場と学校のアカウントの両方からのサインインを受け入れるアプリを作成でき、まったくアカウントに依存しないアプリを作成することができます。 たとえば、アプリで [Microsoft Graph](https://graph.microsoft.io) を呼び出す場合、SharePoint サイトや Directory データなど、いくつかの追加の機能とデータを職場のアカウントで使用できます。 しかし、[ユーザーのメールの読み取り](https://graph.microsoft.io/docs/api-reference/v1.0/resources/message)など、多くのアクションでは、同じコードで個人アカウントおよび職場と学校のアカウントの両方のメールにアクセスすることができます。

v2.0 エンドポイントの場合、単一のライブラリ (MSAL) を使用して、コンシューマー向け、教育向け、エンタープライズ向けのいずれの環境にもアクセスできます。

 Azure AD v1.0 エンドポイントでは、職場と学校のアカウントのみからのサインインが受け入れられます。

## <a name="incremental-and-dynamic-consent"></a>増分および動的な同意

必要な OAuth 2.0 アクセス許可を事前に指定するには、Azure AD v1.0 エンドポイントを使用するアプリが必要になります。その例を以下に示します。

![アクセス許可の登録 UI](./media/azure-ad-endpoint-comparison/app_reg_permissions.png)

アプリケーションの登録時に直接設定されるアクセス許可は**静的**となります。 アプリの静的アクセス許可は Azure portal で定義されており、コードを適切に維持できますが、開発者にとってはそれがいくつかの問題を引き起こす場合があります。

* アプリの作成時に、そのアプリで必要になる可能性のあるすべてのアクセス許可がわかっている必要があります。 後からアクセス許可を追加することは困難なプロセスでした。

* アプリでアクセスする可能性のあるすべてのリソースが事前にわかっている必要があります。 任意の数のリソースにアクセスするアプリを作成することは、困難でした。

* アプリで、ユーザーの初回サインインの時点で必要になる可能性があるすべてのアクセス許可を要求する必要があります。 アクセス許可のリストは長くなる場合があり、エンドユーザーが初回サインイン時にアプリのアクセスを承認することを阻げる要因となっていました。

v2.0 エンドポイントでは、Azure portal のアプリ登録情報で静的に定義されたアクセス許可を無視できます。また、アプリケーションの登録情報で静的に定義されたアクセス許可に関係なく、アプリを通常どおり使用する際に、アプリで必要なアクセス許可を実行時に**動的に**指定することができます。

これを行うために、アプリケーション時間の特定の時点でアプリに必要なスコープを指定できます。その場合、アクセス トークンの要求時に `scope` パラメーターに新しいスコープを含めます。アプリケーションの登録情報で事前に定義する必要はありません。

要求に追加された新しいスコープにユーザーがまだ同意していない場合、新しいアクセス許可のみの同意を求められます。 詳細については、 [アクセス許可、同意、スコープ](v2-permissions-and-consent.md)の説明を参照してください。

`scope` パラメーターを使用してアプリからアクセス許可を動的に要求できるため、開発者はユーザーの操作を完全に制御できます。 必要に応じて、同意操作を初期段階に組み込み、1 回の初期承認要求ですべてのアクセス許可を求めることもできます。 または、アプリで多数のアクセス許可が必要な場合は、時間の経過と共に、ユーザーがアプリの特定の機能を使用するときにアクセス許可を集めることができます。

組織に代わって行われる管理者の同意では、引き続き、アプリ用に登録された静的アクセス許可が使用されるため、組織全体に代わり、管理者が同意する必要がある場合は、v2.0 エンドポイントを使用するアプリに対してこれらのアクセス許可を設定することがお勧めします。 これにより、アプリケーションを設定するために組織の管理者に必要なサイクルが減ります。

## <a name="scopes-not-resources"></a>リソースではなくスコープ

v1.0 エンドポイントを使用するアプリの場合、アプリは、**リソース**、またはトークンの受信者として動作できます。 リソースには、リソースで識別できる多数の**スコープ**または **oAuth2Permissions** を定義できます。それによりクライアント アプリは、そのリソースに特定のスコープのセットのトークンを要求できます。 リソースの例として、Azure AD Graph API があります。

* リソース識別子、または `AppID URI`:`https://graph.windows.net/`

* スコープ、または `OAuth2Permissions`: `Directory.Read`、`Directory.Write` など。

このすべてが v2.0 エンドポイントに当てはまります。 アプリはリソースとして動作し、スコープを定義することができ、URI によって識別できます。 また、クライアント アプリは、スコープへのアクセスを要求できます。 ただし、クライアントがそれらのアクセス許可を要求する方法が変更されました。 v1.0 エンドポイントでは、Azure AD への OAuth 2.0 承認要求は、次のようになっていました。

```text
GET https://login.microsoftonline.com/common/oauth2/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e
&resource=https://graph.windows.net/
...
```

ここで、 **resource** パラメーターは、クライアント アプリが認証を求めている対象のリソースを示します。 Azure AD は、Azure Portal での静的な構成に基づいて、アプリによって要求されたアクセス許可を計算し、適切なトークンを発行していました。 v2.0 エンドポイントを使用するアプリケーションでは、同じ OAuth 2.0 承認要求が次のようになります。

```text
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e
&scope=https://graph.windows.net/directory.read%20https://graph.windows.net/directory.write
...
```

ここで、**scope** パラメーターは、アプリで承認を要求している対象のリソースとアクセス許可を示します。 要求されているリソースはまだ要求内に存在していて、scope パラメーターの各値の中に、ただ含まれています。 このように scope パラメーターを使用すると、v2.0 エンドポイントの OAuth 2.0 仕様への準拠を高め、一般的な業界の慣行に近づけることができます。 また、アプリで[増分同意](#incremental-and-dynamic-consent)を実行できます。これについては既に説明しました。

## <a name="well-known-scopes"></a>既知のスコープ

### <a name="offline-access"></a>オフライン アクセス

v2.0 エンドポイントを使用するアプリでは、アプリ向けで既知の新たなアクセス許可 (`offline_access` スコープ) を使用する必要がある場合があります。 すべてのアプリは、ユーザーがアプリを積極的に利用しない可能性がある場合でも、長期間ユーザーに代わってリソースにアクセスするために必要な、このアクセス許可を要求する必要があります。 `offline_access` スコープは、同意ダイアログで "**いつでもデータにアクセスできます**" と表示され、ユーザーはこれに同意する必要があります。 `offline_access` アクセス許可を要求すると、Web アプリで v2.0 エンドポイントから OAuth 2.0 の refresh_tokens を受け取ることができます。 更新トークンは長期間維持され、アクセスの期間を延長するために新しい OAuth 2.0 のアクセス トークンと交換することができます。

アプリで `offline_access` スコープを要求しない場合、更新トークンを受け取ることはありません。 つまり、OAuth 2.0 承認コード フローの承認コードを使用すると、`/token` エンドポイントからのアクセス トークンのみを受け取ることになります。 そのアクセス トークンは短時間 (通常は 1 時間) 有効ですが、最終的には期限が切れます。 その時点で、アプリでユーザーを `/authorize` エンドポイントにリダイレクトし、新しい承認コードを取得する必要があります。 このリダイレクト中に、アプリの種類によっては、ユーザーが資格情報を再入力したり、アクセス許可に再同意したりする必要がある場合もあります。

OAuth 2.0、`refresh_tokens`、および `access_tokens` の詳細については、[v2.0 プロトコルのリファレンス](active-directory-v2-protocols.md)を参照してください。

### <a name="openid-profile-and-email"></a>OpenID、プロファイル、および電子メール

これまでは、Azure AD を使用する最も基本的な OpenID 接続サインイン フローによって、結果の *id_token* 内でユーザーに関する多くの情報が提供されていました。 *id_token* 内の要求には、ユーザーの名前、推奨ユーザー名、電子メール アドレス、オブジェクト ID などを含めることができます。

アプリが `openid` のスコープでアクセスできる情報は、現在では制限されています。 `openid` スコープでアプリに許可されるのは、ユーザーのサインインと、ユーザーのためにアプリ固有の ID を受信することだけです。 アプリでユーザーに関する個人データを取得する場合は、アプリからユーザーに追加のアクセス許可を要求する必要があります。 2 つの新しいスコープである `email` スコープと `profile` スコープを使用すると、追加のアクセス許可を要求できます。

`email` スコープでは、アプリは id_token の `email` 要求を使用して、ユーザーのプライマリ電子メール アドレスにアクセスできます。 `profile` スコープでは、アプリに名前、推奨ユーザー名、オブジェクト ID など、ユーザーに関するその他のすべての基本的な情報へのアクセスを許可します。

これにより、アプリの公開を最小限にとどめてコードが書けます。アプリがジョブを実行するために必要な情報セットのみをユーザーに要求できます。 これらのスコープの詳細については、[v2.0 スコープのリファレンス](v2-permissions-and-consent.md)を参照してください。

## <a name="token-claims"></a>トークン要求

v2.0 エンドポイントによって発行されるトークン内の要求は、一般に使用できる Azure AD エンドポイントによって発行されるトークンと同じにはなりません。 新しいサービスに移行するアプリで、id_tokens または access_tokens 内に特定の要求が存在すると想定しないでください。 v2.0 エンドポイントで使われている各種トークンの詳細については、[アクセス トークン](access-tokens.md) リファレンスと [`id_token` リファレンス](id-tokens.md)を参照してください。

## <a name="limitations"></a>制限事項

v2.0 を使用する場合に注意する必要があるいくつかの制限があります。

Microsoft ID プラットフォームと統合するアプリケーションを構築する場合は、v2.0 エンドポイントと認証プロトコルがニーズを満たすかどうかを判断する必要があります。 v1.0 エンドポイントとプラットフォームは引き続き完全にサポートされ、いくつかの点では v2.0 よりも機能が豊富です。 しかし、v2.0 には開発者にとって[大きな利点](azure-ad-endpoint-comparison.md)があります。

現時点での開発者向けの推奨は、下記のようにシンプルです。

* アプリケーションで個人の Microsoft アカウントをサポートする必要がある場合は、v2.0 を使用します。 ただしその準備として、この記事で説明する制限事項を必ず理解してください。

* アプリケーションでサポートする必要があるのが Microsoft の職場と学校アカウントのみである場合は、v2.0 を使用しないでください。 代わりに、[v1.0 ガイド](v1-overview.md)を参照してください。

v2.0 エンドポイントはこの一覧に記載された制限事項をなくすように進化するため、v2.0 エンドポイントのみを使用すればよくなる予定です。 当面は、この記事を参照して、v2.0 エンドポイントがニーズを満たしているかどうかを判断してください。 v2.0 エンドポイントの現在の状態を反映するように、この記事を引き続き更新する予定です。 v2.0 の機能に対して、要件を再確認してください。

### <a name="restrictions-on-app-types"></a>アプリの種類に関する制限事項

現時点では、次の種類のアプリは、v2.0 エンドポイントでサポートされていません。 サポートされているアプリの種類の説明については、[v2.0 のアプリの種類](v2-app-types.md)に関するページを参照してください。

#### <a name="standalone-web-apis"></a>スタンドアロン Web API

v2.0 エンドポイントを使用すると [OAuth 2.0 で保護された Web API をビルド](v2-app-types.md#web-apis)できます。 ただし、その Web API は、同じアプリケーション ID を持つアプリケーションからしかトークンを受け取ることができません。 別のアプリケーション ID を持つクライアントから Web API にアクセスすることはできません。 クライアントは、Web API へのアクセス許可を要求することも取得することもできません。

同じアプリケーション ID を持つクライアントからのトークンを受け入れる Web API のビルド方法については、[v2.0 の使用の開始](v2-overview.md#getting-started)に関するセクションに示されている v2.0 エンドポイントの Web API サンプルを参照してください。

### <a name="restrictions-on-app-registrations"></a>アプリの登録に関する制限事項

現在、v2.0 エンドポイントと統合するアプリごとに、新しい [Microsoft アプリケーション登録ポータル](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)にアプリの登録を作成する必要があります。 既存の Azure AD または Microsoft アカウント アプリは、v2.0 エンドポイントと互換性がありません。 アプリケーション登録ポータル以外のポータルに登録されているアプリは、v2.0 エンドポイントと互換性がありません。

また、[アプリケーション登録ポータル](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList)で作成したアプリケーションの登録には、次の注意点があります。

* アプリケーション ID ごとに許可されるアプリ シークレットは 2 種類のみです。

* ユーザーが個人の Microsoft アカウントで登録したアプリの登録は、1 つの開発者アカウントでのみ表示および管理できます。 複数の開発者間で共有することはできません。 アプリケーションの登録を複数の開発者の間で共有したい場合は、Azure AD アカウントで登録ポータルにサインインすることでアプリケーションを作成できます。

* 許可されるリダイレクト URL の形式には、いくつかの制限事項があります。 リダイレクト URL の詳細については、次のセクションを参照してください。

### <a name="restrictions-on-redirect-urls"></a>リダイレクト URL に関する制限事項

アプリケーション登録ポータルで登録されるアプリは、限られたリダイレクト URL 値に限定されています。 Web アプリおよびサービスのリダイレクト URL はスキーム `https` で始める必要があり、すべてのリダイレクト URL 値で単一の DNS ドメインを共有する必要があります。 たとえば、次のリダイレクト URL のいずれかを含む Web アプリを登録することはできません。

* `https://login-east.contoso.com`  
* `https://login-west.contoso.com`

登録システムによって、既存のリダイレクト URL の DNS 名全体と、追加するリダイレクト URL の DNS 名が比較されます。 次のいずれかの条件に当てはまる場合、DNS 名を追加する要求は失敗します。  

* 新しいリダイレクト URL の DNS 名全体が、既存のリダイレクト URL の DNS 名と一致しない。

* 新しいリダイレクト URL の DNS 名全体が、既存のリダイレクト URL のサブドメインではない。

たとえば、アプリに次のリダイレクト URL が含まれているとします。

`https://login.contoso.com`

次のように、これに追加できます。

`https://login.contoso.com/new`

この場合、DNS は完全に一致します。 または、次を行うことができます。

`https://new.login.contoso.com`

この場合、login.contoso.com の DNS サブドメインを参照しています。 リダイレクト URL として `login-east.contoso.com` と `login-west.contoso.com` を含むアプリが必要な場合は、それらのリダイレクト URL を次の順序で追加する必要があります。

`https://contoso.com`  
`https://login-east.contoso.com`  
`https://login-west.contoso.com`  

後の 2 つのリダイレクト URL を追加できるのは、それらが 1 つ目の contoso.com というリダイレクト URL のサブドメインであるためです。 この制限は、今後のリリースで解消される予定です。

また、特定のアプリケーションが持つことのできる返信 URL は 20 個だけであることに注意してください。

アプリケーション登録ポータルでアプリを登録する方法については、「[v2.0 エンドポイントを使用してアプリケーションを登録する方法](quickstart-v2-register-an-app.md)」を参照してください。

### <a name="restrictions-on-libraries-and-sdks"></a>ライブラリと SDK に関する制限事項

現時点では、v2.0 エンドポイントのライブラリ サポートは制限されています。 運用環境のアプリケーションで v2.0 エンドポイントを使用する場合は、次の選択肢があります。

* Web アプリケーションを構築する場合は、Microsoft が一般提供しているサーバー側のミドルウェアを使用して、サインインとトークンの検証を安全に実行できます。 このようなミドルウェアには、OWIN の ASP.NET 用 Open ID Connect ミドルウェアや Node.js 用 Passport プラグインなどがあります。 Microsoft のミドルウェアを使用するコード サンプルについては、[v2.0 の使用の開始](v2-overview.md#getting-started)に関するセクションを参照してください。

* デスクトップまたはモバイル アプリケーションをビルドする場合は、Microsoft の認証ライブラリ (MSAL) プレビューのいずれかを使用できます。 これらのライブラリは、運用環境でサポートされているプレビュー版なので、実稼働アプリケーションで使用しても安全です。 プレビューの使用条件と使用可能なライブラリの詳細については、[認証ライブラリのリファレンス](reference-v2-libraries.md)に関するページをご覧ください。

* Microsoft ライブラリの対象ではないプラットフォームでは、アプリケーション コードで直接プロトコル メッセージを送受信することで v2.0 エンドポイントと統合できます。 v2.0 の OpenID Connect プロトコルと OAuth プロトコルについては、このような統合の実行に役立つように、[明確に文書化](active-directory-v2-protocols.md)されています。

* オープン ソースの Open ID Connect および OAuth のライブラリを使用して、v2.0 エンドポイントと統合できます。 v2.0 のプロトコルは通常、大幅な変更を加えなくても、多数のオープンソース プロトコル ライブラリと互換性があります。 これらのライブラリが使用可能かどうかは、言語とプラットフォームによって異なります。 [Open ID Connect](http://openid.net/connect/) および [OAuth 2.0](http://oauth.net/2/) の Web サイトでは、一般的な実装のリストを公開しています。 詳細については、「[Azure Active Directory (AD) v2.0 と認証ライブラリ](reference-v2-libraries.md)」、および v2.0 エンドポイントでテスト済みのオープンソース クライアント ライブラリとサンプルの一覧を参照してください。

* 参照情報: v2.0 共通エンドポイントの `.well-known` エンドポイントは `https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration` です。  `common` とテナント ID を置き換えて、お使いのテナントに固有のデータを取得します。  

### <a name="restrictions-on-protocols"></a>プロトコルに関する制限事項

v2.0 エンドポイントは SAML と WS-Federation をサポートしていません。OpenID 接続と OAuth 2.0 のみをサポートしています。 OAuth プロトコルの一部の機能がまだ v2.0 エンドポイントには組み込まれていません。

現時点では、v2.0 エンドポイントでは、次のプロトコルの機能は*使用できない*か、または*サポートされていません*。

* `email` 要求は、省略可能な要求が構成され、その要求の中でスコープに scope=email が指定された場合にのみ返されます。 ただし、この動作は、v2.0 エンドポイントが Open ID Connect および OAuth2.0 標準にさらに準拠するように更新されたときに変更されることが予測されます。

* v2.0 エンドポイントで ID トークン内のロールまたはグループの要求の発行はサポートされていません。

* v2.0 エンドポイントは、[OAuth 2.0 リソース所有者パスワード資格情報の付与](https://tools.ietf.org/html/rfc6749#section-4.3)をサポートしていません。

v2.0 エンドポイントでサポートされているプロトコル機能の範囲について詳しく理解するには、[OpenID Connect および OAuth 2.0 プロトコルに関するリファレンス](active-directory-v2-protocols.md)を参照してください。

#### <a name="saml-restrictions"></a>SAML の制限事項

Windows アプリケーションで Active Directory Authentication Library (ADAL) を使用している場合は、Windows 統合認証を活用している可能性がありますが、これは Security Assertion Markup Language (SAML) アサーション付与を使用しています。 この付与により、フェデレーション Azure AD テナントのユーザーは資格情報を入力せずに、オンプレミスの Active Directory インスタンスで自動的に認証できます。 現在、SAML アサーションの付与は、v2.0 のエンドポイントではサポートされていません。
