---
title: "Azure AD アプリケーション プロキシを使用したアプリへのリモート アクセス時のセキュリティに関する注意事項 | Microsoft Docs"
description: "Azure AD アプリケーション プロキシを使用する場合のセキュリティに関する注意事項を説明しています。"
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/12/2017
ms.author: kgremban
translationtype: Human Translation
ms.sourcegitcommit: 67650676117fef834ea819da2fc45ca66ed15493
ms.openlocfilehash: 1b713e015f48b044c6c9d8ff6a0d8669d4532a9f


---

# <a name="security-considerations-when-accessing-apps-remotely-using-azure-ad-application-proxy"></a>Azure AD アプリケーション プロキシを使用したアプリへのリモート アクセス時のセキュリティに関する注意事項

>[!NOTE]
>アプリケーション プロキシは、Azure Active Directory の Premium または Basic エディションにアップグレードしている場合にのみ利用できる機能です。 詳細については、「[Azure Active Directory のエディション](active-directory-editions.md)」をご覧ください。
>  

この記事では、アプリケーションをリモートで公開およびアクセスするための安全なサービスを、Azure AD アプリケーション プロキシがどのように提供するかを説明しています。 

Azure AD アプリケーション プロキシには、次のセキュリティ上の利点があります。

**認証済みアクセス:**認証された接続のみがネットワークにアクセスできる

* Azure AD アプリケーション プロキシでは、すべての認証に Azure AD STS が利用されます。 事前認証を利用して公開されているアプリケーションでは、有効な STS のトークンがないと、トラフィックがアプリケーション プロキシ サービスを通過してお客様の環境に到達することはできません。
* 事前認証はその性質上、認証された ID のみにバックエンド アプリケーションへのアクセスを許可するため、多数の匿名の攻撃がブロックされます。

**条件付きアクセス:** ネットワークへの接続が確立される前に、多数のポリシー制御を適用

* 条件付きアクセスでは、バックエンド アプリケーションにアクセスできるトラフィックの制限を、より細かく定義できます。 場所、認証の強度、ユーザーのリスク プロファイルに基づいて制限を定義できます。
* この機能によって、攻撃者に対する防御を強化できます。 条件付きアクセスの詳細については、「[Azure Active Directory 条件付きアクセスの概要](https://azure.microsoft.com/en-us/documentation/articles/active-directory-conditional-access-azuread-connected-apps)」を参照してください。

**トラフィックの終了:** すべてのトラフィックをクラウドで終了させる

* Azure AD アプリケーション プロキシはリバース プロキシであるため、バックエンド アプリケーションへのすべてのトラフィックは、このサービスで終了します。 バックエンド サーバーでのみ、セッションの再確立が可能です。 つまり、HTTP トラフィックを送信するためにバックエンド サーバーが公開されることはありません。 標的型攻撃をより容易に緩和できるということです。

**すべてのアクセスが外向き:** 企業ネットワークへの受信接続が不要

* Azure AD コネクタは、Azure AD アプリケーション プロキシ サービスへの送信接続を維持します。 つまり、受信接続用のファイアウォール ポートを開放する必要はありません。 
* 従来のアプローチでは DMZ が必要であり、認証されていない接続へのアクセスをネットワーク エッジで開く必要がありました。 そのため、WAF 製品に多額の投資をしてトラフィックを分析し、環境への保護を追加する必要がありました。 アプリケーション プロキシを使用すれば、そのような状況を回避できます。 すべての接続が送信用で、安全なチャネルを介しているため、DMZ なしの運用を検討することも可能です。

**セキュリティ分析と機械語に基づくインテリジェンス:** 最先端のセキュリティ保護

* Azure AD Identity Protection と、機械学習を活用したインテリジェンスとデータは、Microsoft の Digital Crimes Unit および Microsoft セキュリティ レスポンス センターから情報を取得しています。 これらの組織は ID が攻撃されたアカウントを被害の発生前に特定し、危険性の高いサインインが実行されないように、リアルタイムで保護します。 感染したデバイスからのアクセス、匿名ネットワークを経由したアクセス、一般的でない場所や異常な場所からのアクセスなど、多数の要因が考慮されます。
* これらのレポートとイベントの多くは、お客様の SIEM システムとの統合を可能にする API を通じて既に使用可能です。
* Azure AD Identity Protection の詳細については、「[Azure Active Directory Identity Protection](https://azure.microsoft.com/en-us/documentation/articles/active-directory-identityprotection)」をご覧ください。
!
**サービスとしてのリモート アクセス:** オンプレミス サーバーの保守やパッチの適用について心配する必要がない

* Azure AD アプリケーション プロキシは Microsoft によるインターネット規模のサービスであるため、常に最新のセキュリティ パッチとアップグレードが適用された状態で利用できます。 したがって、お客様のネットワークのセキュリティが保たれます。
* パッチの適用されていないソフトウェアは、依然として多数の攻撃の的となっています。 Microsoft のサービス モデルでは、お客様がエッジ サーバーの管理という重荷を背負う必要はありません。 

Azure AD で提供されるリモート アクセス サービスは、[Azure セキュリティ センター](https://azure.microsoft.com/en-us/support/trust-center)で説明されているガイドラインと標準に従って運用されます。 

次の図は、Azure AD を使用して、お客様のオンプレミスのアプリケーションで安全なリモート アクセスを有効にする方法を示しています。

 ![Azure AD アプリケーション プロキシ コネクタ](./media/application-proxy-security-considerations/secure-remote-access.png)

>[!NOTE] 
>Azure AD アプリケーション プロキシによって発行されたアプリケーションのセキュリティを強化するために、アプリケーションをインデックスおよびアーカイブしないように Web クローラー ロボットがブロックされます。 Web クローラー ロボットが発行されたアプリのロボット設定を取得しようとするたびに、アプリケーション プロキシは以下を含む robots.txt ファイルで応答します。 <br>
>   _User-agent: *_<br>
>   _Disallow: /_
>

## <a name="components-of-the-azure-ad-app-proxy-solution"></a>Azure AD アプリケーション プロキシ ソリューションのコンポーネント

Azure AD アプリケーション プロキシは、以下の&2; つで構成されています。

* クラウド ベースのサービス (AAD AP)。 これは、外部のクライアント/ユーザーの接続が作成される場所です。
* AAD アプリケーション プロキシ コネクタと呼ばれるオンプレミスのコンポーネント。  コネクタは、AAD AP サービスからの要求をリッスンし、内部アプリケーションへの接続 (SSO 向けの KCD (Kerberos の制約付き委任) などの項目への対応を含む) を処理します。

### <a name="traffic-flowsand-how-they-are-secured"></a>トラフィック フローとセキュリティ保護の方法
このセクションでは、フローの保護方法の詳細が説明されています。 コネクタとアプリケーション プロキシ サービスの間でフローが確立されるのは以下の場合です。 

* コネクタの最初の設定時。
* コネクタがアプリケーション プロキシ サービスから構成情報 (各コネクタがメンバーとなっているコネクタ グループなど) を収集する。
* 公開されたアプリケーションにユーザーがアクセスする。

>[!NOTE]
>すべての通信は SSL 上で発生し、常にコネクタで生成されて、アプリケーション プロキシ サービスに送られます。 このサービスは送信用のみです。
>

コネクタはクライアント証明書を使用して、すべての呼び出しに対してアプリケーション プロキシ サービスを認証します。 唯一の例外は、クライアント証明書が確立される最初のセットアップ手順です。

#### <a name="install-the-connector"></a>コネクタのインストール

次のフローは、コネクタの最初の設定時に発生します。

1. サービスへのコネクタの登録は、コネクタのインストールの一環として発生します。 この時点で、ユーザーに Azure AD 管理者の資格情報の入力が求められます。 トークンが取得され、Azure AD アプリケーション プロキシ サービスに提示されます。
2. アプリケーション プロキシはトークンを評価して、そのユーザーが、トークンが発行されたテナント内で、会社の管理者ロールを持つメンバーであることを確認します。 そうでない場合は、プロセスが終了します。
3. コネクタは、クライアント証明書の要求を生成し、その要求とトークンをアプリケーション プロキシ サービスに渡します。アプリケーション プロキシ サービスはトークンを確認して、クライアント証明書の要求に署名します。 
4. コネクタはアプリケーション プロキシ サービスとのその後の通信の際に、このクライアント証明書を使用します。
4. コネクタはクライアント証明書を使用して、サービスからのシステム構成データの初回の収集を実行します。これで要求を受け入れる準備が完了します。

#### <a name="periodic-configuration-updates"></a>構成の定期的な更新

アプリケーション プロキシ サービスが構成の設定を更新するたびに、次のフローが定期的に発生します。

1. コネクタはクライアント証明書を使用して、アプリケーション プロキシ サービス内の構成のエンドポイントに接続します。
2. クライアント証明書の検証が完了すると、アプリケーション プロキシ サービスはコネクタに構成データ (そのコネクタが含まれているコネクタ グループなど) を返します。
3. 現在の証明書が 30 日を経過している場合は、コネクタが新しい証明書要求を生成します。このため、30 日ごとに効率よくクライアント証明書が更新されます。

#### <a name="accesss-published-applications"></a>公開済みアプリケーションへのアクセス

次のフローは、公開されているアプリケーションにユーザーがアクセスするときに発生します。

1. 公開されたアプリケーションにユーザーがアクセスするときに、アプリケーション プロキシ サービスは、アプリの構成設定を確認します。  Azure AD で事前認証を使用するようにアプリを構成している場合は、ユーザーは Azure AD STS にリダイレクトされて認証されます。  パススルーを使用してアプリケーションを発行する場合は、この手順は省略されます。
 * Azure AD での認証時に、特定のアプリケーションについて、条件付きアクセス ポリシーの要件を確認します。 これは、そのユーザーがアプリケーションに割り当てられていることを確認するためです (たとえば、MFA が必要な場合は、認証シーケンスでユーザーに&2; つ目の要素の認証が要求されます)。
 * すべてのチェックに合格すると、Azure AD STS はアプリケーション向けに署名されたトークンを発行し、ユーザーをアプリケーション プロキシ サービスにリダイレクトします。
 * 次いでアプリケーション プロキシは、そのトークンが、ユーザーがアクセスを要求したアプリケーションに対して発行されたものであるかを検証します。 そのトークンが Azure AD によって署名されたものであるか、有効期間内であるかなども併せてチェックされます。
 * アプリケーション プロキシは暗号化された認証 Cookie (非永続の Cookie など) を設定して、アプリケーションへの認証が実行されたことを示します。  この Cookie には、Azure AD と他のデータ (認証の元になるユーザー名など) からのトークンを元にした有効期限のタイムスタンプが含まれています。  この Cookie は、アプリケーション プロキシ サービスにのみ認識される秘密キーを使用して暗号化されます。
 * アプリケーション プロキシは、最初に要求された URL にユーザーをリダイレクトします。
 >[!NOTE] 
 >事前認証の手順の一部が失敗した場合は、ユーザーの要求が拒否され、問題の原因を示すメッセージが表示されます。
 >

2. アプリケーション プロキシは、クライアントからの要求を受信すると、事前認証の条件が満たされていること、および Cookie が有効であること (必要な場合) を確認します。 次に、適切なキューに要求を配置し、オンプレミスのコネクタが処理できるようにします。 

 >[!NOTE]
 >コネクタからすべての要求は、アプリケーション プロキシ サービスに送信されます。 コネクタでは、アプリケーション プロキシへの送信接続が維持されます。 要求を受信すると、アプリケーション プロキシは開いている接続のいずれかでキューに要求を配置し、コネクタが処理できるようにします。
 >

 * この要求には、アプリケーションからのアイテム (暗号化された Cookie からの要求とデータのヘッダー、要求を作成したユーザー、要求 ID など) が含まれています。  ただし、暗号化された認証 Cookie はコネクタに送信されません。
3. コネクタは、発信用の Long-Lived 接続に基づくキューからの要求を受信します。 アプリケーション プロキシは、要求に基づいて次のいずれかを実行します。
 * コネクタは、アプリケーションを認識できるかどうかを確認します。  認識できない場合、コネクタはアプリケーション プロキシ サービスへの接続を確立し、アプリケーションの情報を収集し、それをローカルにキャッシュします。
 * 要求が単純な操作の場合 (ボディにデータがない RESTful “GET” 要求であるなど) は、コネクタはターゲットの内部リソースに接続を作成し、応答を待機します。
 * RESTful "POST" 操作など、要求のボディにデータがあり、要求に関連付けられている場合は、コネクタはクライアント証明書を使用して、アプリケーション プロキシのインスタンスに送信接続を作成します。 これはデータを要求し、内部リソースへの接続を開くために行われます。  アプリケーション プロキシ サービスはコネクタからの要求を受信すると、ユーザーからのコンテンツの受信を開始し、コネクタに転送します。  そしてコネクタが内部リソースにデータを転送します。
4. バックエンドへのすべてのコンテンツの要求/送信が完了すると、コネクタは応答を待機します。
5. コネクタは応答を受信すると、アプリケーション プロキシ サービスに送信接続を確立して、ヘッダーの情報を返し、返送するデータのストリーミングを開始します。
6. アプリケーション プロキシは、ユーザーにデータを "ストリーミング" します。  アプリケーションで必要であり、定義されている場合は、ここでヘッダーの処理が発生する場合があります。

クライアントのブラウザーを経由した、Azure Web アプリケーションからオンプレミスの Windows 認証 Simple Object Access Protocal (SOAP) エンドポイントへの通信においてサポートが必要な場合は、こちらの[Azure Field Notes Blog](http://www.azurefieldnotes.com/2016/12/02/claims-to-windows-identity-translation-solutions-and-its-flaws-when-using-azure-ad-application-proxy) を参照してください。 

##<a name="next-steps"></a>次のステップ
[Azure AD アプリケーション プロキシ コネクタについて](application-proxy-understand-connectors.md)




<!--HONumber=Feb17_HO2-->


