---
title: "リンクと URL の Azure AD アプリ プロキシの変換 | Microsoft Docs"
description: "Azure AD アプリケーション プロキシ コネクタの基本について説明します。"
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/30/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.translationtype: Human Translation
ms.sourcegitcommit: 6dbb88577733d5ec0dc17acf7243b2ba7b829b38
ms.openlocfilehash: d716476deb81f6627cf03401f78ab399ae940e68
ms.contentlocale: ja-jp
ms.lasthandoff: 07/04/2017

---

# <a name="redirect-hardcoded-links-for-apps-published-with-azure-ad-application-proxy"></a>Azure AD アプリケーション プロキシで公開されているアプリのハードコードされたリンクをリダイレクトする

Azure AD アプリケーション プロキシを使うと、リモートのユーザーまたは自分のデバイスを使っているユーザーがオンプレミスのアプリを使用できるようになります。 ただし、一部のアプリは、オンプレミスのユーザーを念頭に置いて開発されています。これは通常、ローカル リンクが HTML に埋め込まれ、アプリがリモートで使われる場合に正しく機能しないことを意味します。 これは、複数のオンプレミスのアプリケーションが相互にポイントし、ユーザーが各アプリの外部 URL を入力する代わりにリンクを使ってアプリ間を移動することを想定する場合に最も一般的です。

アプリケーション プロキシのリンク変換機能は、この問題を解決するために開発されました。 内部エンドポイントまたはポートを直接ポイントするアプリがある場合は、公開されている外部アプリケーション プロキシ URL にこれらの内部 URL をマップできます。 リンク変換を有効にすると、アプリケーション プロキシが HTML、CSS を検索して公開されている内部リンクの JavaScript タグを選び、ユーザー エクスペリエンスが中断しないようにそれらを変換します。

>[!NOTE]
>リンク変換機能は、何らかの理由でカスタム ドメインを使ってアプリに同じ内部 URL と外部 URL を持つことのできないテナントを対象としています。 この機能を有効にする前に、[Azure AD アプリケーション プロキシでカスタム ドメイン](active-directory-application-proxy-custom-domains.md)が機能するかどうかをご確認ください。

## <a name="how-link-translation-works"></a>リンク変換の仕組み

認証後に、プロキシ サーバーがユーザーにアプリケーション データを渡すと、アプリケーション プロキシがハードコードされたリンクをアプリケーションでスキャンし、それぞれ公開されている外部 URL で置換します。

### <a name="which-links-are-affected"></a>影響を受けるリンク

リンク変換機能は、アプリの本文のコード タグ内にあるリンクだけを検索します。 アプリケーション プロキシには、ヘッダー内の cookie や URL を変換するための別の機能があります。 

オンプレミスのアプリケーションの内部リンクには 2 つの一般的な種類があります。

- `/claims/claims.html` のようなローカル ファイル構造の共有リソースをポイントする**相対内部リンク**。 これらのリンクは、アプリケーション プロキシ経由で公開されるアプリで自動的に動作し、リンク変換の有無にかかわらず動作を続けます。 
- `http://expenses` のような他のオンプレミスのアプリまたは `http://expenses/logo.jpg` のような公開されたファイルへの**ハードコードされた内部リンク**。 リンク変換機能は、ハードコードされた内部リンクで機能し、リモート ユーザーが経由する必要がある外部 URL をポイントするように変更します。

### <a name="how-do-apps-link-to-each-other"></a>アプリが相互にリンクする方法

リンク変換は、アプリケーションごとに有効化されるため、アプリ レベルでユーザー エクスペリエンスを制御できます。 変換するアプリ "*への*" リンクではなく、そのアプリ "*から*" のリンクが必要な場合に、アプリのリンク変換をオンにします。 

たとえば、すべてが相互にリンクする、アプリケーション プロキシ経由で公開された 3 つのアプリケーション (福利厚生、経費、出張) があるとします。 アプリケーション プロキシ経由で公開されていないフィードバックという 4 番目のアプリがあります。

福利厚生アプリのリンク変換を有効にすると、経費と出張へのリンクは、それらのアプリの外部 URL にリダイレクトされますが、フィードバックへのリンクは外部 URL がないためリダイレクトされません。 経費と出張のアプリに対してはリンク変換が有効になっていないため、この 2 つのアプリから福利厚生へのリンクは機能しません。

![リンク変換が有効になっている場合の福利厚生から他のアプリへのリンク](./media/application-proxy-link-translation/one_app.png)

### <a name="which-links-arent-translated"></a>変換されないリンク

パフォーマンスとセキュリティを向上させるために、一部のリンクは変換されません。

- コード タグ内にないリンク。 
- 他のプログラムから開かれた内部リンク。 電子メールまたはインスタント メッセージで送信されたか、他のドキュメントに含まれているリンクは変換されません。 ユーザーは、外部 URL に移動するために知っておく必要があります。

この 2 つのシナリオのいずれかをサポートする必要がある場合は、同じ内部および外部 URL を使用できます。そうすれば、リンク変換は必要なくなります。  

## <a name="enable-link-translation"></a>リンク変換の有効化

リンク変換の使用開始は、ボタンをクリックするのと同じくらい簡単です。

1. [Azure Portal](https://portal.azure.com) に管理者としてサインインします。
2. **[Azure Active Directory]** > **[エンタープライズ アプリケーション]** > **[すべてのアプリケーション]** に移動し、管理するアプリを選び、**[アプリケーション プロキシ]** を選択します。
3. **[Translate URLs in application body]\(アプリケーション本文の URL を変換する\)** を **[はい]** にします。

   ![[はい] を選択してアプリケーション本文の URL を変換する](./media/application-proxy-link-translation/select_yes.png)に関するページを参照してください。
4. **[保存]** を選択して変更を保存します。

これで、ユーザーがこのアプリケーションにアクセスすると、テナントのアプリケーション プロキシ経由で公開されている内部 URL がプロキシによって自動的にスキャンされます。

## <a name="send-feedback"></a>フィードバックの送信

この機能がすべてのアプリで動作するようにするためにご協力ください。 HTML と CSS で 30 を超えるタグを検索し、サポートする JavaScript ケースを検討しています。 変換されていないリンクが生成された例がある場合は、コード スニペットを[アプリケーション プロキシのフィードバック](mailto:aadapfeedback@microsoft.com)に送信してください。 

## <a name="next-steps"></a>次のステップ
- [Azure AD アプリケーション プロキシでカスタム ドメインを使用して、同じ内部と外部の URL を使用する](active-directory-application-proxy-custom-domains.md)

