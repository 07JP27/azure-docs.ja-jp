<properties title="Search Service: workflow for developers" pageTitle="Search Service: workflow for developers" description="Search Service: workflow for developers" metaKeywords="" services="" solutions="" documentationCenter="" authors="heidist" videoId="" scriptId="" />

# Azure Search: 開発ワークフロー

[WACOM.INCLUDE [この記事では Azure プレビュー ポータルを使用します][]]

この記事では、検索サービスとそのインデックスを作成して維持するためのロードマップといくつかのベスト プラクティスについて説明します。

既にサービスがプロビジョニングされていることが前提となっています。まだ行われていない場合は、「[Azure プレビュー ポータルで Search を構成する][]」を参照して開始してください。

-   [手順 1.インデックスの作成][]
-   [手順 2.ドキュメントの追加][]
-   [手順 3.インデックスのクエリ][]
-   [手順 4.インデックスとドキュメントの更新または削除][]
-   [ストレージの設計に関する考慮事項][]

## 手順 1.インデックスの作成

クエリ (少なくとも非システム クエリ) は、検索のデータと属性を含む検索インデックスを対象としています。この手順では、インデックス スキーマを JSON 形式で定義し、このインデックスがサービスで作成されるように HTTPS PUT 要求を実行します。

インデックスは、通常はローカル開発環境でコーディングされます。インデックス定義のための組み込みのツールやエディターはありません。インデックスの作成の詳細については、MSDN の「[Create Index (Azure Search API) (インデックスの作成 (Azure Search API))][]」を参照してください。

## 手順 2.ドキュメントの追加

検索インデックスを作成した後で、JSON 形式で POST を実行することにより、ドキュメントをインデックスに追加できます。各ドキュメントには、一意のキーと、検索可能なデータと検索不可能なデータが含まれたフィールドのコレクションが含まれている必要があります。ドキュメント データはキー/値ペアのセットとして表されます。

スループットを向上させるために、ドキュメントをバッチで追加することをお勧めします。ドキュメントの平均サイズが 1 ～ 2 KB として、最大 10,000 個のドキュメントをバッチで追加できます。

POST 要求に対する全体的なステータス コードがあります。ステータス コードは、HTTP 200 (Success) または HTTP 207 (Multi-Status) (成功したドキュメントと失敗したドキュメントの組み合わせがある場合) です。POST 要求に対するステータス コードに加えて、Azure Search では各ドキュメントのステータス フィールドが維持されます。バッチ アップロードの場合、各ドキュメントの挿入が成功したか失敗したかを示す、ドキュメントごとのステータスを取得する方法が必要です。その情報は、ステータス フィールドで提供されます。ドキュメントの読み込みが失敗すると、このフィールドは false に設定されます。

負荷が大きい場合、一部のアップロードが失敗することがよくあります。このような失敗が発生したときは、全体的なステータス コードが 207 となり、部分的な成功が示されます。インデックス作成に失敗したドキュメントでは、"status" プロパティが false に設定されます。

> [WACOM.NOTE] サービスがドキュメントを受け取ると、ドキュメントはインデックス作成のためにキューに配置され、即座に検索結果に含まれない場合があります。負荷が大きくない場合は、通常、ドキュメントのインデックスは数秒間で作成されます。

## 手順 3.インデックスのクエリ

ドキュメントのインデックスが作成された後で、検索クエリを実行できます。OData または単純なクエリ構文を使用して、一度に 1 つのインデックスを照会できます。

-   [OData expression syntax for Azure Search (Azure Search の OData 式構文)][]
-   [Simple query syntax in Azure Search (Azure Search の単純なクエリ構文)][]

## 手順 4.インデックスとドキュメントの更新または削除

必要に応じて、検索インデックスに対するスキーマの変更、インデックス内からのドキュメントの更新や削除、インデックスの削除を実行できます。

インデックスを更新するときに、複数のアクション (挿入、マージ、削除) を同一のバッチに組み合わせることで、複数のラウンド トリップの必要がなくなります。現在、Azure Search では部分的な更新 (HTTP PATCH) がサポートされていないため、インデックスを更新する必要がある場合はインデックスの定義を再送信する必要があります。

## ストレージの設計に関する考慮事項

多数の検索アプリケーションで、さまざまなアプリケーションのニーズに対して複数のストレージ形式が使用されています。Azure Search で提供される内部ストレージは、インデックスとドキュメントを格納するために使用する必要があります。テキスト分析は、すべての検索可能なフィールドおよび関連付けられた属性が既に利用可能であることを前提としています。

ドキュメント内のすべてのフィールドが検索可能ではありません。たとえば、アプリケーションが音楽やビデオのオンライン カタログである場合は、BLOB やその他のストレージにバイナリ ファイルを格納することをお勧めします。バイナリ ファイル自体は検索可能ではないため、Azure Search ストレージにそれらを保存する必要はありません。他のサービスまたは場所に画像、ビデオ、オーディオ ファイルを格納し、ファイルの場所への URL を格納するフィールドをドキュメント内に指定する必要があります。

インデックスやドキュメントの作成の詳細については、「[Azure Search Rest API (Azure Search Rest API)][]」を参照してください。



  [この記事では Azure プレビュー ポータルを使用します]: ../includes/preview-portal-note.md
  [Azure プレビュー ポータルで Search を構成する]:  ../search-configure/
  [手順 1.インデックスの作成]: #sub-1
  [手順 2.ドキュメントの追加]: #sub-2
  [手順 3.インデックスのクエリ]: #sub-3
  [手順 4.インデックスとドキュメントの更新または削除]: #sub-4
  [ストレージの設計に関する考慮事項]: #sub-5
  [Create Index (Azure Search API) (インデックスの作成 (Azure Search API))]: http://msdn.microsoft.com/en-us/library/dn798941.aspx
  [OData expression syntax for Azure Search (Azure Search の OData 式構文)]: http://msdn.microsoft.com/en-us/library/dn798921.aspx
  [Simple query syntax in Azure Search (Azure Search の単純なクエリ構文)]: http://msdn.microsoft.com/en-us/library/dn798920.aspx
  [Azure Search Rest API (Azure Search Rest API)]: http://msdn.microsoft.com/en-us/library/dn798935.aspx
