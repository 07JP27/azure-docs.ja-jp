<properties title="Azure SQL Database Elastic Scale" pageTitle="Azure SQL Database Elastic Scale" description="Azure SQL Database の Elastic Scale 機能を使用して、クラウドのデータベース リソースのスケールを簡単に変更できます。" metaKeywords="sharding,elastic scale, Azure SQL DB sharding" services="sql-database" documentationCenter=""  manager="jhubbard" authors="sidneyh@microsoft.com"/>

<tags ms.service="sql-database" ms.workload="sql-database" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="10/02/2014" ms.author="sidneyh" />

#Azure SQL Database Elastic Scale 
Azure SQL Database Elastic Scale のパブリック プレビューへようこそ! 

###約束と課題
Azure SQL Database Elastic Scale は、クラウド コンピューティングの可能性を実現し、Azure SQL DB プラットフォーム上で実質的に無制限の容量と弾力性を可能にします。クラウド サービス プロバイダーは、これまで、コンピューティングおよび BLOB ストレージの無制限の容量に関するほとんどの側面を実現することに成功してきました。ただし、クラウドでのステートフルなデータ処理、特にリレーショナル データベースの管理に関しては、弾力性という課題がまだ残っています。この課題は、次の 2 つのシナリオで顕著に現れます。 

* ワークロードのリレーショナル データベース部分の容量の拡張および縮小。
* ステートフルなデータベースのワークロードとそのデータの使用量ホットスポットの管理。

これらのシナリオに対するこれまでの対処法は、アプリケーションのデータ層をホストするハードウェアをより多く購入するという方法でした。ただし、この方法には、すべての処理が事前に定義済みのコモディティ ハードウェアで実行されるクラウドでは限りがあります。そこで、容量上の理由でデータと処理を複数のスケール単位に分割する "シャーディング" という手法が、コストと弾力性の両方の面で従来のスケールアップ アプローチに代わる説得力のある選択肢となります。私たちは、数年の期間を経て、シャーディングを成功させるためにはお客様が Azure SQL DB の上にスケールアウト アプローチを実装する必要があるという結論に達しました。これは、場合によっては数百または数千の Azure SQL データベースを管理することを意味しました。さらに、アプリケーションのビジネス ロジックではなく、シャーディングの複雑さに対処するコードがデータ層に多く存在することを意味しました。 

私たちは、お客様との長年にわたる直接的なお付き合いを通じて、これらのプロジェクトからシャーディングが登場するいくつかのパターンを見つけました。Azure SQL Database Elastic Scale は、これらのパターンに関するクライアント ライブラリとサービス製品を提供します。Elastic Scale を利用すると、Azure アプリケーションのステートフルなデータ層をより簡単に開発、拡張、管理できます。

その結果、お客様は、シャーディングのためのインフラストラクチャの構築ではなく、アプリケーションのビジネス ロジックに集中することができます。  


##機能 

シャーディングを使用したスケールアウト アプリケーションの開発、スケーリング、および管理では、開発者と管理者の双方に課題がもたらされます。Azure SQL DB Elastic Scale は、開発者と管理者の両者が直面する問題を軽減します。図の中の数字は、このパブリック プレビュー リリースで提供されている主要機能の概要に対応しています。 
下の部分は、アプリケーションのデータ層と、複数のデータベースへのデータの分散 ("シャード" と呼ばれます) を示しています。ここでは、複数のデータベースに複数のシャードのデータが格納されるものと想定しています。 

ここに使用されている用語の定義については、「[Elastic Scale 用語集](./sql-database-elastic-scale-glossary.md)」を参照してください。

###Elastic Scale とシャーディング 

![][1]

この図では、左側に開発者、右側に管理者が示されています。独自のセマンティクスを持つシャード間操作とは異なり、お客様は、シャードにローカルな操作を送信するときに完全な T-SQL 機能を取得することを期待できます。 
Azure SQL Database Elastic Scale のパブリック プレビュー リリースでは、次の特定の機能を使用して、シャード化された Azure SQL DB アプリケーションを容易に開発できます。 

* **シャード マップの管理**: シャード マップの管理 (1) とは、アプリケーションでシャードに関するさまざまなメタデータを管理するための機能を表します。シャード マップの管理は、Elastic Scale クライアント ライブラリの機能です。開発者は、この機能を使用して、シャードを登録したり、個々のシャーディング キーまたはキー範囲のシャードへのマッピングを記述したりできます。さらに、このメタデータを管理して、容量の変更に伴ってデータ層のシャードのレイアウトを発展させることができます。シャード マップの管理は、お客様がシャーディングを自分で実装するときにアプリケーションに記述する必要があったスケルトン コードの大きな部分を構成します。詳細については、「[シャード マップの管理](./sql-database-elastic-scale-shard-map-management.md)」を参照してください。
 
* **データ依存ルーティング**: アプリケーションに要求が送信されるとします。アプリケーションは、要求のシャーディング キー値に基づいてこのシャーディング キー値のデータを保持している正しいシャードを識別し、このシャード (2) への接続を開いて要求を処理する必要があります。データ依存ルーティングでは、アプリケーションのシャード マップへの単一の簡単な呼び出しで接続を開くことができます。インフラストラクチャ コードのもう 1 つの領域であるデータ依存ルーティングは、現在 Elastic Scale クライアント ライブラリの機能でカバーされるようになりました。詳細については、「[データ依存ルーティング](./sql-database-elastic-scale-data-dependent-routing.md)」を参照してください。

* **マルチシャード クエリ (MSQ)**: マルチシャード クエリ実行は、要求にいくつか (またはすべて) のシャードが含まれる場合に機能します。マルチシャード クエリ (3) は、同じ T-SQL コードをすべてのシャードまたはシャードのセットで実行します。参加しているシャードからの結果は、UNION ALL セマンティクスを使用して全体的な結果セットにマージされます。この機能は、クライアント ライブラリを介して公開され、接続管理、スレッド管理、エラー処理、中間結果処理などの多くのタスクを処理します。MSQ では、最大で数百個のシャードを照会できます。詳細については、「[マルチシャード クエリ実行](./sql-database-elastic-scale-multishard-querying.md)」を参照してください。

* **シャードの弾力性**: この機能により、管理者は、PowerShell スクリプトや Azure Automation サービスを使用して、シャード化された環境の垂直スケーリング (単一のシャードのエディションのダイヤル アップおよびダウン) および水平スケーリング (シャード マップのシャードの追加または削除) を行うことができます。詳細については、「[シャードの弾力性](./sql-database-elastic-scale-elasticity.md)」を参照してください。

* **Split-Merge サービス**: アプリケーションは、容量ニーズがビジネスの勢いに伴って変化したときに複数のデータベースにデータを柔軟に再分散できる必要があります (4)。Elastic Scale は、データの移動も伴う状況において、データ層の容量を拡大および縮小し、シャード化されたアプリケーションのホットスポットを管理するための、お客様側でホストされるサービス エクスペリエンスを提供します。Elastic Scale は、異なるシャード間で必要に応じてシャードレットを移動するための基になる機能の上に構築され、シャード マップの管理と統合されて、一貫したマッピングと正確なデータ依存ルーティング接続を保持します。詳細については、「[Elastic Scale による分割とマージ](./sql-database-elastic-scale-overview-split-and-merge.md)」を参照してください。

##一般的なシャーディング パターン

**シャーディング**は、同じ構造を持つ大量のデータを数多くの独立したデータベースに分散する手法です。この手法は、エンド ユーザーまたは企業向けにサービスとしてのソフトウェア (SAAS) 製品をサービスで作成するクラウド開発者の間でよく知られています。これらのエンド カスタマーは、多くの場合、"テナント" と呼ばれます。シャーディングは、次のような理由で必要になります。 

* データの合計数が多すぎて、単一のデータベースの制約に適合しない 
* ワークロード全体のトランザクションのスループットが 1 つのデータベースの能力を超えている 
* テナントを互いに物理的に独立させる必要があり、テナントごとに別個のデータベースが必要になる 
* コンプライアンス、パフォーマンス、または地理上の理由から、データベースの異なる部分を異なる地理的場所に配置することが必要になる場合がある 

他のシナリオ (たとえば、分散されたデバイスからのデータの取り込み) では、シャーディングを使用して、一時的に構成されたデータベースのセットに値を入力できます。たとえば、別個のデータベースをそれぞれの日または週専用に使用できます。その場合、シャーディング キーとして (シャード化テーブルのすべての行に存在する) 日付を表す整数を使用できます。アプリケーションは、日付の範囲の情報を取得するクエリを、対象の範囲をカバーするデータベースのサブセットにルーティングする必要があります。
 
シャーディングは、アプリケーションのすべてのトランザクションをシャーディング キーの単一の値に制限できる場合に最適です。これにより、すべてのトランザクションが特定のデータベースにローカルであることが保証されます。 

一部のアプリケーションでは、テナントごとに別個のデータベースを作成する最も単純なアプローチが使用されています。これは、分離、バックアップ/復元機能、およびテナントの粒度でリソースのスケーリングを提供する、**単一テナントのシャーディング パターン**です。単一テナントのシャーディングでは、各データベースは特定のテナント ID 値 (または顧客キー値) に関連付けられますが、キーは必ずしもデータ自体に存在する必要はありません。各要求を適切なデータベースにルーティングするのはアプリケーションの役目です。 

![][2]

複数のテナントを別個のデータベースに分離する代わりに、一緒にデータベースにパックするシナリオもあります。これが典型的な**マルチテナントのシャーディング パターン**です。このパターンは、コスト、効率性、またはアプリケーションが多数の小さなテナントを管理するという事実の影響を受ける可能性があります。マルチテナントのシャーディングでは、データベース テーブル内の行は、テナント ID を識別するキーまたはシャーディング キーを格納するように設計されます。ここでも、アプリケーション層は、テナントの要求を適切なデータベースにルーティングする役割を負います。 

[AZURE.INCLUDE [elastic-scale-include](../includes/elastic-scale-include.md)]

<!--Anchors-->
<!--Image references-->
[1]:./media/sql-database-elastic-scale-intro/overview.png
[2]:./media/sql-database-elastic-scale-intro/tenancy.png
