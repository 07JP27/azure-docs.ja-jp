---
title: Azure Migrate に関する問題のトラブルシューティング | Microsoft Docs
description: Azure Migrate サービスの既知の問題についての概要を説明し、一般的なエラーのトラブルシューティングのヒントを提供します。
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: troubleshooting
ms.date: 03/19/2018
ms.author: raynew
ms.openlocfilehash: b2c89a980411cac02f46bc91d53620bc94fa845b
ms.sourcegitcommit: 48ab1b6526ce290316b9da4d18de00c77526a541
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/23/2018
---
# <a name="troubleshoot-azure-migrate"></a>Azure Migrate のトラブルシューティング

## <a name="troubleshoot-common-errors"></a>一般的なエラーのトラブルシューティング

[Azure Migrate](migrate-overview.md) は、オンプレミスのワークロードを評価することによって、Azure への移行を支援します。 この記事では、Azure Migrate をデプロイして使用する際に発生する問題のトラブルシューティングを説明します。


**コレクターがインターネットに接続できない**

これは、使用しているマシンがプロキシの内側にある場合に発生することがあります。 プロキシに承認資格情報が必要な場合は、これを提供してください。
URL ベースのファイアウォール プロキシを使用して送信接続を制御している場合は、次の必須の URL を必ずホワイトリストに登録してください。

**URL** | **目的**  
--- | ---
*.portal.azure.com | Azure サービスとの接続性を確認し、時刻の同期の問題を検証するために必要です。
*.oneget.org | powershell ベースの vCenter PowerCLI モジュールをダウンロードするために必要です。

**ポータルからコピーしたプロジェクト ID とキーを使用しても、コレクターがプロジェクトに接続できません。**

情報を正しくコピーして貼り付けたかどうかを確認してください。 この問題を解決するには、Microsoft Monitoring Agent (MMA) をインストールし、次のように MMA がプロジェクトに接続できるかどうかを確認します。

1. コレクター VM 上に、[MMA](https://go.microsoft.com/fwlink/?LinkId=828603) をダウンロードします。
2. インストールを開始するには、ダウンロードしたファイルをダブルクリックします。
3. 設定の **[ようこそ]** ページで **[次へ]** をクリックします。 **[ライセンス条項]** ページで、**[同意する]** をクリックしてライセンスに同意します。
4. **[インストール先のフォルダー]** で、既定のインストール フォルダーをそのまま使用するか変更し、**[次へ]** をクリックします。
5. **[エージェントのセットアップ オプション]** で、**[Azure Log Analytics (OMS)]** > **[次へ]** の順にクリックします。
6. **[追加]** をクリックして、新しい Log Analytics ワークスペースを追加します。 コピーしたプロジェクト ID とキーを貼り付けます。 その後、 **[次へ]**をクリックします。
7. エージェントがプロジェクトに接続できることを確認します。 できない場合は、設定を確認します。 エージェントは接続できるがコレクターは接続できないという場合は、サポートにお問い合わせください。


**エラー 802: 日付と時刻の同期エラーが表示されます。**

サーバー クロックが現在の時刻と同期しておらず、5 分以上ずれている可能性があります。 コレクター VM のクロックの時刻を変更して現在の時刻と一致させるには、次の手順に従います。

1. VM で管理者用のコマンド プロンプトを開きます。
2. タイム ゾーンを確認するには、w32tm /tz を実行します。
3. 時刻を同期するには、w32tm /resync を実行します。

**自分のプロジェクト キーの末尾には “==” という記号がついています。これらはコレクターによって他の英数字にエンコードされます。これは期待される動作ですか?**

はい。すべてのプロジェクト キーは末尾に “==” がついています。 コレクターは、これを処理する前にプロジェクト キーを暗号化します。

**ディスクとネットワーク アダプターのパフォーマンス データが 0 と表示されています。**

これは、vCenter サーバーの統計設定レベルを 3 よりも低いレベルに設定した場合に発生することがあります。 レベルが 3 以上の場合、vCenter はコンピューティング、ストレージ、ネットワークの VM パフォーマンス履歴を保存します。 レベルが 3 よりも小さい場合、vCenter はストレージとネットワーク データは保存せずに、CPU とメモリのデータのみを保存します。 このシナリオでは、Azure Migrate でパフォーマンス データが 0 と表示され、Azure Migrate はオンプレミスのマシンから収集したメタデータに基づいて、ディスクとネットワークの推奨サイズを提供します。

ディスクおよびネットワーク パフォーマンス データの収集を有効にするには、統計レベルの設定を 3 に変更します。 その後、ご利用の環境が検出され評価されるまで、少なくとも 1 日待ちます。

**エージェントをインストールし、依存関係の視覚エフェクトを使用してグループを作成しました。現在、フェールオーバー後にマシンで [依存関係の表示] ではなく [エージェントのインストール] アクションが表示されます。**
* 計画的なフェールオーバー、または計画外のフェールオーバーの後、オンプレミスのマシンはオフになり、同等のマシンが Azure にスピン アップされます。 これらのマシンは、別々の MAC アドレスを取得します。 ユーザーがオンプレミスの IP アドレスを保持するか保持しないかによって、異なる IP アドレスを取得する場合があります。 MAC と IP アドレスの両方が異なる場合、Azure Migrate はオンプレミスのマシンと Service Map 依存関係データの関連付けを行わず、依存関係を表示する代わりにエージェントをインストールするようユーザーに要求します。
* テスト フェールオーバー後、オンプレミスのマシンは想定どおりにオンの状態を維持します。 Azure にスピン アップされる同等のマシンは、異なる MAC アドレスを取得して、異なる IP アドレスを取得することがあります。 これらのマシンから送信される OMS トラフィックをユーザーがブロックしない限り、Azure Migrate はオンプレミスのマシンと Service Map 依存関係データの関連付けを行わず、依存関係を表示する代わりにエージェントをインストールするようユーザーに要求します。


## <a name="troubleshoot-readiness-issues"></a>準備に関する問題のトラブルシューティング

**問題** | **解決策**
--- | ---
サポートされていないブートの種類 | Azure では、ブートの種類が EFI の VM はサポートされません。 移行を実行する前に、ブートの種類を BIOS に変換することをお勧めします。 <br/><br/>[Azure Site Recovery](https://docs.microsoft.com/azure/site-recovery/tutorial-migrate-on-premises-to-azure) を使用すると、移行中に VM のブートの種類が BIOS に変換される、このような VM の移行を行うことができます。
条件付きでサポートされる Windows OS | この OS はサポート期間が終了しており、Azure のサポートのためには[カスタム サポート契約 (CSA)](https://aka.ms/WSosstatement) が必要です。Azure に移行する前に OS をアップグレードすることを検討してください。
サポートされていない Windows OS | Azure は[一部の Windows OS バージョン](https://aka.ms/WSosstatement)のみをサポートしています。Azure に移行する前にマシンの OS をアップグレードすることを検討してください。
条件付きで動作が保証されている Linux OS | Azure は[一部の Linux OS バージョン](../virtual-machines/linux/endorsed-distros.md)のみの動作を保証しています。Azure に移行する前にマシンの OS をアップグレードすることを検討してください。
動作が保証されていない Linux OS | マシンは Azure で起動する可能性はありますが、Azure でサポートされている OS はありません。Azure に移行する前に OS を[動作保証済みの Linux バージョン](../virtual-machines/linux/endorsed-distros.md)にアップグレードすることを検討してください
オペレーティング システムが不明です | vCenter Server で VM のオペレーティング システムが [その他] に指定されました。そのため、Azure Migrate は VM の Azure 対応性を識別できません。 マシンを移行する前に、マシン内で実行されている OS が Azure によって[サポートされている](https://aka.ms/azureoslist)ことを確認してください。
サポートされていないビット数版の OS | 32 ビット版 OS の VM は Azure で起動する可能性はありますが、Azure に移行する前に、VM の OS を 32 ビット版から 64 ビット版にアップグレードすることをお勧めします。
Visual Studio サブスクリプションが必要です。 | マシン内で、Visual Studio サブスクリプションでのみサポートされている Windows クライアント OS が実行されています。
必要なストレージ パフォーマンスの VM が見つかりませんでした。 | そのマシンに必要なストレージ パフォーマンス (IOPS/スループット) が Azure VM のサポート範囲を超えています。 移行前に、そのマシンのストレージ要件を緩和します。
必要なネットワーク パフォーマンスの VM が見つかりませんでした。 | そのマシンに必要なネットワーク パフォーマンス (入力/出力) が Azure VM のサポート範囲を超えています。 そのマシンのネットワーク要件を緩和します。
指定された価格レベルの VM が見つかりません。 | 価格レベルが Standard に設定されている場合、Azure に移行する前に VM のサイズを小さくすることを検討してください。 サイズのレベルが Basic の場合、アセスメントの価格レベルを Standard に変更することを検討してください。
指定した場所で VM が見つかりませんでした。 | 移行前に、別のターゲットの場所を指定します。
不適切なディスクが 1 つ以上あります。 | 仮想マシンに接続されている 1 つ以上のディスクが Azure の要件を満たしていません。 仮想マシンに接続されている各ディスクのサイズが 4 TB を超えていないことを確認し、超えている場合は Azure に移行する前にディスク サイズを縮小してください。 各ディスクで必要とされるパフォーマンス (IOPS/スループット) が Azure の[仮想マシンの管理ディスク](https://docs.microsoft.com/azure/azure-subscription-service-limits#storage-limits)でサポートされていることを確認してください。   
不適切なネットワーク アダプターが 1 つ以上あります。 | 移行前に、マシンから未使用のネットワーク アダプターを削除します。
ディスクの数が制限を超えています | 移行前に、マシンから未使用のディスクを削除します。
ディスクのサイズが制限を超えています | Azure は最大 4 TB のディスクをサポートしています。 移行前に、ディスクを 4 TB 未満に縮小します。
指定した場所でディスクを使用できません | 移行前に、ディスクがターゲットの場所にあることを確認します。
指定した冗長性でディスクを使用できません | 評価の設定 (既定では LRS) で定義されているストレージの冗長性の種類をディスクで使用する必要があります。
内部エラーが原因でディスクの適合性を決定できませんでした | そのグループの評価を新しく作成してみます。
必要なコアとメモリを備えた VM が見つかりません | Azure が適切な VM の種類を見つけられなかったことになります。 移行前に、オンプレミスのマシンのメモリとコアの数を削減します。
内部エラーが原因で VM の適合性を決定できませんでした。 | そのグループの評価を新しく作成してみます。
内部エラーが原因で 1 つ以上のディスクの適合性を決定できませんでした。 | そのグループの評価を新しく作成してみます。
内部エラーが原因で 1 つ以上のネットワーク アダプターの適合性を決定できませんでした。 | そのグループの評価を新しく作成してみます。


## <a name="collect-logs"></a>ログの収集

**コレクター VM でのログの収集方法**

ログ記録は既定で有効になっています。 ログは次の場所にあります。

- C:\Profiler\ProfilerEngineDB.sqlite
- C:\Profiler\Service.log
- C:\Profiler\WebApp.log

Windows イベント トレーシング を収集するには、次の操作を行います。

1. コレクター VM で、PowerShell コマンド ウィンドウを開きます。
2. **Get-EventLog -LogName Application | export-csv eventlog.csv** を実行します。

**ポータルのネットワーク トラフィック ログの収集方法**

1. ブラウザーを開き、[ポータル](https://portal.azure.com)に移動してログインします。
2. F12 キーを押して開発者ツールを起動します。 必要な場合は、**[ナビゲーション時にエントリをクリア]** の設定をクリアします。
3. **[ネットワーク]** タブをクリックし、ネットワーク トラフィックのキャプチャを開始します。
 - Chrome では、**[Preserve log]\(ログの保持\)** を選択します。 自動で記録が開始されるはずです。 赤い円は、トラフィックがキャプチャされていることを示しています。 表示されない場合は、黒い円をクリックして開始します。
 - Edge/IE では、自動で記録が開始されるはずです。 開始されない場合は、緑色の再生ボタンをクリックします。
4. エラーを再現してみます。
5. 記録中にエラーが発生したら、記録を停止し、記録されたアクティビティのコピーを保存します。
 - Chrome では、右クリックして **[Save as HAR with content]\(内容を HAR ファイルに保存する\)** をクリックします。 これにより、ログが .har ファイルとして圧縮されエクスポートされます。
 - Edge/IE では、**[キャプチャしたトラフィックのエクスポート]** アイコンをクリックします。 これにより、ログが圧縮されエクスポートされます。
6. **[コンソール]** タブに移動して、いずれかの警告またはエラーを確認します。 コンソール ログを保存するには次の操作を行います。
 - Chrome では、コンソール ログのどこかを右クリックします。 **[Save as]\(名前を付けて保存\)** を選択して、ログをエクスポートおよび圧縮します。
 - Edge/IE では、エラーを右クリックして **[すべてコピー]** を選択します。
7. 開発者ツールを閉じます。


## <a name="vcenter-errors"></a>vCenter のエラー

### <a name="error-unhandledexception-internal-error-occured-systemiofilenotfoundexception"></a>エラー UnhandledException 内部エラーが発生しました: System.IO.FileNotFoundException

これは、コレクター バージョン 1.0.9.5 未満で見られる問題です。 コレクター バージョン 1.0.9.2、または 1.0.8.59 などの GA 前バージョンをご使用の場合は、この問題が発生します。 [詳細な回答については、フォーラムへのこちらのリンク](https://social.msdn.microsoft.com/Forums/azure/en-US/c1f59456-7ba1-45e7-9d96-bae18112fb52/azure-migrate-connect-to-vcenter-server-error?forum=AzureMigrate)に従ってください。

[コレクターをアップグレードして問題を解決](https://aka.ms/migrate/col/checkforupdates)します。

### <a name="error-unabletoconnecttoserver"></a>エラー UnableToConnectToServer

vCenter Server "Servername.com:9443" に接続できません。原因となったエラー: メッセージを受信できる https://Servername.com:9443/sdk でリッスンしているエンドポイントがありませんでした。

これは、コレクター マシンが、指定された vCenter サーバー名を解決できないか、指定されたポートが間違っている場合に発生します。 既定では、ポートが指定されていない場合、コレクターはポート番号 443 への接続を試みます。

1. コレクターのマシンから Servername.com に ping を実行してみてください。
2. 手順 1. が失敗した場合は、IP アドレスで vCenter サーバーへの接続を再試行してください。
3. 正しいポート番号を識別して vCenter に接続します。
4. 最後に、vCenter サーバーが起動されていて実行中かどうかを確認します。

## <a name="collector-error-codes-and-recommended-actions"></a>コレクターのエラー コードと推奨されるアクション

|           |                                |                                                                               |                                                                                                       |                                                                                                                                            | 
|-----------|--------------------------------|-------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------| 
| エラー コード | エラー名                      | メッセージ                                                                       | 考えられる原因                                                                                        | 推奨される操作                                                                                                                          | 
| 601       | CollectorExpired               | コレクターの有効期限が切れています。                                                        | コレクターの有効期限が切れました。                                                                                    | 新しいバージョンのコレクターをダウンロードし、再試行してください。                                                                                      | 
| 751       | UnableToConnectToServer        | vCenter Server '%Name;' に接続できません。原因となったエラー: %ErrorMessage;     | 詳細については、エラー メッセージを確認してください。                                                             | 問題を解決してから、操作をやり直してください。                                                                                                           | 
| 752       | InvalidvCenterEndpoint         | サーバー '%Name;' は vCenter Server ではありません。                                  | vCenter Server の詳細を指定してください。                                                                       | 正しい vCenter Server の詳細を指定してから、操作を再試行してください。                                                                                   | 
| 753       | InvalidLoginCredentials        | 次のエラーが原因で vCenter Server '%Name;' に接続できません: %ErrorMessage; | ログイン資格情報が無効であるため、vCenter Server への接続に失敗しました。                             | 指定されたログイン資格情報が正しいことを確認してください。                                                                                    | 
| 754       | NoPerfDataAvaialable           | パフォーマンス データは利用できません。                                               | vCenter Server で統計情報のレベルを確認してください。 パフォーマンス データを利用するには 3 に設定されている必要があります。 | 統計情報のレベルを 3 (5 分、30 分、2 時間間隔) に変更し、少なくとも 1 日待ってからやり直してください。                   | 
| 756       | NullInstanceUUID               | InstanceUUID が null のマシンを検出しました                                  | vCenter Server に不適切なオブジェクトがある可能性があります。                                                      | 問題を解決してから、操作をやり直してください。                                                                                                           | 
| 757       | VMNotFound                     | 仮想マシンが見つかりません                                                  | 仮想マシンが削除されている可能性があります: %VMID;                                                                | 検出中に、vCenter のインベントリのスコーピングで選択した仮想マシンが存在することを確認してください                                      | 
| 758       | GetPerfDataTimeout             | VCenter の要求がタイムアウトしました。メッセージ %Message;                                  | vCenter Server の資格情報が正しくありません                                                              | VCenter Server の資格情報をチェックし、その vCenter Server が到達可能であることを確認して、 操作をやり直してください。 問題が解決しない場合は、サポートにお問い合わせください。 | 
| 759       | VmwareDllNotFound              | VMWare.Vim DLL が見つかりません。                                                     | PowerCLI が正しくインストールされていません。                                                                   | PowerCLI が正しくインストールされていることを確認して、 操作をやり直してください。 問題が解決しない場合は、サポートにお問い合わせください。                               | 
| 800       | ServiceError                   | Azure Migrate Collector サービスが実行されていません。                               | Azure Migrate Collector サービスが実行されていません。                                                       | services.msc を使用してサービスを開始し、操作をやり直してください。                                                                             | 
| 801       | PowerCLIError                  | VMware PowerCLI をインストールできませんでした。                                          | VMware PowerCLI をインストールできませんでした。                                                                  | 操作をやり直してください。 問題が解決しない場合は、手動でインストールしてやり直してください。                                                   | 
| 802       | TimeSyncError                  | 時刻がインターネット時刻サーバーと同期していません。                            | 時刻がインターネット時刻サーバーと同期していません。                                                    | マシンの時間がマシンのタイム ゾーンに合わせて正しく設定されていることを確認し、操作をやり直してください。                                 | 
| 702       | OMSInvalidProjectKey           | 無効なプロジェクト キーが指定されました。                                                | 無効なプロジェクト キーが指定されました。                                                                        | 正しいプロジェクト キーを指定してから、操作をやり直してください。                                                                                              | 
| 703       | OMSHttpRequestException        | 要求の送信中にエラーが発生しました。 メッセージ %Message;                                | プロジェクト ID とキーをチェックして、エンドポイントが到達可能であることを確認してください。                                       | 操作をやり直してください。 引き続き問題が発生する場合は、Microsoft サポートにお問い合わせください。                                                                     | 
| 704       | OMSHttpRequestTimeoutException | HTTP 要求がタイムアウトしました。メッセージ %Message;                                     | プロジェクト ID とキーをチェックして、エンドポイントが到達可能であることを確認してください。                                       | 操作をやり直してください。 引き続き問題が発生する場合は、Microsoft サポートにお問い合わせください。                                                                     | 
