---
title: "Azure Migrate での大規模な検出と評価 | Microsoft Docs"
description: "Azure Migrate サービスを使用して、多数のオンプレミス マシンを評価する方法について説明します。"
author: rayne-wiselman
ms.service: azure-migrate
ms.topic: article
ms.date: 11/22/2017
ms.author: raynew
ms.openlocfilehash: e28a2144dd102fcd2ec05531432cac0df250ae01
ms.sourcegitcommit: aaba209b9cea87cb983e6f498e7a820616a77471
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/12/2017
---
# <a name="discover-and-assess-a-large-vmware-environment"></a>大規模な VMware 環境の検出と評価

この記事では、[Azure Migrate](migrate-overview.md) を使用して、多数のオンプレミス マシンを評価する方法について説明します。 Azure Migrate は、マシンを評価して Azure への移行に適しているかどうかを確認し、Azure でマシンを稼働させる際のサイズとコストの見積りを示します。

## <a name="prerequisites"></a>前提条件

- **VMware**: 少なくとも 1 つの VMware VM が、バージョン 5.0 以降を実行しているESXi ホスト上またはクラスター上に配置されている必要があります。 ホストまたはクラスターが、バージョン 5.5 または 6.0 を実行している vCenter サーバーによって管理されている必要があります。
- **vCenter アカウント**: vCenter サーバーの管理者の資格情報と、読み取り専用のアカウントが必要です。 Azure Migrate はこのアカウントを使って VM を検出します。
- **アクセス許可**: vCenter サーバー上で、.OVA 形式でファイルをインポートして VM を作成するためのアクセス許可が必要です。
- **統計情報の設定**: デプロイを開始する前に、vCenter サーバーの統計レベルを 2 以上に設定する必要があります。

## <a name="plan-azure-migrate-projects"></a>Azure Migrate プロジェクトの計画

Azure Migrate プロジェクトは、最大 1500 台のマシンを評価できます。 1 つのプロジェクトにおける 1 つの検出で、最大 1000 台のマシンを検出できます。

- 検出するマシンが 1000 台未満の場合、必要になるのは 1 つのプロジェクトと 1 つの検出です。
- マシンの数が 1000 台から 1500 台であれば、1 つのプロジェクトと、そのプロジェクト内での 2 つの検出が必要になります。
- マシンの数が 1500 台を超える場合は、要件に従って複数のプロジェクトを作成し、複数の検出を実行する必要があります。 For example:
    - マシンの数が 3000 台の場合、2 つのプロジェクトでそれぞれ 2 つの検出をセットアップするか、3 つのプロジェクトで 1 つの検出をセットアップするかを選択できます。
    - マシンの数が 5000 台の場合、4 つのプロジェクトをセットアップすることを選択できます。 2 つのプロジェクトで 1500 台のマシンを検出し、1 つのプロジェクトで 500 台のマシンを検出します。 あるいは、5 つのプロジェクトそれぞれに検出を 1 つセットアップすることもできます。 
- Azure Migrate で検出を行う場合、検出スコープを VMware フォルダー、データセンター、またはクラスターに設定できます。
- 2 つ以上の検出を行うには、検出を行う VM が、マシンの数が 1000 台という制限に対応しているフォルダー、データセンター、またはクラスター内にあることを、vCenter で確認します。
- 評価を目的としている場合は、複数のマシンを同じプロジェクトと同じ評価内にまとめ、相互に依存関係にある状態にすることをお勧めします。 そして vCenter で、依存関係にあるマシンが評価を目的として同じフォルダー、データセンター、またはクラスター内にあることを確認してください。


## <a name="create-a-project"></a>プロジェクトの作成

要件に従って Azure Migrate プロジェクトを作成します。

1. Azure Portal で、**[リソースの作成]** をクリックします。
2. 「**Azure Migrate**」を検索し、検索結果でサービス (**Azure Migrate (プレビュー)**) を選びます。 **[Create]**をクリックします。
3. プロジェクト名およびプロジェクトの Azure サブスクリプションを指定します。
4. 新しいリソース グループを作成します。
5. プロジェクトを作成するリージョンを指定して、**[作成]** をクリックします。 オンプレミス VM から収集されるメタデータが、このリージョンに保存されます。

## <a name="set-up-the-collector-appliance"></a>コレクター アプライアンスの設定

Azure Migrate は、コレクター アプライアンスと呼ばれるオンプレミスの VM を作成します。 この VM はオンプレミスの VMware VM を検出し、それについてのメタデータを Azure Migrate サービスに送信します。 コレクター アプライアンスをセットアップするには、.OVA ファイルをダウンロードしてオンプレミスの vCenter サーバーにインポートし、VM を作成します。

### <a name="download-the-collector-appliance"></a>コレクター アプライアンスのダウンロード

複数のプロジェクトがある場合でも、コレクター アプライアンスをダウンロードして vCenter サーバーにインポートするのは 1 度だけでかまいません。 アプライアンスをダウンロードしてセットアップした後、それを各プロジェクトで実行し、一意のプロジェクト ID とキーを指定します。

1. Azure Migrate プロジェクトで、**[開始]** > **[検出と評価]** > **[マシンの検出]** の順にクリックします。
2. **[マシンの検出]** で **[ダウンロード]** をクリックし、.OVA ファイルをダウンロードします。
3. **[プロジェクトの資格情報をコピーします]** で、プロジェクトの ID とキーをコピーします。 これらの情報はコレクターを構成するときに必要になります。

   
### <a name="verify-the-collector-appliance"></a>コレクター アプライアンスの確認

.OVA ファイルをデプロイする前に、それが安全であることを確認します。

1. ファイルをダウンロードしたマシンで、管理者用のコマンド ウィンドウを開きます。
2. 次のコマンドを実行して、OVA のハッシュを生成します。
    - ```C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]```
    - 使用例: ```C:\>CertUtil -HashFile C:\AzureMigrate\AzureMigrate.ova SHA256```
3. 生成されたハッシュは、次の設定と一致する必要があります。

    **アルゴリズム** | **ハッシュ値**
    --- | ---
    MD5 | c283f00f46484bf673dc8383b01d0741 
    SHA1 | 8f49b47f53d051af1780bbc725659ce64e717ed4
    SHA256 | 7aecdbdb2aea712efe99d0c1444503f52d16de5768e783465e226fbbca71501d

## <a name="create-the-collector-vm"></a>コレクター VM の作成

ダウンロードしたファイルを vCenter サーバーにインポートします。

1. vSphere Client コンソールで、**[File]\(ファイル\)** > **[Deploy OVF Template]\(OVF テンプレートのデプロイ\)** の順にクリックします。

    ![OVF をデプロイする](./media/how-to-scale-assessment/vcenter-wizard.png)

2. [Deploy OVF Template]\(OVF テンプレートのデプロイ\) ウィザードで **[Source]\(ソース\)** を選択し、.OVA ファイルの場所を指定します。
3. **[Name]\(名前\)** と **[Location]\(場所\)** で、コレクター VM のフレンドリ名と、VM がホストされるインベントリ オブジェクトを指定します。
5. **[Host/Cluster]\(ホスト/クラスター\)** で、コレクター VM が実行するホストまたはクラスターを指定します。
7. ストレージで、コレクター VM の保存先を指定します。
8. **[Disk Format]\(ディスク フォーマット\)** で、ディスクの種類とサイズを指定します。
9. **[Network Mapping]\(ネットワーク マッピング\)** で、コレクター VM の接続先となるネットワークを指定します。 このネットワークには、Azure にメタデータを送信するためのインターネット接続が必要です。 
10. 設定を確認したら、**[Finish]\(完了\)** をクリックします。

## <a name="identify-the-key-and-id-for-each-project"></a>各プロジェクトのキーと ID の特定

プロジェクトが複数ある場合は、各プロジェクトの ID とキーを特定する必要があります。 キーは、コレクターを実行して VM を検出するときに必要になります。

1. プロジェクト内で、**[開始]** > **[検出と評価]** > **[マシンの検出]** の順にクリックします。
2. **[プロジェクトの資格情報をコピーします]** で、プロジェクトの ID とキーをコピーします。 
    ![プロジェクト ID](./media/how-to-scale-assessment/project-id.png)

## <a name="vcenter-statistics-level-to-collect-the-performance-counters"></a>パフォーマンス カウンターを収集する vCenter の統計レベル
次の表は、検出中に収集されるカウンターの一覧です。 カウンターは、既定では vCenter サーバーのさまざまなレベルで使用可能です。 すべてのカウンターが正しく収集されるように、統計レベルを一般の最高レベル (レベル 3) に設定することをお勧めします。 vCenter を低いレベルに設定した場合、完全な形で収集できるカウンターがわずかになり、残りのカウンターがレベル 0 に設定したのと同じ結果になってしまう可能性があります。 その結果、評価が不完全なデータを示す場合があります。 また、次の表では、特定のカウンターが収集されなかった場合に影響を受ける評価結果を示しています。

|カウンター                                  |Level    |デバイスごとのレベル  |評価の影響                               |
|-----------------------------------------|---------|------------------|------------------------------------------------|
|cpu.usage.average                        | 1       |該当なし                |推奨される VM サイズとコスト                    |
|mem.usage.average                        | 1       |該当なし                |推奨される VM サイズとコスト                    |
|virtualDisk.read.average                 | 2       |2                 |ディスク サイズ、ストレージ コスト、VM サイズ         |
|virtualDisk.write.average                | 2       |2                 |ディスク サイズ、ストレージ コスト、VM サイズ         |
|virtualDisk.numberReadAveraged.average   | 1       |3                 |ディスク サイズ、ストレージ コスト、VM サイズ         |
|virtualDisk.numberWriteAveraged.average  | 1       |3                 |ディスク サイズ、ストレージ コスト、VM サイズ         |
|net.received.average                     | 2       |3                 |VM サイズとネットワーク コスト                        |
|net.transmitted.average                  | 2       |3                 |VM サイズとネットワーク コスト                        |

> [!WARNING]
> 統計レベルを高く設定した場合は、パフォーマンス カウンターを生成するのに最大 1 日かかります。 そのため、1 日経ってから検出を実行することをお勧めします。

## <a name="run-the-collector-to-discover-vms"></a>VM を検出するコレクターの実行

実行する必要があるそれぞれの検出について、コレクターを実行して指定のスコープの VM を検出します。 1 つずつ検出を実行します。 検出の同時実行はサポートされておらず、各検出は異なるスコープである必要があります。

1. vSphere Client コンソールで、[VM] を右クリックして **[Open Console]\(コンソールを開く\)** を選択します。
2. アプライアンスの設定で、言語、タイム ゾーン、パスワードを指定します。
3. デスクトップにある **[Run collector]\(コレクターの実行\)** ショートカットをクリックします。
4. Azure Migrate Collector で、**[Set Up Prerequisites]\(前提条件の設定\)** を開きます。
    - ライセンス条項に同意し、サード パーティの情報を確認します。
    - VM がインターネットにアクセスできることをコレクターがチェックします。
    - VM がプロキシ経由でインターネットにアクセスしている場合は、**[Proxy settings]\(プロキシの設定\)** をクリックし、プロキシ アドレスとリスニング ポートを指定します。 プロキシで認証が必要な場合は、資格情報を指定します。
    - Windows プロファイラー サービスが実行されていることをコレクターがチェックします。 このサービスは、既定でコレクター VM にインストールされています。
    - VMware PowerCLI をダウンロードしてインストールします。
が必要です。 **[マシンの検出]** で、次の操作を行います。
    - vCenter サーバーの名前 (FQDN) または IP アドレスを指定します。
    - **[ユーザー名]** と **[パスワード]** で、コレクターが vCenter サーバーの VM を検出するために使用する読み取り専用の資格情報を指定します。
    - **[コレクション スコープ]** で、VM 検出のスコープを選択します。 コレクターは、指定されたスコープ内の VM のみを検出できます。 スコープは、指定のフォルダー、データセンター、またはクラスターに設定できます。 VM の数は 1000 台を超えないようにします。 
    - n **[Tag category for grouping]\(グループ化のためのタグ カテゴリ\)** で、**[なし]** を選択します。

        ![スコープの選択](./media/how-to-scale-assessment/select-scope.png)

1. **[プロジェクトの選択]** で、プロジェクトの ID とキーを指定します。 ID とキーをコピーしていなかった場合は、コレクター VM から Azure Portal を開きます。 プロジェクトの **[概要]** ページで **[マシンの検出]** をクリックし、値をコピーします。  
**[Complete Discovery]\(検出の完了\)** で検出プロセスを監視し、VM から収集されたメタデータがスコープ内にあることをチェックします。 コレクターがおおよその検出時間を表示します。


### <a name="verify-vms-in-the-portal"></a>ポータル内での VM の特定

検出時間は検出している VM の数によって異なります。 通常、VM が 100 台の場合、コレクターが実行を終了した後、検出が完了するまで約 1 時間かかります。 

1. Azure Migrate プロジェクト内で、**[管理]** > **[マシン]** の順にクリックします。
2. 検出対象の VM がポータルに表示されていることを確認します。


## <a name="next-steps"></a>次のステップ

- 評価のために[グループを作成する](how-to-create-a-group.md)方法を確認します。
- 評価の計算方法の[詳細を確認](concepts-assessment-calculation.md)します。