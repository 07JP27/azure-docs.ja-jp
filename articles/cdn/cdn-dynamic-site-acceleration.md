---
title: "Azure CDN による動的サイトの高速化"
description: "動的サイトの高速化の詳細"
services: cdn
documentationcenter: 
author: smcevoy
manager: erikre
editor: 
ms.assetid: 
ms.service: cdn
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: v-semcev
ms.translationtype: HT
ms.sourcegitcommit: bde1bc7e140f9eb7bb864c1c0a1387b9da5d4d22
ms.openlocfilehash: e886296fd0a0d49975a36fb86347dec8ad30b176
ms.contentlocale: ja-jp
ms.lasthandoff: 07/21/2017

---
# <a name="dynamic-site-acceleration-via-azure-cdn"></a>Azure CDN による動的サイトの高速化

ソーシャル メディア、電子商取引、高度にパーソナライズされた Web の爆発的な普及に伴って、リアルタイムでエンドユーザーに対して生成されるコンテンツの割合が急増しています。 ユーザーは、ブラウザー、場所、デバイス、ネットワークに関係なく、反応が早く、信頼性の高い、パーソナライズされた Web エクスペリエンスを期待しています。 ただし、これらのエクスペリエンスを実現できる新技術は非常に魅力的ですが、ページのダウンロード速度が遅く、コンシューマー エクスペリエンスの質を低下させるリスクがあります。 

標準的な CDN 機能には、エンドユーザーに近い場所にファイルをキャッシュすることで、静的ファイルの配信速度を上げる機能が含まれています。 ただし、動的な Web アプリケーションでは、サーバーがユーザーの行動に応答してコンテンツを生成するため、コンテンツを特定の場所にキャッシュすることはできません。 このようなコンテンツの配信速度を向上させることは、従来のエッジ キャッシュよりも複雑であり、その発端から配信までのデータ パス全体で各要素を微調整するエンド ツー エンド ソリューションが必要です。 Azure CDN の動的サイトの高速化 (DSA: Dynamic Site Acceleration) 機能を使用すると、動的コンテンツを含む Web ページのパフォーマンスが大幅に向上します。

Akamai の Azure CDN では、エンドポイントの作成中に、**[最適化の対象]** メニューを通して DSA の最適化を提供しています。 この機能は Verizon プロファイルに対してはまだ利用できませんが、近い将来利用可能になる予定です。 

## <a name="configuring-cdn-endpoint-to-accelerate-delivery-of-dynamic-files"></a>動的ファイルの配信を高速化する CDN エンドポイントを構成する

Azure Portal でのエンドポイントの作成中に、**[最適化の対象]** プロパティで **[動的サイトの高速化]** オプションを選択することで、動的ファイルの配信を最適化するように CDN エンドポイントを構成できます。 REST API またはクライアント SDK を使用してこれを行うこともできます。 

### <a name="probe-path"></a>プローブ パス
プローブ パスは Dynamic Site Acceleration に固有の機能であり、エンドポイントを作成するには有効なものが必要です。 DSA は、配信元に配置された小さな "*プローブ パス*" ファイルを使用して、CDN のネットワーク ルーティング構成を最適化します。 用意されているサンプル ファイルをダウンロードしてサイトにアップロードするか、約 10 KB のプローブ パス用の既存の資産が配信元に存在する場合はそれを使用できます。

> [!Note]
> DSA には追加料金がかかります。 詳細については、価格に関するページを参照してください。

次のスクリーン ショットは、Azure Portal を使ったプロセスを示しています。
 
![新しい CDN エンドポイントの追加](./media/cdn-dynamic-site-acceleration/01_Endpoint_Profile.png) 

*図 1: CDN プロファイルからの新しい CDN エンドポイントの追加*
 
![DSA を使用する新しい CDN エンドポイントの作成](./media/cdn-dynamic-site-acceleration/02_Optimized_DSA.png)  

*図 2: 最適化の対象として [動的サイトの高速化] が選択された CDN エンドポイントの作成*

CDN エンドポイントを作成した後は、特定の条件に一致するすべてのファイルに DSA の最適化が適用されます。 次のセクションでは、これを詳しく説明します。

## <a name="dsa-optimization-using-azure-cdn-from-akamai"></a>Akamai の Azure CDN での DSA の最適化

Akamai の Azure CDN による動的サイトの高速化では、次の手法を使用して動的資産の配信を高速化します。

-   ルートの最適化
-   TCP の最適化
-   オブジェクトのプリフェッチ

### <a name="route-optimization"></a>ルートの最適化

インターネットは非常に動的な環境であり、トラフィックと一時的な停止によってネットワーク トポロジが常に変化しているため、ルートを最適化することが重要です。 インターネットのルーティング プロトコルは Border Gateway Protocol (BGP) ですが、Akamai サーバーを経由するルートのほうが高速である可能性があります。 

ルートの最適化では、サイトに継続的にアクセスでき、候補の中で最も高速かつ最も信頼性の高いルート経由でエンドユーザーに動的なコンテンツを配信できる、配信元にとって最も最適化された経路が選択されます。 Akamai ネットワークは、リアルタイムでデータを収集し、開いているインターネットを経由する既定の BGP ルートだけではなく、Akamai サーバーの異なるノードを経由するさまざまな経路を比較して、配信元と CDN エッジの間の最も高速なルートを決定するという手法を使用しています。 これにより、インターネットの混雑しているポイントと不必要に長いルートが回避されます。 
 
その結果、完全に動的なトランザクション コンテンツが、コンテンツをキャッシュできない場合でも、短時間で確実にエンドユーザーに配信されます。 

### <a name="tcp-optimizations"></a>TCP の最適化

伝送制御プロトコル (TCP) は、IP ネットワーク上のアプリケーション間で情報を伝達するために使用される標準的なインターネット プロトコル スイートです。  既定では、TCP 接続をセットアップするには要求を数回送受信する必要があり、ネットワークの混雑を回避するための制限もあります。このため、大きな規模では効率が悪くなります。 Akamai の Azure CDNでは、これを次の 3 つの領域を最適化することによって処理しています。 

 - スロー スタートの排除
 - 永続的な接続の活用
 - TCP パケットのパラメーターの調整

#### <a name="eliminating-slow-start"></a>スロー スタートの排除

*スロー スタート*は、ネットワーク経由で送信されるデータの量を制限することでネットワークの輻輳を回避する TCP プロトコルの部分です。 スロー スタートでは、送信側と受信側の間で小さな輻輳ウィンドウ サイズから始めて、最大サイズに達するかパケットの消失が検出されるまで送信量を増やしていきます。

Akamai の Azure CDNでは、次の 3 つの手順でスロー スタートを排除しています。
1.  エッジ サーバーの分散ネットワークが、使用状況、接続状態、帯域幅、およびその他のパラメーターを Akamai のネットワーク監視システムに一定の間隔で報告します。 
2.  統合されたレポートが、プラットフォーム上のすべてのエッジ サーバーで共有されます。 これにより、すべてのエッジ サーバーが、周囲にあるエッジ サーバーの状態を認識できるようになります。 
3.  CDN エッジ サーバーは、近接する他の CDN エッジ サーバーと通信するときに、最適なウィンドウ サイズなどの一部の伝送パラメーターを推定できるようになります。 これは、CDN エッジ サーバー間の接続の状態が、高いパケット データ転送に対応できる場合は、最初の輻輳ウィンドウ サイズを大きくできることを意味します。 

#### <a name="leveraging-persistent-connections"></a>永続的な接続の活用

CDN では、配信元サーバーに直接接続されるユーザーの数よりも少ない数の一意のコンピューターが配信元に直接接続されます。 Akamai の Azure CDN では、配信元との間に確立する接続の数を少なくするために、ユーザーの要求をまとめてプールします。

前述のように、TCP 接続では、ハンドシェイクの中で複数の要求を送受信して新しい接続を確立します。 永続的な接続 (別名 HTTP キープアライブ) は、複数の HTTP 要求で既存の TCP 接続を再利用することで、ラウンド トリップ時間を短縮し、伝送を高速化します。 

#### <a name="tuning-tcp-packet-parameters"></a>TCP パケットのパラメーターの調整
さらに、Akamai の Azure CDN では、サーバー間接続を管理するパラメーターを調整して、サイトに埋め込まれたコンテンツを取得するために必要な長距離のラウンド トリップの発生を減らしています。これは、以下を行うことで実現されます。
1.  最初の輻輳ウィンドウを大きくする。これにより、受信確認を待たずにより多くのパケットを送信できます。
2.  最初の再送信タイムアウトを小さくする。これにより、消失の検出と再送信が迅速に行われるようになります。
3.  最小と最大の再送信タイムアウトを小さくする。これにより、転送中にパケットが消失したと推定するまでの待機時間が短縮されます。

### <a name="object-prefetch"></a>オブジェクトのプリフェッチ
ほとんどの Web サイトは、画像やスクリプトなどのさまざまな他のリソースを参照する HTML ページで構成されています。 通常、クライアントが Web ページを要求すると、ブラウザーは、HTML オブジェクトをダウンロードして解析した後、ページを完全に読み込むために必要な、リンクされた資産に対する追加要求を行います。 

"*プリフェッチ*" は、ブラウザーによる HTML の処理中に、ブラウザーがこれらのオブジェクトを要求する前であっても、HTML ページに埋め込まれている画像やスクリプトを取得する技法です。 

プリフェッチでは、CDN が HTML ベースのページをクライアントのブラウザーに提供する時点で、**プリフェッチ** オプションがオンになります。このとき、CDN は、HTML ファイルを解析して、リンクされているリソースに対する追加要求をキャッシュに格納します。 クライアントがリンクされた資産の要求を行った時点で、要求されたオブジェクトは CDN エッジ サーバーに既に用意されているため、配信元へのラウンド トリップなしですぐに提供できます。 この最適化は、キャッシュできるコンテンツとキャッシュできないコンテンツの両方にメリットがあります。

## <a name="adaptive-image-compression"></a>アダプティブ イメージの圧縮

一部のデバイス、特にモバイル デバイスでは、ネットワーク速度の低下が発生することがあります。 これらのシナリオでは、フル解像度の画像が表示されるまで待つよりも、小さな画像が Web ページにすぐに表示されるほうが、ユーザーには有益です。

この機能は、ネットワークの質を自動的に監視し、ネットワークの速度が低下したときに標準的な JPEG 圧縮方法を採用することで配信時間を向上させます。

アダプティブ イメージの圧縮 | ファイル拡張子  
--- | ---  
JPEG 圧縮 | .jpg、.jpeg、.jpe、.jig、.jgig、.jgi





