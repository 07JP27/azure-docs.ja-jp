<properties
	pageTitle="CDN - ファイル圧縮によるパフォーマンスの向上"
	description="ファイルを圧縮して、ファイル転送速度とページ読み込みパフォーマンスを向上させることができます。"
	services="cdn"
	documentationCenter=".NET"
	authors="camsoper"
	manager="erikre"
	editor=""/>

<tags
	ms.service="cdn"
	ms.workload="tbd"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="04/26/2016" 
	ms.author="casoper"/>

# ファイル圧縮によるパフォーマンスの向上

このトピックでは、ファイルを圧縮して、ファイル転送速度とページ読み込みパフォーマンスを向上させる方法を説明します。

CDN は次の 2 つの方法で圧縮をサポートしています。

- 配信元サーバーで圧縮を有効にします。この方法では、CDN は既定で圧縮をサポートし、圧縮されたファイルをクライアントに配信します。
- CDN エッジ サーバーで直接、圧縮を有効にします。この方法では、CDN でファイルが圧縮され、エンド ユーザーに渡されます。

## 圧縮の有効化

> [AZURE.NOTE] Standard および Premium CDN レベルでは同じ圧縮機能が提供されますが、ユーザー インターフェイスは異なります。Standard と Premium CDN レベルの違いの詳細については、[Azure CDN の概要](cdn-overview.md)に関する記述を参照してください。

### Standard レベル

1. CDN プロファイル ブレードで、管理する CDN エンドポイントをクリックします。

	![CDN プロファイル ブレード エンドポイント](./media/cdn-file-compression/cdn-endpoints.png)

	CDN エンドポイントのブレードが開きます。

2. **[構成]** をクリックします。

	![[CDN プロファイル] ブレードの [管理] ボタン](./media/cdn-file-compression/cdn-config-btn.png)

	CDN 構成ブレードが開きます。

3. **[圧縮]** をオンにします。

	![CDN の圧縮オプション](./media/cdn-file-compression/cdn-compress-standard.png)

4. 既定の種類を使用するか、ファイルの種類を削除または追加して一覧を変更します。

5. 変更したら、**[保存]** をクリックします。

### Premium レベル

1. CDN プロファイル ブレードで、**[管理]** をクリックします。

	![[CDN プロファイル] ブレードの [管理] ボタン](./media/cdn-file-compression/cdn-manage-btn.png)

	CDN 管理ポータルが開きます。

2. **[HTTP ラージ]** タブ、**[キャッシュの設定]** フライアウトの順にマウスのカーソルを合わせます。**[圧縮]** をクリックします。

	圧縮のオプションが表示されます。

	![ファイル圧縮](./media/cdn-file-compression/cdn-compress-files.png)

3. **[Compression Enabled]** ラジオ ボタンをクリックして圧縮を有効にします。**[ファイルの種類]** テキストボックスで、コンマ区切りのリスト (スペースなし) として圧縮する MIME の種類を入力します。

4. 変更したら、**[更新]** をクリックします。


## 圧縮プロセス

### 概要

1. 依頼者は、コンテンツの要求を送信します。

2. エッジ サーバーは、**Accept-Encoding** ヘッダーがあるかどうかをチェックします。
	1. ヘッダーがある場合、このヘッダーは要求された圧縮方法を特定します。
		> [AZURE.NOTE] サポートされている圧縮メソッドは、 **gzip**、**deflate**、**bzip2** です。
	2. ない場合、この種類の要求は、非圧縮形式で処理されます。
	
3.	最も近いエッジ POP でキャッシュの状態、圧縮方法、まだ有効期間があるかどうかが確認されます。
	1.	キャッシュ **ミス**: 要求されたバージョンがキャッシュされていない場合、要求は配信元に転送されます。
	2.	キャッシュ **ヒット**: 要求された圧縮方法で要求されたバージョンがキャッシュされた場合、エッジ サーバーが直ちに圧縮されたコンテンツをクライアントに配信します。
	3.	キャッシュ **ヒット**: 異なる圧縮方法でファイルがキャッシュされた場合、エッジ サーバーが資産を要求された圧縮方法にトランスコードします。
	4.	キャッシュ **ヒット**: 非圧縮形式でファイルがキャッシュされた場合、要求でエッジ サーバー圧縮を実行可能かどうかを確認するチェックが実行されます (下記のメモを参照してください)。実行可能な場合、エッジ サーバーはファイルを圧縮してクライアントに渡します。実行できない場合、エッジ サーバーは非圧縮コンテンツを返します。
		
> [AZURE.IMPORTANT] 圧縮を実行可能にするためのファイルの条件は、次のとおりです。
>
> - 128 バイトより大きい
> - 1 MB 未満
> - [圧縮用に構成された](#enabling-compression) MIME 型である

### テーブル

次の表に、すべてのシナリオでの CDN 圧縮動作を示します。

#### 圧縮が無効であるか、ファイルの圧縮が実行不可能

|要求された形式|キャッシュされたファイル|CDN の応答|メモ|
|----------------|-----------|------------|-----|
|圧縮|圧縮|圧縮|サポートされている形式間での CDN のトランスコード|
|圧縮|非圧縮|非圧縮| |	
|圧縮|キャッシュなし|圧縮または非圧縮|配信元の応答に依存|
|非圧縮|圧縮|非圧縮|CDN は非圧縮バージョンの配信元に戻る|
|非圧縮|非圧縮|非圧縮| |	
|非圧縮|キャッシュなし|非圧縮| |

#### 圧縮が有効でファイルの圧縮が実行可能

|要求された形式|キャッシュされたファイル|CDN の応答|メモ|
|----------------|-----------|------------|-----|
|圧縮|圧縮|圧縮|サポートされている形式間での CDN のトランスコード|
|圧縮|非圧縮|圧縮|CDN が圧縮を実行|
|圧縮|キャッシュなし|圧縮|配信元から非圧縮が返された場合、CDN が圧縮を実行|
|非圧縮|圧縮|非圧縮|CDN が展開を実行|
|非圧縮|非圧縮|非圧縮| |	
|非圧縮|キャッシュなし|非圧縮| |	


## メモ

1. 新しいエンドポイントをデプロイする場合と同様に、CDN の構成の変更がネットワークを通じて反映されるまでには多少の時間がかかります。ほとんどの場合、90 分以内に変更内容が適用されます。今回初めて CDN エンドポイントの圧縮を設定した場合は、トラブルシューティングの前に、圧縮設定が確実に POP に反映されるように 1 ～ 2 時間の待機時間を検討してください。
2. エッジ サーバーでキャッシュされるのは、1 つのファイル バージョン (圧縮または非圧縮) のみです。他のバーションを要求すると、エッジ サーバーによってコンテンツがトランスコードされます。
3. Media Services CDN 対応ストリーミング エンドポイントについて、圧縮は既定で application/vnd.ms-sstr+xml、application/dash+xml、application/vnd.apple.mpegurl、application/f4m+xml というコンテンツの種類に対応しています。これらの種類の圧縮は、Azure ポータルを使用して有効/無効にすることはできません。  
4. ZIP、MP3、MP4、JPG などの圧縮形式に圧縮を適用することは可能ですが、推奨されません。

## 関連項目
- [CDN ファイルの圧縮のトラブルシューティング](cdn-troubleshoot-compression.md)    

<!---HONumber=AcomDC_0504_2016-->