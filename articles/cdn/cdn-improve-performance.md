<properties 
	pageTitle="CDN - ファイル圧縮によるパフォーマンスの向上"
	description="ファイルを圧縮して、ファイル転送速度とページ読み込みパフォーマンスを向上させることができます。"
	services="cdn"
	documentationCenter=".NET"
	authors="juliako"
	manager="dwrede"
	editor=""/>

<tags 
	ms.service="cdn"
	ms.workload="tbd"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="09/01/2015"
	ms.author="juliako"/>

#ファイル圧縮によるパフォーマンスの向上

このトピックでは、ファイルを圧縮して、ファイル転送速度とページ読み込みパフォーマンスを向上させる方法を説明します。

CDN は次の 2 つの方法で圧縮をサポートしています。

- 配信元サーバーで圧縮を有効にします。この方法では、CDN は既定で圧縮をサポートし、圧縮されたファイルをクライアントに配信します。 
- CDN エッジ サーバーで直接、圧縮を有効にします。この方法では、CDN でファイルが圧縮され、エンド ユーザーに渡されます。

##定義

- **Accept-Encoding** 要求ヘッダー - このヘッダーはユーザー エージェントでサポートする圧縮方法を指定します。これは、要求ヘッダーに含める必要があります。詳細については、[ヘッダー フィールドの定義](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)に関するページを参照してください。
- **コンテンツの種類** - 圧縮用に追加する必要のあるコンテンツ タイプの一覧。圧縮に対応しているのはテキスト ファイルのみです (text/plain、text/html など)。
- **圧縮方法** - サポートされている圧縮方法は gzip/deflate/bzip2 です。サポートされた方法は、Accept-Encoding 要求ヘッダーに設定する必要があります。 
- **キャッシュの状態** - キャッシュの状態では、要求されたコンテンツが要求者に一番近い POP で既にキャッシュされているかどうかを特定します。  
- **ファイル サイズ** - 既定では、圧縮でサポートされるのは、1 バイトから 1MB までのファイルです。  

##ワークフロー

1. 依頼者は、コンテンツの要求を送信します。
2. エッジ サーバーは、**Accept-Encoding** ヘッダーがあるかどうかをチェックします。
	1. ヘッダーがある場合、このヘッダーは要求された圧縮方法を特定します。
	1. ない場合、この種類の要求は、非圧縮形式で処理されます。
3.	最も近いエッジ POP でキャッシュの状態、圧縮方法、また有効な TTL があるかどうかが確認されます。
	1.	キャッシュ ミス: 要求されたバージョンがキャッシュされていない場合、要求は配信元に転送されます。
	2.	圧縮方法が同じキャッシュ ヒット: エッジ サーバーが直ちに圧縮されたコンテンツをクライアントに配信します。
	3.	圧縮方法が異なるキャッシュ ヒット: エッジ サーバーが資産を要求された圧縮方法にトランスコードします。 
	4.	キャッシュ ヒットと非圧縮: 最初の要求で資産を非圧縮形式でキャッシュする必要があった場合、(前の定義/要件セクションの条件に基づいて) 要求でエッジ サーバー圧縮を実行可能かどうかを確認するチェックが実行されます。
		1.	実行可能な場合、エッジ サーバーはファイルを圧縮してクライアントに渡します。
		2.	実行できない場合: エッジ サーバーはすぐに非圧縮コンテンツをクライアントに配信します。 

![ファイル圧縮](./media/cdn-file-compression/cdn-compress-files.png)

##考慮事項 

1. Media Services CDN 対応ストリーミング エンドポイントについて、圧縮は既定で次のコンテンツの種類に対応しています: application/vnd.ms-sstr+xml、application/dash+xml、application/vnd.apple.mpegurl、application/f4m+xml。これらの種類の圧縮は、Azure ポータルを使用して有効/無効にすることはできません。  
2. エッジ サーバーでキャッシュされるのは、1 つのファイル バージョン (圧縮または非圧縮) のみです。他のバーションを要求すると、エッジ サーバーによってコンテンツがトランスコードされます。  

<!---HONumber=September15_HO1-->