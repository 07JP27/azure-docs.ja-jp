<properties
	pageTitle="アクティブ geo レプリケーションのセキュリティ構成"
	description="このトピックでは、SQL Database のアクティブ geo レプリケーションのシナリオを管理するためのセキュリティに関する考慮事項について説明します。"
	services="sql-database"
	documentationCenter="na"
	authors="carlrabeler"
	manager="jhubbard"
	editor="monicar" />


<tags
	ms.service="sql-database"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="data-management"
	ms.date="04/27/2016"
	ms.author="carlrab" />

# geo レプリケーションのセキュリティ構成

>[AZURE.NOTE] すべてのサービス階層のデータベースで [Active Geo-Replication](sql-database-geo-replication-overview.md) を使用できるようになりました。

## アクティブ geo レプリケーションの認証要件の概要
このトピックでは、[アクティブ geo レプリケーション](sql-database-geo-replication-overview.md)を構成し、制御するための認証要件と、セカンダリ データベースへのユーザー アクセスを設定するために必要な手順について説明します。geo レプリケーションの使用方法の詳細については、「[Azure SQL Database を障害から回復する](sql-database-disaster-recovery.md)」を参照してください。

## 包含ユーザーによるアクティブ Geo レプリケーションの使用
[Azure SQL Database の V12 バージョン](sql-database-v12-whats-new.md)で、包含ユーザーがサポートされるようになりました。従来のユーザーは master データベース内のログインにマップする必要がありましたが、包含ユーザーは、データベース自体で完全に管理されます。これには 2 つ利点があります。データベースがユーザーを管理するため、geo レプリケーションのシナリオでも、ユーザーは追加の構成なしで引き続きセカンダリ データベースに接続できます。また、ログインの観点からは、この構成を使用することで、スケーラビリティとパフォーマンスを向上できる可能性があります。詳細については、「[包含データベース ユーザー - データベースの可搬性を確保する](https://msdn.microsoft.com/library/ff929188.aspx)」を参照してください。

同じログインを使用するデータベースが複数ある場合、複数のデータベースで包含ユーザーを使用して資格情報を維持すると、包含ユーザーの利点が損なわれる場合があります。たとえば、パスワードが変更された場合、サーバー レベルでログインのパスワードを一括で変更するのではなく、各データベースの包含ユーザーごとに変更を行う必要があります。このような理由から、同じユーザー名とパスワードを使用するデータベースが複数ある場合、包含ユーザーの使用は推奨されません。

## アクティブ Geo レプリケーションでのログインとユーザーの使用
(包含ユーザーではなく) ログインとユーザーを使用している場合、追加の手順を実行して、セカンダリ データベース サーバー上に同じログインが存在することを確認する必要があります。次のセクションでは、関連する手順とその他の考慮事項について概要を説明します。

### セカンダリ データベースへのユーザー アクセスの設定
フェールオーバーの発生後に、セカンダリ データベースを読み取り専用データベースか有効なプライマリ データベースとして使用できるようにするには、セカンダリ データベースに適切なセキュリティ構成が設定されている必要があります。

サーバー管理者または適切なアクセス許可を持つユーザーは、このトピックに記載されている構成手順を完了できます。各手順の詳細なアクセス許可については、後ほど詳しく説明します。

アクティブ geo レプリケーション オンライン セカンダリに対するユーザー アクセスの準備は、いつでも実行できます。これには、大きく分けて次の 3 つの手順があります。

1. プライマリ データベースにアクセスできるログインを特定する。
2. ソース サーバーでそのログインの SID を検索する。
3. ソース サーバー側と同じ SID を設定したログインをターゲット サーバーで作成する。

>[AZURE.NOTE] ターゲット サーバーへのログインがセカンダリ データベースのユーザーに正しくマップされていない場合、フェールオーバー発生後の読み取り専用セカンダリ データベースへのアクセスまたは新しいプライマリへのアクセスは、サーバー管理者のみに制限されます。

#### 1\.プライマリ データベースにアクセスできるログインを特定する:
このプロセスの最初の手順は、ターゲット サーバー上に複製するログインを特定することです。そのために、ソース サーバーの論理 master データベースとプライマリ データベースでそれぞれ 1 回ずつ SELECT ステートメントを実行します。

サーバー管理者または **LoginManager** サーバー ロールのメンバーのみが、次の SELECT ステートメントを使用してソース サーバーのログインを特定できます。

	SELECT [name], [sid] 
	FROM [sys].[sql_logins] 
	WHERE [type_desc] = 'SQL_Login'

また、db\_owner データベース ロールのメンバー、dbo ユーザー、またはサーバー管理者のみが、プライマリ データベース内にあるすべてのデータベース ユーザー プリンシパルを特定できます。

	SELECT [name], [sid]
	FROM [sys].[database_principals]
	WHERE [type_desc] = 'SQL_USER'

#### 2\.手順 1. で特定したログインの SID を検索する:
前のセクションで実行したクエリの出力を比較して SID を一致させることで、サーバー ログインをデータベース ユーザーに対応付けることができます。一致する SID を持つデータベース ユーザーが対応付けられたログインは、そのデータベースのユーザー プリンシパルとしてデータベースに対するユーザー アクセス権が付与されます。

次のクエリを使用すると、データベース内のすべてのユーザー プリンシパルとその SID を表示できます。このクエリを実行できるのは、db\_owner データベース ロールのメンバーまたはサーバー管理者のみです。

	SELECT [name], [sid]
	FROM [sys].[database_principals]
	WHERE [type_desc] = 'SQL_USER'

>[AZURE.NOTE] **INFORMATION\_SCHEMA** ユーザーと **sys** ユーザーの SID は *NULL* で、**ゲスト** SID は **0x00** です。データベースの作成者が **DbManager** のメンバーではなくサーバー管理者だった場合、**dbo** SID は *0x01060000000001648000000000048454* で始まることがあります。

#### 3\.ターゲット サーバーへのログインを作成する:
最後の手順では、1 つ以上のターゲット サーバーにアクセスし、適切な SID を使用してログインを生成します。基本的な構文は次のとおりです。

	CREATE LOGIN [<login name>]
	WITH PASSWORD = <login password>,
	SID = <desired login SID>

>[AZURE.NOTE] セカンダリへのユーザー アクセスを許可し、プライマリへのアクセスは許可しない場合は、次の構文を使用してプライマリ サーバーでユーザー ログインを変更します。
>
>ALTER LOGIN <login name> DISABLE
>
>DISABLE を実行してもパスワードは変更されないため、必要な場合にいつでも有効にできます。

## 次のステップ
アクティブな geo レプリケーションの詳細については、「[アクティブ geo レプリケーション](sql-database-geo-replication-overview.md)」を参照してください。


## その他のリソース

- [ビジネス継続性の概要](sql-database-business-continuity.md)
- [アクティブ geo レプリケーション](sql-database-geo-replication-overview.md)
- [クラウド障害復旧用アプリケーションの設計](sql-database-designing-cloud-solutions-for-disaster-recovery.md)
- [復旧された Azure SQL データベースの最終処理を行う](sql-database-recovered-finalize.md)
- [SQL Database BCDR の FAQ](sql-database-bcdr-faq.md)

<!---HONumber=AcomDC_0504_2016-->
