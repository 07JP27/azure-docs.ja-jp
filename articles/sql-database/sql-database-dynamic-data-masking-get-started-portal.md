<properties 
   pageTitle="SQL Database 動的データ マスクの使用 (Azure ポータル)" 
   description="Azure ポータルでの SQL Database 動的データ マスクの使用方法" 
   services="sql-database" 
   documentationCenter="" 
   authors="nadavhelfman" 
   manager="jeffreyg" 
   editor="v-romcal"/>

<tags
   ms.service="sql-database"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-services" 
   ms.date="04/02/2015"
   ms.author="nadavh; ronmat; v-romcal; sstein"/>

# SQL Database 動的データ マスクの使用 (Azure ポータル)

> [AZURE.SELECTOR]
- [Dynamic Data Masking - Azure Preview portal](sql-database-dynamic-data-masking-get-started.md)

## 概要

SQL Database 動的データ マスクは、特権のないユーザーに対してデリケートなデータをマスクし、データの公開を制限します。動的データ マスクは、V12 バージョンの Azure SQL Database の Basic、Standard と Premium の各サービス階層でプレビューとして使用できます。

動的データ マスクでは、公開するデリケートなデータの量を指定することで、デリケートなデータに対する未承認のアクセスを防ぎ、アプリケーション レイヤーへの影響は最小限に抑えられます。これはポリシー ベースのセキュリティ機能であり、指定されたデータベース フィールドに対するクエリの結果セットに含まれるデリケートなデータが表示されないようにします。データベース内のデータは変更されません。

たとえば、コール センターのサポート担当者は、社会保障番号やクレジット カード番号の一部の数字から電話の相手を特定できますが、このようなデータ項目をサポート担当者にすべて公開してはなりません。開発者は、結果セットの社会保障番号やクレジット カード番号の末尾 4 桁を除くすべての数字をマスクするマスク ルールを各クエリ結果に適用するように定義できます。別の例として、開発者は、適切なデータ マスクを使用して個人を特定できる情報 (PII) データを保護し、法令遵守規定に違反することなくトラブルシューティングの目的で運用環境に対して照会を行うことができます。

## SQL Database 動的データ マスクの基礎

動的データ マスク ポリシーは Azure ポータルの中で設定します。設定は、データベースにアクセスするアプリケーションや他のクライアントによって使用されるセキュリティ保護接続文字列を使用することによって完了します。

> [AZURE.NOTE]Azure プレビュー ポータルで動的データ マスクを設定する方法について詳しくは、「[SQL Database 動的データ マスク (Azure プレビュー ポータル)](sql-database-dynamic-data-masking-get-started.md)」を参照してください。

### 動的データ マスクのアクセス許可

動的データ マスクを構成できるのは、Azure Database 管理者、サーバー管理者、またはセキュリティ責任者の各ロールです。

### 動的データ マスク ポリシー

* **特権ログイン** - SQL クエリ結果に含まれるマスクされていないデータを取得するログインのセット。
  
* **マスク ルール** - マスクされる指定のフィールドと使用されるマスク関数を定義するルールのセット。データベース テーブル名と列名またはエイリアス名を使用して、指定のフィールドを定義できます。

* **マスク対象** - ソースまたはターゲットでマスクを行うことができます。**テーブル**名と**列**名を特定することによってソース レベルでマスクを構成できます。または、クエリで使用する**エイリアス**を特定することによって結果レベルでマスクを構成できます。データベースのデータ アーキテクチャを熟知していて、すべてのクエリ結果の公開を制限する必要がある場合は、ソース マスク ルールを使用することをお勧めします。データベースのデータ アーキテクチャを分析せずにクエリ結果の公開を制限する必要がある場合や、別のソースから取得する可能性のあるフィールドについては、結果マスク ルールを追加できます。
  
* **制限の拡張** - 機密データの公開を制限しますが、一部のアプリケーションの機能に悪影響を及ぼす可能性があります。

>[AZURE.TIP]**制限の拡張**オプションを使用すると、データベースに直接アクセスして、トラブルシューティングの目的で SQL クエリを実行する開発者のために、アクセスが制限されます。

* **マスク関数** - さまざまなシナリオに対応してデータの公開を制御する方法のセット。

| マスク関数 | マスク ロジック |
|----------|---------------|
| **既定値** |**指定のフィールドのデータ型に応じたフル マスク**<br/><br/>• 文字列データ型 (nchar、ntext、nvarchar) のフィールドのサイズが 8 文字未満の場合は、XXXXXXXX またはそれ未満の数の X を使用します。<br/>• 数値データ型 (bigint、bit、decimal、int、money、numeric、smallint、smallmoney、tinyint、float、real) の場合は、値 0 を使用します。<br/>• 日付/時刻データ型 (date、datetime2、datetime、datetimeoffset、smalldatetime、time) の場合は、現在の時刻を使用します。<br/>• SQL バリアントの場合は、現在の型の既定値が使用されます。<br/>• XML の場合は、ドキュメント <masked/> が使用されます。<br/>• 特殊なデータ型 (タイムスタンプ テーブル、hierarchyid、GUID、binary、image、varbinary 空間型) の場合は、空の値を使用します。
| **クレジット カード** |クレジット カードのフォームでプレフィックスとして定数文字列を追加し、**指定のフィールドの末尾 4 桁を公開するマスク方法**。<br/><br/>XXXX-XXXX-XXXX-1234|
| **社会保障番号** |米国の社会保障番号のフォームでプレフィックスとして定数文字列を追加し、**指定のフィールドの末尾 2 桁を公開するマスク方法**。<br/><br/>XXX-XX-XX12 |
| **電子メール** | 電子メール アドレスのフォームでプレフィックスとして定数文字列を使用し、**最初の文字とドメインを公開するマスク方法**。<br/><br/>aXX@XXXX.com |
| **ランダムな数値** | 選択した境界と実際のデータ型に応じて**乱数を生成するマスク方法**。指定された境界が等しい場合、マスク関数は定数になります。<br/><br/>![ナビゲーション ウィンドウ][Image1] |
| **カスタム テキスト** | 間にカスタム埋め込み文字列を追加し、**最初と最後の文字を公開するマスク方法**。<br/>プレフィックス[埋め込み]サフィックス<br/><br/>![ナビゲーション ウィンドウ][Image2] |

  
<a name="Anchor1"></a>
### セキュリティが有効な接続文字列

動的データ マスクを設定する場合は、Azure が提供する、セキュリティが有効な接続文字列をデータベース用に使用できます。動的データ マスク ポリシーに従ってデリケートなデータをマスクできるのは、この接続文字列を使用するクライアントのみです。また、新しい接続文字列の形式を使用するように既存のクライアント (例: アプリケーション) を更新しておく必要もあります。

* 元の接続文字列形式: <*サーバー名*>.database.windows.net
* セキュリティが有効な接続文字列: <*サーバー名*>.database.**secure**.windows.net

**[セキュリティが有効なアクセス]** の設定を **[オプション]** から **[必須]** に変更することもできます。この場合、元の接続文字列を使用してデータベースにアクセスしたり、動的データ マスク ポリシーを無視したりすることはできません。特定のクライアント (開発フェーズのアプリケーションや SSMS など) を使用して動的データ マスクを実行している場合は、**[オプション]** を選択します。運用環境の場合は、**[必須]** を選択します。<br/><br/>

![ナビゲーション ウィンドウ][Image3]<br/><br/>

## Azure ポータル使用によるデータベースの動的データ マスク設定

1. Azure ポータル ([https://manage.windowsazure.com](https://manage.windowsazure.com)) を起動します。

2. マスクするデータベースをクリックしてから **[監査とセキュリティ]** タブをクリックします。

3. **[動的データ マスク]** で、**[有効]** をクリックして動的データ マスク機能を有効にします。

4. マスクされていないデリケートなデータへのアクセスを許可する特権ログインを入力します。

	>[AZURE.TIP]アプリケーションの特権を持つユーザーに対してアプリケーション レイヤーがデリケートなデータを表示できるようにするには、照会に使用するアプリケーション ログインとデータベースを追加します。デリケートなデータの公開を最小限に抑えるには、この一覧に含めるログインの数を最小限にすることを強くお勧めします。

	![ナビゲーション ウィンドウ][Image4]

5. ページの下部にあるメニュー バーの **[マスクの追加]** をクリックして、マスク ルール構成ウィンドウを開きます。

6. **[マスク対象]** を選択して、マスクをソースとターゲットのどちらで実行するかを指定します。**テーブル**名と**列**名を特定することによってソース レベルでマスクを構成できます。または、クエリで使用する**エイリアス**を特定することによって結果レベルでマスクを構成できます。**テーブル**名はデータベース内のすべてのスキーマを指し、スキーマのプレフィックスは含めないことに注意してください。データベースのデータ アーキテクチャを熟知していて、すべてのクエリ結果の公開を制限する必要がある場合は、ソース マスク ルールを使用することをお勧めします。データベースのデータ アーキテクチャを分析せずにクエリ結果の公開を制限する必要がある場合や、別のソースから取得する可能性のあるフィールドについては、結果マスク ルールを追加できます。

7. マスクする指定のフィールドを定義するために、**[テーブル]** にテーブル名を入力し、**[列]** に列名を入力します。または、**[エイリアス]** にエイリアス名を入力します。

8. 機密データのマスク カテゴリの一覧から **[マスク関数]** を選択します。

	![ナビゲーション ウィンドウ][Image5]
 	
9. データ マスク ルール ウィンドウの **[更新]** をクリックして、動的データ マスク ポリシーのマスク ルールのセットを更新します。

10. **[制限の拡張の使用]** を選択するかどうかを検討します。このオプションを選択すると、アドホック クエリを使用して機密データの公開が制限されます。

11. **[保存]** をクリックして、新しいマスク ルールまたは更新されたマスク ルールを保存します。

## REST API を使用してデータベース用の動的データ マスクを設定する

「[Azure SQL データベースの操作](https://msdn.microsoft.com/library/dn505719.aspx)」を参照してください。

[Image1]: ./media/sql-database-dynamic-data-masking-get-started-portal/1_DDM_Random_number.png
[Image2]: ./media/sql-database-dynamic-data-masking-get-started-portal/2_DDM_Custom_text.png
[Image3]: ./media/sql-database-dynamic-data-masking-get-started-portal/3_DDM_Current_Preview.png
[Image4]: ./media/sql-database-dynamic-data-masking-get-started-portal/4_DMM_Policy_Classic_Portal.png
[Image5]: ./media/sql-database-dynamic-data-masking-get-started-portal/5_DDM_Add_Masking_Rule_Classic_Portal.png
 

<!---HONumber=July15_HO4-->