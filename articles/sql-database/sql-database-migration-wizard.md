<properties 
   pageTitle="SQL Azure 移行ウィザードを使用した移行 | Microsoft Azure" 
   description="Microsoft Azure SQL Database、データベースの移行、データベースのインポート、データベースのエクスポート、移行ウィザード" 
   services="sql-database" 
   documentationCenter="" 
   authors="pehteh" 
   manager="jeffreyg" 
   editor="monicar"/>


<tags
   ms.service="sql-database"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="data-management" 
   ms.date="07/01/2015"
   ms.author="pehteh"/>


# SQL Azure 移行ウィザードを使用した移行


![alt text](./media/sql-database-migration-wizard/01SAMWDiagram.png)


このオプションでは、SQL Azure 移行ウィザードを使用して、ソース データベースから T-SQL スクリプトを生成した後、SQL Database に対応するようにこのスクリプトを変換し、Azure SQL Database に接続して空の Azure SQL データベースに対してこのスクリプトを実行します。スキーマのみを含むスクリプトを生成することも、BCP 形式のデータを含むスクリプトを生成することもできます。さらに、このウィザードを使用すると、スクリプト内のデータベースに特定のオブジェクトを含めたり、特定のオブジェクトを除外したりできます。


ウィザードで検出できるすべての非互換スキーマを組み込み変換で処理できるとは限りません。処理できない非互換スクリプトは、生成されたスクリプトにコメントが挿入され、エラーとして報告されます。このような場合は、スクリプトを保存して手動で編集してから Azure SQL Database に送信する必要があります。変更が必要な場合は、スクリプトを保存した後、SSMS または VS の SQL Server ツールを使って編集できます。互換性のあるスクリプトは、Azure SQL Database に対して帯域外で実行できます。


> **注: **このオプションの拡張機能として、多数のエラーが検出され、エラーを簡単に解決できない場合は、生成されたスクリプト ファイルを Visual Studio のデータベース プロジェクトにインポートできます。プロジェクトのターゲットを SQL Database V12 に設定すると、VS の SQL Server ツールを使用してプロジェクトをビルドし、段階的にエラーを修正できます。スキーマにエラーがなくなったら、オプション 1 の説明に従って、ソース データベースのコピーにスキーマを発行した後、SSMS を使用して、データベースを Azure SQL Database にデプロイまたはエクスポート/インポートできます。


## SQLAzureMW.exe をダウンロードする


CodePlex から、SQL Azure 移行ウィザードをダウンロードできます。


[SQLAzureMW.exe のダウンロード](http://sqlazuremw.codeplex.com/)


## 移行の手順


& nbsp;1.SQL Database の新しいサーバー、または前に説明したように手順に従ってアップグレードした既存のサーバーに、新しいデータベースをプロビジョニングします。このデータベースに対して、このオプションで作成した移行スクリプトを最後の手順として実行します。


& nbsp;2.移行ウィザードを起動します。**[データベースの分析/移行]** を選択し、**[ターゲット サーバー]** を [Azure SQL Database V12] に設定します。次に、**[次へ]** をクリックします。


![alt text](./media/sql-database-migration-wizard/02MigrationWizard.png)


& nbsp;3.次のページで、**[サーバーに接続]** をクリックし、移行元サーバーの接続情報を指定します。接続ダイアログ ボックスでソース データベースを指定するか、またはサーバーに接続した後でデータベースの一覧からソース データベースを選択します。


![alt text](./media/sql-database-migration-wizard/03MigrationWizard.png)


& nbsp;4.次の [オブジェクトの選択] ページで、すべてのデータベース オブジェクトのスクリプトを生成する (既定値) か、またはスクリプトを生成する特定のデータベース オブジェクトを選択するかを選択します。最初にすべてのオブジェクトのスクリプトを作成することを選択し、ウィザードによってスクリプト生成エラーや変換エラーが報告されたら後でこの手順に戻って特定のオブジェクトを除外する方法をお勧めします。ウィザードにより、最初に (SMO を使用して) データベースのオブジェクトが生成されます。次に、後処理として、生成されたスクリプトに対して、一連の正規表現に基づく検証および変換規則が適用されます。


![alt text](./media/sql-database-migration-wizard/04MigrationWizard.png)


& nbsp;5.[詳細] を選択し、ウィザードで使用される構成オプションを確認します。特に大規模なデータベースでは、最初に **[テーブル/データのスクリプトを生成]** を [テーブル スキーマのみ] に、**[ターゲット サーバー]** を [Microsoft Azure SQL Database V12] に、**[互換性チェック]** を [上書き: すべての互換性チェックを実行する] に設定します。


![alt text](./media/sql-database-migration-wizard/05MigrationWizard.png)


& nbsp;6.**[次へ]** をクリックしてオプションを確認し、もう一度 **[次へ]** をクリックしてスクリプトの生成と変換を実行します。スクリプトは、[SQL スクリプト] タブで確認できます。


& nbsp;7.スクリプトの生成処理において、スキーマが SQL Database との互換性を持たず、スキーマをウィザードで変換できない場合は、エラーが報告されます。次の画面ショットでは、変換処理中に 1 つのストアド プロシージャに問題が検出されています。このケースでは、プロシージャがフルテキスト検索用に書き込まれています。この機能は V12 でまだサポートされていませんが、今後のリリースでサポートされる予定です。


![alt text](./media/sql-database-migration-wizard/06MigrationWizard.png)


- エラーの内容によっては、ウィザードの前の手順に戻って問題の原因となっているオブジェクトを除外した後でスクリプトを再生成することができます。エラーを修正する方法を計画する際は、エラーは、データベースを使用するアプリケーションに加え、データベース内の他のオブジェクトへの影響も考慮してください。
- 修正する必要があるエラーがスクリプトに含まれている場合は、[SQL スクリプト] タブからスキーマのみのスクリプト ファイルを保存し、任意のエディターでスクリプトを開いてエラーを修正します。その後、手順 1. で作成した新しいデータベースに対して SAMW の外部でスクリプトを実行します。スクリプトのサイズが大きい場合や大量のエラーがある場合は、オプション 3 を使用する必要があります。生成されたスクリプト ファイルは Visual Studio にインポートすることができます。ただし、オプション 3 の説明のとおり、SQL ファイルからインポートするには、データベースからインポートするのに比べてかなり長い時間がかかります。 


& nbsp;8.エラーがない場合、またはスクリプトの生成処理で発生したエラーの原因を取り除いた場合は、**[次へ]** をクリックします。表示されるページで、**[サーバーに接続]** をクリックして、手順 1. で作成した Azure SQL Database サーバーに接続します。


![alt text](./media/sql-database-migration-wizard/07MigrationWizard.png)


& nbsp;9.次の手順では、スクリプトの実行対象となるデータベースを選択します。サーバー上のすべての既存のデータベースが表示されます。手順 1. で作成したデータベースを選択します。データベースは空で、この操作に適した価格レベルが設定されている必要があります。必要に応じて、この時点でウィザードを使用してデータベースを作成できます。そのためには、[データベースを作成する] をクリックしてデータベースの構成と作成を実行します。移行プロセス中に使用するパフォーマンス レベルを選択する方法のガイダンスについては、概要に関するセクションを参照してください。データベースが作成されたら、データベースを選択して作業を続けます。


& nbsp;10.空のデータベースを選択し、**[次へ]** をクリックします。次に、スクリプトを実行して移行操作を実行することを確認します。

 

<!---HONumber=Oct15_HO3-->