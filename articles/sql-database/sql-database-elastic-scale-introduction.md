<properties 
    pageTitle="Azure SQL Database - エラスティック データベース ツール" 
    description="エラスティック データベース ツールを使用して、クラウド内のデータベース リソースを簡単に拡大します。" 
    services="sql-database" 
    documentationCenter="" 
    manager="jeffreyg" 
    authors="sidneyh" 
    editor=""/>

<tags 
    ms.service="sql-database" 
    ms.workload="sql-database" 
    ms.tgt_pltfrm="na" 
    ms.devlang="na" 
    ms.topic="article" 
    ms.date="04/24/2015" 
    ms.author="sidneyh"/>

# Azure SQL Database - エラスティック データベース ツール

## 約束と課題

Azure SQL Database は、実質的に無制限のデータベース リソースを提供すると共に、トランザクション ワークロードに弾力性を与えます。この機能は、**エラスティック データベース クライアント ライブラリ**や**分割/マージ ツール**などの機能 (**エラスティック データベース ツール**とも呼ばれる) によって簡単に有効にすることができます。このようなコンポーネントは、この記事で説明するシャード化データベース ソリューションの開発および管理を簡略化できる設計になっています。

クラウド アプリケーションの弾力性とスケールを達成することは、コンピューティングおよび BLOB ストレージに対しては簡単でしたが、リレーショナル データベースでのステートフルなデータ処理に対しては課題が残っています。この課題は、次の 2 つのシナリオで顕著に現れます。

* ワークロードのリレーショナル データベース部分の容量の拡張および縮小。
* 特に負荷の高いエンド ユーザー (テナント) など、データの特定のサブセットに影響を及ぼす可能性があるホットスポットの管理。

これまで、このようなシナリオには、大規模なデータベース サーバーに投資を行ってアプリケーションをサポートすることで、対処してきました。ただし、この方法には、すべての処理が事前に定義済みのコモディティ ハードウェアで実行されるクラウドでは限りがあります。そこで、同じ構造を持つ多くのデータベース間でデータを分散し処理を行う手法 (シャーディングと呼ばれているスケールアウト パターン) が、コストと弾力性の両方の面で従来のスケールアップ アプローチに代わる説得力のある選択肢となります。

Azure SQL Database のエラスティック データベース機能を使用すれば、従来に比べてスケールアウトが簡単になり、柔軟性が向上します。サービス アプリケーションとしてのソフトウェアを開発する場合、**エラスティック データベース プール**では、エンドユーザーまたはテナントごとに個別のデータベースを簡単に作成することができるので、各々が予測可能な予算を維持しながら、リソース フット プリントの拡大・縮小を動的かつ自動的に行えるようになります。**エラスティック データベース ジョブ**では、スキーマの変更や資格情報の管理など、目的のデータベース メンテナンス操作を行う T-SQL スクリプトを実行することにより、データベース セット全体にわたるスケールで管理操作を確実に実行することができます。エラスティック データベース ジョブの詳細については、「[エラスティック データベース ジョブの概要](sql-database-elastic-jobs-overview.md)」を参照してください。

テナントごとに別々のデータベースを使用するのか、それともデータの複数の範囲をデータベースのコレクションのそれぞれにパックするのかに関係なく、エラスティック データベース クライアント ライブラリと分割/マージ ツールでは、シャーディングを利用するアプリケーションの構築および管理に必要な労力が削減されます。クライアント ライブラリを使用すれば、データベースにまたがるデータのレイアウトをドキュメント化して適切な場所への接続をルーティングするためのコードを記述することに労力を費やすのではなく、アプリケーションのビジネス ロジックに集中することができます。

## 水平および垂直方向のスケーリング
次の図には、水平および垂直方向のスケーリングを示します。
 
![水平のスケールアウトと垂直のスケールアウト][4]

水平方向のスケーリングとは、容量または全体のパフォーマンスを調整するためにデータベースを追加または削除することを意味します。「スケール アウト」と呼ばれることがよくあります。シャーディングは、水平方向のスケーリングの一般的な手法です。この場合、同じ構造を持つデータベースのコレクション中でデータがパーティション分割されます。

垂直方向のスケーリングとは、個々のデータベースのパフォーマンス レベルを増減することを意味します。「スケール アップ」とも呼ばれます。

ほとんどのクラウド規模のデータベース アプリケーションでは、この 2 つの手法を組み合わせて使用しています。たとえば、サービス アプリケーションとしてのソフトウェアでは、水平方向のスケーリングを使用して新しいエンド ユーザーをプロビジョニングし、垂直方向のスケーリングを使用して、各エンドユーザーのデータベースがワークロードで必要される条件に応じてリソースを拡大縮小できるようにします。

エラスティック データベース ツールを使用すれば、シャーディング (水平方向のスケーリング インフラストラクチャの処理) に依存するアプリケーションを簡単に構築することができます 。データベース ファミリに対してエラスティック データベース プールを使用すると、垂直方向のスケーリングはシステムによって自動的に処理されます。プールを使用する場合は、システム全体に対する制限と、データベース単位で許可するバリエーションの範囲を設定する必要があります。データベース エディションの変更、またはエラスティック データベース プールに属していないデータベースのリソース レベルの変更は、手動で行うこともできます。たとえば、月末に膨大なデータの流入を処理するための新しいシャードを作成できます。シャードは、新しいデータが到着している間はスケール アップされ、流入が減少するとスケール ダウンされます。

エラスティック データベース プールの詳細については、「[エラスティック データベース プールの概要](sql-database-elastic-pool.md)」を参照してください。

## エラスティック データベース ツールの機能 

シャーディングを使用したスケールアウト アプリケーションの開発、スケーリング、および管理では、開発者と管理者の双方に課題がもたらされます。エラスティック データベース ツールは、この両方のロールの作業を容易にします。下図中の番号は、エラスティック データベース クライアント ライブラリと分割/マージ ツールでサポートされている主な機能の概略を示しています。図は多くのデータベースが存在する環境を示しており、各データベースはシャードに対応しています。ツールは、次の特定の機能を介して、シャード化された Azure SQL DB アプリケーションの開発を容易にします。

ここに使用されている用語の定義については、「[エラスティック データベース ツールの用語集](sql-database-elastic-scale-glossary.md)」を参照してください。

![エラスティック スケールの機能][1]

1.  **シャード マップの管理**: シャード マップの管理は、アプリケーションでシャードに関するさまざまなメタデータを管理する機能です。シャード マップの管理は、エラスティック データベース クライアント ライブラリの機能です。開発者は、この機能を使用して、データベースをシャードとして登録したり、個々のシャーディング キーまたはキー範囲の当該データベースへのマッピングを記述したりできます。さらに、このメタデータを管理して、容量の変更に伴ってデータベースの数および構成を発展させることができます。シャード マップの管理は、お客様がシャーディングを自分で実装するときにアプリケーションに記述する必要があったスケルトン コードの大きな部分を構成します。詳細については、「[シャード マップの管理](sql-database-elastic-scale-shard-map-management.md)」を参照してください。
 
* **データ依存ルーティング**: アプリケーションに要求が送信されるとします。アプリケーションは、要求のシャーディング キー値に基づいてこのキー値のデータを保持している正しいデータベースを識別し、そのデータベースへの接続を開いて要求を処理する必要があります。データ依存ルーティングでは、アプリケーションのシャード マップへの単一の簡単な呼び出しで接続を開くことができます。インフラストラクチャ コードのもう 1 つの領域であるデータ依存ルーティングは、現在、エラスティック データベース クライアント ライブラリの機能でカバーされるようになりました。詳細については、「[データ依存ルーティング](sql-database-elastic-scale-data-dependent-routing.md)」を参照してください。

* **マルチシャード クエリ (MSQ)**: マルチシャード クエリ実行は、要求にいくつか (またはすべて) のシャードが含まれる場合に機能します。マルチシャード クエリは、同じ T-SQL コードをすべてのシャードまたはシャードのセットで実行します。参加しているシャードからの結果は、UNION ALL セマンティクスを使用して全体的な結果セットにマージされます。この機能は、クライアント ライブラリを介して公開され、接続管理、スレッド管理、エラー処理、中間結果処理などの多くのタスクを処理します。MSQ では、最大で数百個のシャードを照会できます。詳細については、「[マルチシャード クエリ実行](sql-database-elastic-scale-multishard-querying.md)」を参照してください。


* **分割/マージ ツール**: シャードレット (テナント) ごとにエラスティック データベース プールに個々のデータベースを割り当てるという単純なモデルを使用しないと決めた場合、アプリケーションでは、容量ニーズがビジネスの勢いに伴って変化したときに複数のデータベースにデータを柔軟に再分散することが必要な場合があります。エラスティック データベース ツールには、お客様側でホストされる分割/マージ ツールが含まれています。このツールは、データの移動も必要な状況で、データ分散の再調整を行い、シャード化されたアプリケーションのホット スポットを管理します。この機能は、異なるデータベース間で必要に応じてシャードレットを移動するための基になる機能の上に構築され、シャード マップの管理と統合されて、一貫したマッピングと正確なデータ依存ルーティング接続を保持します。詳細については、「[エラスティック データベース ツールによる分割とマージ](sql-database-elastic-scale-overview-split-and-merge.md)」を参照してください。

一般に、独自のセマンティクスを持つシャード間操作とは異なり、エラスティック データベース ツールを使用するお客様は、シャードにローカルな操作を送信するときに完全な T-SQL 機能を取得することを期待できます。

## 一般的なシャーディング パターン

**シャーディング**は、同じ構造を持つ大量のデータを数多くの独立したデータベースに分散する手法です。この手法は、エンド ユーザーまたは企業向けにサービスとしてのソフトウェア (SAAS) 製品をサービスで作成するクラウド開発者の間でよく知られています。これらのエンド カスタマーは、多くの場合、"テナント" と呼ばれます。シャーディングは、次のような理由で必要になります。

* データの合計数が多すぎて、単一のデータベースの制約に適合しない 
* ワークロード全体のトランザクションのスループットが 1 つのデータベースの能力を超えている 
* テナントを互いに物理的に独立させる必要があり、テナントごとに別個のデータベースが必要になる 
* コンプライアンス、パフォーマンス、または地理上の理由から、データベースの異なる部分を異なる地理的場所に配置することが必要になる場合がある。 

他のシナリオ (たとえば、分散されたデバイスからのデータの取り込み) では、シャーディングを使用して、一時的に構成されたデータベースのセットに値を入力できます。たとえば、別個のデータベースをそれぞれの日または週専用に使用できます。その場合、シャーディング キーとして (シャード化テーブルのすべての行に存在する) 日付を表す整数を使用できます。アプリケーションは、日付の範囲の情報を取得するクエリを、対象の範囲をカバーするデータベースのサブセットにルーティングする必要があります。
 
シャーディングは、アプリケーションのすべてのトランザクションをシャーディング キーの単一の値に制限できる場合に最適です。これにより、すべてのトランザクションが特定のデータベースにローカルであることが保証されます。

一部のアプリケーションでは、テナントごとに別個のデータベースを作成する最も単純なアプローチが使用されています。これは、分離、バックアップ/復元機能、およびテナントの粒度でリソースのスケーリングを提供する、**単一テナントのシャーディング パターン**です。単一テナントのシャーディングでは、各データベースは特定のテナント ID 値 (または顧客キー値) に関連付けられますが、キーは必ずしもデータ自体に存在する必要はありません。各要求を適切なデータベースにルーティングするのはアプリケーションの役目です。エラスティック データベース クライアント ライブラリを使用すれば、その作業が簡単になります。

![単一テナントをマルチテナント][3]

複数のテナントを別個のデータベースに分離する代わりに、一緒にデータベースにパックするシナリオもあります。これが典型的な**マルチテナントのシャーディング パターン**です。このパターンは、アプリケーションが多数の小さなテナントを管理するという事実の影響を受ける可能性があります。マルチテナントのシャーディングでは、データベース テーブル内の行は、テナント ID を識別するキーまたはシャーディング キーを格納するように設計されます。ここでも、アプリケーション層は、テナントの要求を適切なデータベースにルーティングする役割を負います。これは、エラスティック データベース クライアント ライブラリによってサポートされます。さらに、行レベルのセキュリティを使用して、各テナントがアクセスできる行をフィルター処理することができます。詳細については、「[エラスティック データベース ツールと行レベルのセキュリティを使用したマルチテナント アプリケーション](sql-database-elastic-tools-multi-tenant-row-level-security.md)」を参照してください。マルチ テナントのシャーディング パターンでは、データを複数のデータベース間で再分散することが必要な場合があります。この再分散は、データベース分割/マージ ツールで容易に行うことができます。

[AZURE.INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Anchors-->
<!--Image references-->
[1]: ./media/sql-database-elastic-scale-introduction/overview.png
[2]: ./media/sql-database-elastic-scale-intro/tenancy.png
[3]: ./media/sql-database-elastic-scale-introduction/single_v_multi_tenant.png
[4]: ./media/sql-database-elastic-scale-introduction/h_versus_vert.png
 

<!---HONumber=July15_HO4-->