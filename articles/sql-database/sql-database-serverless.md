---
title: Azure SQL Database サーバーレス (プレビュー) | Microsoft Docs
description: この記事では、新しいサーバーレス コンピューティング レベルについて説明し、既存のプロビジョニング済みコンピューティング レベルと比較します
services: sql-database
ms.service: sql-database
ms.subservice: service
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: oslake
ms.author: moslake
ms.reviewer: sstein, carlrab
manager: craigg
ms.date: 05/11/2019
ms.openlocfilehash: ba79e2b9552f0c27ac11501b2b125a126e40eb1d
ms.sourcegitcommit: f013c433b18de2788bf09b98926c7136b15d36f1
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/13/2019
ms.locfileid: "65551636"
---
# <a name="sql-database-serverless-preview"></a>SQL Database サーバーレス (プレビュー)

## <a name="what-is-the-serverless-compute-tier"></a>サーバーレス コンピューティング レベルとは

SQL Database サーバーレス (プレビュー) は、1 つのデータベースによって 1 秒間に使用されたコンピューティングの量に対して請求されるコンピューティング レベルです。 サーバーレスは、アイドル使用期間後のコンピューティング ウォームアップにおいてある程度の遅延を許容できる一時的な予測できない使用パターンの単一データベースに対して価格とパフォーマンスが最適化されています。

サーバーレス コンピューティング レベルのデータベースは、使用できるコンピューティング範囲と自動一時停止遅延でパラメーター化されます。

![サーバーレスの請求](./media/sql-database-serverless/serverless-billing.png)

### <a name="performance"></a>パフォーマンス

- `MinVcore` と `MaxVcore` は、データベースに使用可能なコンピューティング キャパシティの範囲を定義する構成可能なパラメーターです。 メモリと IO の上限は、指定された仮想コアの範囲に比例します。  
- 自動一時停止遅延は、データベースが自動的に一時停止するために必要な非アクティブ期間を定義する構成可能なパラメーターです。 次のログインが発生すると、データベースは自動的に再開されます。

### <a name="pricing"></a>価格

- サーバーレス データベースの合計請求額は、コンピューティング料金とストレージ料金の合計です。
コンピューティングの料金は、使用された仮想コアの量と、1 秒間に使用されたメモリの量に基づきます。
- コンピューティングの最小請求額は、最小の仮想コア数と最小のメモリに基づきます。
- データベースが一時停止している間は、ストレージのみが課金されます。

## <a name="scenarios"></a>シナリオ

サーバーレスは、アイドル使用期間後のコンピューティング ウォームアップにおいてある程度の遅延を許容できる一時的な予測できない使用パターンの単一データベースに対して価格とパフォーマンスが最適化されています。 これに対し、プロビジョニング済みコンピューティング レベルは、コンピューティング ウォームアップの遅延を許容できない平均的に使用量が多い単一データベースまたはプールされたデータベースに対して価格とパフォーマンスが最適化されています。

### <a name="scenarios-well-suited-for-serverless-compute"></a>サーバーレス コンピューティングに最適なシナリオ

- 一時的な予測できない使用パターンと非アクティブな期間が混在する単一データベースは、コンピューティングの使用量に対する 1 秒あたりの課金に基づく価格の節約によるメリットがある可能性があります。
- リソース需要の予測が難しく、顧客がサイズ計算をサービスに委任することを好む、単一データベース。
- パフォーマンス レベルが頻繁に変更されるプロビジョニング済みコンピューティング レベルの単一データベース。

### <a name="scenarios-well-suited-for-provisioned-compute"></a>プロビジョニング済みコンピューティングに最適なシナリオ

- コンピューティングの使用量が多く、時間による変動が少ない単一データベース。
- 頻繁なメモリ トリミングまたは一時停止状態からの自動再開での遅延によるパフォーマンスのトレードオフを許容できないデータベース。
- 価格の最適化向上のために 1 台のサーバーに統合してエラスティック プールを使用できる一時的な予測できない使用パターンの複数のデータベース。

## <a name="comparison-with-provisioned-compute-tier"></a>プロビジョニング済みコンピューティング レベルとの比較

次の表は、サーバーレス コンピューティング レベルとプロビジョニング済みコンピューティング レベル間の違いをまとめたものです。

| | **サーバーレス コンピューティング** | **プロビジョニング済みコンピューティング** |
|:---|:---|:---|
|**一般的な使用シナリオ**| 断続的な予測できない使用状況と非アクティブな期間が混在しているデータベース | 使用状況がより一定のデータベースまたはエラスティック プール|
| **パフォーマンス管理作業** |低|高|
|**コンピューティングのスケーリング**|自動|マニュアル|
|**コンピューティングの応答性**|非アクティブな期間の後は低い|即時|
|**請求の最小単位**|1 秒あたり|1 時間あたり|

## <a name="purchasing-model-and-service-tier"></a>購入モデルとサービス レベル

SQL Database サーバーレスは、現在、仮想コア購入モデルの第 5 世代ハードウェアの General Purpose レベルでのみサポートされます。

## <a name="autoscaling"></a>自動スケール

### <a name="scaling-responsiveness"></a>スケーリング応答性

一般に、データベースは、リソースの需要を満たすために十分な容量を備え、`maxVcores` 値によって設定される制限内で要求されたどのようなコンピューティング量に対しても中断することのない、コンピューターで実行されます。 場合によっては、コンピューターが数分以内にリソースの需要を満たすことができない場合、自動的に負荷分散が行われることがあります。 データベースは、接続が切断されるときの操作の最後の短時間を除き、負荷分散の間オンライン状態を維持します。

### <a name="memory-management"></a>メモリ管理

サーバーレス データベースのメモリは、プロビジョニング済みデータベースより頻繁に回収されます。 この動作は、サーバーレスでのコストを管理するために重要です。 プロビジョニング済みコンピューティングとは異なり、CPU またはキャッシュの使用率が低いとき、SQL キャッシュからのメモリはサーバーレス データベースから回収されます。

## <a name="autopause-and-autoresume"></a>自動一時停止と自動再開

### <a name="autopause"></a>自動一時停止

自動一時停止遅延の期間を通して次のすべての条件が満たされた場合、自動一時停止がトリガーされます。

- セッション数 = 0
- CPU = 0 (ユーザー プールで実行されているユーザー ワークロードの場合)

必要な場合に自動一時停止を無効にするオプションが提供されています。

### <a name="autoresume"></a>自動再開

いつでも次の条件のいずれかに該当した場合は、自動再開がトリガーされます。

|機能|自動再開トリガー|
|---|---|
|認証と権限承認|ログイン|
|脅威の検出|データベース レベルまたはサーバー レベルでの脅威検出の設定の有効化/無効化<br>データベース レベルまたはサーバー レベルでの脅威検出の設定の変更|
|データの検出と分類|機密ラベルの追加、変更、削除、表示|
|監査|監査レコードの表示。<br>監査ポリシーの更新または表示|
|データ マスク|データ マスク ルールの追加、変更、削除、表示|
|透過的なデータ暗号化|透過的データ暗号化の状態またはステータスの表示|
|クエリ (パフォーマンス) データ ストア|クエリ ストアの設定の変更または表示、自動チューニング|
|自動調整|自動インデックス作成などの自動調整の推奨事項の適用と検証|
|データベースのコピー|コピーとしてのデータベースの作成<br>BACPAC ファイルへのエクスポート|
|SQL データ同期|構成可能なスケジュールまたは手動で実行される、ハブとメンバー データベースの間の同期|
|特定のデータベース メタデータの変更|新しいデータベース タグの追加<br>最大仮想コア数、最小仮想コア数、自動一時停止遅延の変更|
|SQL Server Management Studio (SSMS)|SSMS バージョン 18 を使用し、サーバーでデータベースの新しいクエリ ウィンドウを開くと、同じサーバーで自動一時停止されていたデータベースが再開します。 この動作は、IntelliSense をオフにした SSMS バージョン 17.9.1 を使用している場合は発生しません。|

### <a name="connectivity"></a>接続

サーバーレス データベースが一時停止された場合、最初のログインでデータベースは再開され、データベースが使用できないことを示すエラーがエラー コード 40613 で返されます。 データベースが再開され後、ログインを再試行して接続を確立する必要があります。 接続再試行ロジックを備えたデータベース クライアントは、変更する必要はありません。

### <a name="latency"></a>Latency

サーバーレス データベースの自動一時停止または自動再開に対する待ち時間は、通常はおよそ 1 分です。

### <a name="feature-support"></a>機能のサポート

次の機能では、自動一時停止と自動再開はサポートされません。 つまり、次の機能のいずれかを使用する場合、データベースの非アクティブな期間に関係なくデータベースはオンラインのままになります。

- geo レプリケーション (アクティブ geo レプリケーションと自動フェールオーバー グループ)
- 長期的なバックアップ保有期間 (LTR)
- SQL データ同期で使用される同期データベース。


## <a name="on-boarding-into-the-serverless-compute-tier"></a>サーバーレス コンピューティング レベルへのオンボーディング

サーバーレス コンピューティング レベルでの新しいデータベースの作成または既存のデータベースの移動は、プロビジョニング済みコンピューティング レベルでの新規データベースの作成と同じパターンに従い、次の 2 つのステップが含まれます。

1. サービス目標名を指定します。 サービス目標では、サービス レベル、ハードウェアの世代、および最大仮想コア数が規定されます。 次の表にサービス目標のオプションを示します。

   |サービス目標名|サービス階層|ハードウェアの世代|最大仮想コア数|
   |---|---|---|---|
   |GP_S_Gen5_1|汎用|第 5 世代|1|
   |GP_S_Gen5_2|汎用|第 5 世代|2|
   |GP_S_Gen5_4|汎用|第 5 世代|4|

2. 必要に応じて、最小仮想コア数と自動一時停止遅延を指定して、既定値を変更します。 これらのパラメーターに対して使用可能な値を次の表に示します。

   |パラメーター|値の選択肢|Default value|
   |---|---|---|---|
   |最小仮想コア数|最大仮想コア数を超えない {0.5、1、2、4} のいずれか|0.5 仮想コア|
   |自動一時停止遅延|最小:360 分 (6 時間)<br>最大:10080 分 (7 日)<br>増分: 約 60 分<br>自動一時停止の無効化: -1|360 分|

> [!NOTE]
> T-SQL を使用して、サーバーレスに既存データベースを移動すること、またはコンピューティング サイズを変更することは、現在はサポートされていませんが、Azure portal または PowerShell を使用して行うことができます。

### <a name="create-new-database-using-the-azure-portal"></a>Azure portal を使用して新しいデータベースを作成する

「[クイック スタート:Azure portal を使用して Azure SQL Database で単一データベースを作成する](sql-database-single-database-get-started.md)」をご覧ください。

### <a name="create-new-database-using-powershell"></a>PowerShell を使用して新しいデータベースを作成する

次の例では、サービス目標名 GP_S_Gen5_4、最小仮想コア数と自動一時停止遅延は既定値で定義されているサーバーレス コンピューティング レベルに、新しいデータベースを作成します。

サーバーレスでは、現在ギャラリーにあるものより新しいバージョンの PowerShell が必要なので、`Update-Module Az.Sql` を実行してサーバーレスが有効な最新のコマンドレットを取得します。

```powershell
New-AzSqlDatabase `
  -ResourceGroupName $resourceGroupName `
  -ServerName $serverName `
  -DatabaseName $databaseName `
  -ComputeModel Serverless `
  -Edition GeneralPurpose `
  -ComputeGeneration Gen5 `
  -MinVcore 0.5 `
  -MaxVcore 2 `
  -AutoPauseDelay 720
```

### <a name="move-existing-database-into-the-serverless-compute-tier"></a>サーバーレス コンピューティング レベルに既存のデータベースを移動する

次の例では、既存の単一データベースを、プロビジョニング済みコンピューティング レベルからサーバーレス コンピューティング レベルに移動します。 この例では、最小仮想コア数、最大仮想コア数、および自動一時停止遅延を明示的に指定します。

```powershell
Set-AzSqlDatabase
  -ResourceGroupName $resourceGroupName `
  -ServerName $serverName `
  -DatabaseName $databaseName `
  -Edition GeneralPurpose `
  -ComputeModel Serverless `
  -ComputeGeneration Gen5 `
  -MinVcore 1 `
  -MaxVcore 4 `
  -AutoPauseDelay 1440
```

### <a name="move-a-database-out-of-the-serverless-compute-tier"></a>サーバーレス コンピューティング レベルからデータベースを移動する

プロビジョニング済みコンピューティング データベースをサーバーレス コンピューティング レベルに移動するのと同じ方法で、サーバーレス データベースをプロビジョニング済みコンピューティング レベルに移動できます。

## <a name="modify-serverless-configuration-parameters"></a>サーバーレスの構成パラメーターを変更する

### <a name="maximum-vcores"></a>最大仮想コア数

最大仮想コア数の変更は、PowerShell の [Set-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/set-azsqldatabase) コマンドと `MaxVcore` 引数を使用して実行します。

### <a name="minimum-vcores"></a>最小仮想コア数

最大仮想コア数の変更は、PowerShell の [Set-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/set-azsqldatabase) コマンドと `MinVcore` 引数を使用して実行します。

### <a name="autopause-delay"></a>自動一時停止遅延

自動一時停止遅延の変更は、PowerShell の [Set-AzSqlDatabase](https://docs.microsoft.com/powershell/module/az.sql/set-azsqldatabase) コマンドと `AutoPauseDelay` 引数を使用して実行します。

## <a name="monitor-serverless-database"></a>サーバーレス データベースを監視する

### <a name="resources-used-and-billed"></a>使用済みおよび請求対象のリソース

サーバーレス データベースのリソースは、次のエンティティにカプセル化されています。

#### <a name="app-package"></a>アプリ パッケージ

アプリ パッケージは、データベースがサーバーレスまたはプロビジョニング済みのどちらのコンピューティング レベルであるかに関係なく、データベースに対する最も外側のリソース管理境界です。 アプリ パッケージには SQL インスタンスと外部サービスが含まれ、両者によって SQL Database のデータベースによって使用されるすべてのユーザー リソースとシステム リソースのスコープが決まります。 外部サービスの例としては、R やフルテキスト検索などがあります。 一般に、アプリ パッケージでの全体的なリソース使用量より、SQL インスタンスの方が優位です。

#### <a name="user-resource-pool"></a>ユーザー リソース プール

ユーザー リソース プールは、データベースがサーバーレスまたはプロビジョニング済みのどちらのコンピューティング レベルであるかに関係なく、データベースに対する最も内側のリソース管理境界です。 ユーザー リソース プールのスコープは、DDL クエリ (CREATE、ALTER など) および DML クエリ (SELECT、INSERT、UPDATE、DELETE など) によって生成されるユーザー ワークロードに対する CPU と IO です。 これらのクエリは、一般に、アプリ パッケージでの使用量の最も大きな割合を表します。

### <a name="metrics"></a>メトリック

|エンティティ|メトリック|説明|Units|
|---|---|---|---|
|アプリ パッケージ|app_cpu_percent|アプリに許可されている最大仮想コア数に対する、アプリによって使用された仮想コア数の割合。|割合|
|アプリ パッケージ|app_cpu_billed|レポート期間中にアプリに対して請求されるコンピューティングの量。 この期間中に支払われる金額は、このメトリックと仮想コアの単位価格の積です。 <br><br>このメトリックの値は、1 秒ごとに使用された CPU とメモリの最大値を時間で集計することによって決定されます。 使用された金額が、最小仮想コア数と最小メモリによって設定されるプロビジョニング済みの最低額より少ない場合、プロビジョニング済みの最低額が請求されます。 請求のために CPU とメモリを比較するため、メモリは GB 単位のメモリ量を仮想コアあたり 3 GB で再スケーリングすることによって、仮想コアの単位に正規化されます。|仮想コア秒数|
|アプリ パッケージ|app_memory_percent|アプリに許可されている最大メモリに対する、アプリによって使用されたメモリの割合。|割合|
|ユーザー プール|cpu_percent|ユーザー ワークロードに許可されている最大仮想コア数に対する、ユーザー ワークロードによって使用された仮想コア数の割合。|割合|
|ユーザー プール|data_IO_percent|ユーザー ワークロードに許可されている最大データ IOPS に対する、ユーザー ワークロードによって使用されたデータ IOPS の割合。|割合|
|ユーザー プール|log_IO_percent|ユーザー ワークロードに許可されている最大ログ MB/秒に対する、ユーザー ワークロードによって使用されたログ MB/秒の割合。|割合|
|ユーザー プール|workers_percent|ユーザー ワークロードに許可されている最大ワーカー数に対する、ユーザー ワークロードによって使用されたワーカー数の割合。|割合|
|ユーザー プール|sessions_percent|ユーザー ワークロードに許可されている最大セッション数に対する、ユーザー ワークロードによって使用されたセッション数の割合。|割合|
____

> [!NOTE]
> Azure portal でのメトリックは、単一データベースのデータベース ウィンドウの **[監視]** で見ることができます。

### <a name="pause-and-resume-status"></a>一時停止と再開の状態

Azure portal では、データベースの状態は、サーバーに含まれるデータベースの一覧が表示される概要ウィンドウで示されます。 データベースの状態は、データベースの概要ウィンドウにも表示されます。

データベースの一時停止と再開の状態を照会するには、次の PowerShell コマンドを使用します。

```powershell
Get-AzSqlDatabase `
  -ResourceGroupName $resourcegroupname `
  -ServerName $servername `
  -DatabaseName $databasename `
  | Select -ExpandProperty "Status"
```

## <a name="resource-limits"></a>リソース制限

リソースの制限については、[サーバーレス コンピューティング レベル](sql-database-vCore-resource-limits-single-databases.md#serverless-compute-tier)に関する記事をご覧ください

## <a name="billing"></a>課金

コンピューティング請求金額は、各秒に使用された CPU およびメモリの最大量です。 CPU とメモリの使用量がそれぞれのプロビジョニング済みの最小量より少ない場合、プロビジョニング済みの量が請求されます。 請求のために CPU とメモリを比較するため、メモリは GB 単位のメモリ量を仮想コアあたり 3 GB で再スケーリングすることによって、仮想コアの単位に正規化されます。

- **請求されるリソース**: CPU とメモリ
- **請求される金額 ($)**: 仮想コア単位価格 * (最小仮想コア数、使用された仮想コア数、最小メモリ GB * 1/3、使用されたメモリ GB * 1/3) のうち最大の値 
- **請求頻度**: 1 秒あたり

1 秒あたり、仮想コアあたりのコストの仮想コア単位価格。 特定のリージョンの特定の単位価格については、[Azure SQL Database の価格に関するページ](https://azure.microsoft.com/pricing/details/sql-database/single/)をご覧ください。

請求されるコンピューティングの金額は、次のメトリックで示されます。

- **メトリック**: app_cpu_billed (仮想コア秒数)
- **定義**: (最小仮想コア数、使用された仮想コア数、最小メモリ GB * 1/3、使用されたメモリ GB * 1/3) のうち最大の値
- **レポート頻度**: 1 分あたり

この量が 1 秒ごとに計算され、1 分間について集計されます。

**例**:GP_S_Gen5_4 を使用するデータベースで、1 時間の使用量が次のような場合について考えます。

|時間 (時:分)|app_cpu_billed (仮想コア秒数)|
|---|---|
|0:01|63|
|0:02|123|
|0:03|95|
|0:04|54|
|0:05|41|
|0:06 - 1:00|1255|
||合計: 1631|

コンピューティングの単位価格は $0.000073/仮想コア/秒とします。 この場合、この 1 時間に対して請求されるコンピューティングは、次の式を使用して決定されます: **$0.000073/仮想コア/秒 * 1631 仮想コア秒数 = $0.1191**

## <a name="available-regions"></a>対応リージョン

サーバーレス コンピューティング レベルは、次のリージョンを除くすべてのリージョンで利用できます: オーストラリア中部、中国東部、中国北部、フランス南部、ドイツ中部、ドイツ北東部、インド西部、韓国南部、南アフリカ西部、英国北部、英国南部、英国西部、および米国中西部

## <a name="next-steps"></a>次の手順

- 使用を開始するには、「[クイック スタート: Azure portal を使用して Azure SQL Database で単一データベースを作成する](sql-database-single-database-get-started.md)」をご覧ください。
- リソースの制限については、[サーバーレス コンピューティング レベルのリソース制限](sql-database-vCore-resource-limits-single-databases.md#serverless-compute-tier)に関する記事をご覧ください。