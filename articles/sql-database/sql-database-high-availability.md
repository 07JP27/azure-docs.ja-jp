---
title: "高可用性 - Azure SQL Database サービス | Microsoft Docs"
description: "Microsoft Azure SQL Database サービスの高可用性機能および特色について説明します。"
keywords: 
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
ms.assetid: 
ms.service: sql-database
ms.custom: 
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: Inactive
ms.date: 12/13/2017
ms.author: sashan
ms.reviewer: carlrab
ms.openlocfilehash: c0a140c959f14c2e8ceaddad5d323f0900be5d2f
ms.sourcegitcommit: fa28ca091317eba4e55cef17766e72475bdd4c96
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/14/2017
---
# <a name="high-availability-and-azure-sql-database"></a>高可用性と Microsoft Azure SQL Database
マイクロソフトは、Azure SQL Database PaaS サービスの開発当初から、お客様が操作したり、特別なロジックを追加したり、高可用性に関する意思決定をしなくても実現できる高可用性 (HA) をサービスに組み込むことをお約束してきました。 マイクロソフトは、お客様に SLA を提供し、HA システム構成および運用を完全に制御します。 HA SLA は、領域内の SQL データベースに適用され、マイクロソフトの妥当な制御の及ばない事象 (自然災害、戦争、テロ行為、暴動、政府の行為、または、お客様の施設、またはお客様の施設とマイクロソフトのデータ センターの間を含む、マイクロソフトのデータ センター外のネットワークまたはデバイスの障害など) に起因する、領域全体の障害の場合の保護は提供できません 。

HA の問題領域を簡略化するため、マイクロソフトは、次の事項を前提条件とします。
1.  ハードウェアおよびソフトウェアの障害は不可避である
2.  障害につながるミスを運用スタッフが犯すことがある
3.  計画的な保守作業によって障害が発生する 

このような事象は頻繁に起こるものではありませんが、クラウド規模では、毎日ではないにしても、週に 1 回は発生する可能性があります。 

## <a name="fault-tolerant-sql-databases"></a>フォールト トレラントの SQL データベース
お客様にとって重要なのは、お客様が使用するデータベースの回復性であり、SQL Database サービス全体の回復性ではありません。 たとえサービスのアップタイムが 99.99% であろうと、0.01% のダウンしているデータベースにお客様のデータベースが含まれていたら、何の意味もありません。 データベース 1 つ 1 つがそれぞれフォールト トレラントである必要があり、フォールト対策によって、コミットされたトランザクションが失われることがあってはなりません。 

Microsoft Azure SQL Database では、直結されたディスク/VHD を使用するローカル ストレージ (LS) と、Azure Premium Storage ページ blob を使用するリモート ストレージ (RS) の両方を使用します。 
- ローカル ストレージは、IOPS の要件の高い OLTP アプリケーション用に設計された Premium データベースとプールで使用されます。 
- リモート ストレージは、ストレージとコンピューティング能力が独立して拡張できる必要がある、小規模または大規模な cold データベース用に設計された、Basic および Standard サービス レベルで使用されます。 データベースおよびログ ファイル用の単一のページ blob と、組込みストレージ レプリケーションおよびフェイルオーバー メカニズムが使用されます。

いずれの場合も、Microsoft Azure SQL Database のレプリケーション、障害検知、およびフェイルオーバー メカニズムは完全に自動化されており、ユーザーが介入しなくても運用できます。 このアーキテクチャの目的は、コミットされたデータを絶対に損失しないことと、データの持続性を最優先することです。

主な利点:
- お客様は、複雑なハードウェア、ソフトウェア、オペレーティング システムまたは仮想化環境を設定したり管理することなく、レプリケートされたデータベースを最大限に活用できます。
- リレーショナル データベースの ACID プロパティは、すべてシステムが管理します。
- フェールオーバーは完全に自動化されており、コミットされたデータの損失は発生しません。
- プライマリ レプリカへの接続のルーティングは、サービスによって動的に管理されるため、アプリケーション ロジックは必要ありません。
- 追加料金なしで、自動化された高度の冗長性が提供されます。

> [!NOTE]
> 説明されている高可用性アーキテクチャは、予告なしに変更される場合があります。 

## <a name="data-redundancy"></a>データの冗長性

Microsoft Azure SQL Database の高可用性ソリューションは、SQL Server の [AlwaysON](/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server) テクノロジを使用し、LS データベースと RS データベースの違いが最小限に抑えられているため、いずれのデータベースでも動作します。 AlwaysON は、LS 構成では永続化のために使用され、RS では可用性 (低 RTO) のために使用されます。 

## <a name="local-storage"></a>ローカル ストレージ

LS データベースの場合は、各データベースは、制御リング内の管理サービス (MS) によってオンラインになります。 1 つのプライマリ レプリカと 2 つ以上のセカンダリ レプリカ (クォーラム セット) は、同じデータ センター内の 3 つの独立した物理サブシステムにまたがるテナント リング内に存在します。 すべて読み取りおよび書き込み操作は、プライマリ レプリカへのゲートウェイ (GW) によって送信され、書き込み操作はセカンダリ レプリカに非同期的にレプリケートされます。 Microsoft Azure SQL Database は、トランザクションがコミットされる前に、データがプライマリ レプリカと 1 つ以上のセカンダリ レプリカに書き込まれる、クォーラム ベースのコミット スキームを使用します。

ノードで障害が発生すると、[Service Fabric](/azure/service-fabric/service-fabric-overview.md) フェールオーバー システムは自動的にレプリカを再構築し、ノードが離れシステムに加わる間、クォーラム セットのメンバーシップを保持します。 計画的なメンテナンスは、クォーラム セットがレプリカ最小数 (通常、2) を下回らないよう慎重に調整されます。 このモデルは Premium データベースに適していますが、コンピューティングとストレージの両方のコンポーネントで冗長性を必要とするため、コストが高くなります。

## <a name="remote-storage"></a>リモート ストレージ

リモート ストレージの構成 (Basic および Standard レベル) の場合、リモート blob ストレージにデータベースのコピーが 1 つのみ保持され、ストレージ システムが提供する、持続性、冗長性、およびビット崩壊検出機能を活用できます。 

高可用性アーキテクチャを、次の図に示します。
 
![高可用性アーキテクチャ](./media/sql-database-high-availability/high-availability-architecture.png)

## <a name="failure-detection--recovery"></a>障害の検出と回復 
大規模な分散システムでは、障害を確実にすばやく、そしてお客様にできるだけ近い箇所で検出できる、高信頼性の障害検出システムが必要です。 Microsoft Azure SQL Database の場合、このシステムは Azure Service Fabric を使用します。 

プライマリ レプリカを使用すると、すべての読み取りよび書き込み操作がまずプライマリ レプリカ上で行われるため、プライマリ レプリカで障害が発生し、作業が継続できない場合は、障害が起こったことと、いつ発生したかが、すぐに明らかになります。 セカンダリ レプリカをプライマリ ステータスに昇格させるこのプロセスには、目標復旧時間 (RTO) = 30 秒と目標復旧時点 (RPO) = 0 を使用します。 30 秒 RTO の影響を軽減するベスト プラクティスは、待機時間を短くして再接続の試行を続けることです。

セカンダリ レプリカで障害が発生した場合、データベースのクォーラム セットは最低限まで下がり、スペアがなくなります。 サービス ファブリックは、プライマリ レプリカで障害が発生した場合と類似した再構成プロセスを開始し、障害が恒久的なものかどうか判断するために待機した後、セカンダリ レプリカを作成します。 オペレーティング システムの障害やアップグレードなどの一時的なサービス停止の場合、新しいレプリカはすぐには構築されず、停止したノードが再起動されます。 

リモート ストレージ構成の場合は、Microsoft Azure SQL Database は、アップグレード中にフェールオーバー データベースに対し AlwaysON 機能を使用します。 このために、計画的なアップグレード イベントの一部として新しい SQL インスタンスが事前に派生され、リモート ストレージからデータベース ファイルを回復し添付します。 プロセスがクラッシュまたは計画外のその他のイベントが発生した場合、Windows Fabric は、回復の最後の手順としてインスタンスの可用性を管理し、リモート データベース ファイルを添付します。

## <a name="conclusion"></a>まとめ
Azure SQL DB は、Azure プラットフォームと緊密に統合されており、障害の検出と復旧に Service Fabric を、データ保護に Azure Storage Blob を活用します。 同時に、Azure SQL データベースは、レプリケーションとフェールオーバーのための SQL Server 既成製品からの AlwaysOn テクノロジを使用します。 これらのテクノロジを組み合わせることにより、アプリケーションは混合ストレージ モデルを最大限に活用して、高要件の SLA にも対応できます。 

## <a name="next-steps"></a>次のステップ

- [Service Fabric](/azure/service-fabric/service-fabric-overview.md) の詳細
- [Azure Traffic Manager](/traffic-manager/traffic-manager-overview.md) の詳細 
