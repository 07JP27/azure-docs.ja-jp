<properties 
   pageTitle="Azure SQL Database Index Advisor" 
   description="Azure SQL Database Index Advisor は、現在のクエリのパフォーマンスを向上できる、既存の SQL Database に向けた新しいインデックスを推奨します。" 
   services="sql-database" 
   documentationCenter="" 
   authors="stevestein" 
   manager="jeffreyg" 
   editor="monicar"/>

<tags
   ms.service="sql-database"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="data-management" 
   ms.date="01/23/2016"
   ms.author="sstein"/>

# SQL Database Index Advisor

Azure SQL Database Index Advisor は、現在のクエリのパフォーマンスを向上できる、既存の SQL データベースに向けた推奨インデックスを提供します。SQL Database サービスは、SQL データベースの使用履歴を分析することで、インデックスのパフォーマンスを評価します。これにより、データベースの一般的なワークロードを実行するのに最適なインデックスが推奨されます。

Index Advisor は、次の処理によって、データベースのパフォーマンスを最適化するのに役立ちます。

- 作成するインデックスに関する推奨事項を提供する (推奨事項は非クラスター化インデックスにのみ使用できます)。
- 削除するインデックスに関する推奨事項を提供する (インデックスの削除に関する推奨事項はプレビュー段階であり、現時点では、重複するインデックスのみに適用されます)。
- ユーザーが介入することなく自動的に推奨インデックスを適用することを選択できるようにする (推奨インデックスの自動化には、[クエリ ストア](https://msdn.microsoft.com/library/dn817826.aspx)を有効にして実行しておく必要があります)。
- パフォーマンスに悪影響を与える推奨インデックスを自動的にロールバックする。 


この記事では、V12 サーバー向けの Index Advisor について説明します。推奨インデックスは V11 サーバーで利用できますが、提供された Transact-SQL (T-SQL) スクリプトを実行して推奨インデックスを実装する必要があります。アドバイザーが V11 サーバー上でのインデックス操作を元に戻すことはないため、パフォーマンスへの影響を監視して、必要に応じて操作を元に戻す必要があります。


### アクセス許可

推奨インデックスを表示し作成するには、Azure における適切な [ロールベースのアクセス制御](../active-directory/role-based-access-control-configure.md)権限が必要です。

- 推奨インデックスを表示するには、**リーダー**権限と **SQL DB の共同作成者**権限が必要です。
- インデックスの作成またはドロップおよびインデックス作成のキャンセルなどのアクションを実行するには、**所有者**権限と **SQL DB の共同作成者**権限が必要です。


## 推奨インデックスの表示

[推奨インデックス] ページには、パフォーマンスの向上につながる可能性が高い順に推奨されるインデックスが表示されます。さらに、直前に行ったいくつかのインデックス操作の状態も確認できます。推奨インデックスまたは状態を選択すると、その詳細が表示されます。

推奨インデックスを表示するには、次の手順に従います。

1. [Azure ポータル](https://portal.azure.com/)にサインインします。
2. **[参照]**、**[SQL データベース]** の順にクリックし、ご使用のデータベースを選択します。
5. **[すべての設定]**、**[Index Advisor]** の順にクリックし、選択したデータベースで使用できる**推奨インデックス**を表示します。

> [AZURE.NOTE] 推奨インデックスを得るには、データベースを約 1 週間使用し、さらにその週内にいくつかのアクティビティを行う必要があります。さらに、一貫性のアクティビティも行う必要もあります。Index Advisor は、ランダムでむらのある瞬間的なアクティビティよりも一貫性のあるアクティビティのクエリ パターンをより簡単に最適化できます。推奨インデックスを使用できない場合は、**[推奨インデックス]** ページに、その理由を説明するメッセージが表示されます。

![推奨インデックス](./media/sql-database-index-advisor/recommendations.png)

お勧め候補は、パフォーマンスへの潜在的な影響ごとに、次の 4 つのカテゴリに並べ替えられます。

| 影響 | 説明 |
| :--- | :--- |
| 高 | 高い影響を及ぼすお勧め候補は、パフォーマンスに最も重要な影響を与えます。 |
| 相当 | 相当な影響を及ぼすお勧め候補は、パフォーマンスを著しく向上します。 |
| 中 | 中程度の影響を及ぼすお勧め候補は、パフォーマンスを向上しますが、それほど著しい向上ではありません。 |
| 低 | 低いの影響を及ぼすお勧め候補は、インデックスのない場合よりも優れたパフォーマンスを提供しますが、重要ではない可能性があります。 
新しいインデックスを作成するための最適な候補を判断するには、影響に関するタグを使用します。


### 一覧から推奨インデックスを削除する

推奨されるインデックスの一覧に、削除したいインデックスが含まれている場合は、推奨インデックスを破棄できます。

1. **[推奨されるインデックス]** の一覧にある推奨インデックスを選択します。
2. **[インデックスの詳細]** ブレードの **[インデックスを破棄]** をクリックします。


必要な場合は、破棄したインデックスをもう一度 **[推奨されるインデックス]** の一覧に追加できます。

1. **[推奨インデックス]** ブレードで **[破棄した推奨インデックスを表示]** をクリックします。
1. 破棄したインデックスを一覧から選択し、その詳細を表示します。
1. 必要に応じて、**[破棄を元に戻す]** をクリックしてインデックスを **[推奨インデックス]** の主な一覧に戻します。



## 推奨インデックスの適用

Index Advisor では、次の 3 つのオプションのいずれかを使用して、推奨インデックスを有効にする方法を完全に制御できます。

- 個々の推奨インデックスを 1 つずつ適用する。
- Index Advisor が推奨インデックスを自動的に適用できるようにする。
- 推奨される T-SQL スクリプトをデータベースに対して手動で実行して推奨インデックスを実装する。

任意の推奨インデックスを選択すると、その詳細が表示されます。その後、**[スクリプトの表示]** をクリックして、推奨インデックスの作成方法の詳細を確認します。

アドバイザーによって推奨インデックスが適用される間、データベースはオンラインのままです。つまり、Index Advisor を使用することでデータベースがオフラインになることはありません。

### 個々の推奨インデックスを適用する

推奨インデックスは、1 つずつ確認して受け入れることができます。

1. **[推奨インデックス]** ブレードで、推奨インデックスをクリックします。
2. **[インデックスの詳細]** ブレードで、**[適用]** をクリックします。

    ![Apply recommendation](./media/sql-database-index-advisor/apply.png)


### インデックスの自動管理を有効にする

推奨インデックスを自動的に実装するように Index Advisor を設定できます。推奨インデックスは、利用可能になると自動的に適用されます。サービスによって管理されるすべてのインデックス操作と同様に、パフォーマンスに悪影響が生じる場合は、推奨インデックスは元に戻されます。

1. **[推奨インデックス]** ブレードで、**[アドバイザーの設定]** をクリックします。

    ![Advisor settings](./media/sql-database-index-advisor/settings.png)

2. インデックスを自動的に**作成**または**削除**するようにアドバイザーを設定します。

    ![推奨インデックス](./media/sql-database-index-advisor/automation.png)




### 推奨される T-SQL スクリプトを手動で実行する

任意の推奨インデックスを選択し、**[スクリプトの表示]** をクリックします。データベースに対してこのスクリプトを実行し、推奨インデックスを手動で適用します。

*手動で実行されたインデックスは、パフォーマンスへの影響についてサービスによる監視や検証が行われません。*そのため、作成後にこれらのインデックスを監視して、パフォーマンスが向上するかどうかを検証し、必要に応じて調整または削除することをお勧めします。インデックスの作成方法の詳細については、「[CREATE INDEX (TRANSACT-SQL)](https://msdn.microsoft.com/library/ms188783.aspx)」を参照してください。


### インデックス作成を取り消す

**[保留中]** 状態にあるインデックスを取り消すことができます。作成中のインデックス (**[実行中]** の状態) はキャンセルできません。

1. **[インデックス操作]** 領域にある任意の **[保留中]** のインデックスを選択して、**[インデックスの詳細]** ブレードを開きます。
2. **[キャンセル]** をクリックすると、インデックス作成の処理が中止されます。



## インデックス操作の監視

推奨インデックスの適用は、瞬時に行われない場合があります。ポータルには、インデックス操作の状態に関する詳細情報が表示されます。インデックスを管理しているとき、インデックスは次のいずれかの状態になります。

| 状態 | 説明 |
| :--- | :--- |
| Pending | インデックスの作成コマンドが受信され、インデックスの作成が予定されています。 |
| を実行しています | Create index コマンドの実行中で、インデックスを現在作成中です。 |
| 成功 | インデックスが正常に作成されました。 |
| Failed | インデックスが作成されていません。一時的な問題か、またはテーブルおよびスクリプトへのスキーマの変更が無効になっている可能性があります。 |
| 復元 | インデックス作成の処理が取り消されたか、または実行されないと見なされたため自動的に元に戻されています。 |

一覧内で処理中の推奨インデックスをクリックすると、その詳細が表示されます。

![推奨インデックス](./media/sql-database-index-advisor/operations.png)



### インデックスを元に戻す

アドバイザーを使用してインデックスを作成した場合 (つまり、T-SQL スクリプトを手動で実行していない場合)、パフォーマンスへの悪影響が見つかるとインデックスは自動的に元に戻されます。何らかの理由で Index Advisor の操作を元に戻すには、次の手順を実行します。


1. **[インデックス操作]** の一覧で、正常に作成されたインデックスを選択します。
2. **[インデックスの詳細]** ブレードで **[元に戻す]** をクリックするか、または **[スクリプトの表示]** をクリックして実行可能な DROP INDEX スクリプトを表示します。

![推奨インデックス](./media/sql-database-index-advisor/details.png)


## 推奨インデックスによるパフォーマンスへの影響の監視

推奨インデックスが正常に実装されたら、[インデックスの詳細] ブレードの **[クエリの洞察]** をクリックして [Query Performance Insight](sql-database-query-performance.md) を開き、よく使用されるクエリによるパフォーマンスへの影響を確認します。

![Monitor performance impact](./media/sql-database-index-advisor/query-insights.png)


## 概要

Index Advisor は、推奨インデックスに加え、SQL データベースのインデックスを管理するための自動化されたエクスペリエンスを提供します。Index Advisor は、T-SQL スクリプトのほか、インデックスの個別管理オプションと完全自動管理オプションが備わっているため、データベースのインデックスを最適化して最終的にクエリ パフォーマンスを向上させるのに役立ちます。



## 次のステップ

推奨インデックスを監視し、引き続きパフォーマンスの調整対象とします。データベースのワークロードは動的であり、継続的に変化します。Index Advisor では、お使いのデータベースのパフォーマンスを向上させる可能性があるインデックスの監視と推奨を継続します。

<!---HONumber=AcomDC_0224_2016-->