<properties 
	pageTitle="DocumentDB の容量とパフォーマンスの管理 | Azure" 
	description="アプリケーションの容量のニーズを満たすために DocumentDB を柔軟に拡張する方法について説明します。" 
	services="documentdb" 
	authors="mimig1, johnfmacintyre" 
	manager="jhubbard" 
	editor="cgronlun" 
	documentationCenter=""/>

<tags 
	ms.service="documentdb" 
	ms.workload="data-services" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="03/17/2015" 
	ms.author="mimig"/>

#DocumentDB の容量とパフォーマンスの管理
DocumentDB は、完全に管理された、拡張性の高いドキュメント志向の NoSQL データベース サービスです。DocumentDB 内では、仮想マシンのレンタル、ソフトウェアのデプロイ、データベースの監視などを行ったり、障害復旧の心配をしたりする必要はありません。Microsoft のエンジニアによって運用され、継続的な監視が行われる DocumentDB は、卓越した可用性、パフォーマンス、データ保護を提供します。  

DocumentDB の使用を開始するには、[Microsoft Azure プレビュー管理ポータル](https://portal.azure.com/)でデータベース アカウントを作成します。DocumentDB は、ソリッド ステート ドライブ (SSD) ベースのストレージとスループットから構成される、スタック可能な容量単位 (CU) で提供されます。お客様は、アプリケーションのパフォーマンスとストレージのニーズに合わせて DocumentDB を柔軟に拡張できます。 

各容量単位には、ドキュメント データを格納するためのコレクションのクォータ、プロビジョニング済みドキュメント ストレージ、およびプロビジョニング済みスループット (1 秒あたりの要求単位) が設定されています。アプリケーションの容量要件が変化した場合は、データベース アカウントのプロビジョニング済み容量を拡大または縮小できます。データベース アカウントにプロビジョニングされた容量は、既に存在するかまたはそのアカウントに作成されるすべてのデータベースとコレクションで使用できます。

> [AZURE.NOTE] 各コレクションは、サポートされている[制限](documentdb-limits.md)の最大値まで、ストレージとスループットの両方を拡張できます。スループットはコレクションあたりの制限の最大値まで、すべてのコレクションに均等に分配されます。

1 つ以上のコレクションでアプリケーションがパフォーマンス レベルを超えると、コレクションごとに要求が調整されます。つまり、アプリケーションの要求が成功する場合と調整される場合があります。

##<a name="DBaccount"></a>データベース アカウントと管理リソース
Azure の利用者であるお客様は、1 つまたは複数の DocumentDB データベース アカウントをプロビジョニングできます。各データベース アカウントには、データベース、ユーザー、アクセス許可を含む管理リソースのクォータが設定されます。これらのリソースは、[制限とクォータ](documentdb-limits.md)の影響を受けます。追加の管理リソースが必要な場合は、サポートにお問い合わせください。   

##<a name="DBstorage"></a> ドキュメント ストレージが無制限のデータベース
1 つの DocumentDB データベースには、実質的に容量が無限の、コレクション別に区切られたドキュメント ストレージを格納できます。コレクションは、その中に含まれているドキュメントのトランザクション ドメインを構成します。DocumentDB データベースは、既定で高い柔軟性を持ち、数 GB から場合によっては数テラバイトに上る SSD ベースのドキュメント ストレージとプロビジョニング済みスループットが用意されています。従来の RDBMS データベースとは異なり、DocumentDB のデータベースはその範囲が単一のコンピューターに制限されません。   

DocumentDB では、アプリケーションの規模を拡大することが必要になった時点で、さらに多くのコレクション、データベース、またはその両方を作成できます。実際、Microsoft 社内のさまざまなファースト パーティ アプリケーションでは、それぞれ数千個のコレクションと数テラバイトのドキュメント ストレージを含むきわめて大規模な DocumentDB データベースを作成することにより、コンシューマー規模で DocumentDB を使用しています。データベースは、アプリケーションの規模要件に合わせてコレクションを追加または削除することにより、拡大または縮小できます。データベース サブジェクト内では、可用性と購入した容量単位の量に合わせて、任意の数のコレクションを作成できます。お客様向けにプロビジョニングされた SSD ベースのストレージおよびスループットは、データベース アカウントのデータベースで複数のコレクションにわたって利用できます。 

##<a name="DBCollections"></a>データベース コレクション
各 DocumentDB データベースには 1 つまたは複数のコレクションを格納できます。コレクションは、ドキュメント ストレージとクエリ実行のスコープを提供します。コレクションは、そこに含まれるすべてのドキュメントのトランザクション ドメインでもあります。アプリケーションの規模要件に合わせて任意の数のコレクションを作成できます。コレクションを作成するには、最初に 1 つまたは複数の容量単位 (CU) を購入する必要があります。各容量単位には、コレクションのクォータが含まれています。アカウントのコレクション クォータに達したら、追加の容量単位を購入できます。  

>[AZURE.NOTE] 各コレクションは、最大 10 GB のドキュメント データのストレージをサポートします。 

##<a name="ProvStorage"></a>容量単位としてのプロビジョニング済みストレージとスループット
SSD ベースのドキュメント ストレージとスループットから構成されるスタック可能な単位を容量単位 (CU) としてプロビジョニングできます読み取り規模、ストレージ、およびスループットに関するアプリケーションのニーズに合わせてより多くの容量単位を購入することにより、予測可能なパフォーマンスで DocumentDB を柔軟に拡大できます。  
 
各 CU には、3 つの柔軟なコレクション、10 GB の SSD ベースのプロビジョニング済みドキュメント ストレージ、2,000 要求単位 (RU) のプロビジョニング済みスループットが用意されています。CU に関連付けられたプロビジョニング済みストレージおよびスループット容量は、お客様が作成した DocumentDB コレクション間で配分されます。   

##<a name="ProvThroughput"></a>要求単位とデータベース操作
DocumentDB では、UDF、ストアド プロシージャ、トリガーを使用したリレーショナル クエリと階層クエリなど、さまざまなデータベース操作をデータベース コレクション内のドキュメントに対して実行できます。これらの各操作に関連付けられる処理コストは、CPU、IO、操作の完了に必要なメモリによって異なります。ハードウェア リソースの管理について考える代わりに、各種のデータベース操作を実行しアプリケーション要求を処理するのに必要なリソースに関する単一の測定単位として要求単位 (RU) を考えることができます。

要求単位は、お客様が購入した容量単位に基づいて、それぞれのデータベース アカウントにプロビジョニングされます。DocumentDB のプレビューでは、作成された各コレクションに要求単位の制限が割り当てられます。割り当ては、アカウント内に作成されたコレクションの数に対して、購入された容量単位からすべての要求単位を均等に割り当てることによって計算されます。たとえば、2 容量単位が購入され、4 コレクションが作成されたアカウントでは、各コレクションに割り当てられるのは、2 容量単位 x 2,000 要求単位 / 4 コレクションで求められ、コレクションごとに 1,000 要求単位となります。Azure DocumentDB が一般公開となった後は、アカウント内のコレクションに対して要求単位が振り分けられることはありません。要求単位が購入されると、パフォーマンス レベルに基づいて特定のコレクションに割り当てられます。詳細については、[DocumentDB のパフォーマンス レベル](documentdb-performance-levels.md)に関する記事を参照してください。 

>[AZURE.NOTE] Azure DocumentDB のプレビューでは、各コレクションに 2,000 を超える要求単位を割り当てることはできません。 

要求単位の消費は、1 秒あたりのレートとして評価されます。アカウントのプロビジョニング済み要求単位レートを超過するアプリケーションは、レートが各コレクションに予約されているレベル以下になるまで制限されます。アプリケーションでより高いスループットが必要になった場合は、追加の容量単位を購入できます。

要求単位は、要求の処理コストを標準化した測定単位です。1 つの要求単位は、10 個の一意のプロパティ値で構成される 1 KB JSON ドキュメントの読み取りに必要な処理能力を表します。要求単位の負担は、整合性レベルが既定の "セッション" に設定され、すべてのドキュメントに自動的にインデックスが作成されることを前提としています。同じドキュメントを挿入、置換、または削除する要求では、必要になるサービスの処理が多くなるため、使用される要求単位も多くなります。各サービスからの要求応答には、要求で使用される要求単位を測定するカスタム ヘッダー (x-ms-request-charge) が含まれます。このヘッダーには、SDK を介してアクセスすることもできます。.Net SDK では、RequestCharge は ResourceResponse オブジェクトのプロパティです。

DocumentDB データベース アカウントに対する操作に使用される要求単位に影響を及ぼす要因はいくつかあります。その要因には次のものがあります。

- ドキュメントのサイズ - ドキュメントのサイズが増大すると、データの読み取りまたは書き込みに使用される単位も増加します。
- プロパティ数 - すべてのプロパティに既定でインデックスが作成されると想定すると、プロパティ数の増加に伴って、ドキュメントの書き込みに使用される単位が増加します。
- データの整合性 - Strong または Bounded Staleness のデータの整合性レベルを使用すると、ドキュメントの参照に使用される単位が増加します。
- インデックス付きプロパティ - 各コレクションのインデックス ポリシーによって、既定でインデックスが作成されるプロパティが決まります。インデックス付きプロパティの数を制限することで、使用する要求単位を削減できます。
- ドキュメントのインデックス作成 - 各ドキュメントには既定で自動的にインデックスが作成されます。一部のドキュメントにインデックスを作成しないようにすると、使用される要求単位が少なくなります。

クエリ、ストアド プロシージャ、トリガーは、実行する操作の複雑さに基づいて要求単位を使用します。アプリケーションを開発するときは、ヘッダーを調べて、各操作で使用される要求単位の量を詳しく把握するようにしてください。

##<a name="Collections"></a>コレクションとプロビジョニング済みスループット
データベース アカウントのプロビジョニング済みスループットは、単一のコレクションの最大スループット レベル (要求単位) に達するまで、すべてのコレクションにわたって均一に割り当てられます。たとえば、単一の容量単位を購入し、単一のコレクションを作成した場合、その CU のプロビジョニング済みスループットのすべてがそのコレクションで使用されます。コレクションをもう 1 つ作成した場合、プロビジョニング済みスループットはそれぞれのコレクションに均等に割り当てられるため、それぞれに全プロビジョニング済みスループットの半分が割り当てられます。  

##<a name="Consistency"></a>整合性レベルの選択とスループット
既定の一貫性レベルの選択内容により、スループットと待機時間が影響を受けます。既定の一貫性レベルは、プログラムで設定することも Azure ポータルを通じて設定することもできます。また、要求ベースで一貫性レベルをオーバーライドすることもできます。既定の一貫性レベルは、モノトニックな読み取り/書き込みおよび書き込みの読み取り保証を提供する "Session" 一貫性レベルとなります。"Session" 整合性レベルは、ユーザー中心のアプリケーションに効果的で、整合性とパフォーマンスのトレードオフが優れたバランスで実現されます。    

Azure プレビュー管理ポータルで整合性レベルを変更する手順については、「[DocumentDB アカウントの管理方法](documentdb-manage-account.md)」で、DocumentDB 整合性の管理に関するセクションを参照してください。

##<a name="IndexOverhead"></a>プロビジョニング済みドキュメント ストレージとインデックス オーバーヘッド
購入した CU ごとに、10 GB の SSD ベースのドキュメント ストレージがアカウントにプロビジョニングされます。10 GB のドキュメント ストレージには、ドキュメントとインデックス用のストレージが含まれます。既定では、DocumentDB コレクションは、セカンダリ インデックスまたはスキーマを明示的に必要とすることなくすべてのドキュメントのインデックスを自動的に作成するように構成されます。DocumentDB を使用するコンシューマー規模のファースト パーティ アプリケーションでの本番運用に基づくと、一般的なインデックス オーバーヘッドは 2 ～ 20% です。DocumentDB で使用しているインデックス作成テクノロジにより、既定の設定では、プロパティの値に関係なく、インデックス オーバーヘッドがドキュメント サイズの 80% を超えることはありません。  

既定では、DocumentDB によって自動的にすべてのドキュメントのインデックスが作成されます。ただし、インデックス オーバーヘッドを調整する場合は、ドキュメントの挿入時または置換時におけるインデックス作成の対象から特定のドキュメントを除外することができます。コレクション内のすべてのドキュメントをインデックス作成の対象から除外するように DocumentDB コレクションを構成できます。また、JSON ドキュメントのワイルドカードを使用して特定のプロパティまたはパスに関してのみ選択的にインデックスを作成するように DocumentDB コレクションを構成することもできます。プロパティまたはドキュメントを除外すると書き込みスループットが向上し、消費する要求単位が少なくなります。   
 
##<a name="NextSteps"></a>次のステップ
Azure プレビュー ポータルで DocumentDB アカウントを管理する手順については、「[DocumentDB アカウントの管理方法](documentdb-manage-account.md)」で、DocumentDB 整合性の管理に関するセクションを参照してください。

Azure プレビュー ポータルでパフォーマンス レベルを監視する手順については、「[DocumentDB アカウントを監視する](documentdb-monitor-accounts.md)」を参照してください。

<!--HONumber=49--> 