<properties title="Integrate your Azure Website with an Azure Virtual Network" pageTitle="Integrate Azure Website with Azure VNet" description="Shows you how to connect an Azure Website to a new or existing Azure virtual network" metaKeywords="" services="web-sites,virtual-network" solutions="web,integration,infrastructure" documentationCenter="" authors="cephalin" videoId="" scriptId="" />

<tags ms.service="web-sites" ms.workload="web" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="09/24/2014" ms.author="cephalin" />

# Azure Web サイトを Azure Virtual Network に統合する

本書では、仮想ネットワークの統合プレビュー機能について説明し、自分の Azure Web サイト用に設定する方法を示します。Azure Virtual Network は、Azure リソースやオンプレミスのリソースを利用するハイブリッド ソリューションを構築できる機能です。

この統合機能を使用することにより、自分の Web サイトから仮想ネットワーク内のリソースにアクセスできるようにする一方で、仮想ネットワークからその Web サイトへのアクセス権は付与しないようにすることが可能です。標準的なシナリオとしては、VNET 内の仮想マシンあるいは独自のデータ センターで実行されているデータベースや Web サービスへのアクセスが Web サイトで必要になる場合があります。ドライブのマウントはできません。また、現在のところ、vnet 内の認証システムとの統合は可能になっていません。この機能はプレビュー段階であり、GA に達する前にさらに改善が加えられる予定です。

Azure Virtual Network の詳細については、「Virtual Networkの概要」を参照してください。Azure Virtual Network の利用例、また利点について説明されています。

## Getting Started (概要)

ここでは、自分のサイトを仮想ネットワークに接続する前に考慮する必要がある点について説明します。

1.  サイトを仮想ネットワークに接続できるのは、「標準」料金レベルの Web ホスティング プラン上でサイトが実行されている場合だけです。フリーのサイト、共有サイト、また基本サイトを仮想ネットワークに接続することはできません。
2.  ターゲットの仮想ネットワークが既に存在している場合、Web サイトに接続するためには、事前に動的ルーティング ゲートウェイによりポイント対サイトが有効になっていなければなりません。ゲートウェイが静的ルーティングで設定されている場合、ポイント対サイト VPN を有効にすることはできません。
3.  Web ホスティング プランの中で設定できるネットワークは 5 つまでです。1 つの Web サイトは、一度に 1 つのネットワークにのみ接続可能です。それらの 5 つのネットワークは、同じ Web ホスティング プランに含まれる任意の数の Web サイトで使用できます。

新しい仮想ネットワークまたは既存の仮想ネットワークを接続先とするオプションがあります。新しいネットワークを作成する場合、ゲートウェイは事前設定済みになります。新しい仮想ネットワークを作成して構成する処理には数分かかることに注意してください。

Web サイトが標準レベルでない場合、UI による通知がなされ、クリックすると料金レベルにアクセスできるようになります。

![](./media/web-sites-integrate-with-vnet/upgrade-to-standard.png)

## システムの動作

実際のところ、この機能では、ポイント対サイト VPN テクノロジを使用することにより、Azure Web サイトが VNET に接続されます。Azure Websites システム アーキテクチャは本来、仮想マシンの場合のように VNET 内に Web サイトを直接プロビジョニングすることがないようにするマルチテナントです。ポイント対サイト テクノロジを構築することにより、Web サイトをホスティングする仮想マシンだけにネットワーク アクセスを制限します。さらに、それらの Web サイト ホスト上では、Web サイトからのアクセス先として設定するネットワークにのみアクセス可能となるようにネットワークへのアクセスが制限されます。

アクセスの必要な Web サイト限定のネットワーク セキュリティ確保に必要な作業のため、SMB 接続の作成はできなくなります。リモート リソースへのアクセスは可能ですが、リモート ドライブのマウントは可能になりません。

![](./media/web-sites-integrate-with-vnet/how-it-works.png)

仮想ネットワークで DNS サーバーを設定していない場合、IP アドレスを使用することが必要です。希望するエンドポイントのポートを、ファイアウォール経由で公開するようにします。接続テストをすることになった場合、現時点で唯一の方法は、希望するエンドポイントを呼び出す Web サイトまたは Web ジョブを使用することです。現在のところ、ping や nslookup などのツールは、Kudu コンソールでは動作しません。これは、近い将来に改善の余地のある分野です。

## 既存ネットワークへの接続

サイトを仮想ネットワークに接続するには、Web サイトのブレードに移動し、ネットワーキングのセクションで仮想ネットワークのタイルをクリックした後、既存のネットワークの 1 つを選択します。

![](./media/web-sites-integrate-with-vnet/connect-to-existing-vnet.png)

サブスクリプションの中でそのネットワークに接続する最初の Web サイトの場合は、VNET での認証のための証明書がシステムにより作成されます。証明書を確認するには、現行のポータルで仮想ネットワークに移動し、ネットワークを選択した後、[証明書] タブを選択します。

上の図に示されている cantConnectVnet という名前のネットワークは、淡色表示になっており、選択できません。このようになる理由として考えられるのは、2 つだけです。ネットワーク上でポイント対サイト VPN が有効になっていないか、または、VNET 内に動的ルーティング ゲートウェイがプロビジョニングされていないかのいずれかです。そのいずれも該当しない場合、Web サイトとの統合対象として、その VNET を選択することができます。

## 新しい VNET の作成と接続

既存の VNET に接続することに加えて、Web サイト UI から新しい VNET を作成し、それに自動接続するということも可能です。そのためには、仮想ネットワーク UI に達する同じパスをたどり、[新しい仮想ネットワークの作成] を選択します。表示される UI で、ネットワークの名前を指定し、アドレス空間を指定し、仮想ネットワークで使用する DNS サーバーのアドレスを設定することができます。

![](./media/web-sites-integrate-with-vnet/create-new-vnet.png)

ゲートウェイを設定した新しい仮想ネットワークを作成するには、最大 30 分の時間がかかります。その間、UI に作業が進行中であることが表示され、以下のメッセージが表示されます。

![](./media/web-sites-integrate-with-vnet/new-vnet-progress.png)

ネットワークが Web サイトに結合されれば、その Web サイトから TCP または UDP を通じてその VNET 内のリソースにアクセスできるようになります。サイト間 VPN 経由で VNET から利用可能なオンプレミス システムのリソースにアクセスするには、独自の社内ネットワークから、VNET 内で設定されているポイント対サイトのアドレスへのトラフィックが可能となるように、そのネットワーク上のルートを追加することが必要です。

統合処理が正常に完了したら、接続についての基本情報がポータルに表示され、ネットワークから Web サイトを切断する方法が示されます。さらに、接続の認証に使用される証明書の同期方法も示されます。証明書が期限切れになった場合、または失効した場合、同期が必要になることがあります。

![](./media/web-sites-integrate-with-vnet/vnet-status-portal.png)

仮想ネットワーク接続の管理
Web ホスティング プランのブレードに移動することにより、Web ホスティング プラン内のサイトに現在関連付けられているすべての仮想ネットワークのリストが表示されます。1 つの標準 Web ホスティング プランでは、最大 5 つのネットワークを関連付けることができます。

Web ホスティング プランを、フリー、共有、または基本など、さらに低いレベルのプランに合わせてスケーリングすると、そのプランに含まれる Web サイトで使用される仮想ネットワーク接続は無効になります。そのプランを再び標準プランに合わせてスケーリングすると、それらのネットワーク接続は再確立されます。

この時点で、Azure において既存の仮想マシンを仮想ネットワーク内に含めることは不可能です。仮想マシンは、作成中に仮想ネットワーク内にプロビジョニングする必要があります。

## オンプレミスのリソースへのアクセス

サイト間 VPN で設定された VNET の作業をする際、Azure Web サイトからオンプレミスのリソースにアクセスするには、付加的なステップが必要になります。オンプレミスのネットワークへのルートを追加し、ネットワークから VNET 内で設定されているポイント対サイトのアドレスに至るトラフィックが可能になるようにすることが必要です。ポイント対サイト接続の IP 範囲を確認するには、ここに示されている現行ポータルの [ネットワーク] 領域に移動します。

![](./media/web-sites-integrate-with-vnet/vpn-to-onpremise.png)

## 証明書

VNET との安全な接続を確立するには、証明書の交換が必要です。以下に示すように、現行のネットワーク ポータルから、Azure Websites により生成される公開証明書の拇印を確認することができます。

![](./media/web-sites-integrate-with-vnet/vpn-to-onpremise-certificate.png)

何らかの理由で証明書の同期が失われてしまった場合 (誤ってネットワーク ポータルから削除した場合など)、接続が失われます。修正するために、Web サイト仮想ネットワーク UI の中に、接続を再確立する [接続の同期] アクションがあります。

このアクションは、仮想ネットワークに DNS を追加した場合、またはサイト間 VPN をネットワークに追加した場合にも使用する必要があります。

![](./media/web-sites-integrate-with-vnet/vnet-sync-connection.png)

## ハイブリッド接続との比較

Azure Websites には、ハイブリッド接続と呼ばれる別の機能があります。これは、いくつかの点で仮想ネットワーク統合とよく似ています。共通の利用例があるとはいえ、それらの機能は互いに置き換え可能ではありません。ハイブリッド接続では、複数ネットワーク混合の中で複数のアプリケーション エンドポイントとの接続を確立できます。仮想ネットワーク機能は、Web サイトを、オンプレミスのネットワークに接続可能な VNET に接続します。それは、リソースがすべてそのネットワークのスコープ内にある場合にはうまく機能します。

別の相違点は、ハイブリッド接続が動作するためには、リレー エージェントをインストールする必要があるということです。そのエージェントは、Windows Server インスタンス上で実行する必要があります。仮想ネットワーク機能の場合、インストールの必要なものは何もなく、ホスティング オペレーティング システムとは関係なくリモート リソースへのアクセスが可能です。

さらに、現時点では、2 つの機能の間に料金レベルの違いもあります。それは、最安価のレベルでは、開発/テストのシナリオにおいてハイブリッド接続機能が非常に便利であり、ごく少数のエンドポイントへのアクセスのみ可能になるからです。仮想ネットワーク機能の場合は、VNET 内にあるすべてのもの、または VNET に接続されているすべてのものへのアクセスが提供されます。

  []: ./media/web-sites-integrate-with-vnet/upgrade-to-standard.png
