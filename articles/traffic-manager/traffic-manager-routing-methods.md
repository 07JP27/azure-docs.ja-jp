---
title: "Traffic Manager - トラフィック ルーティング方法 | Microsoft Docs"
description: "この記事では、Traffic Manager で使用されるさまざまなトラフィック ルーティング方法について説明します。"
services: traffic-manager
documentationcenter: 
author: kumudd
manager: timlt
editor: 
ms.assetid: db1efbf6-6762-4c7a-ac99-675d4eeb54d0
ms.service: traffic-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/11/2016
ms.author: kumud
translationtype: Human Translation
ms.sourcegitcommit: 993408c9d008a94dfd4004ed6826a2fe6180b20c
ms.openlocfilehash: aa3c77c0bf9db1f875dd992c4eb7a494af58c400

---

# <a name="traffic-manager-traffic-routing-methods"></a>Traffic Manager のトラフィック ルーティング方法

Azure Traffic Manager では、さまざまなサービス エンドポイントにネットワーク トラフィックをルーティングする方法を決定するために、3 つのトラフィック ルーティング方法をサポートしています。 Traffic Manager では、受信する DNS クエリごとにトラフィック ルーティング方法が適用されます。 トラフィック ルーティング方法によって、DNS 応答で返されるエンドポイントが決まります。

Azure Resource Manager による Traffic Manager のサポートでは、クラシック デプロイ モデルとは異なる用語を使用します。 次の表は、Resource Manager とクラシック モデルの用語の違いを示しています。

| Resource Manager の用語 | クラシックの用語 |
| --- | --- |
| トラフィック ルーティング方法 |負荷分散方法 |
| 優先順位方式 |フェールオーバー方式 |
| 重み付け方式 |ラウンド ロビン方式 |
| パフォーマンス方式 |パフォーマンス方式 |

よくある誤解を減らし、より分かりやすくするために、お客様からのフィードバックに従って用語を変更しました。 機能に違いはありません。

Traffic Manager では、次の&3; つのトラフィック ルーティング方法を使用できます。

* **優先順位:** すべてのトラフィックにプライマリ サービス エンドポイントを使用し、プライマリ エンドポイントまたはバックアップ エンドポイントが使用できない場合に備えてバックアップを用意する場合は、"優先順位" を選択します。
* **重み付け:** 一連のエンドポイントに、均等にまたは定義した重みに従ってトラフィックを分散させる場合は、"重み付け" を選択します。
* **パフォーマンス**: 複数のエンドポイントが地理的に異なる場所にあり、エンド ユーザーが、ネットワーク待ち時間が最も短いという意味で "最も近い" エンドポイントを使用できるようにする場合は、"パフォーマンス" を選択します。

すべての Traffic Manager プロファイルには、エンドポイントの正常性とエンドポイントの自動フェールオーバーの監視が含まれます。 詳細については、 [Traffic Manager のエンドポイント監視](traffic-manager-monitoring.md)に関する記事をご覧ください。 1 つの Traffic Manager プロファイルで使用できるトラフィック ルーティング方法は&1; つに限られます。 プロファイルの別のトラフィック ルーティング方法をいつでも選択できます。 変更は&1; 分以内に適用され、ダウンタイムは発生しません。 入れ子になった Traffic Manager プロファイルを使用することで、トラフィック ルーティング方法を組み合わせることができます。 入れ子にすることで、高度で柔軟性のあるトラフィック ルーティング構成が可能になり、より大規模で複雑なアプリケーションのニーズに対応できます。 詳細については、「 [入れ子になった Traffic Manager プロファイル](traffic-manager-nested-profiles.md)」をご覧ください。

## <a name="priority-traffic-routing-method"></a>優先順位トラフィック ルーティング方法

多くの場合、組織ではサービスの信頼性を提供したいと考えており、主要なサービスがダウンした場合に備えて&1; つ以上のバックアップ サービスをデプロイすることでこれを実行しています。 "優先順位" トラフィック ルーティング方法を使用すると、Azure ユーザーはこのフェールオーバー パターンを簡単に実装できます。

![Azure Traffic Manager の "優先順位" トラフィック ルーティング方法][1]

Traffic Manager プロファイルには、サービス エンドポイントの優先順位リストが含まれます。 Traffic Manager では、既定では、すべてのトラフィックがプライマリ (優先順位が一番高い) エンドポイントに送信されます。 プライマリ エンドポイントを使用できない場合、Traffic Manager は、2 番目のエンドポイントにトラフィックをルーティングします。 プライマリとセカンダリのどちらのエンドポイントも使用できない場合、トラフィックは&3; 番目のエンドポイントに送信されます。以降も同様です。 エンドポイントの可用性は、構成済みのステータス (有効または無効) とエンドポイントの継続的な監視に基づきます。

### <a name="configuring-endpoints"></a>エンドポイントの構成

Azure Resource Manager では、エンドポイントごとに "priority" プロパティを使用して、エンドポイントの優先順位を明示的に構成します。 このプロパティの値の範囲は、1 ～ 1000 です。 値が小さいほど、優先順位が高くなります。 同じ優先順位の値を複数のエンドポイントに指定することはできません。 プロパティの設定は省略可能です。 省略した場合、エンドポイントの順序に基づく既定の優先順位が使用されます。

クラシック インターフェイスでは、エンドポイントの優先順位は暗黙的に構成されます。 この優先順位は、プロファイル定義でエンドポイントが列挙されている順序に基づいて構成されます。

## <a name="weighted-traffic-routing-method"></a>加重トラフィック ルーティング方法

"重み付け" トラフィック ルーティング方法を使用すると、トラフィックを均等に分散したり、定義済みの重み付けを使用したりできます。

![Azure Traffic Manager の "重み付け" トラフィック ルーティング方法][2]

重み付けトラフィック ルーティング方法では、Traffic Manager プロファイル構成で各エンドポイントに重みを割り当てます。 重みは 1 から 1000 の整数です。 このパラメーターは省略可能です。 省略すると、Traffic Managers では、既定の重みの "1" が使用されます。

Traffic Manager では、受信する DNS クエリごとに、使用可能なエンドポイントをランダムに選択します。 あるエンドポイントが選択される確率は、すべての利用可能なエンドポイントに割り当てられている重みに基づきます。 すべてのエンドポイント間で同じ重みを使用すると、トラフィック分散は均一になります。 特定のエンドポイントの重みを大きくする (または小さくする) と、それらのエンドポイントは DNS からの応答の頻度が増えます (または減ります)。

重み付け方式を使用することで、有用なシナリオをいくつか実現できます。

* アプリケーションの段階的アップグレード: 新しいエンドポイントにルーティングするトラフィックのパーセンテージを割り当て、時間と共に 100% までトラフィックを徐々に増やします。
* Azure へのアプリケーション移行: Azure と外部エンドポイントの両方を含むプロファイルを作成します。 エンドポイントの重みを調整して新しいエンドポイントを優先します。
* 追加容量のクラウド バースト: Traffic Manager プロファイルに対応させることで、オンプレミスのデプロイメントをクラウドにすばやく拡張します。 クラウドに追加容量が必要なとき、エンドポイントを追加または有効にして、各エンドポイントに送るトラフィックの割り当てを指定します。

新しい Azure Portal は、重み付けトラフィック ルーティングの構成をサポートしています。 クラシック ポータルでは、重み付けを構成することはできません。 Resource Manager と従来のバージョンの Azure PowerShell、CLI、REST API を使用して重み付けを構成することもできます。

クライアントと、DNS 名を解決するためにクライアントが使用する再帰 DNS サーバーによって、DNS 応答がキャッシュされることに留意してください。 このキャッシュは、重み付けトラフィック分散に影響を与える可能性があります。 クライアントと再帰 DNS サーバーの数が多い場合は、トラフィック分散が期待どおりに機能します。 ただし、クライアントまたは再帰 DNS サーバーの数が少ない場合は、キャッシュによってトラフィック分散に大きな偏りが生じる可能性があります。

一般的なユース ケースは次のとおりです。

* 開発環境とテスト環境
* アプリケーション間の通信
* 共通の再帰 DNS インフラストラクチャを共有する、限られたユーザーを対象としたアプリケーション (たとえば、プロキシ経由で接続する会社の従業員など)

これらの DNS キャッシュの影響は、Azure Traffic Manager だけでなく、DNS ベースのすべてのトラフィック ルーティング システムに共通するものです。 DNS キャッシュの明示的なクリアが回避策になる場合もあれば、 別のトラフィック ルーティング方法の方が適している場合もあります。

## <a name="performance-traffic-routing-method"></a>パフォーマンス トラフィック ルーティング方法

世界中の複数の場所にエンドポイントをデプロイすると、ユーザーに "最も近い" 場所にトラフィックをルーティングすることで、多くのアプリケーションの応答性を向上させることができます。 "パフォーマンス" トラフィック ルーティング方法が、この機能を提供します。

![Azure Traffic Manager の "パフォーマンス" トラフィック ルーティング方法][3]

"最も近い" エンドポイントが必ずしも地理的な距離で最も近いとは限りません。 "パフォーマンス" トラフィック ルーティング方法では、代わりに、ネットワーク待ち時間を尺度として最も近いエンドポイントを特定します。 Traffic Manager は、インターネット待機時間テーブルを管理して、IP アドレス範囲と各 Azure データセンター間のラウンドトリップ時間を追跡します。

Traffic Manager は、受信 DNS 要求の送信元 IP アドレスをインターネット待機時間テーブルで見つけます。 Traffic Manager は、その IP アドレス範囲について待機時間が最も短くなる Azure データ センター内の使用可能なエンドポイントを選び、DNS 応答でそのエンドポイントを返します。

[Traffic Manager の動作のしくみ](traffic-manager-how-traffic-manager-works.md)で説明したように、Traffic Manager は、クライアントから直接には DNS クエリを受信しません。 代わりに、DNS クエリは、クライアントが使用するように構成された再帰 DNS サービスから受信します。 そのため、"最も近い" エンドポイントの特定に使用される IP アドレスは、クライアントの IP アドレスではなく、再帰 DNS サービスの IP アドレスになります。 実際には、この IP アドレスはクライアントにとって適切なプロキシとなります。

Traffic Manager は、インターネット待機時間テーブルを定期的に更新して、グローバル インターネットと新しい Azure リージョンの変化に対応しています。 ただし、アプリケーションのパフォーマンスは、インターネット全体におけるリアルタイムな負荷の変動によって変わります。 パフォーマンスによるトラフィック ルーティングでは、特定のサービス エンドポイントの負荷は監視されません。 ただし、エンドポイントを使用できなくなった場合は、Traffic Manager は DNS クエリの応答でそのエンドポイントを返しません。

注意する点:

* プロファイルに同一 Azure リージョン内の複数のエンドポイントが含まれている場合は、Traffic Manager では、そのリージョンで利用可能なエンドポイントにトラフィックが均等に分散されます。 リージョン内で別のトラフィック分散を使用する場合は、[入れ子になった Traffic Manager プロファイル](traffic-manager-nested-profiles.md)を使用できます。
* Traffic Manager では、特定の Azure リージョン内のすべての有効なエンドポイントの実行状況が低下している場合に、2 番目に近いエンドポイントではなく、他のすべての利用可能なエンドポイント間でトラフィックが振り分けられます。 このロジックで、2 番目に近いエンドポイントのオーバー ロードを回避することで、連鎖的な障害の発生を防止しています。 希望するフェールオーバー シーケンスを定義する場合は、「[入れ子になった Traffic Manager プロファイル](traffic-manager-nested-profiles.md)」を使用してください。
* 外部エンドポイントまたは入れ子になったエンドポイントでパフォーマンス トラフィック ルーティング方法を使用する場合は、エンドポイントの場所を指定する必要があります。 デプロイメントに最も近い Azure リージョンを選択してください。 これらの場所は、インターネット待機時間テーブルでサポートされている値です。
* エンドポイントを選択するアルゴリズムは確定的です。 同じクライアントからの反復 DNS クエリは、同じエンドポイントに送信されます。 通常、クライアントは、出張中に別の再帰 DNS サーバーを使用します。 このクライアントは、別のエンドポイントにルーティングされる可能性があります。 また、ルーティングは、インターネット待機時間テーブルの更新の影響を受ける場合もあります。 そのため、パフォーマンス トラフィック ルーティング方法では、クライアントが常に同じエンドポイントにルーティングされる保証はありません。
* インターネット待機時間テーブルが変更されたときに、一部のクライアントが別のエンドポイントにルーティングされていることに気付く場合があります。 このルーティングの変更は、最新の待機時間データに基づいてより厳密に行われます。 これらの更新は、インターネットが継続的に発展する中で、パフォーマンス トラフィック ルーティングの精度を維持するために不可欠となります。

## <a name="next-steps"></a>次のステップ

[Traffic Manager endpoint monitoring](traffic-manager-monitoring.md)

[Traffic Manager プロファイルの作成](traffic-manager-manage-profiles.md)

<!--Image references-->
[1]: ./media/traffic-manager-routing-methods/priority.png
[2]: ./media/traffic-manager-routing-methods/weighted.png
[3]: ./media/traffic-manager-routing-methods/performance.png



<!--HONumber=Jan17_HO1-->


