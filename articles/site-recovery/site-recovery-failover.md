---
title: "Site Recovery でのフェールオーバー | Microsoft Docs"
description: "Azure Site Recovery は、仮想マシンと物理サーバーのレプリケーション、フェールオーバー、回復を調整します。 Azure またはセカンダリ データセンターへのフェールオーバーについて説明します。"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 1/04/2017
ms.author: raynew
translationtype: Human Translation
ms.sourcegitcommit: b70d2d709d0940964c4220b798207adaf3551d36
ms.openlocfilehash: d31e987e636b178b5aa05722ff08707a6e53c3cf


---
# <a name="failover-in-site-recovery"></a>Site Recovery でのフェールオーバー
Azure Site Recovery サービスは、仮想マシンと物理サーバーのレプリケーション、フェールオーバー、復旧を調整してビジネス継続性と障害復旧 (BCDR) 戦略に貢献します。 コンピューターを Azure に、またはオンプレミスのセカンダリ データ センターにレプリケートできます。 簡単な概要については、「 [Site Recovery とは](site-recovery-overview.md)

## <a name="overview"></a>概要
この記事は、Site Recovery を使用して保護されている仮想マシンと物理サーバーを復旧するプロセス (フェールオーバーおよびフェールバック) に関する情報とその手順を示しています。

コメントや質問はこの記事の末尾、または [Azure Recovery Services フォーラム](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr)で投稿してください。

## <a name="types-of-failover"></a>フェールオーバーの種類
仮想マシンと物理サーバーの保護を有効にして、その&2; 台がレプリケートしていると、必要に応じてフェールオーバーを実行することができます。 Site Recovery は、さまざまな種類のフェールオーバーをサポートします。

| **フェールオーバー** | **実行する状況** | **詳細** | **プロセス** |
| --- | --- | --- | --- |
| **テスト フェールオーバー** |レプリケーション戦略を検証するか、または障害復旧の訓練を行うために実行します。 |データの損失やダウンタイムはありません<br/><br/>レプリケーションへの影響はありません<br/><br/>運用環境への影響はありません |フェールオーバーを開始します<br/><br/>フェールオーバー後にテスト仮想マシンがネットワークに接続する方法を指定します<br/><br/>ジョブの進捗状況を **[ジョブ]** タブで追跡します。 テスト マシンが作成され、セカンダリの場所で起動します<br/><br/>Azure - Azure Portal でマシンに接続します<br/><br/>セカンダリ サイト - 同じホストとクラウドでマシンにアクセスします<br/><br/>テストを完了し、テスト フェールオーバーの設定を自動的にクリーンアップします。 |
| **計画されたフェールオーバー** |コンプライアンス要件を満たすために実行します<br/><br/>定期的なメンテナンス用に実行します<br/><br/>既知の障害 (予想される電源障害や悪天候の予報など) に備えてワークロードを継続して実行できるように、必要なデータをフェールオーバーするために実行します<br/><br/>プライマリからセカンダリへのフェールオーバー後にフェールバックするために実行します |データ損失なし<br/><br/>プライマリ上の仮想マシンをシャットダウンしてセカンダリの場所で起動するまでの間に、ダウンタイムが発生します。<br/><br/>フェールオーバー後にターゲット マシンがソース マシンになる際、仮想マシンは影響を受けます。 |フェールオーバーを開始します<br/><br/>ジョブの進捗状況を **[ジョブ]** タブで追跡します。 ソース マシンがシャットダウンされます<br/><br/>レプリカのマシンがセカンダリの場所で起動します<br/><br/>Azure - Azure Portal でレプリカ マシンに接続します<br/><br/>セカンダリ サイト - 同じホストと同じクラウドでマシンにアクセスします<br/><br/>フェールオーバーをコミットします |
| **計画されていないフェールオーバー** |停電やウイルスの攻撃などの予期しないインシデントが原因で、プライマリ サイトにアクセスできなくなったときに、この事後対応方式のフェールオーバーを実行します <br/><br/> プライマリ サイトが利用できない場合でも、計画されていないフェールオーバーは実行できます |レプリケーション頻度の設定に応じてデータの損失が発生します<br/><br/>データは前回の同期時点に合わせて最新状態になります |フェールオーバーを開始します<br/><br/>ジョブの進捗状況を **[ジョブ]** タブで追跡します。 必要に応じて、仮想マシンをシャットダウンして最新のデータを同期します<br/><br/>レプリカのマシンがセカンダリの場所で起動します<br/><br/>Azure - Azure Portal でレプリカ マシンに接続します<br/><br/>セカンダリ サイト - 同じホストと同じクラウドでマシンにアクセスします<br/><br/>フェールオーバーをコミットします |

サポートされるフェールオーバーの種類は、デプロイ シナリオに応じて異なります。

| **フェールオーバーの方向** | **テスト フェールオーバー** | **計画されたフェールオーバー** | **計画されていないフェールオーバー** |
| --- | --- | --- | --- |
| プライマリ VMM サイトからセカンダリ VMM サイト |サポートされています |サポートされています |サポートされています |
| セカンダリ VMM サイトからプライマリ VMM サイト |サポートされています |サポートされています |サポートされています |
| クラウド間 (単一の VMM サーバー) |サポートされています |サポートされています |サポートされています |
| VMM サイトから Azure |サポートされています |サポートされています |サポートされています |
| Azure から VMM サイト |サポートされていません |サポートされています |サポートされていません |
| Hyper-V サイトから Azure |サポートされています |サポートされています |サポートされています |
| Azure から Hyper-V サイト |サポートされていません |サポートされています |サポートされていません |
| VMware サイトから Azure |サポートされている (拡張のシナリオ)<br/><br/> サポートされていません (従来のシナリオ) |サポートされていません |サポートされています |
| 物理サーバーから Azure |サポートされている (拡張のシナリオ)<br/><br/> サポートされていません (従来のシナリオ) |サポートされていません |サポートされています |

## <a name="failover-and-failback"></a>フェールオーバーとフェールバック
デプロイの種類に応じて、仮想マシンをセカンダリ オンプレミス サイトまたは Azure にフェールオーバーします。 Azure にフェールオーバーするマシンは、Azure 仮想マシンとして作成されます。 フェールオーバーできるのは、単一の仮想マシン、単一の物理サーバー、または復旧計画です。 復旧計画は、保護対象の仮想マシンまたは物理サーバーを含む、順序のある&1; つ以上のグループで構成されます。 復旧計画は、所属するグループに従ってフェールオーバーする複数のマシンのフェールオーバーを調整するために使用されます。 [こちら](site-recovery-create-recovery-plans.md) を参照してください。

フェールオーバーが完了し、マシンがセカンダリの場所で稼働している場合は、次のことに注意してください。

* Azure にフェールオーバーした場合は、フェールオーバー後に、プライマリまたはセカンダリの場所でマシンは保護されたりレプリケートされたりしません。 Azure では、仮想マシンは、回復性は提供してもレプリケートされない、geo レプリケートされたストレージに格納されます。
* セカンダリ サイトへの計画されていないフェールオーバーを実行した場合、フェールオーバー後に、セカンダリの場所のマシンは保護されたりレプリケートされたりしません。
* セカンダリ サイトへの計画されたフェールオーバーを実行した場合、フェールオーバー後に、セカンダリの場所のマシンは保護されます。

### <a name="failback-from-secondary-site"></a>セカンダリ サイトからのフェールバック
セカンダリ サイトからプライマリ サイトへのフェールバックは、プライマリからセカンダリへのフェールオーバーと同じプロセスを使用します。 プライマリからセカンダリのデータセンターへのフェールオーバーがコミットされて完了した後は、プライマリ サイトが使用可能になったときに、レプリケーションの反転を開始することができます。 レプリケーションの反転は、差分データを同期することによって、セカンダリ サイトとプライマリ サイトの間のレプリケーションを開始します。 レプリケーションの反転により、仮想マシンは保護された状態になりますが、セカンダリ データセンターは引き続きアクティブな場所です。 プライマリ サイトをアクティブな場所にするには、セカンダリからプライマリへの計画されたフェールオーバーを開始し、続いて別のレプリケーションの反転を実行します。

### <a name="failback-from-azure"></a>Azure からのフェールバック
Azure にフェールオーバーした場合、仮想マシンは、仮想マシンのための Azure 回復性機能によって保護されます。 元のプライマリ サイトをアクティブな場所にするには、計画されたフェールオーバーを実行します。 元の場所にフェールバックすることも、元のサイトが利用できない場合には別の場所にフェールバックすることもできます。 プライマリの場所へのフェールバック後にレプリケートを再び開始するには、レプリケーションの反転を開始します。

### <a name="failover-considerations"></a>フェールオーバーの考慮事項
* **フェールオーバー後の IP アドレス**— 既定では、フェールオーバー先のマシンは、ソース マシンとは異なる IP アドレスを持ちます。 同じ IP アドレスを保持する場合は、次の説明を参照してください。
  * **セカンダリ サイト**— セカンダリ サイトにフェールオーバーし、IP アドレスを保持する場合は、 [こちらの記事](http://blogs.technet.com/b/scvmm/archive/2014/04/04/retaining-ip-address-after-failover-using-hyper-v-recovery-manager.aspx) を参照してください。 ISP がサポートする場合は、パブリック IP アドレスを保持できることに注意してください。
  * **Azure** — Azure にフェールオーバーする場合は、仮想マシンのプロパティの **[構成]** タブで、割り当てる IP アドレスを指定することができます。 Azure へのフェールオーバー後にパブリック IP アドレスを保持することはできません。 内部アドレスとして使用されている RFC 1918 非準拠のアドレス空間は保持することができます。
* **部分的なフェールオーバー**— サイトの全体ではなく、サイトの一部をフェールオーバーする場合には、次の点に注意してください。

  * **セカンダリ サイト**— セカンダリ サイトにプライマリ サイトの一部をフェールオーバーし、プライマリ サイトに再び接続する場合、セカンダリ サイト上のフェールオーバー先のアプリケーションを、サイト間 VPN 接続を使用して、プライマリ サイト上で実行するインフラストラクチャ コンポーネントに接続します。 サブネット全体をフェールオーバーする場合は、仮想マシンの IP アドレスを保持できます。 部分的なサブネットをフェールオーバーする場合は、サブネットはサイト間で分割できないので、仮想マシンの IP アドレスを保持することはできません。
  * **Azure**— Azure にサイトの一部をフェールオーバーし、プライマリ サイトに再び接続する場合、サイト間 VPN を使用して、Azure 内のフェールオーバー先のアプリケーションを、プライマリ サイト上で実行するインフラストラクチャ コンポーネントに接続することができます。 サブネット全体をフェールオーバーする場合は、仮想マシンの IP アドレスを保持できることに注意してください。 部分的なサブネットをフェールオーバーする場合は、サブネットはサイト間で分割できないので、仮想マシンの IP アドレスを保持することはできません。
* **ドライブ文字** — フェールオーバー後に仮想マシンのドライブ文字を保持する場合は、仮想マシンの SAN のポリシーを **[On]** に設定することができます。 仮想マシンのディスクは自動的にオンラインになります。 詳細については、[こちら](https://technet.microsoft.com/library/gg252636.aspx)を参照してください。
* **クライアント要求をルーティングする**— Site Recovery は、Azure Traffic Manager と連携して、フェールオーバー後にクライアント要求をアプリケーションにルーティングします。

## <a name="run-a-test-failover"></a>テスト フェールオーバーの実行
Azure へのテスト フェールオーバーを行う場合は、「[Test failover to Azure](site-recovery-test-failover-to-azure.md)」(Azure へのテスト フェールオーバー) ドキュメントをご覧ください。 VMM サーバーによって管理されている別のオンプレミス サイトへのテスト フェールオーバーを行う場合は、「[Test Failover to VMM](site-recovery-test-failover-vmm-to-vmm.md)」(VMM へのテスト フェールオーバー) ドキュメントをご覧ください。  

## <a name="run-a-planned-failover-primary-to-secondary"></a>計画されたフェールオーバーの実行 (プライマリからセカンダリ)
 この手順では、復旧計画の、計画されたフェールオーバーを実行する方法について説明します。 別の方法として、 **[仮想マシン]** タブで、単一の仮想マシンに対するフェールオーバーを実行することもできます。

1. 開始する前に、フェールオーバーするすべての仮想マシンが、初期レプリケーションを完了していることを確認します。
2. **[復旧計画]**  >  *recoveryplan_name* を選択します。 **フェールオーバー** > **Planned フェールオーバー**で投稿してください。
3. **[計画されたフェールオーバーの確認] **ページで、ソースとターゲットの場所を選択します。 フェールオーバーの方向に注意してください。

   * 以前のフェールオーバーが想定どおりに実行されており、すべての仮想マシン サーバーが、ソースの場所とターゲットの場所のいずれかに配置されている場合、フェールオーバーの方向の詳細は、情報の提供のみを目的としています。
   * ソースの場所とターゲットの場所の両方で仮想マシンがアクティブである場合は、 **[方向の変更]** ボタンが表示されます。 このボタンを使って、フェールオーバーが実行される方向を変更し、指定します。
4. Azure にフェールオーバーし、クラウドのデータ暗号化が有効になっている場合には、 **[暗号化キー]** で、VMM サーバーへのプロバイダーのインストール中にデータ暗号化を有効にしたときに発行された証明書を選択します。
5. データ損失を確実に防ぐために、計画されたフェールオーバーの開始時の最初のステップとして、仮想マシンをシャットダウンします。 フェールオーバーの進行状況は、 **[ジョブ]** タブで確認できます。 フェールオーバーで (仮想マシン、または復旧計画に含まれているスクリプトのいずれかにおいて) エラーが発生した場合は、復旧計画の計画されたフェールオーバーは停止します。 フェールオーバーは、もう一度開始することができます。
6. レプリカ仮想マシンは、作成後にコミット保留中の状態になります。 **[コミット]** をクリックして、フェールオーバーをコミットします。
7. レプリケーションが完了すると、仮想マシンがセカンダリの場所で起動します。

## <a name="run-an-unplanned-failover"></a>計画されていないフェールオーバーの実行
この手順では、復旧計画の、計画されていないフェールオーバーを実行する方法について説明します。 別の方法として、 **[仮想マシン]** タブで、単一の仮想マシンまたは物理サーバーに対するフェールオーバーを実行することもできます。

1. **[復旧計画]**  >  *recoveryplan_name* を選択します。 **フェールオーバー** > **Unplanned フェールオーバー**で投稿してください。
2. **[計画されていないフェールオーバーの確認] **ページで、ソースとターゲットの場所を選択します。 フェールオーバーの方向に注意してください。

   * 以前のフェールオーバーが想定どおりに実行されており、すべての仮想マシン サーバーが、ソースの場所とターゲットの場所のいずれかに配置されている場合、フェールオーバーの方向の詳細は、情報の提供のみを目的としています。
   * ソースの場所とターゲットの場所の両方で仮想マシンがアクティブである場合は、 **[方向の変更]** ボタンが表示されます。 このボタンを使って、フェールオーバーが実行される方向を変更し、指定します。
3. Azure にフェールオーバーし、クラウドのデータ暗号化が有効になっている場合には、 **[暗号化キー]** で、VMM サーバーへのプロバイダーのインストール中にデータ暗号化を有効にしたときに発行された証明書を選択します。
4. **[仮想マシンをシャットダウンして最新のデータを同期 (Shut down virtual machines and synchronize the latest data)]** を選択し、Site Recovery が保護された仮想マシンをシャットダウンしてデータを同期するように指定することで、最新バージョンのデータをフェールオーバーします。 このオプションを選択しないか、または試行が成功しない場合、仮想マシンのフェールオーバーは、利用可能な最新の回復ポイントから実行されます。
5. フェールオーバーの進行状況は、 **[ジョブ]** タブで確認できます。 計画されていないフェールオーバーの実行中にエラーが発生しても、復旧計画は最後まで実行されることに注意してください。
6. フェールオーバーの後、仮想マシンは **コミット保留中** の状態になります。 **[コミット]** をクリックして、フェールオーバーをコミットします。
7. レプリケーションで複数の回復ポイントを使用するように設定している場合は、[回復ポイントの変更 (Change Recovery Point)] で、最新のものではない回復ポイントを使用するように選択できます (既定では最新のものが使用されます)。 コミット後には、その他の回復ポイントは削除されます。
8. レプリケーションが完了すると、仮想マシンがセカンダリの場所で起動し、稼働状態になります。 ただし、それらは保護されたりレプリケートされたりしません。 プライマリ サイトが、基になる同じインフラストラクチャで再び使用可能になったら、 **[レプリケーションの反転]** をクリックして、レプリケーションの反転を開始します。 これによって、すべてのデータがプライマリ サイトに確実にレプリケートされ、仮想マシンがフェールオーバー可能な状態に戻ります。 計画されていないフェールオーバー後のレプリケーションの反転では、データ転送のオーバーヘッドが発生します。 転送は、クラウドの初期レプリケーション設定で構成されているものと同じ方法で行われます。

## <a name="failback-from-secondary-to-primary"></a>セカンダリからプライマリへのフェールバック
 プライマリからセカンダリの場所へのフェールオーバー後は、レプリケートされた仮想マシンは Site Recovery では保護されず、セカンダリの場所はプライマリとして機能するようになります。 元のプライマリ サイトにフェールバックするには、次の手順に従います。 この手順では、復旧計画の、計画されたフェールオーバーを実行する方法について説明します。 別の方法として、 **[仮想マシン]** タブで、単一の仮想マシンに対するフェールオーバーを実行することもできます。

1. **[復旧計画]**  >  *recoveryplan_name* を選択します。 **フェールオーバー** > **Planned フェールオーバー**で投稿してください。
2. **[計画されたフェールオーバーの確認] **ページで、ソースとターゲットの場所を選択します。 フェールオーバーの方向に注意してください。 プライマリからのフェールオーバーが想定どおりに機能し、すべての仮想マシンがセカンダリの場所にある場合には、これは情報の提供のみを目的としています。
3. Azure からフェールバックする場合は、 **[データの同期 (Data Synchronization)]**で次の設定を選択してください。

   * **[フェールオーバーの前にデータを同期する (差分変更のみを同期する)]**- 仮想マシンをシャットダウンせずに同期するため、仮想マシンのダウンタイムが最小限に抑えられます。 その内容は次のとおりです。
     * フェーズ 1: Azure で仮想マシンのスナップショットを取得し、それをオンプレミスの Hyper-V ホストにコピーします。 マシンは Azure での実行を継続します。
     * フェーズ 2: Azure で仮想マシンをシャットダウンします。これでその仮想マシンでは新しい変更は発生しません。 変更の最終セットがオンプレミス サーバーに転送され、オンプレミスの仮想マシンが起動します。

    - **[フェールオーバー中にのみデータを同期する (すべてダウンロードする)]**- Azure の実行期間が長い場合にこのオプションを使用します。 ほとんどのディスクを変更し、チェックサム計算に時間をかけたくない場合は、このオプションの方が高速です。 ディスクのダウンロードが実行されます。 また、オンプレミスの仮想マシンを削除した場合にも便利です。

    > [!NOTE] 
    > Azure を長期間 (1 か月間以上) 実行している場合、またはオンプレミスの VM を削除した場合にこのオプションを使用することをお勧めします。このオプションを選択しても、チェックサム計算は実行されません。
    >
    >


1. Azure にフェールオーバーし、クラウドのデータ暗号化が有効になっている場合には、 **[暗号化キー]** で、VMM サーバーへのプロバイダーのインストール中にデータ暗号化を有効にしたときに発行された証明書を選択します。
2. 既定では最新の回復ポイントが使用されますが、 **[回復ポイントの変更 (Change Recovery Point)]** で、別の回復ポイントを指定することができます。
3. チェックマークをクリックして、フェールバックを開始します。  フェールオーバーの進行状況は、 **[ジョブ]** タブで確認できます。
4. フェールオーバー前のデータを同期するオプションを選択した場合、初期データの同期が完了して、Azure で仮想マシンをシャットダウンする準備ができたら、 **[ジョブ]** > <planned failover job name> **[フェールオーバーの実行]**で投稿してください。 これにより Azure で仮想マシンがシャットダウンされ、最新の変更がオンプレミスの仮想マシンに転送され、オンプレミスの仮想マシンが起動します。
5. これで仮想マシンにログオンして、それが想定どおりに使用できるかを検証できます。
6. 仮想マシンは、コミット保留中の状態になります。 **[コミット]** をクリックして、フェールオーバーをコミットします。
7. フェールバックを完了するために、 **[レプリケーションの反転]** をクリックして、プライマリ サイトの仮想マシンの保護を開始します。

## <a name="failback-to-an-alternate-location"></a>別の場所へのフェールバック
[Hyper-V サイトと Azure](site-recovery-hyper-v-site-to-azure.md) の間での保護がデプロイされている場合は、Azure から別のオンプレミスの場所にフェールバックを実行できます。 これは、新しいオンプレミス ハードウェアを設定する必要がある場合に便利です。 これを行うには、次の手順を実行します。

1. 新しいハードウェアを設定する場合は、Windows Server 2012 R2 および Hyper-V のロールをサーバーにインストールします。
2. 元のサーバーに保存していたものと同じ名前を使用して、仮想ネットワーク スイッチを作成します。
3. フェールバックの対象を **[保護された項目]**  ->  **[保護グループ]**  ->  <ProtectionGroupName>  ->  <VirtualMachineName>で選択して、**[計画されたフェールオーバー]** を選択します。
4. **[計画されたフェールオーバーの確認]** select **[オンプレミスの仮想マシンが存在しない場合に作成 (Create on-premises virtual machine if it does not exist)]**で投稿してください。
5. **[ホスト名]** で、仮想マシンを配置する、新しい Hyper-V ホスト サーバーを選択します。
6. [データの同期 (Data Synchronization)] で、オプション **[フェールオーバー前のデータを同期 (Synchronize the data before the failover)]**を選択することをお勧めします。 このオプションを指定すると、仮想マシンをシャットダウンせずに同期するため、ダウンタイムを最小限に抑えることができます。 その内容は次のとおりです。

   * フェーズ 1: Azure で仮想マシンのスナップショットを取得し、それをオンプレミスの Hyper-V ホストにコピーします。 マシンは Azure での実行を継続します。
   * フェーズ 2: Azure で仮想マシンをシャットダウンします。これでその仮想マシンでは新しい変更は発生しません。 変更の最終セットがオンプレミス サーバーに転送され、オンプレミスの仮想マシンが起動します。
7. チェックマークをクリックして、フェールオーバー (フェールバック) を開始します。
8. 初期の同期が終了し、Azure で仮想マシンをシャットダウンする準備ができたら、 **[ジョブ]** > <planned failover job> > **[フェールオーバーの実行]**で投稿してください。 これにより Azure で仮想マシンがシャットダウンされ、最新の変更がオンプレミスの仮想マシンに転送され、オンプレミスの仮想マシンが起動します。
9. これでオンプレミスの仮想マシンにログオンして、すべてが想定どおりに動作するかどうかを検証できます。 **[コミット]** をクリックして、フェールオーバーを完了します。
10. **[レプリケーションの反転]** をクリックして、オンプレミス仮想マシンの保護を開始します。

    > [!NOTE]
    > "データの同期" 中にフェールバック ジョブを取り消した場合、オンプレミスの VM は破損状態となります。 データの同期によって Azure VM ディスクからオンプレミスのデータ ディスクに最新のデータがコピーされるので、同期が完了するまでは、ディスク データの一貫性が保たれていない可能性があるためです。 データの同期を取り消した後でオンプレミスの VM を起動する場合、その VM は起動しないおそれがあります。 フェールオーバーの再トリガーを行い、データの同期を完了してください。
    >
    >



<!--HONumber=Jan17_HO2-->


