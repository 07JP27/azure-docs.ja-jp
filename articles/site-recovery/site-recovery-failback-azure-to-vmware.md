<properties 
   pageTitle="VMware 仮想マシンと物理サーバーをオンプレミス サイトにフェールバックする | Microsoft Azure"
   description="VMware VM および物理サーバーを Azure にフェールオーバーした後に、オンプレミス サイトにフェールバックする方法について説明します。" 
   services="site-recovery" 
   documentationCenter="" 
   authors="ruturaj" 
   manager="mkjain" 
   editor=""/>

<tags
   ms.service="site-recovery"
   ms.devlang="na"
   ms.tgt_pltfrm="na"
   ms.topic="article"
   ms.workload="required" 
   ms.date="10/05/2016"
   ms.author="ruturajd"/>


# <a name="fail-back-vmware-virtual-machines-and-physical-servers-to-the-on-premises-site"></a>VMware 仮想マシンと物理サーバーをオンプレミス サイトにフェールバックする

> [AZURE.SELECTOR]
- [Azure ポータル](site-recovery-failback-azure-to-vmware.md)
- [Azure クラシック ポータル](site-recovery-failback-azure-to-vmware-classic.md)
- [Azure クラシック ポータル (レガシ)](site-recovery-failback-azure-to-vmware-classic-legacy.md)


この記事では、Azure からオンプレミス サイトへ Azure Virtual Machines をフェールバックする方法について説明します。 この記事の手順は、 [このチュートリアル](site-recovery-vmware-to-azure-classic.md)を使用して、VMware 仮想マシンまたは Windows/Linux 物理サーバーをオンプレミス サイトから Azure にフェールオーバーした後に、それらをフェールバックする準備ができたときに実行します。



## <a name="overview"></a>概要

この図では、このシナリオのフェールバック アーキテクチャを示します。

このアーキテクチャは、プロセス サーバーがオンプレミスであり、ExpressRoute を使用している場合に使用します。

![Expressroute のアーキテクチャ ダイアグラム](./media/site-recovery-failback-azure-to-vmware-classic/architecture.png)

このアーキテクチャは、プロセス サーバーが Azure 上にあり、VPN または ExpressRoute 接続のいずれかがある場合に使用します。

![VPN のアーキテクチャ ダイアグラム](./media/site-recovery-failback-azure-to-vmware-classic/architecture2.PNG)

ポートの一覧とフェールバック アーキテクチャ ダイアグラムについては、次の図をご覧ください。

![すべてのポートのフェールオーバー/フェールバック](./media/site-recovery-failback-azure-to-vmware-classic/Failover-Failback.png)

フェールバックのしくみは次のとおりです。

- Azure にフェールオーバー後、オンプレミス サイトへはいくつかの段階でフェールバックします。
    - **第 1 段階**: オンプレミス サイトで実行されている VMware VM へのレプリケートを開始できるように Azure VM を再保護します。 
    - **第 2 段階**: Azure VM がオンプレミス サイトへのレプリケーションを開始したら、フェールオーバーを実行して Azure からフェールバックします。
    - **第 3 段階**: データがフェールバックされたら、フェールバック先のオンプレミスの VM を再保護します。これにより、オンプレミスの VM は Azure へのレプリケートを開始できるようになります。


### <a name="failback-to-the-original-or-alternate-location"></a>元のまたは別の場所にフェールバックする

VMware VM をフェールオーバーした場合、オンプレミスにまだ存在する場合、同じソース VM にフェールバックできます。 このシナリオでのみ、差分変更のみがフェールバックされます。 以下の点に注意してください。

- 物理サーバーをフェールオーバーした場合、常に新しい VMware VM にフェールバックは実行されます。
    - 物理マシンをフェールバックする前に以下に注意してください。
        - 保護されている物理マシンは Azure から VMware にフェールオーバーして戻った場合に、仮想マシンとして返されます
        - 1 つ以上のマスター ターゲット サーバーと、フェールバック先として必要な ESX/ESXi ホストを必ず検出します。
- 元の VM にフェールバックする場合、次が必要です。
    - vCenter サーバーで VM を管理する場合は、マスター ターゲットの ESX ホストが VM のデータストアにアクセスできる必要があります。
    - VM が ESX ホスト上にあっても、vCenter によって管理されていない場合、VM のハード ディスクは MT のホストがアクセスできるデータストア内に存在する必要があります。
    - VM が ESX ホスト上にあり vCenter を使用しない場合、再保護する前に、MT の ESX ホストの検出を完了する必要があります。 これは、物理サーバーにフェールバックする場合も同様です。
    - (オンプレミスに VM がある場合) フェールバックを実行する前に削除するという選択肢もあります。 このようにすると、フェールバックにより、マスター ターゲット ESX ホストと同じホストに新しい VM が作成されます。
    
- 別の場所にフェールバックすると、オンプレミスのマスター ターゲット サーバーによって使用されるのと同じデータ ストアおよび同じ ESX ホストにデータは復元されます。 


## <a name="prerequisites"></a>前提条件

- VMware VM および物理サーバーのフェールバックには、VMware 環境が必要です。 物理サーバーへのフェールバックはサポートされていません。
- フェールバックするには、最初に保護を設定するときに Azure ネットワークを作成する必要があります。 フェールバックには、Azure VM が配置されている Azure ネットワークからオンプレミス サイトへの VPN または ExpressRoute 接続が必要です。
- フェールバックする VM が vCenter サーバーによって管理されている場合、vCenter サーバー上の VM の検出に必要な権限があることを確認する必要があります。 詳細については、[こちら](site-recovery-vmware-to-azure-classic.md#vmware-permissions-for-vcenter-access)を参照してください。
- VM 上にスナップショットがある場合、再保護は失敗します。 スナップショットまたはディスクを削除します。 
- フェールバックを開始する前に、いくつかのコンポーネントを作成する必要があります。
    - **Azure にプロセス サーバーを作成します**。 これが、作成し、フェールバック中に実行し続ける必要のある Azure VM です。 コンピューターはフェールバックの完了後、削除できます。
    - **マスター ターゲット サーバーを作成する**: マスター ターゲット サーバーは、フェールバック データを送受信します。 オンプレミスに作成した管理サーバーには、既定でマスター ターゲット サーバーがインストールされています。 ただし、フェールバック トラフィックの量によっては、フェールバック用に別のマスター ターゲット サーバーを作成する必要があります。
    - Linux 上で実行するマスター ターゲット サーバーを別に作成する場合は、以下の説明に従って、マスター ターゲット サーバーをインストールする前に、Linux VM を設定する必要があります。
- フェールバックを実行するときは、構成サーバーがオンプレミスに存在している必要があります。 フェールバック時に仮想マシンが構成サーバー データベースに存在していないと、フェールバックは失敗します。 サーバーを定期的にバックアップするようスケジュールを設定してください。 万一障害が発生した場合は、フェールバックが正常に機能するよう同じ IP アドレスで復元する必要があります。
- VMware でマスター ターゲット VM の構成パラメーターに disk.enableUUID=true が設定されていることを確認してください。 この行が存在しない場合は追加してください。 これは、一貫性のある UUID を VMDK に提供することで適切なマウントが実行されるようにするために必要です。
- **マスター ターゲット サーバーをストレージ vMotioned にすることはできません**。 そのようにした場合、フェールバックが失敗する可能性があります。 ディスクが利用可能にならないため、この VM は起動しません。

## <a name="failback-policy"></a>フェールバック ポリシー
オンプレミスにレプリケートするには、フェールバック ポリシーが必要です。 このポリシーは、順方向のポリシーを作成したときに自動的に作成されます。 次の点に注意してください。 

1. このポリシーは、作成時に構成サーバーに自動的に関連付けられます。
2. このポリシーは編集できません。
3. ポリシーの設定値は、RPO しきい値 = 15 分、復旧ポイントのリテンション期間 = 24 時間、アプリケーションの整合性スナップショットの取得頻度 = 60 分です。![](./media/site-recovery-failback-azure-to-vmware-new/failback-policy.png)

## <a name="set-up-the-process-server-in-azure"></a>Azure にプロセス サーバーをセットアップする

Azure の VM がデータをオンプレミスのマスター ターゲット サーバーに戻せるようにするために、Azure にプロセス サーバーをインストールする必要があります。 

マシンをクラシック リソースとして保護した場合 (Azure に復旧された VM がクラシック VM の場合)、Azure にクラシック プロセス サーバーが必要です。 デプロイメントの種類として Resource Manager を指定してマシンを復旧した場合、デプロイメントの種類が Resource Manager であるプロセス サーバーが必要になります。 この種類は、プロセス サーバーのデプロイ先の Azure 仮想ネットワークによって選択されます。

1.  [コンテナー]、[設定]、[Site Recovery インフラストラクチャ] ([管理] 見出しの下)、**[構成サーバー]** ("VMware マシンと物理マシン" 見出しの下) の順にクリックし、構成サーバーを選択します。 下のサンプル スクリーンショットに黄色で強調表示されている [+ プロセスサーバー] をクリックします。

    ![](./media/site-recovery-failback-azure-to-vmware-classic/add-processserver.png)

2. プロセス サーバーのデプロイ先として、[Deploy a failback process server in Azure (フェールバック プロセス サーバーを Azure にデプロイする)] を選択します。

3. マシンの復旧時に使用したサブスクリプションを選択します。 

4. 復旧したマシンが配置されている Azure ネットワークを選択します。 復旧した VM とプロセス サーバーが通信できるように、プロセス サーバーが同じネットワークに存在する必要があります。

5. *クラシック デプロイメント* ネットワークを選択した場合、Azure ギャラリーを使用して新しい VM を作成し、プロセス サーバーをインストールするよう求められます。

    ![](./media/site-recovery-failback-azure-to-vmware-classic/add-classic.png)
    
    1. イメージの名前は、 *Microsoft Azure Site Recovery Process Server V2*です。 デプロイメント モデルとして、必ず [ *クラシック* ] を選択します。
    
        ![](./media/site-recovery-failback-azure-to-vmware-classic/templatename.png)
    
    2.  [こちらに記載](./site-recovery-vmware-to-azure-classicz.md#step-5-install-the-management-server)
    
6. *Resource Manager* Azure ネットワークを選択した場合、サーバーをデプロイするには次の情報が必要です。

    1. サーバーのデプロイ先のリソース グループを指定します。
    
    2. サーバーに名前を付けます。
    
    3. ログインに使用するユーザー名とパスワードを指定します。
    
    4. サーバーのデプロイ先のストレージ アカウントを選択します。
    
    5. サブネットとサブネットに接続するネットワーク インターフェイスを選択します。 注: 独自の [ネットワーク インターフェイス](../virtual-network/virtual-networks-multiple-nics.md) (NIC) を作成し、デプロイ時に選択する必要があります。
    
        ![](./media/site-recovery-failback-azure-to-vmware-classic/psinputsadd.png)
    
    6. [OK] をクリックします。 これにより、プロセス サーバーのセットアップで、デプロイメントの種類が Resource Manager の仮想マシンを作成するジョブがトリガーされます。 VM 内でセットアップを実行して、サーバーを構成サーバーに登録する必要があります。 [この手順](./site-recovery-vmware-to-azure-classic.md#step-5-install-the-management-server)に従って行います。

    7. プロセス サーバーをデプロイするジョブがトリガーされます。

7. 最後に、[構成サーバー] ページの [プロセス サーバー] タブにある関連付けられたサーバーのセクションにプロセス サーバーが表示されます。
    ![](./media/site-recovery-failback-azure-to-vmware-new/pslistingincs.png)

        
    >[AZURE.NOTE] サーバーは、 **[VM プロパティ]**には表示されません。 登録先の管理サーバーの **[サーバー]** タブにのみ表示されます。 プロセス サーバーの表示には、10 ～ 15 分かかります。


## <a name="set-up-the-master-target-server-on-premises"></a>マスター ターゲット サーバーをオンプレミスで設定する

マスター ターゲット サーバーは、フェールバック データを受信します。 マスター ターゲット サーバーは、オンプレミスの管理サーバーに自動的にインストールされますが、大量のデータをフェールバックする場合、マスター ターゲット サーバーを追加で設定した方がよい場合があります。 これを行うには、次の手順を実行します。

>[AZURE.NOTE] Linux にマスター ターゲット サーバーをインストールするには、次の手順に従います。

1. Windows にマスター ターゲット サーバーをインストールするには、マスター ターゲット サーバーをインストールする VM の [クイック スタート] ページを開き、Azure Site Recovery 統合セットアップ ウィザードのインストール ファイルをダウンロードします。
2. セットアップを実行し、**[開始する前に]** で **[Add additional process servers to scale out deployment (デプロイをスケールアウトするためにプロセス サーバーを追加する)]** を選択します。
3. [管理サーバーをセットアップ](site-recovery-vmware-to-azure-classic.md#step-5-install-the-management-server)したときと同様にウィザードを完了します。 **[構成サーバーの詳細]** ページで、このマスター ターゲット サーバーの IP アドレスと、VM にアクセスするためのパスフレーズを指定します。

### <a name="set-up-a-linux-vm-as-the-master-target-server"></a>マスター ターゲット サーバーとしての Linux VM をセットアップする
マスター ターゲット サーバーを実行する管理サーバーを Linux VM としてセットアップするには、CentOS 6.6 最小構成オペレーティング システムのインストール、各 SCSI ハード ディスクの SCSI ID の取得、追加パッケージのインストール、カスタム変更の適用を行う必要があります。

#### <a name="install-centos-6.6"></a>CentOS 6.6 をインストールする

1.  管理サーバー VM に CentOS 6.6 最小構成オペレーティング システムをインストールします。 DVD ドライブに ISO イメージを保持し、システムを起動します。 メディア テストをスキップします。次に、言語として日本語を選択し、**[基本ストレージ デバイス]** を選択します。ハード ドライブに重要なデータがないことを確認したら、**[はい]** をクリックしてすべてのデータを破棄します。 管理サーバーのホスト名を入力し、サーバーのネットワーク アダプターを選択します。  **[Editing System (編集システム)]** ダイアログで **[自動的に接続する]** を選択し、静的 IP アドレス設定、ネットワーク設定、DNS 設定を追加します。 管理サーバーにアクセスするためにタイム ゾーンとルート パスワードを指定します。 
2.  希望するインストールの種類を求められたら、パーティションとして **[Create Custom Layout (カスタム レイアウトを作成する)]** を選択します。  **[次へ]** select **[Free (Free)]** を選択して、[作成] をクリックします。 **FS Type:** **ext4** を使用して、**/**、**/var/crash**、**/home** の各パーティションを作成します。 **FS Type: swap**としてスワップ パーティションを作成します。
3.  既存のデバイスが検出される場合、警告メッセージが表示されます。 **[フォーマット]** をクリックし、パーティション設定を使用してドライブをフォーマットします。 **[Write change to disk (変更をディスクに書き込む)]** をクリックして、パーティションの変更を適用します。
4.  **[Install boot loader (ブート ローダーをインストールする)]**  >  **[次へ]** の順に選択して、ルート パーティションにブート ローダーをインストールします。
5.  インストールが完了したら、 **[再起動]**をクリックします。


#### <a name="retrieve-the-scsi-ids"></a>SCSI ID を取得する

1. インストール後、VM 内の各 SCSI ハード ディスクの SCSI ID を取得します。 これを実行するには、管理サーバー VM をシャットダウンし、VMware の VM のプロパティで VM エントリを右クリックして、**[設定の編集]**  >  **[オプション]** の順にクリックします。
2. **[詳細設定]**  >  **[General item (全般)]** の順に選択し、**[構成パラメーター]** をクリックします。 このオプションは、コンピューターの実行中は無効になります。 アクティブにするには、コンピューターをシャット ダウンする必要があります。
3. **disk.EnableUUID** 行が存在する場合は、値が **True** (大文字と小文字が区別されます) に設定されていることを確認します。 設定されている場合、キャンセルして、ゲスト オペレーティング システムの起動後に、その OS 内で SCSI コマンドをテストします。 
4. この行が存在しない場合は、**[行の追加]** をクリックし、値を **True** に設定して行を追加します。 二重引用符は使用しないでください。

#### <a name="install-additional-packages"></a>追加パッケージをインストールする

いくつかその他のパッケージをダウンロードおよびインストールする必要があります。 

1.  マスター ターゲット サーバーがインターネットに接続されていることを確認します。
2.  **# yum install –y xfsprogs perl lsscsi rsync wget kexec-tools**コマンドを実行して、CentOS リポジトリから 15 個のパッケージをダウンロードし、インストールします。
3.  保護しているソース マシンが、ルートまたはブート デバイス用に Linux wit Reiser または XFS ファイル システムを実行している場合、次のようなパッケージを追加でインストールする必要があります。

    - # <a name="cd-/usr/local"></a>cd /usr/local
    - # <a name="wget-[http://elrepo.org/linux/elrepo/el6/x86_64/rpms/kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm](http://elrepo.org/linux/elrepo/el6/x86_64/rpms/kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm)"></a>wget [http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm](http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm)
    - # <a name="wget-[http://elrepo.org/linux/elrepo/el6/x86_64/rpms/reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm](http://elrepo.org/linux/elrepo/el6/x86_64/rpms/reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm)"></a>wget [http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm](http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm)
    - # <a name="rpm-–ivh-kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm-reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm"></a>rpm –ivh kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm
    - # <a name="wget-[http://mirror.centos.org/centos/6.6/os/x86_64/packages/xfsprogs-3.1.1-16.el6.x86_65.rpm](http://mirror.centos.org/centos/6.6/os/x86_64/packages/xfsprogs-3.1.1-16.el6.x86_65.rpm)"></a>wget [http://mirror.centos.org/centos/6.6/os/x86_64/Packages/xfsprogs-3.1.1-16.el6.x86_65.rpm](http://mirror.centos.org/centos/6.6/os/x86_64/Packages/xfsprogs-3.1.1-16.el6.x86_65.rpm)
    - # <a name="rpm-–ivh-xfsprogs-3.1.1-16.el6.x86_64.rpm"></a>rpm –ivh xfsprogs-3.1.1-16.el6.x86_64.rpm

#### <a name="apply-custom-changes"></a>カスタム変更を適用する

インストール後の手順と、パッケージのインストールが完了したら、次を実行して独自の変更を適用します。

1.  RHEL 6-64 ユニファイド エージェント バイナリを、VM にコピーします。 次のコマンドを実行して、バイナリを解凍します: **tar –zxvf <file name>**
2.  次のコマンドを実行して、アクセス許可を付与します: **# chmod 755 ./ApplyCustomChanges.sh**
3.  次のスクリプトを実行します: **# ./ApplyCustomChanges.sh**。 このスクリプトは一度だけ実行します。 スクリプトが正常に実行されたら、サーバーを再起動します。


## <a name="run-the-failback"></a>フェールバックを実行する

### <a name="reprotect-the-azure-vms"></a>Azure VM を再保護する

1.  [コンテナー] の [レプリケートされたアイテム] で、フェールオーバーされた VM を選択し、右クリックして **[再保護]** をクリックします。 マシンをクリックし、コマンド ボタンから再保護を選択することもできます。
2.  ブレードで、保護の方向として [Azure からオンプレミスへ] が既に選択されていることを確認します。
3.  **[マスター ターゲット サーバー]** と **[プロセス サーバー]** で、オンプレミスのマスター ターゲット サーバーと Azure VM プロセス サーバーを選択します。
4.  オンプレミスのディスクの復旧先となる **データストア** を選択します。 このオプションは、オンプレミスの VM を削除し、新しいディスクを作成する必要がある場合に使用されます。 ディスクが既に存在する場合、このオプションは無視されますが、値は指定しておく必要があります。 
5.  リテンション ドライブは、VM がオンプレミスにレプリケートされたときの特定の時点で停止するために使用されます。 リテンション ドライブの条件の一部を以下に示します。これらの条件を満たしていない場合、このドライブはマスター ターゲット サーバーに表示されません。
    a.[サインオン URL] ボックスに、次のパターンを使用して、ユーザーが Yardi eLearning アプリケーションへのサインオンに使用する URL を入力します。 ボリュームを他の目的 (レプリケーションのターゲットなど) に使用することはできません。b.  ボリュームをロック モードにすることはできません。
    c. ボリュームをキャッシュ ボリュームにすることはできません。 (そのボリュームに MT インストールが存在してはいけません。 PS + MT カスタム インストール ボリュームは、保持ボリュームの対象ではありません。 ここでは、インストール済みの PS + MT ボリュームが MT のキャッシュ ボリュームです)。d.  ボリューム ファイル システムの種類として、FAT および FAT32 は使用できません。
    e. ボリュームの容量は 0 以外である必要があります。
    e. Windows の既定の保持ボリュームは R ボリュームです。 
    f.SAML 属性の属性名またはスキーマ リファレンスを入力します。 Linux の既定の保持ボリュームは、/mnt/retention/ です。

6.  フェールバック ポリシーが自動的に選択されます。

7.  **[OK]** をクリックして再保護を開始すると、Azure からオンプレミス サイトに VM をレプリケートするジョブが開始されます。 進行状況は **[ジョブ]** タブで追跡できます。

別の場所に復元する場合は、マスター ターゲット サーバー用に構成したリテンション ドライブとデータ ストアを選択します。 オンプレミス サイトにフェールバックした場合、フェールバック保護計画の VMware VM はマスター ターゲット サーバーと同じデータ ストアを使用します。 レプリカの Azure VM を同じオンプレミスの VM に復元したい場合、オンプレミスの VM は、マスター ターゲット サーバーと同じデータ ストアに存在している必要があります。 オンプレミスに VM がない場合、再保護時に新しいものが作成されます。
    ![](./media/site-recovery-failback-azure-to-vmware-new/reprotectinputs.png)



また、復旧計画レベルで再保護を実行することもできます。 レプリケーション グループがある場合、グループを再保護するには、復旧計画を使用する必要があります。 復旧計画を使用した再保護では、保護対象のすべてのマシンに上記の値を指定する必要があります。 

>[AZURE.NOTE] レプリケーション グループは、同じマスター ターゲットを使用して保護する必要があります。 別のマスター ターゲット サーバーを使用して保護されている場合、共通の時点を取得できません。

### <a name="run-a-failover-to-the-on-premises-site"></a>オンプレミス サイトでフェールオーバーを実行する

VM を再保護したら、Azure からオンプレミスへのフェールオーバーを開始できます。 

1.  [レプリケートされたアイテム] ページで仮想マシンを選択し、右クリックして **[計画されていないフェールオーバー]**をクリックします。
2.  **[フェールオーバーの確認]** で、フェールオーバーの方向 (Azure から) を確認し、フェールオーバーに使用する最新の復旧ポイント (最新のアプリケーション整合性ポイント) を選択します。 アプリケーション整合性ポイントは最新の時点よりも過去になるため、一部のデータが失われます。
3.  フェールオーバー中に、Site Recovery によって Azure VM がシャット ダウンされます。 フェールバックが期待どおりに完了したことを確認したら、Azure VM が期待どおりにシャット ダウンされたこと確認します。

### <a name="reprotect-the-on-premises-site"></a>オンプレミス サイトを再保護する

フェールバックが完了したら、Azure に復旧された VM が確実に削除されるように、仮想マシンをコミットする必要があります。

1. 保護された項目を右クリックし、[コミット] をクリックします。 Azure に復旧された前の仮想マシンを削除するジョブがトリガーされます。

コミットが完了したら、データはオンプレミス サイトに戻りますが、保護はされていません。 Azure に再度レプリケートを開始するには、次を実行します。

1.  [コンテナー]、[設定]、[レプリケートされたアイテム] の順にクリックして、フェールバックされた VM を選択し、**[再保護]** をクリックします。 
2.  Azure にデータを送信する際に使用する必要があるプロセス サーバーの値を指定します。
3.  [OK] をクリックすると、再保護ジョブが開始されます。

再保護が完了すると、VM が Azure にレプリケートされるので、フェールオーバーを実行できます。


### <a name="common-issues-in-failback"></a>フェールバックに関する一般的な問題

1. 読み取り専用ユーザー vCenter の検出を実行し、仮想マシンを保護すると、適切に動作し、フェールオーバーが実行されます。 再保護の場合は、データストアを検出できないため失敗します。 症状としては、再保護中はデータストアの一覧が表示されません。 これを解決するには、適切な権限を持つアカウントを使用して vCenter 資格情報を更新し、ジョブを再試行します。 [詳細については、こちらを参照してください。](site-recovery-vmware-to-azure-classic.md#vmware-permissions-for-vcenter-access)
2. Linux VM をフェールバックし、オンプレミスで実行すると、ネットワーク マネージャー パッケージがマシンからアンインストールされます。 これは、Azure で VM が復旧したときに、ネットワーク マネージャーのパッケージが削除されるためです。
3. VM が静的 IP アドレスで構成されている場合、Azure にフェールオーバーされると、IP アドレスは DHCP 経由で取得されます。 オンプレミスにフェールオーバーで戻るとき、VM は引き続き DHCP を使用して、IP アドレスを取得します。 このため、必要に応じて手動でコンピューターにログインし、IP アドレスを静的アドレスに設定し直す必要があります。
4. ESXi 5.5 Free エディションまたは vSphere 6 Free エディションのいずれかを使用すると、フェールオーバーは成功しますが、フェールバックが失敗します。 いずれかの評価ライセンスにアップグレードして、フェールバックを有効にする必要があります。

## <a name="failing-back-with-expressroute"></a>ExpressRoute を使用したフェールバック

VPN 接続または Azure ExpressRoute を使用してフェールバックできます。 ExpressRoute を使用する場合、次に注意してください。

- ExpressRoute が、ソース マシンがフェールオーバーする、フェールオーバーの発生後に Azure VM が配置される Azure VM 仮想ネットワーク上に設定されている必要があります。
- データは、パブリック エンドポイントの Azure ストレージ アカウントに複製されます。 ExpressRoute を使用するには、Site Recovery のレプリケーション用のターゲット データ センターを使用して ExpressRoute でパブリック ピアリングを設定する必要があります。






<!---HONumber=Oct16_HO2-->


