---
title: "Azure Site Recovery の監視とトラブルシューティング | Microsoft Docs"
description: "ポータルを使って、Azure Site Recovery でのレプリケーションの問題と動作の監視およびトラブルシューティングを行います"
services: site-recovery
documentationcenter: 
author: bsiva
manager: abhemraj
editor: raynew
ms.assetid: 
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 02/22/2018
ms.author: bsiva
ms.openlocfilehash: bb453f6c16440fae8a12cc1c4890a473ce541f45
ms.sourcegitcommit: fbba5027fa76674b64294f47baef85b669de04b7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/24/2018
---
# <a name="monitoring-and-troubleshooting-azure-site-recovery"></a>Azure Site Recovery の監視とトラブルシューティング

この記事では、Azure Site Recovery の組み込み監視機能を使って監視とトラブルシューティングを行う方法を説明します。 以下の項目について説明します。
> [!div class="checklist"]
> - Azure Site Recovery ダッシュボードを使用する (コンテナーの概要ページ)
> - レプリケーションを監視して問題をトラブルシューティングする
> - Azure Site Recovery のジョブ/操作を監視する
> - 電子メール通知に登録する

## <a name="using-the-azure-site-recovery-dashboard"></a>Azure Site Recovery ダッシュボードの使用

Azure Site Recovery ダッシュボードのコンテナーの概要ページには、コンテナーのすべての監視情報がまとめられています。 コンテナーのダッシュボードから開始し、ダッシュボードの各部分を移動して詳しい情報を取得します。 Azure Site Recovery ダッシュボードの主要な部分は次のとおりです。

### <a name="1-switch-between-azure-backup-and-azure-site-recovery-dashboards"></a>1.Azure Backup ダッシュボードと Azure Site Recovery ダッシュボードを切り替える

概要ページの上部にあるトグル スイッチを使って、Site Recovery と Backup のダッシュボード ページを切り替えることができます。 この選択は記憶されていて、コンテナーの概要ページを次に開いたときに既定で表示されます。 Site Recovery ダッシュボードを表示するには、[Site Recovery] オプションを選びます。 

Azure Site Recovery ダッシュボード ページのさまざまな部分は 10 分ごとに自動的に更新されるので、ダッシュボードには入手可能な最新の情報が反映されます。

![Azure Site Recovery 概要ページの監視機能](media/site-recovery-monitor-and-troubleshoot/site-recovery-overview-page.png)

### <a name="2-replicated-items"></a>2.レプリケートされたアイテム

ダッシュボードの [レプリケートされたアイテム] セクションには、コンテナー内の保護されたサーバーのレプリケーションの正常性の概要が示されます。 

<table>
<tr>
    <td>Healthy</td>
    <td>これらのサーバーのレプリケーションは正常に進行中であり、エラーや警告の兆候は検出されていません。</td>
</tr>
<tr>
    <td>警告 </td>
    <td>レプリケーションに影響する可能性のある、またはレプリケーションが正常に行われていないことを示す可能性のある 1 つ以上の警告現象が、これらのサーバーで検出されました。</td>
</tr>
<tr>
    <td>重大</td>
    <td>これらのサーバーで、1 つ以上の重大なレプリケーション エラーの現象が検出されました。 これらのエラー現象は、通常、レプリケーションがスタックしていること、またはサーバーのデータ変更速度と同じくらいの速さで処理が行われていないことを示します。</td>
</tr>
<tr>
    <td>適用不可</td>
    <td>現在、サーバーはレプリケートを行っていないものと思われます (フェールオーバーされたサーバーなど)。</td>
</tr>
</table>

レプリケーションの正常性でフィルター処理された保護されたサーバーの一覧を表示するには、ドーナツの横にあるレプリケーションの正常性の説明をクリックします。 セクション タイトルの近くにある [すべて表示] リンクは、コンテナーのレプリケート済みアイテム ページへのショートカットです。 コンテナー内のすべてのサーバーの一覧を表示するには、[すべて表示] リンクを使います。

### <a name="3-failover-test-success"></a>手順 3.フェールオーバー テスト成功

ダッシュボードの [フェールオーバー テスト成功] セクションには、テスト フェールオーバーの状態に基づく、コンテナー内の仮想マシンの分類が表示されます。 

<table>
<tr>
    <td>テストをお勧めします</td>
    <td>保護された状態に達したときからテスト フェールオーバーが成功したことのない仮想マシンです。</td>
</tr>
<tr>
    <td>正常に実行されました</td>
    <td>1 つ以上のテスト フェールオーバーが成功した仮想マシンです。</td>
</tr>
<tr>
    <td>適用不可</td>
    <td>現在はテスト フェールオーバーの対象にならない仮想マシンです。 例: フェールオーバーされたサーバー、初期レプリケーションが進行中のサーバー、フェールオーバーが進行中のサーバー、テスト フェールオーバーが既に進行中のサーバー。</td>
</tr>
</table>

ドーナツの横にあるテスト フェールオーバーの状態をクリックすると、テスト フェールオーバーの状態に基づく保護されたサーバーの一覧が表示されます。
 
> [!IMPORTANT]
> ベスト プラクティスとして、6 か月ごとに少なくとも 1 回は保護されたサーバーのテスト フェールオーバーを実行することをお勧めします。 テスト フェールオーバーの実行は、サーバーとアプリケーションを分離された環境に試験的にフェールオーバーする非破壊的な方法であり、ビジネス継続性の準備状況を評価するのに役立ちます。

 サーバーまたは復旧計画に対するテスト フェールオーバー操作は、テスト フェールオーバー操作とクリーンアップ テスト フェールオーバー操作の両方が正常に完了した後でのみ、成功と見なされます。

### <a name="4-configuration-issues"></a>4.構成の問題

[構成の問題] セクションには、仮想マシンを正常にフェールオーバーする機能に影響を与える可能性のある問題の一覧が表示されます。 このセクションに一覧表示される問題のクラスは次のとおりです。
 - **構成がありません:** 回復ネットワークや回復リソース グループなどの必要な構成がない保護されたサーバーです。
 - **リソースがありません:** 構成済みのターゲット リソースまたは回復リソースが、サブスクリプションで見つからないか、使用できません。 たとえば、リソースが削除されたか、別のサブスクリプションまたはリソース グループに移行されました。 可用性を監視されるターゲット/回復構成は、ターゲット リソース グループ、ターゲット仮想ネットワークとサブネット、ログ/ターゲット ストレージ アカウント、ターゲット可用性セット、ターゲット IP アドレスです。
 - **サブスクリプション クォータ:** 使用可能なサブスクリプション リソース クォータの残量が、コンテナー内のすべての仮想マシンをフェールオーバーできるために必要な残量と比較されます。 使用可能な残量が不足していると、クォータ残量不足が報告されます。 クォータを監視される Azure リソースは、仮想マシンのコア数、仮想マシン ファミリのコア数、ネットワーク インターフェイス カード (NIC) の数です。
 - **ソフトウェア更新プログラム:** 新しいソフトウェア更新プログラムの可用性、ソフトウェア バージョンの期限切れです。

構成の問題 (ソフトウェア更新プログラムの可用性以外) は、既定では 12 時間ごとに実行される定期的な検証コントロール操作によって検出されます。 "*構成の問題*" のセクション見出しの横にある更新アイコンをクリックすることにより、検証コントロール操作を強制的にすぐ実行できます。

リンクをクリックすると、一覧表示された問題とそれらによって影響を受ける仮想マシンについての詳細が表示されます。 特定の仮想マシンに影響する問題については、仮想マシンのターゲット構成列の下にある **[要注意]** リンクをクリックすることで詳細を表示できます。 詳細には、検出された問題を修復する方法に関する推奨事項が含まれます。

### <a name="5-error-summary"></a>5.エラーの概要

[エラーの概要] セクションには、コンテナー内のサーバーのレプリケーションに影響を与える可能性がある現在アクティブなレプリケーション エラーの現象と、各エラーが原因で影響を受けたエンティティの数が表示されます。

重大または警告レプリケーション正常性状態のサーバーに対するレプリケーション エラーの現象は、エラーの概要テーブルで確認できます。 

- オンプレミスの構成サーバー、VMM サーバー、または Hyper-V ホストで実行されている Azure Site Recovery Provider からのハートビートの受信不能など、オンプレミスのインフラストラクチャ コンポーネントに影響を与えているエラーが、[エラーの概要] セクションの先頭に一覧表示されます。
- その次に、保護されたサーバーに影響するレプリケーション エラーの現象が一覧表示されます。 エラーの概要テーブルのエントリは、最初にエラーの重大度の高い順に、次に影響を受けたサーバーの数の多い順に、並べ替えられます。
 

> [!NOTE]
> 
>  複数のレプリケーション エラー現象が、1 台のサーバーで検出される場合があります。 1 台のサーバーに複数のエラー現象がある場合、そのサーバーは影響を受けるサーバーの一覧でエラー現象ごとにカウントされます。 エラー現象の原因になっている問題が解決すると、レプリケーション パラメーターは改善し、仮想マシンからエラーがクリアされます。
>
> > [!TIP]
> 影響を受けたサーバーの数は、基になる 1 つの問題が複数のサーバーに影響するかどうかを理解するのに役立ちます。 たとえば、ネットワークの不具合は、オンプレミスのサイトから Azure にレプリケートするすべてのサーバーに影響を与える可能性があります。 このビューでは、基になっているその 1 つの問題を解決すると複数のサーバーのレプリケーションが修正されることが簡単にわかります。
>

### <a name="6-infrastructure-view"></a>6.インフラストラクチャ ビュー

インフラストラクチャ ビューでは、レプリケーションに関連するインフラストラクチャ コンポーネントのシナリオ対応のビジュアル表現が提供されます。 また、さまざまなサーバー間の接続およびサーバーとレプリケーションに関連する Azure サービスの間の接続の正常性も視覚的に示されます。 

緑の線は接続が正常であることを示すのに対し、エラー アイコンが重ねて表示されている赤い線は、関係するコンポーネント間の接続に影響する 1 つ以上のエラー現象が存在することを示します。 線のエラー アイコンをマウス ポインターでポイントすると、エラーと影響を受けるエンティティの数が表示されます。 

エラー アイコンをクリックすると、そのエラーの影響を受けるエンティティのフィルター処理された一覧が表示されます。

![Site Recovery のインフラストラクチャ ビュー (コンテナー)](media/site-recovery-monitor-and-troubleshoot/site-recovery-vault-infra-view.png)

> [!TIP]
> オンプレミスのインフラストラクチャ コンポーネント (構成サーバー、その他のプロセス サーバー、レプリケートする VMware 仮想マシン、Hyper-V ホスト、VMM サーバー) が、最新バージョンの Azure Site Recovery ソフトウェアを実行していることを確認してください。 インフラストラクチャ ビューのすべての機能を使用できるようにするには、Azure Site Recovery の[更新プログラムのロールアップ 22](https://support.microsoft.com/help/4072852) 以降を実行している必要があります

インフラストラクチャ ビューを使うには、ソース環境に応じて、適切なレプリケーション シナリオ (Azure 仮想マシン、VMware 仮想マシン/物理サーバー、または Hyper-V) を選びます。 コンテナーの概要ページに表示されるインフラストラクチャ ビューは、コンテナーの集計されたビューです。 ボックスをクリックすることで、個別のコンポーネントにさらにドリルダウンすることができます。

単一のレプリケートするマシンのコンテキストにスコープ設定されたインフラストラクチャ ビューは、レプリケートされるアイテムの概要ページで確認できます。 レプリケートするサーバーの概要ページに移動するには、コンテナーのメニューからレプリケートされるアイテムに移動して、詳細を表示するサーバーを選びます。

### <a name="infrastructure-view---faq"></a>インフラストラクチャ ビュー - FAQ

**Q.** 使っている VM のインフラストラクチャ ビューが表示されないのはなぜですか。 </br>
**A.** インフラストラクチャ ビュー機能は、Azure にレプリケートしている仮想マシンについてのみ使用できます。 現在は、オンプレミスのサイト間でレプリケートしている仮想マシンには使用できません。

**Q.** コンテナーのインフラストラクチャ ビューに表示される仮想マシンの数が、レプリケートされたアイテムのドーナツに表示される合計数と異なるのはなぜですか。</br>
**A.** コンテナーのインフラストラクチャ ビューは、レプリケーション シナリオによってスコープ設定されています。 インフラストラクチャ ビューに表示される仮想マシンの数には、現在選択されているレプリケーション シナリオに参加している仮想マシンだけが含まれます。 また、選択されているシナリオでは、Azure にレプリケートするように現在構成されている仮想マシンのみが、インフラストラクチャ ビューに表示される仮想マシンの数に含まれます (例: フェールオーバーされた仮想マシンの場合、オンプレミスのサイトにレプリケートして戻される仮想マシンは、インフラストラクチャ ビューに含まれません)。

**Q.** 概要ページの基本ドロアーに表示されるレプリケートされたアイテムの数が、ダッシュボードのドーナツ グラフに表示されるレプリケートされたアイテムの合計数と異なるのはなぜですか。</br>
**A.** 基本ドロアーに表示される数には、初期レプリケーションが完了した仮想マシンだけが含まれます。 ドーナツのレプリケートされたアイテムの合計には、初期レプリケーションが現在進行中のサーバーを含む、コンテナー内のすべての仮想マシンが含まれます。

**Q.** インフラストラクチャ ビューはどのようなレプリケーション シナリオに利用できますか。 </br>
**A.**
>[!div class="mx-tdBreakAll"]
>|レプリケーション シナリオ  | VM の状態  | インフラストラクチャ ビューを使用できるか  |
>|---------|---------|---------|
>|2 つのオンプレミス サイト間でレプリケートする仮想マシン     | -        | いいえ       |
>|すべて     | フェールオーバー済み         |  いいえ        |
>|2 つの Azure リージョン間でレプリケートする仮想マシン     | 初期レプリケーション進行中または保護済み         | [はい]         |
>|Azure にレプリケートする VMware 仮想マシン     | 初期レプリケーション進行中または保護済み        | [はい]        |
>|Azure にレプリケートする VMware 仮想マシン     | オンプレミスの VMware サイトにレプリケートして戻されるフェールオーバーされた仮想マシン         | いいえ         |
>|Azure にレプリケートする Hyper-V 仮想マシン     | 初期レプリケーション進行中または保護済み        | [はい]       |
>|Azure にレプリケートする Hyper-V 仮想マシン     | フェールオーバー済み/フェールバック実行中        |  いいえ        |


### <a name="7-recovery-plans"></a>7.復旧計画

[復旧計画] セクションには、コンテナー内の復旧計画の数が表示されます。 復旧計画の一覧表示、新しい復旧計画の作成、または既存の復旧計画の編集を行うには、数字をクリックします。 

### <a name="8-jobs"></a>8.[ジョブ]

Azure Site Recovery ジョブは、Azure Site Recovery 操作の状態を追跡します。 Azure Site Recovery のほとんどの操作は非同期的に実行され、操作の進行状況を追跡するには追跡ジョブが使われます。  操作の状態を監視する方法については、「[Azure Site Recovery のジョブ/操作を監視する](#monitor-azure-site-recovery-jobsoperations)」セクションをご覧ください。

ダッシュボードのこの [ジョブ] セクションには、次の情報が表示されます。

<table>
<tr>
    <td>失敗</td>
    <td>過去 24 時間に失敗した Azure Site Recovery ジョブ</td>
</tr>
<tr>
    <td>進行中</td>
    <td>現在進行中の Azure Site Recovery ジョブ</td>
</tr>
<tr>
    <td>入力待ち</td>
    <td>ユーザーからの入力を待って現在一時停止している Azure Site Recovery ジョブ。</td>
</tr>
</table>

セクション見出しの横にある [すべて表示] リンクは、ジョブ一覧ページに移動するショートカットです。

## <a name="monitor-and-troubleshoot-replication-issues"></a>レプリケーションを監視して問題をトラブルシューティングする

コンテナーのダッシュボード ページに表示される情報に加えて、仮想マシン一覧ページと仮想マシン詳細ページでも、その他の詳細とトラブルシューティング情報を得ることができます。 コンテナーのメニューの **[レプリケートされたアイテム]** オプションを選ぶことで、コンテナー内で保護されている仮想マシンの一覧を表示できます。 または、コンテナーのダッシュボード ページにあるスコープ設定されたショートカットのいずれかをクリックして、保護されたアイテムのフィルター処理された一覧を表示することもできます。

![Site Recovery のレプリケートされたアイテムの一覧表示](media/site-recovery-monitor-and-troubleshoot/site-recovery-virtual-machine-list-view.png)

レプリケートされたアイテムの一覧ページのフィルター オプションでは、レプリケーションの正常性やレプリケーション ポリシーなど、さまざまなフィルターを適用できます。 

列セレクター オプションを使うと、RPO、ターゲットの構成の問題、レプリケーション エラーなど、列の追加表示を指定できます。 マシン一覧の特定の行を右クリックすることにより、仮想マシンで操作を開始したり、仮想マシンに影響を与えるエラーを表示したりできます。

さらにドリルダウンするには、仮想マシンをクリックして選びます。 これにより、仮想マシンの詳細ページが開きます。 仮想マシンの詳細の下の概要ページに含まれるダッシュボードでは、そのマシンに関する追加情報を見ることができます。 

レプリケートするマシンの概要ページには、次の情報が表示されます。
- RPO (目標復旧時点): 仮想マシンの現在の RPO と、RPO が最後に計算された日時。
- マシンの利用可能な最新の回復ポイント
- マシンのフェールオーバーの準備に影響する可能性がある構成の問題 (ある場合)。 リンクをクリックすると詳細情報が表示されます。
- エラーの詳細: 現在マシンで検出されているレプリケーション エラーの現象の一覧と、考えられる原因および推奨される改善策
- イベント: マシンに影響を与える最近のイベントの時系列での一覧。 エラーの詳細には現在検出可能なエラー現象が表示されるのに対し、イベントには、マシンで以前に認識されたエラー現象など、マシンに影響を与える可能性があるさまざまなイベントの履歴レコードが表示されます。
- Azure にレプリケートするマシンのインフラストラクチャ ビュー

![Site Recovery のレプリケートされたアイテムの詳細/概要](media/site-recovery-monitor-and-troubleshoot/site-recovery-virtual-machine-details.png)

ページの上部にあるアクション メニューでは、仮想マシンでのテスト フェールオーバーなど、さまざまな操作を実行するオプションが提供されています。 アクション メニューのエラー詳細ボタンを使うと、レプリケーション エラー、構成の問題、および構成のベスト プラクティスに基づく仮想マシンに対する警告など、現在アクティブなエラーをすべて確認できます。

> [!TIP]
> RPO または目標復旧時点は、利用可能な最新の回復ポイントとどのように異なりますか。
> 
>Azure Site Recovery は、マルチ ステップの非同期プロセスを使って、Azure に仮想マシンをレプリケートします。 レプリケーションの最後から 2 番目のステップで、仮想マシンでの最新の変更とメタデータが、ログ/キャッシュ ストレージ アカウントにコピーされます。 これらの変更と、回復可能ポイントを識別するためのタグが、ターゲット リージョンのストレージ アカウントに書き込まれた後は、Azure Site Recovery は仮想マシンの回復可能ポイントを生成するために必要な情報を得られます。 この時点で、RPO はそれまでにストレージ アカウントにアップロードされた変更に対して満たされています。 つまり、時間単位で表されたこの時点での仮想マシンの RPO は、回復可能ポイントに対応するタイムスタンプからの経過時間と等しくなります。
>
>バックグラウンドで動作している Azure Site Recovery サービスは、ストレージ アカウントからアップロードされたデータを取得し、仮想マシン用に作成されたレプリカ ディスクに適用します。 その後、回復ポイントを生成し、このポイントをフェールオーバー時に回復で利用できるようにします。 利用可能な最新の回復ポイントは、既に処理されてレプリカ ディスクに適用された最新の回復ポイントに対応するタイムスタンプを示します。
>> [!WARNING]
> レプリケートするソース マシンまたはオンプレミスのインフラストラクチャ サーバーでクロックがずれていたり、システム時刻が正しくないと、計算される RPO 値が正しくなくなります。 正確な RPO 値が報告されるようにするには、レプリケーションに関係するサーバーのシステム クロックが正しいことを確認してください。 
>

## <a name="monitor-azure-site-recovery-jobsoperations"></a>Azure Site Recovery のジョブ/操作を監視する

Azure Site Recovery は、指定された操作を非同期に実行します。 実行できる操作の例としては、レプリケーションの有効化、復旧計画の作成、テスト フェールオーバー、レプリケーションの設定の更新などがあります。このような操作のすべてに、操作の追跡と監査のための作成される対応するジョブがあります。 ジョブ オブジェクトは、操作の状態と進行状況を追跡するために必要なすべての情報を持っています。 コンテナーに対するさまざまな Site Recovery 操作の状態を、[ジョブ] ページから追跡できます。 

コンテナーの Site Recovery ジョブの一覧を表示するには、コンテナー メニューの **[監視およびレポート]** セクションで、[ジョブ] > [Site Recovery ジョブ] を選びます。 ページのジョブ一覧でジョブをクリックして選ぶと、指定したジョブの詳細が表示されます。 ジョブが正常に完了していない場合、またはエラーが発生した場合は、ジョブ詳細ページの上部にあるエラー詳細ボタンをクリックすることで、エラーについての詳細と考えられる修復方法を確認できます (この情報は、ジョブ一覧ページで失敗したジョブを右クリックして表示することもできます)。ジョブ一覧ページの上部にあるアクション メニューのフィルター オプションを使うと、特定の条件に基づいて一覧をフィルター処理でき、エクスポート ボタンを使うと、選んだジョブの詳細を Excel にエクスポートできます。 ジョブの一覧表示には、Site Recovery ダッシュボード ページのショートカットからアクセスすることもできます。 

 Azure Portal から実行する操作の場合は、作成されたジョブとその現在の状態を、Azure Portal の通知セクション (右上のベル アイコン) から追跡することもできます。

## <a name="subscribe-to-email-notifications"></a>電子メール通知に登録する

組み込みのメール通知機能を使うと、重大なイベントのメール通知の受け取りを登録することができます。 登録した場合、次のイベントに対してメール通知が送信されます。
- レプリケートするマシンのレプリケーションの正常性が重大に低下した場合。
- オンプレミスのインフラストラクチャ コンポーネントと Azure Site Recovery サービスの間に接続がない場合。 コンテナーに登録されている構成サーバー (VMware) や System Center Virtual Machine Manager(Hyper-V) などのオンプレミスのインフラストラクチャ コンポーネントから Site Recovery サービスへの接続は、ハートビート メカニズムを使って検出されます。
- フェールオーバー操作が失敗した場合。

Azure Site Recovery のメール通知の受け取りを登録するには、コンテナー メニューの **[監視およびレポート]** セクションに移動して、次のようにします。
1. [アラートとイベント] > [Azure Site Recovery イベント] の順に選びます。
2. 開かれるイベント ページの上部にあるメニューから、[メール通知] を選びます。
3. メール通知ウィザードを使って、メール通知をオンまたはオフにし、通知の受信者を選びます。 すべてのサブスクリプション管理者に通知を送るように指定したり、通知の送り先のメール アドレス一覧を提供したりできます。 