
<properties
	pageTitle="Azure Site Recovery: 単一 VMM サーバー上で Hyper-V 仮想マシンをレプリケートする | Microsoft Azure"
	description="この記事では、VMM サーバーが 1 台のみの場合に Hyper-V 仮想マシンをレプリケートする方法について説明します。"
	services="site-recovery"
	documentationCenter=""
	authors="rayne-wiselman"
	manager="jwhit"
	editor=""/>

<tags
	ms.service="site-recovery"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="backup-recovery"
	ms.date="07/06/2016"
	ms.author="raynew"/>

#  単一 VMM サーバー上で Hyper-V 仮想マシンをレプリケートする

この記事では、デプロイに単一 VMM サーバーしかない場合に、VMM クラウドの Hyper-V ホスト サーバー上に配置されている Hyper-V 仮想マシンをレプリケートする方法について説明します。

この記事の内容について質問がある場合は、記事の下部にあるコメント欄に記入するか、[Azure Recovery Services フォーラム](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr)に投稿してください。

## 概要

VMM クラウドの Hyper-V ホストに配置された Hyper-V VM は、次の 2 つの方法でレプリケートできます。

- Azure にレプリケートする。
- セカンダリ VMM サイトにレプリケートする。

しかし、セカンダリ VMM サイトにレプリケートしたいが、デプロイに単一 VMM サーバーしかない場合はどうすればよいのでしょうか?

このようなシナリオには、次の 2 つのオプションがあります。

- VMM クラウドの Hyper-V VM を Azure にレプリケートする。このシナリオについて詳細は[こちら](site-recovery-vmm-to-azure.md)をご覧ください。
- 単一 VMM サーバー上のクラウド間でレプリケートする。

1 番目のオプションをお勧めするのは、2 番目のオプションではフェールオーバーや復旧がシームレスではなく、またいくつもの手動による手順が必要となるからです。Azure に対してではなくサイト間でレプリケートする場合は、2 つのオプションを使用できます。


## 単一スタンドアロンの VMM サーバーでのサイト間レプリケート

サイト間でレプリケートするこのシナリオでは、単一 VMM サーバーを仮想マシンとしてプライマリ サイトにデプロイし、この VM を Site Recovery と Hyper-V レプリカを使用してセカンダリ サイトにレプリケートします。これを行うには、次の手順を実行します。

1. HYPER-V 仮想マシン上の VMM を設定します。この操作を行うときは、VMM によって使用される SQL Server インスタンスを同じ VM 上に配置することをお勧めします。1 つの VM をインスタンス化するだけでよいので時間節約になります。リモート インスタンスを使用したときに障害が発生した場合は、VMM を回復する前にインスタンスを回復する必要があります。
2. VMM サーバーには少なくとも 2 つのクラウドを構成してください。一方のクラウドにはレプリケートを行う VM が含まれ、もう一方のクラウドはセカンダリのロケーションとして機能します。保護する VM を含むクラウドには、以下が存在する必要があります。

	- 各グループに 1 つまたは複数の Hyper-V ホスト サーバーが登録されている 1 つまたは複数の VMM ホスト グループ。
	- 各 Hyper-V ホスト サーバー上の少なくとも 1 つの Hyper-V 仮想マシン。
3. Site Recovery コンテナーの作成、コンテナー登録キーの生成およびダウンロード、コンテナーへの VMM サーバー登録を行ってください。登録時に、VMM サーバーに Azure Site Recovery プロバイダーをインストールします。
4. VMM VM 上に 1 つまたは複数のクラウドを設定し、保護する VM を含む Hyper-V ホストをそれらのクラウドに追加します。
3. Azure Site Recovery でクラウドのための保護設定を構成します。ソースの場所とターゲットの場所で、単一の VMM サーバーの名前を指定します。ネットワーク マッピングを構成する場合、保護する VM を含むクラウドの VM ネットワークを、レプリケート先のクラウドの VM ネットワークにマップします。
4. 両方のクラウドが同じサーバーにあるので、レプリケーションの方法として**ネットワーク経由**を使用して、保護する VM のレプリケーションを有効にします。
4. Hyper-V マネージャー コンソールで、VMM VM を含む Hyper-V ホスト上での Hyper-V レプリカを有効にし、それから VM 上のレプリケーションを有効にします。Site Recovery で保護されているクラウドに対して VMM 仮想マシンを追加しないようにしてください。これは、Hyper-V レプリカの設定が Site Recovery によってオーバーライドされないようにするためです。
5. 復旧計画を作成する場合は、同じ VMM サーバーをソースとターゲットに指定します。

コンテナーの作成、キーの取得、サーバーへの登録、および保護の設定は、[こちらの記事](site-recovery-vmm-to-vmm.md)に記載されている手順に従って実行してください。

### 障害が発生した場合

障害が発生した場合は、次の手順で Hyper-V VM のワークロードを回復します。

1. Hyper-V マネージャーの計画されたフェールオーバーを使用して、手動で VMM VM をセカンダリ サイトにフェールオーバーします。
2. VMM VM が回復したら、セカンダリ サイトから Hyper-V Recovery Manager にログインし、セカンダリ サイトからプライマリ サイトへの VM の計画外のフェールオーバーを実行します。ワークロード VM をフェールオーバーする前に VMM VM を手動でセカンダリ サイトにフェールオーバーする必要があります。
3. 計画外のフェールオーバーが完了すると、プライマリ サイトからすべてのリソースに再びアクセスできるようになります。


![スタンドアロンの仮想 VMM サーバー](./media/site-recovery-single-vmm/single-vmm-standalone.png)

## ストレッチ クラスターの単一 VMM サーバーでのサイト間レプリケート

スタンドアロン VMM サーバーを仮想マシンとしてデプロイしセカンダリ サイトにレプリケートするのではなく、VM として Windows フェールオーバー クラスターにデプロイすることで VMM の可用性を高めることができます。これにより、ワークロードの回復力とハードウェア障害に対する保護が提供されます。Site Recovery でデプロイするには、VMM VM を地理的に離れたサイトにまたがるストレッチ クラスターにデプロイする必要があります。これを行うには、次の手順を実行します。

1. Windows フェールオーバー クラスターの仮想マシンに VMM をインストールし、セットアップ中にサーバーを可用性が高い状態で実行するオプションを選択します。
2. VMM によって使用される SQL Server インスタンスは SQL Server AlwaysOn 可用性グループでレプリケートする必要があります。それにより、セカンダリ サイト内にデータベースのレプリカが作成されます。

Site Recovery をセットアップするときに、クラスター内の各 VMM サーバーを Site Recovery コンテナーに登録する必要があります。これを行うには、プロバイダーをアクティブ ノードにインストールし、インストールを終了して VMM サーバーをコンテナーに登録します。次に、プロバイダーを他のノードにインストールします。
 
### 障害が発生した場合 

障害が発生すると、VMM サーバーと対応する SQL Server データベースがフェールオーバーされ、セカンダリ サイトからアクセスされるようになります。

![クラスター化された仮想 VMM サーバー](./media/site-recovery-single-vmm/single-vmm-cluster.png)

## 次のステップ

[VMM から VMM にレプリケートするための Site Recovery のデプロイの詳細](site-recovery-vmm-to-vmm.md)を確認します。




 

<!---HONumber=AcomDC_0706_2016-->