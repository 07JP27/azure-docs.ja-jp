---
title: "Azure からオンプレミスにフェールバックする方法 |Microsoft Docs"
description: "VM を Azure にフェールオーバーした後に、フェールバックを開始して VM をオンプレミスに戻すことができます。 フェールバックする方法の手順について説明します。"
services: site-recovery
documentationcenter: 
author: ruturaj
manager: gauravd
editor: 
ms.assetid: 44813a48-c680-4581-a92e-cecc57cc3b1e
ms.service: site-recovery
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: 
ms.date: 12/15/2016
ms.author: ruturajd
translationtype: Human Translation
ms.sourcegitcommit: 1a6dfb60f5db8b842af27b4c88bc3e5927331622
ms.openlocfilehash: 20446aadbb7bc3d13c5a38de5c4040f5898d4f6b


---
# <a name="failback-from-azure-to-on-premises"></a>Azure からオンプレミスへのフェールバック
この記事では、Azure からオンプレミス サイトへ Azure Virtual Machines をフェールバックする方法について説明します。 この記事の手順は、[このチュートリアル](site-recovery-vmware-to-azure-classic.md)を使用して、VMware 仮想マシンまたは Windows/Linux 物理サーバーをオンプレミス サイトから Azure にフェールオーバーした後に、それらをフェールバックする準備ができたときに実行します。

## <a name="overview"></a>概要
フェールバックのしくみは次のとおりです。

* Azure にフェールオーバー後、オンプレミス サイトへはいくつかの段階でフェールバックします。
  * **第 1 段階**: オンプレミス サイトで実行されている VMware VM へのレプリケートを開始できるように Azure VM を再保護します。 このためには、以下も実行する必要があります。 
        1. オンプレミスのマスター ターゲットをセットアップする
        2. プロセス サーバーをセットアップする
        3. 再保護を開始する
  * **第 2 段階**: Azure VM がオンプレミス サイトへのレプリケーションを開始したら、フェールオーバーを実行して Azure からフェールバックします。
  * **第 3 段階**: データがフェールバックされたら、フェールバック先のオンプレミスの VM を再保護します。これにより、オンプレミスの VM は Azure へのレプリケートを開始できるようになります。

### <a name="failback-to-the-original-or-alternate-location"></a>元のまたは別の場所にフェールバックする

    
VMware VM をフェールオーバーした場合、オンプレミスにまだ存在する場合、同じソース VM にフェールバックできます。 このシナリオにおいてのみ、差分変更のみがレプリケートされます。 このシナリオは、元の場所の復旧と呼ばれます。

* 元の VM にフェールバックする場合、次の条件が必要です。
  * vCenter サーバーで VM を管理する場合は、マスター ターゲットの ESX ホストが VM のデータストアにアクセスできる必要があります。
  * VM が ESX ホスト上にあっても、vCenter によって管理されていない場合、VM のハード ディスクは MT のホストがアクセスできるデータストア内に存在する必要があります。
  * VM が ESX ホスト上にあり vCenter を使用しない場合、再保護する前に、MT の ESX ホストの検出を完了する必要があります。 これは、物理サーバーにフェールバックする場合も同様です。

  
VM を再保護する前にオンプレミスの VM が存在しない場合、これは別の場所の復旧と呼ばれます。 子の場合、再保護ワークフローによってオンプレミスの VM が再作成されます。

* 別の場所にフェールバックすると、VM は、マスター ターゲット サーバーがデプロイされたのと同じ ESX ホストに復元されます。 ディスクを作成するために使用したデータストアは、VM の再保護時に選択したのと同じデータストアになります。
* VMFS データストアにのみフェールバックできます。 vSAN または RDM がある場合、再保護とフェールバックは機能しません。
* 再保護するには、最初の大規模データ転送に続き、差分変更が行われる必要があります。 これは、VM がオンプレミスに存在しないため、完全なデータをレプリケートする必要があるからです。 また、この再保護は元の場所の復旧よりも時間がかかります。

物理マシンは Azure にフェールオーバーした場合のみ、VMware 仮想マシンとしてフェールバックできます (P2A2V とも呼ばれます)。 このフローは、別の場所の復旧に該当します。

* Windows Server 2008 R2 SP1 マシンが保護されていて、Azure にフェールオーバーした場合、これをフェールバックすることはできません。
* 1 つ以上のマスター ターゲット サーバーと、フェールバック先として必要な ESX/ESXi ホストを必ず検出します。


## <a name="pre-requisites"></a>前提条件

* フェールバックする VM が vCenter サーバーによって管理されている場合、vCenter サーバー上の VM の検出に必要な権限があることを確認する必要があります。 詳細については、[こちら](site-recovery-vmware-to-azure-classic.md#vmware-permissions-for-vcenter-access)を参照してください。
* オンプレミスの VM 上にスナップショットがある場合、再保護は失敗します。 スナップショットを削除してから再保護に進むことができます。
* フェールバックを開始する前に、さらに&2; つのコンポーネントを作成する必要があります。
  * **プロセス サーバーを作成する**:  プロセス サーバーは、Azure の保護された VM からデータを受け取り、オンプレミスにデータを送信するために使用されます。 そのため、プロセス サーバーは、保護された VM との間の待機時間が短いネットワーク上にあることが必要です。 したがって、プロセス サーバーはオンプレミス (Express Route 接続を使用している場合)、または Azure (VPN を使用している場合) に配置できます。
  * **マスター ターゲット サーバーを作成する**: マスター ターゲット サーバーは、フェールバック データを受信します。 オンプレミスに作成した管理サーバーには、既定でマスター ターゲット サーバーがインストールされています。 ただし、フェールバック トラフィックの量によっては、フェールバック用に別のマスター ターゲット サーバーを作成する必要があります。 
        * Linux VM には Linux のマスター ターゲット サーバーが必要です。 
        * Windows VM には、Windows のマスター ターゲットが必要です。
* フェールバックを実行するときは、構成サーバーがオンプレミスに存在している必要があります。 フェールバック時に仮想マシンが構成サーバー データベースに存在していないと、フェールバックは失敗します。 サーバーを定期的にバックアップするようスケジュールを設定してください。 万一障害が発生した場合は、フェールバックが正常に機能するように、同じ IP アドレスで復元する必要があります。
* VMware でマスター ターゲット VM の構成パラメーターに disk.enableUUID=true が設定されていることを確認してください。 この行が存在しない場合は追加してください。 これは、一貫性のある UUID を VMDK に提供することで適切なマウントが実行されるようにするために必要です。
* **マスター ターゲット サーバーをストレージ vMotioned にすることはできません**。 そのようにした場合、フェールバックが失敗する可能性があります。 ディスクが利用可能にならないため、この VM は起動しません。
* マスター ターゲット サーバーに新しいドライブを追加する必要があります。 このドライブはリテンション ドライブと呼ばれます。 新しいディスクを追加し、ドライブをフォーマットします。


## <a name="steps-to-failback"></a>フェールバックする手順

フェールバックを開始する前に、**仮想マシンの再保護が完了していることを確認します**。 仮想マシンは、正常性が維持され、保護された状態になければなりません。 仮想マシンの再保護の詳細については、[再保護する方法](site-recovery-how-to-reprotect.md)に関する記事をご覧ください。


1. [レプリケートされたアイテム] ページで仮想マシンを選択し、右クリックして **[計画されていないフェールオーバー]**をクリックします。
2. **[フェールオーバーの確認]** で、フェールオーバーの方向 (Azure から) を確認し、フェールオーバーに使用する最新の復旧ポイント (最新のアプリケーション整合性ポイント) を選択します。 アプリケーション整合性ポイントは最新の時点よりも過去になるため、一部のデータが失われます。
3. フェールオーバー中に、Site Recovery によって Azure VM がシャット ダウンされます。 フェールバックが期待どおりに完了したことを確認したら、Azure VM がシャット ダウンされたこと確認します。

## <a name="next-steps"></a>次のステップ

フェールバックが完了したら、Azure に復旧された VM が確実に削除されるように、仮想マシンをコミットする必要があります。

1. 保護された項目を右クリックし、[コミット] をクリックします。 Azure にフェールオーバーされた仮想マシンを削除するジョブがトリガーされます。

コミットが完了したら、VM はオンプレミス サイトに戻りますが、保護はされていません。 Azure に再度レプリケートを開始するには、次を実行します。

1. [コンテナー]、[設定]、[レプリケートされたアイテム] の順にクリックして、フェールバックされた VM を選択し、**[再保護]** をクリックします。
2. Azure にデータを送信する際に使用する必要があるプロセス サーバーの値を指定します。
3. [OK] をクリックすると、再保護ジョブが開始されます。

再保護ジョブが完了すると、VM が Azure にレプリケートされるので、フェールオーバーを実行できます。

## <a name="common-issues"></a>一般的な問題





<!--HONumber=Feb17_HO2-->


