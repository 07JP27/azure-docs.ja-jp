---
title: "Site Recovery のしくみ  | Microsoft Docs"
description: "この記事では、Site Recovery アーキテクチャの概要を説明します"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/02/2017
ms.author: raynew
translationtype: Human Translation
ms.sourcegitcommit: bd8082c46ee36c70e372208d1bd15337acc558a1
ms.openlocfilehash: eb97f66901efa336942dee56d9a8a62ade1f6842


---
# <a name="how-does-azure-site-recovery-work"></a>Azure Site Recovery のしくみ

この記事では、Azure Site Recovery サービスの基になるアーキテクチャと、それを機能させるためのコンポーネントについて説明します。

組織には、予定されたダウンタイムおよび予定外のダウンタイム時にアプリ、ワークロード、およびデータの実行と利用可能な状態を維持し、できるだけ早く通常の動作状態に復旧させる方法を決定する BCDR の戦略が必要です。 BCDR 戦略は、災害発生時にビジネス データを安全かつ回復可能な状態に維持し、ワークロードが継続的に利用可能な状態に保たれるようなものである必要があります。

Site Recovery とは、クラウド (Azure) またはセカンダリ データセンターへのオンプレミスの物理サーバーおよび仮想マシンのレプリケーションを統制することで BCDR 戦略を支援する Azure サービスです。 プライマリ ロケーションで障害が発生した場合は、セカンダリ ロケーションにフェールオーバーしてアプリとワークロードの可用性を維持します。 プライマリの場所が通常の動作に戻ると、その場所にフェールバックします。 詳細については、「 [Site Recovery とは](site-recovery-overview.md)

この記事では、[Azure Portal](https://portal.azure.com) でのデプロイについて説明します。 [Azure クラシック ポータル](https://manage.windowsazure.com/)を使用すると、既存の Site Recovery コンテナーを管理できますが、新しいコンテナーを作成することはできません。

コメントがありましたら、この記事の下部に投稿してください。 技術的な質問については、 [Azure Recovery Services フォーラム](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr)に投稿してください。


## <a name="deployment-scenarios"></a>デプロイメント シナリオ

Site Recovery は、次のようなさまざまなシナリオで、レプリケーションを調整するためにデプロイできます。

- **VMware 仮想マシンをレプリケートする**: オンプレミスの VMware 仮想マシンを Azure またはセカンダリ データセンターにレプリケートできます。
- **物理マシンをレプリケートする**: 物理マシン (Windows または Linux) を Azure またはセカンダリ データセンターにレプリケートできます。 物理マシンをレプリケートするためのプロセスは、VMware VM をレプリケートするためのプロセスとほとんど同じです。
- **Hyper-V VM をレプリケートする**: Hyper-V VM を Azure またはセカンダリ VMM サイトにレプリケートできます。 セカンダリ サイトにレプリケートする場合は、System Center Virtual Machine Manager (VMM) クラウドで管理されている必要があります。
- **VM を移行する**: オンプレミスの VM と物理サーバーを Azure にレプリケート (レプリケート、フェールオーバー、フェールバック) するだけでなく、Azure VM に移行することもできます (レプリケート、フェールオーバーを実行し、フェールバックはしません)。 移行できるものを次に示します。
    - オンプレミスの Hyper-V VM、VMware VM、物理サーバーで実行されているワークロードを、Azure VM で実行するように移行する。
    - Azure リージョン間で [Azure IaaS VM](site-recovery-migrate-azure-to-azure.md) を移行する。 このシナリオでは、現時点でサポートされているのは移行のみです。つまり、フェールバックはサポートされていません。
    - [AWS Windows インスタンス](site-recovery-migrate-aws-to-azure.md)を Azure に移行する。 このシナリオでは、現時点でサポートされているのは移行のみです。つまり、フェールバックはサポートされていません。

Site Recovery は、サポートされている VM と物理サーバーで実行されているアプリをレプリケートします。 サポートされるアプリの概要については、「 [Azure Site Recovery で保護できるワークロード](site-recovery-workload.md)

## <a name="replicate-vmware-vmsphysical-servers-to-azure"></a>Azure に VMware VM/物理サーバーをレプリケートする

### <a name="components"></a>コンポーネント

**コンポーネント** | **詳細**
--- | ---
**Azure** | Azure では、Microsoft Azure アカウント、Azure ストレージ アカウント、Azure ネットワークが必要です。<br/><br/> ストレージとネットワークには、Resource Manager アカウントまたはクラシック アカウントを指定できます。<br/><br/>  レプリケートされたデータはストレージ アカウントに格納され、オンプレミス サイトからのフェールオーバーが発生したときにそのレプリケートされたデータで Azure VM が作成されます。 Azure VM は、作成時に Azure 仮想ネットワークに接続します。
**構成サーバー** | オンプレミス サイトと Azure の間の通信を調整し、データ レプリケーションを管理するようにオンプレミスで構成サーバーを設定します。
**プロセス サーバー** | 既定で、オンプレミスの構成サーバーにインストールされます。<br/><br/> レプリケーション ゲートウェイとして機能します。 プロセス サーバーは保護されたソース マシンからレプリケーション データを受信し、キャッシュ、圧縮、および暗号化を使用して最適化してから、データを Azure Storage に送信します。<br/><br/> 保護されたマシンへのモビリティ サービスのプッシュ インストールを処理し、VMware VM の自動検出を実行します。<br/><br/> デプロイメントの拡大に合わせて、増大するレプリケーション トラフィックの処理を実行する独立した専用プロセス サーバーを追加できます。
**マスター ターゲット サーバー** | 既定で、オンプレミスの構成サーバーにインストールされます。<br/><br/> Azure からのフェールバック中にレプリケーション データを処理します。 フェールバックのトラフィックの量が多い場合は、フェールバック用に別のマスター ターゲット サーバーをデプロイすることができます。
**VMware サーバー** | VMware VM をレプリケートするには、Recovery Services コンテナーに vCenter サーバーと vSphere サーバーを追加します。<br/><br/> 物理サーバーをレプリケートする場合は、フェールバック用にオンプレミスの VMware インフラストラクチャが必要になります。 物理マシンにはフェールバックできません。
**レプリケートされたマシン** | レプリケートする各マシンにモビリティ サービスがインストールされている必要があります。 このサービスは、各マシンに手動でインストールすることも、プロセス サーバーからのプッシュ インストールでインストールすることもできます。

**図 1: VMware から Azure へのコンポーネント**

![コンポーネント](./media/site-recovery-components/arch-enhanced.png)

### <a name="replication-process"></a>レプリケーション プロセス

1. Azure コンポーネント、Recovery Services コンテナーを含むデプロイを設定します。 このコンテナーでは、レプリケーションのソースとターゲットの指定、構成サーバーのセットアップ、VMware サーバーの追加、レプリケーション ポリシーの作成、モビリティ サービスのデプロイ、レプリケーションの有効化、テスト フェールオーバーの実行を行います。
2.  マシンがレプリケーション ポリシーに従ってレプリケートを開始し、データの初回コピーが Azure Storage にレプリケートされます。
4. Azure への差分変更のレプリケーションは、初期レプリケーションの終了後に開始されます。 マシンの追跡された変更は .hrl ファイルに保持されます。
    - レプリケートするマシンは、レプリケーション管理のために、受信ポート HTTPS 443 で構成サーバーと通信します。
    - レプリケートするマシンは、受信ポート HTTPS 9443 でレプリケーション データをプロセス サーバーに送信します (構成可能)。
    - 構成サーバーは、送信ポート HTTPS 443 経由で Azure によるレプリケーション管理を調整します。
    - プロセス サーバーは、ソース マシンからデータを受信し、そのデータを最適化して暗号化し、送信ポート 443 を介して Azure Storage に送信します。
    - マルチ VM 整合性を有効にすると、レプリケーション グループ内のマシンは、ポート 20004 を介して相互に通信します。 フェールオーバー時にクラッシュ整合性復旧ポイントとアプリ整合性復旧ポイントを共有するレプリケーション グループに複数のマシンをグループ化する場合にマルチ VM が使用されます。 これは、これらのマシンが同じワークロードを実行していて、一貫性を持たせる必要がある場合に役立ちます。
5. トラフィックは、インターネット経由で Azure Storage のパブリック エンドポイントにレプリケートされます。 また、Azure ExpressRoute の[パブリック ピアリング](https://docs.microsoft.com/en-us/azure/expressroute/expressroute-circuit-peerings#public-peering)を使用することもできます。 オンプレミス サイトから Azure へのサイト間 VPN を介したトラフィックのレプリケートはサポートされていません。

**図 2: VMware から Azure へのレプリケーション**

![拡張](./media/site-recovery-components/v2a-architecture-henry.png)

### <a name="failover-and-failback-process"></a>フェールオーバーとフェールバックのプロセス

1. オンプレミスの VMware VM や物理サーバーから Azure への計画外フェールオーバーを実行します。 計画フェールオーバーはサポートされていません。
2. 単一のマシンをフェールオーバーするか、複数のマシンのフェールオーバーを調整するための[復旧計画](site-recovery-create-recovery-plans.md)を作成することができます。
3. フェールオーバーを実行すると、レプリカ VM が Azure に作成されます。 フェールオーバーをコミットして、レプリカの Azure VM からワークロードへのアクセスを開始します。
4. プライマリ オンプレミス サイトが再度使用可能になると、フェールバックできます。 フェールバック インフラストラクチャをセットアップし、セカンダリ サイトからプライマリへのマシンのレプリケートを開始して、セカンダリ サイトから計画外フェールオーバーを実行します。 このフェールオーバーをコミットすると、データがオンプレミスに戻るため、Azure へのレプリケーションをもう一度有効にする必要があります。 [詳細情報](site-recovery-failback-azure-to-vmware.md)

フェールバックの要件がいくつかあります。

- **物理マシン間のフェールバックはサポートされていません**: そのため、物理サーバーを Azure にフェールオーバーした後でフェールバックする場合は、VMware VM にフェールバックする必要があります。 物理サーバーにはフェールバックできません。 フェールバック先の Azure VM が必要になります。構成サーバーを VMware VM としてデプロイしていない場合は、別のマスター ターゲット サーバーを VMware VM としてセットアップする必要があります。 これは、マスター ターゲット サーバーが VMware ストレージとのやり取りと接続を通じてディスクを VMware VM に復元する必要があるために必要です。
- **Azure 上の一時的なプロセス サーバー**: フェールオーバー後に Azure からフェールバックする場合は、Azure からのレプリケーションを処理するために、プロセス サーバーとして構成された Azure VM をセットアップする必要があります。 この VM は、フェールバックの完了後に削除できます。
- **VPN 接続**: フェールバックするには、Azure ネットワークからオンプレミス サイトへの VPN 接続 (または Azure ExpressRoute) をセットアップする必要があります。
- **独立したオンプレミス マスター ターゲット サーバー**: オンプレミスのマスター ターゲット サーバーによって、フェールバックが処理されます。 マスター ターゲット サーバーは、既定では管理サーバーにインストールされますが、大量のトラフィックをフェールバックする場合は、この目的用にオンプレミスのマスター ターゲット サーバーをセットアップする必要があります。
- **フェールバック ポリシー**: オンプレミスにもう一度レプリケートするには、フェールバック ポリシーが必要です。 これは、レプリケーション ポリシーを作成したときに自動的に作成されます。

**図 3: VMware/物理マシンのフェールバック**

![フェールバック](./media/site-recovery-components/enhanced-failback.png)


## <a name="replicate-vmware-vmsphysical-servers-to-a-secondary-site"></a>セカンダリ サイトに VMware VM/物理サーバーをレプリケートする

### <a name="components"></a>コンポーネント

**コンポーネント** | **詳細**
--- | ---
**Azure** | InMage Scout を使用してこのシナリオをデプロイします。 InMage Scout を入手するには、Azure サブスクリプションが必要です。<br/><br/> Recovery Services コンテナーを作成した後、InMage Scout をダウンロードし、最新の更新プログラムをインストールして、デプロイを設定します。
**プロセス サーバー** | キャッシュ、圧縮、およびデータの最適化を処理できるように、プライマリ サイトでプロセス サーバーのコンポーネントをデプロイします。<br/><br/> プロセス サーバーでは、保護するマシンへの統合エージェントのプッシュ インストールも処理します。
**VMware ESX/ESXi と vCenter サーバー** |  VMware VM をレプリケートするには、VMware インフラストラクチャが必要です。
**VM/物理サーバー** |  レプリケートする VMware VM または Windows/Linux 物理サーバーに統合エージェントをインストールします。<br/><br/> エージェントはすべてのコンポーネント間の通信プロバイダーとして機能します。
**構成サーバー** | 構成サーバーは、管理 Web サイトまたは vContinuum コンソールを使用してデプロイを管理、構成、および監視するためにセカンダリ サイトにインストールされます。
**vContinuum サーバー** | 構成サーバーと同じ場所にインストールされます。<br/><br/> 保護対象の環境を管理および監視するためのコンソールを提供します。
**マスター ターゲット サーバー (セカンダリ サイト)** | マスター ターゲット サーバーは、レプリケートされたデータを保持します。 プロセス サーバーからデータを受信して、セカンダリ サイトにレプリカ マシンを作成し、データのリテンション期間ポイントを保持します。<br/><br/> 必要のあるマスター ターゲット サーバーの数は、保護するマシンの数によって異なります。<br/><br/> プライマリ サイトにフェールバックする場合は、そこにもマスター ターゲット サーバーが必要です。 統合エージェントはこのサーバーにインストールされます。

### <a name="replication-process"></a>レプリケーション プロセス

1. 各サイトでコンポーネント サーバー (構成、プロセス、マスター ターゲット) をセットアップし、レプリケートするマシンに統合エージェントをインストールします。
2. 初期レプリケーションの後、各マシン上のエージェントによって、差分レプリケーションの変更がプロセス サーバーに送信されます。
3. プロセス サーバーは、このデータを最適化して、セカンダリ サイト上のマスター ターゲット サーバーに転送します。 構成サーバーでは、レプリケーション プロセスを管理します。

**図 4: VMware から VMware へのレプリケーション**

![VMware から VMware](./media/site-recovery-components/vmware-to-vmware.png)



## <a name="replicate-hyper-v-vms-to-azure"></a>Hyper-V VM を Azure にレプリケート


### <a name="components"></a>コンポーネント

**コンポーネント** | **詳細**
--- | ---
**Azure** | Azure では、Microsoft Azure アカウント、Azure ストレージ アカウント、Azure ネットワークが必要です。<br/><br/> ストレージとネットワークには、Resource Manager ベースのアカウントまたはクラシック アカウントを指定できます。<br/><br/> レプリケートされたデータはストレージ アカウントに格納され、オンプレミス サイトからのフェールオーバーが発生したときにそのレプリケートされたデータで Azure VM が作成されます。<br/><br/> Azure VM は、作成時に Azure 仮想ネットワークに接続します。
**VMM サーバー** | Hyper-V ホストが VMM クラウドに存在する場合は、[ネットワーク マッピング](site-recovery-network-mapping.md)を構成するように論理ネットワークと VM ネットワークをセットアップする必要があります。 VM ネットワークは、クラウドに関連付けられた論理ネットワークにリンクされている必要があります。
**Hyper-V ホスト** | 1 つ以上の Hyper-V ホスト サーバーが必要です。
**Hyper-V VM** | Hyper-V ホスト サーバー上に 1 つ以上の VM が必要です。 Hyper-V ホストで実行されているプロバイダーは、インターネット経由で Site Recovery サービスを使用してレプリケーションを調整および統制します。 エージェントは、HTTPS 443 でデータ レプリケーション データを処理します。 プロバイダーとエージェントの両方からの通信は、セキュリティで保護され、暗号化されます。 Azure Storage 内のレプリケートされたデータも暗号化されます。


## <a name="replication-process"></a>レプリケーション プロセス

1. Azure コンポーネントを設定します。 Site Recovery のデプロイを開始する前に、ストレージ アカウントとネットワーク アカウントを設定することをお勧めします。
2. Site Recovery 用のレプリケーション サービス コンテナーを作成し、次のようにコンテナーの設定を構成します。
    - VMM クラウドで Hyper-V ホストを管理していない場合、Hyper-V サイト コンテナーを作成し、そのコンテナーに Hyper-V ホストを追加します。
    - レプリケーションのソースとターゲット。 Hyper-V ホストが VMM で管理されている場合、ソースは VMM クラウドになります。 VMM で管理されていない場合、ソースは Hyper-V サイトになります。
    - Azure Site Recovery プロバイダーと Microsoft Azure Recovery Services エージェントのインストール。 VMM がある場合、プロバイダーは VMM にインストールされ、エージェントは各 Hyper-V ホストにインストールされます。 VMM がない場合は、プロバイダーとエージェントの両方が各ホストにインストールされます。
    - Hyper-V サイトまたは VMM クラウドのレプリケーション ポリシーを作成します。 このポリシーは、そのサイトまたはクラウド内のホストに存在するすべての VM に適用されます。
    - Hyper-V VM のレプリケーションを有効にします。 初期レプリケーションは、レプリケーション ポリシーの設定に従って実行されます。
4. データ変更は追跡され、初期レプリケーションの終了後に Azure への差分変更のレプリケーションが開始されます。 アイテムの追跡された変更は .hrl ファイルに保持されます。
5. テスト フェールオーバーを実行して、すべて問題なく動作していることを確認します。

### <a name="failover-and-failback-process"></a>フェールオーバーとフェールバックのプロセス

1. 計画または計画外[フェールオーバー](site-recovery-failover.md)をオンプレミスの Hyper-V VM から Azure に実行できます。 予定されたフェールオーバーを実行する場合、データが決して失われないように、ソース側の VM はシャット ダウンされます。
2. 単一のマシンをフェールオーバーするか、複数のマシンのフェールオーバーを調整するための[復旧計画](site-recovery-create-recovery-plans.md)を作成することができます。
4. フェールオーバーを実行すると、Azure に作成されたレプリカ VM が表示されるようになります。 必要に応じて、VM にパブリック IP アドレスを割り当てることができます。
5. その後、フェールオーバーをコミットして、レプリカの Azure VM からワークロードへのアクセスを開始します。
6. プライマリ オンプレミス サイトが再度使用可能になると、フェールバックできます。 Azure からプライマリ サイトへの計画フェールオーバーを開始します。 計画フェールオーバーの場合、データが失われないように、同じ VM と別の場所のどちらにフェールバックするかを選択し、Azure とオンプレミスの間で変更を同期することができます。 VM がオンプレミスで作成されたら、フェールオーバーをコミットします。

**図 5: Hyper-V サイトから Azure へのレプリケーション**

![コンポーネント](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)

**図 6: VMM クラウド内の Hyper-V から Azure へのレプリケーション**

![コンポーネント](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png)



## <a name="replicate-hyper-v-vms-to-a-secondary-site"></a>Hyper-V VM をセカンダリ サイトにレプリケート

### <a name="components"></a>コンポーネント

**コンポーネント** | **詳細**
--- | ---
**Azure アカウント** | Microsoft Azure のアカウントが必要です。
**VMM サーバー** | プライマリ サイトに 1 つの VMM サーバーを配置し、セカンダリ サイトにもう 1 つの VMM サーバーを配置し、それぞれインターネットに接続しておくことをお勧めします。<br/><br/> 各サーバーには、Hyper-V 機能プロファイルが設定されている VMM プライベート クラウドが少なくとも 1 つ必要です。<br/><br/> VMM サーバーに Azure Site Recovery プロバイダーをインストールします。 Provider は、インターネット経由で Site Recovery サービスを使用してレプリケーションを調整および統制します。 プロバイダーと Azure の間の通信は、セキュリティで保護され、暗号化されます。
**Hyper-V サーバー** |  プライマリおよびセカンダリの VMM クラウドに Hyper-V ホスト サーバーが少なくとも 1 つ必要です。 サーバーはインターネットに接続している必要があります。<br/><br/> プライマリ Hyper-V ホスト サーバーとセカンダリ Hyper-V ホスト サーバーとの間で Kerberos または証明書認証を使用して LAN または VPN 経由で、データがレプリケートされます。  
**ソース マシン** | ソース Hyper-V ホスト サーバーには、レプリケートする VM が少なくとも 1 つ必要です。

## <a name="replication-process"></a>レプリケーション プロセス

1. Azure アカウントを設定します。
2. Site Recovery 用のレプリケーション サービス コンテナーを作成し、次のようにコンテナーの設定を構成します。

    - レプリケーション ソースとターゲット (プライマリ サイトとセカンダリ サイト)。
    - Azure Site Recovery プロバイダーと Microsoft Azure Recovery Services エージェントのインストール。 プロバイダーは VMM サーバーにインストールされ、エージェントは各 Hyper-V ホストにインストールされます。
    - ソース VMM クラウドのレプリケーション ポリシーを作成します。 このポリシーは、クラウド内のホストに存在するすべての VM に適用されます。
    - Hyper-V VM のレプリケーションを有効にします。 初期レプリケーションは、レプリケーション ポリシーの設定に従って実行されます。
4. データ変更は追跡され、初期レプリケーションの終了後に差分変更のレプリケーションが開始されます。 アイテムの追跡された変更は .hrl ファイルに保持されます。
5. テスト フェールオーバーを実行して、すべて問題なく動作していることを確認します。

**図 7: VMM から VMM へのレプリケーション**

![オンプレミス間](./media/site-recovery-components/arch-onprem-onprem.png)

### <a name="failover-and-failback-process"></a>フェールオーバーとフェールバックのプロセス

1. 計画または計画外[フェールオーバー](site-recovery-failover.md)をオンプレミス サイト間で実行できます。 予定されたフェールオーバーを実行する場合、データが決して失われないように、ソース側の VM はシャット ダウンされます。
2. 単一のマシンをフェールオーバーするか、複数のマシンのフェールオーバーを調整するための[復旧計画](site-recovery-create-recovery-plans.md)を作成することができます。
4. セカンダリ サイトへの計画外フェールオーバーを実行すると、フェールオーバー後に、セカンダリの場所のマシンの保護またはレプリケーションが有効になりません。 計画フェールオーバーを実行した場合は、フェールオーバー後に、セカンダリの場所のマシンは保護されます。
5. その後、フェールオーバーをコミットして、レプリカ VM からワークロードへのアクセスを開始します。
6. プライマリ サイトが再度使用可能になったら、レプリケーションの反転を開始して、セカンダリ サイトからプライマリ サイトにレプリケートします。 レプリケーションの反転により、仮想マシンは保護された状態になりますが、セカンダリ データセンターはアクティブな場所のままです。
7. プライマリ サイトをもう一度アクティブな場所にするには、セカンダリからプライマリへの計画フェールオーバーを開始し、続いて別のレプリケーションの反転を実行します。


### <a name="hyper-v-replication-workflow"></a>Hyper-V レプリケーションのワークフロー

**ワークフローの段階** | **アクション**
--- | ---
1.**保護を有効にする** | Hyper-V VM の保護を有効にすると、**保護の有効化**ジョブが開始され、マシンが前提条件に準拠していることを確認します。 このジョブは 2 つのメソッドを呼び出します。<br/><br/> [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx): 構成した設定を使用してレプリケーションを設定します。<br/><br/> [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx): 完全な VM レプリケーションを初期化します。
2.**初期レプリケーション** |  仮想マシンのスナップショットが取得され、仮想ハード ディスクが、セカンダリの場所にすべてコピーされるまで 1 つずつレプリケートされます。<br/><br/> この所要時間は、VM サイズ、ネットワーク帯域幅、および初期レプリケーション方法によって異なります。<br/><br/> 初期レプリケーションの進行中にディスクの変更が発生した場合、Hyper-V レプリカ レプリケーション トラッカーは、Hyper-V レプリケーション ログ (.hrl) を該当するディスクと同じフォルダーに配置して、それらの変更を追跡します。<br/><br/> 各ディスクには関連付けられた .hrl ファイルが存在し、これらはセカンダリ ストレージに送信されます。<br/><br/> 初期レプリケーションの進行中は、スナップショットおよびログ ファイルによってディスク リソースが消費されます。 初期レプリケーションが終了すると、VM のスナップショットは削除され、ログ内の差分ディスク変更が同期およびマージされます。
3.**保護の最終処理** | 初期レプリケーションが終了すると、**保護の最終処理**ジョブによって、ネットワークなどのレプリケーション後の設定が構成され、仮想マシンが保護されます。<br/><br/> Azure にレプリケートする場合は、仮想マシンの設定を微調整して、いつでもフェールオーバーできるようにしておくことが必要なことがあります。<br/><br/> この時点で、テスト フェールオーバーを実行して、すべてが想定通りに動作しているかを確認できます。
4.**レプリケーション** | 初期レプリケーション後は、レプリケーションの設定に従って差分の同期が開始されます。<br/><br/> **レプリケーションの失敗**: 差分レプリケーションに失敗した場合、完全なレプリケーションが帯域幅または時間の観点からコスト高になるときは、再同期が実行されます。 たとえば、.hrl ファイルがディスク サイズの 50% に達した場合、VM には再同期のマークが付けられます。 再同期では、ソースとターゲットの仮想マシンのチェックサムを計算して差分のみを送信することで、送信されるデータの量が最小限に抑えられます。 再同期が完了すると、差分レプリケーションが再開されます。 既定では再同期は業務時間外に自動的に実行するようにスケジュールされますが、手動で仮想マシンを再同期することもできます。<br/><br/> **レプリケーション エラー**: レプリケーション エラーが発生した場合に備えて、組み込み再試行があります。 認証エラーや承認エラーなど回復できないエラーである場合、またはレプリカ マシンが無効な状態にある場合、再試行は行われません。 ネットワーク エラーなどの回復可能なエラーの場合、またはディスクの空き領域やメモリが少ない場合は、再試行が実行されます。回数を重ねるごとに再試行間隔は長くなります (1、2、4、8、10 分と長くなり、その後は 30 分ごとに行われる)。
5.**計画フェールオーバー/計画外フェールオーバー** | 必要に応じて、計画フェールオーバーまたは計画外フェールオーバーを実行できます。<br/><br/> 予定されたフェールオーバーを実行する場合、データが決して失われないように、ソース側の VM はシャット ダウンされます。<br/><br/> レプリカ VM は、作成後、コミット保留中の状態になります。 フェールオーバーを完了するには、それらをコミットする必要があります。<br/><br/> プライマリ サイトが稼働状態になった後、使用できるようになった時点で、プライマリ サイトにフェールバックすることができます。


**図 8: Hyper-V のワークフロー**

![ワークフロー](./media/site-recovery-components/arch-hyperv-azure-workflow.png)

## <a name="next-steps"></a>次のステップ

[デプロイメントの準備をする](site-recovery-best-practices.md)



<!--HONumber=Feb17_HO3-->


