<properties
	pageTitle="Active Directory の ASR ガイダンス | Microsoft Azure" 
	description="この記事では、Azure Site recovery を使用した AD 用の障害復旧ソリューションの作成方法、ワンクリック復旧計画を使用した計画済み、計画外、テスト フェールオーバーの実行方法、およびサポートされている構成および前提条件の詳細について説明します。" 
	services="site-recovery" 
	documentationCenter="" 
	authors="prateek9us" 
	manager="abhiag" 
	editor=""/>

<tags 
	ms.service="site-recovery" 
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="storage-backup-recovery" 
	ms.date="10/12/2015" 
	ms.author="pratshar"/>

#ASR を使用した Active Directory と DNS 用の自動化された DR ソリューション


SharePoint、Dynamics AX、SAP など、いずれのエンタープライズ アプリケーションも、正常に動作するには AD と DNS のインフラストラクチャに依存しています。どのエンタープライズ アプリケーション用に障害復旧 (DR) ソリューションを作成する場合でも、アプリケーションの他のコンポーネントで中断のイベントが発生する前に、AD を保護し、復旧することが重要です。

Azure Site Recovery は、仮想マシンのレプリケーション、フェールオーバー、および復旧を調整して、障害復旧機能を提供する Azure ベースのサービスです。Azure Site Recovery は、仮想マシンとアプリケーションの一貫したレプリケート、保護、およびプライベート/パブリック クラウドまたはホスト側のクラウドへのシームレスなフェールオーバーを実行するための多くのレプリケーション テクノロジをサポートしています。

Azure Site Recovery を使用すると、実際の AD に合わせて完全な自動障害復旧計画を作成できます。中断イベントに際して、任意の場所から、数秒でフェールオーバーを開始し、数分で AD を稼働させることができます。プライマリ サイトで SharePoint、SAP などの複数のアプリケーション用に AD を使用していて、完全なサイトをフェールオーバーする場合、まず ASR を使用して AD をフェールオーバーしてから、アプリケーション固有の復旧計画を使用して他のアプリケーションをフェールオーバーします。

この記事では、AD 用の障害復旧ソリューションの作成方法、ワンクリック復旧計画を使用した計画済み、計画外、テスト フェールオーバーの実行方法、およびサポートされている構成および前提条件の詳細について説明します。この記事は、AD および Azure Site Recovery に関する知識があるユーザーを対象としています。AD の保護については、お客様のオンプレミス環境の複雑さに基づく、2 つの推奨される方法があります。

####方法 1

アプリケーションの数が少なく、環境内のドメイン コントローラーが 1 つであり、サイト全体をまとめてフェールオーバーする場合、ASR レプリケーションを使用して、セカンダリ サイト のへドメイン コントローラー マシンをレプリケートすることをお勧めします (サイト対サイト、サイト対 Azure の両方に対応)。同一のレプリケートされた仮想マシンは、テスト フェールオーバー用にも使用できます。

####方法 2
アプリケーションの数が多く、環境内に 2 つ以上のドメイン コントローラーが あるか、一度にいくつかのアプリケーションをフェールオーバーすることを計画している場合、ドメイン コントローラーの仮想マシンで ASR レプリケーションを有効化し (テスト フェールオーバーに使用)、さらに追加のドメイン コントローラーを DR サイト (セカンダリ オンプレミス サイトまたは Azure) に設定することをお勧めします。

>[AZURE.NOTE]方法 2 を採用する場合でも、テスト フェールオーバーの実行には、ドメイン コントローラー用の ASR レプリケーションの設定が必要になります。詳細については、「[テスト フェールオーバーの考慮事項](#considerations-for-test-failover)」を参照してください。


以下のセクションでは、ASR 内のドメイン コントローラー上の保護を有効にする方法と Azure でドメイン コントローラーを設定する方法について説明します。


##前提条件

Azure Site Recovery を使用して AD 用の障害復旧を実装するには、次の前提条件を満たす必要があります。

- Active Directory と DNS サーバーのオンプレミス デプロイメント
- Microsoft Azure サブスクリプションでの Azure Site Recovery コンテナーの作成 
- Azure が復旧サイトである場合、Azure の仮想マシン準備状況評価ツールを VM で実行し、Azure VM および Azure Site Recovery サービスと互換性があることを確認してください。


##ASR を使用したドメイン コントローラーおよび DNS の保護の有効化


###VM の保護
ASR を使用して、ドメイン コントローラーおよび DNS VMの保護を有効化します。VM が Hyper-V にあるか、または VMware にあるかに基づいて、関連する Azure Site Recovery の構成を行います。推奨されるクラッシュ整合性頻度の構成は 15 分です。

###VM ネットワーク設定の構成
- ドメイン コントローラーおよび DNS の仮想マシン用に、ASR でネットワーク設定を構成します。これにより、フェールオーバー後に、VM が適切なネットワークに接続されるようになります。 
- たとえば、DR サイトとして Azure を使用している場合、以下のスクリーンショットのようにネットワーク設定を構成するために、「VMM クラウド」または「保護グループ」で VM を選択することができます。
- 
![VM ネットワークの設定](./media/site-recovery-active-directory/VM-Network-Settings.png)

##AD レプリケーションを使用した AD の保護の有効化
###サイト対サイトのシナリオ

セカンダリ (DR) サイトでドメイン コントローラーを作成し、ドメイン コントローラーのロールへサーバーを昇格している間に、プライマリ サイトで使用されているのと同じドメインの名前を指定します。サイトの追加先となるサイト リンク オブジェクトの設定の構成には、Active Directory サイトとサービスのスナップインを使用できます。サイト リンクで設定を構成することで、2 つまたはそれ以上のサイト間でレプリケーションを発生させる時間と頻度を制御できます。 詳細については、「[Scheduling Replication Between Sites (サイト間のレプリケーションのスケジュール設定)](https://technet.microsoft.com/JA-JP/library/cc731862.aspx)」を参照してください。

###サイト対 Azure のシナリオ
次の手順に従って、 [Azure の仮想ネットワーク内のドメイン コントローラー](../virtual-network/virtual-networks-install-replica-active-directory-domain-controller.md)を作成します。ドメイン コントローラーのロールへのサーバーの昇格中に、プライマリ サイトで使用されているのと同じドメインの名前を付けます。

この後、Azure で DNS サーバーを使用するには、[仮想ネットワークの DNS サーバーを再構成する](../virtual-network/virtual-networks-install-replica-active-directory-domain-controller.md#reconfigure-dns-server-for-the-virtual-network)必要があります。
  
![Azure ネットワーク](./media/site-recovery-active-directory/azure-network.png)

##テスト フェールオーバーの考慮事項
テスト フェールオーバーは、実稼働ワークロードへ影響しないように、実稼動ネットワークから分離されたネットワークで行われます。ほとんどのアプリケーションでは、ドメイン コントローラーと DNS サーバーが動作する必要もあります。そのため、アプリケーションでフェールオーバーを実行する前に、テスト フェールオーバーに使用する分離されたネットワークでドメイン コントローラーを作成する必要があります。そのための最も簡単な方法としては、最初に ASR を使用して、ドメイン コントローラーおよび DNS の仮想マシンで保護を有効化し、アプリケーションの復旧計画のテスト フェールオーバーをトリガーする前に、ドメイン コントローラーの仮想マシンのテスト フェールオーバーをトリガーします。テスト フェールオーバーを行うためのステップ バイ ステップ ガイダンスを以下に示します。

1. その他の仮想マシンのように、ドメイン コントローラーおよび DNS の仮想マシンの保護を有効化します。
2. 分離されたネットワークを作成します。既定では、Azure で作成されるすべての仮想ネットワークは、その他のネットワークから分離します。このネットワークの IP 範囲は、実稼動ネットワークと同じものを使用することをお勧めします。このネットワーク上でサイト間接続を有効化しないでください。
3. DNS の VM が取得する IP のように、上記の手順で作成されたネットワークに DNS の IP を指定します。DR サイトとして Azure を使用している場合は、VM プロパティの「ターゲット IP」設定のフェールオーバーで使用される VM の IP を指定できます。DR サイトがオンプレミスで、DHCP を使用している場合は、ここに示される手順を [setup DNS and DHCP for test failover (テスト フェールオーバー用の DNS および DHCP の設定)](site-recovery-failover.md#prepare-dhcp) に使用します。 

>[AZURE.NOTE]テスト フェールオーバーで仮想マシンに割り当てられる IP は、計画されたフェールオーバーまたは計画されていないフェールオーバーを実行するときに割り当てられる IP と同じです (その IP がテスト フェールオーバー ネットワークで使用できる場合)。テスト フェールオーバー ネットワークで同じ IP が使用できない場合、テスト フェールオーバー ネットワークで利用できる IP が仮想マシンによって取得されます。

4. ドメイン コントローラーの仮想マシンに移動し、分離されたネットワークでテスト フェールオーバーを行います。 
5. アプリケーションの復旧計画のテスト フェールオーバーを行います。
6. テストが完了した後、ASR の[ジョブ] タブから、ドメイン コントローラーの仮想マシンのテスト フェールオーバー ジョブと復旧計画を「完了」とマークします。 

###ドメイン コントローラーと同じ仮想マシン上に DNS がない場合: 
DNS がドメイン コントローラーと同じ仮想マシン上にない場合、テスト フェールオーバー用の DNS を作成する必要があります。同じ VM 上にある場合は、このセクションを省略できます。新規の DNS サーバーを使用し、必要なすべてのゾーンを作成することができます。たとえば、Active Directory ドメインが contoso.com である場合には、contoso.com という名前でゾーンを作成することができます。Active Directory に対応するエントリは DNS で更新する必要があります。これを行うには、次の手順を実行します。

- 復旧計画内の他のすべての仮想マシンが起動する前に、次の設定が有効になっているようにします。
	- ゾーンは、フォレスト ルート名に従って名前を付ける必要があります。
	- ゾーンは、ファイルに格納される必要があります。
	- ゾーンは、セキュリティ保護された更新とセキュリティ保護されていない更新の両方に対して有効である必要があります。
	- ドメイン コントローラーの仮想マシンのリゾルバーは、DNS の仮想マシンの IP アドレスをポイントする必要があります。
- ドメイン コントローラーの仮想マシンのディレクトリで、次のコマンドを実行します。nltest/dsregdns

- **ゾーンの追加** — DNS サーバー上にゾーンを追加し、セキュリティで保護されていない更新を許可し、その DNS サーバー用のエントリを DNS に追加するには、次のサンプル スクリプトを使用します。

	    dnscmd /zoneadd contoso.com  /Primary 
	    dnscmd /recordadd contoso.com  contoso.com. SOA %computername%.contoso.com. hostmaster. 1 15 10 1 1 
	    dnscmd /recordadd contoso.com %computername%  A <IP_OF_DNS_VM> 
	    dnscmd /config contoso.com /allowupdate 1


##概要
Azure Site Recovery を使用すると、実際の AD に合わせて完全な自動障害復旧計画を作成できます。中断イベントに際して、任意の場所から、数秒でフェールオーバーを開始し、数分で AD を稼働させることができます。プライマリ サイトで SharePoint、SAP などの複数のアプリケーション用に AD を使用していて、完全なサイトをフェールオーバーする場合、まず ASR を使用して AD をフェールオーバーしてから、アプリケーション固有の復旧計画を使用して他のアプリケーションをフェールオーバーします。


ASR を使用したさまざまなワークロードの保護の詳細については、「[Site Recovery ワークロードのガイダンス](../site-recovery/site-recovery-workload.md)」を参照してください。

<!---HONumber=Oct15_HO3-->