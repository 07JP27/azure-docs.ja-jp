---
title: Azure Event Hubs への SQL データのプル | Microsoft Docs
description: SQL サンプルから Event Hubs へのインポートの概要
services: event-hubs
documentationcenter: na
author: spyrossak
manager: timlt
editor: ''

ms.service: event-hubs
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/25/2016
ms.author: spyros;sethm

---
# SQL から Azure Event Hub へのデータのプル
リアルタイムのデータを処理するアプリケーションの一般的なアーキテクチャでは、まず、対象データを Azure Event Hub にプッシュする必要があります。例として、IoT シナリオ (方々に広がっているハイウェイの交通量の監視など)、ゲーム シナリオ (多数の熱狂的な競技者のアクションの監視など)、エンタープライズ シナリオ (建物の占有率の監視など) を挙げることができます。これらのケースでは、データ プロデューサーは一般に、収集、分析、保存、および対処が必要な時系列データを生成する外部オブジェクトです。そして、これらのプロセスに必要なインフラストラクチャを構築するために膨大な労力がつぎ込まれている可能性があります。ストリーミング データのソースではなく、データベースのようなものからデータを取り込み、そのデータをその他のストリーミング データと組み合わせて使用したい場合、どうしますか? Azure Stream Analytics、Remote Data Explorer (RDX)、またはその他のツールを使用して、Microsoft Dynamics AX またはカスタムの施設管理システムから取得した緩やかに変化するデータを解析し、対処する場合を考えてみましょう。 この問題を解決するために、SQL テーブルからデータをプルし、Azure Event Hub にプッシュすることでダウンストリームの分析アプリケーションの入力として使用するオープン ソースの小さなクラウド サンプルが用意されています。開発者は、このサンプルを修正してデプロイできます。これはまれなシナリオであり、Event Hub では、通常、これと逆のことを行うことに注意してください。ただし、このシナリオを行わなければならない状況にある場合は、Azure サンプル ギャラリー ([こちら](https://azure.microsoft.com/documentation/samples/event-hubs-dotnet-import-from-sql/)) にあるコードをご利用になれます。

このサンプルに含まれるコードは、サンプルにすぎないので注意してください。これは、運用アプリケーション**ではなく**、運用環境で使用できるものではありません。あくまでも、開発者が独自のアプリケーションを記述するために利用できるサンプルとして提供されています。開発者は、エンド ツー エンド アプリケーションを設定する前に、セキュリティ、パフォーマンス、機能、およびコストの各種要素をすべて検討する必要があります。

## アプリケーション構造
アプリケーションは C# で記述されています。このサンプルの readme.md ファイルには、アプリケーションを変更、ビルド、および発行するために必要なすべての情報が含まれています。次のセクションでは、アプリケーションの動作の概要を説明します。

SQL Azure テーブルにアクセスできることを前提として説明を始めます。Azure Event Hub をセットアップし、それにアクセスするために必要な接続文字列を知っておく必要もあります。

SqlToEventHub ソリューションが起動すると、ソリューションは readme.md ファイルに記載の手順に従って構成ファイル (App.config) を読み取ってさまざまな情報を取得します。これらは、データ テーブルの名前など、容易に理解できるものなので、ここでは説明を省略します。

アプリケーションは、構成ファイルを読み取ると、ループ状態になります。つまり、SQL テーブルを読み取り、レコードをイベント ハブにプッシュし、ユーザー定義のスリープ期間を待機した後、最初から繰り返します。注意を要する点がいくつかあります。

1. アプリケーションは次の前提に基づいて動作します。それは、SQL テーブルは何らかの外部プロセスによって更新され、Event Hub には更新のみをすべて送信することが求められているというものです。
2. SQL テーブルには、一意で、増加する番号 (レコード番号など) を持つフィールドが必要です。このフィールドにはわかりやすく "Id" という名前を付けることができます。また、このフィールドは、データベースでレコード ("Creation\_time" または "Sequence\_number" など) が追加されるといったように、とにかく更新が発生するたびにインクリメントされます。アプリケーションでは、反復のたびにそのフィールドの値を確認し格納します。ループの後続の各実行では、アプリケーションは基本的にテーブルに対してクエリを実行して、当該フィールド値がループの前回の実行で確認した値を超えているすべてのレコードを取得します。この最終値を "オフセット" と呼んでいます。
3. アプリケーションは、起動時にオフセットを格納する "TableOffsets" テーブルを作成します。テーブルは、構成ファイルに定義された "CreateOffsetTableQuery" クエリによって作成されます。
4. オフセット テーブルを操作するために使用される複数のクエリがあります。これらは構成ファイル内で "OffsetQuery"、"UpdateOffsetQuery"、および "InsertOffsetQuery" として定義されています。これらを変更する必要がありません。
5. 最後に、構成ファイルで定義されているクエリ "DataQuery" は、SQL テーブルからレコードをプルするときに実行されるクエリです。現時点で、クエリは最適化のために、ループの一回の実行につき上位 1,000 個のレコードに制限されています。たとえば、前回のクエリ以降、25,000 個のレコードが追加された場合、クエリの実行にはしばらく時間がかかる場合があります。クエリを 1,000 個のレコードに制限することにより、クエリの速度が増します。単純に上位 1,000 個を選択すると、1,000 個のレコードの連続バッチがイベント ハブにプッシュされます。

## 次のステップ
ソリューションをデプロイするには、SqlToEventHub アプリケーションを複製またはダウンロードし、App.config ファイルを編集して、アプリケーションをビルドし、最後に発行します。アプリケーションを発行したら、Cloud Services の Azure クラシック ポータルでアプリケーションの実行を確認できるほか、イベント ハブで受信したイベントを監視できます。頻度は 2 つの条件により決まります。1 つは SQL テーブルに対する更新の頻度です。もう 1 つはアプリケーションの構成ファイルで指定したスリープ間隔です。

<!---HONumber=AcomDC_0831_2016-->