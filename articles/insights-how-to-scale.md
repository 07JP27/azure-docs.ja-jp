<properties 
	pageTitle="Web サイトの規模の変更方法" 
	description="Azure でホスティング プランのスケールを設定する方法について説明します。" 
	authors="stepsic-microsoft-com" 
	manager="kamrani" 
	editor="" 
	services="application-insights" 
	documentationCenter=""/>

<tags 
	ms.service="application-insights" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="ibiza" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="2014-11-04" 
	ms.author="stepsic"/>

# Web サイトのスケールの変更方法

Azure プレビュー ポータルで、Web ホスティング プランのインスタンス数を手動で設定するか、パラメーターを指定して自動的にスケールを変更することができます。Web ホスティング プランの規模を構成する前に、インスタンスのサイズによってスケールが影響を受けることを考慮する必要があります。サイズが大きくなると、コアとメモリが増えるため、インスタンス数が同じままの場合はパフォーマンスが向上します。

規模は、全体的な Web ホスティング プランに影響します。Web サイトを作成するときに、新しい Web ホスティング プランを作成するか、既存の Web ホスティング プランを使用するオプションがあります。Web ホスティング プランを確定した時点で、すべてのサイトが同じインスタンスを共有するため、それらすべては共にスケールを変更することになります。

## Web ホスティング プランのスケールの変更

1. [Azure プレビュー ポータル](https://portal.azure.com/)で、**[参照]**、**[Web サイト]** の順にクリックしてから、Web サイトの名前をクリックしてブレードを開きます。
2. [Web サイト] ブレードの **[操作]** レンズにある **[スケール]** パーツで Web ホスティング プランのステータスが表示されます。**[Off]** は手動でスケールを変更する状況に対応します。**[パフォーマンス]** は、1 つ以上のパフォーマンス メトリックによってスケールを変更する状況に対応します。**[スケジュール]** は、複数の自動スケール プロファイルを有効にした状況に対応します。  
    ![Scale part](./media/insights-how-to-scale/Insights_ScalePartOff.png)
3. このパーツをクリックすると、**[スケール]** ブレードに移動します。[スケール] ブレードの上部には、Web ホスティング プランに対応する自動スケール アクションの履歴が表示されます。  

    ![Scale blade](./media/insights-how-to-scale/Insights_ScaleBladeDayZero.png)
4. **[インスタンス]** スライダーを使用して、Web ホスティング プランを実行する仮想マシンの数を手動で調整することができます。
5. 負荷に基づいてインスタンス数を自動的に調整する場合は、**[自動スケール モード]** の **[パフォーマンス]** をオンにします。現時点では、Azure プレビュー ポータルで **[スケジュール]** を選択することはできません。  
    ![Scale blade with CPU Percentage](./media/insights-how-to-scale/Insights_ScaleBladeCPU.png) 
6. [パフォーマンス]を選択した時点で、2 つの変化が生じます。
    - **[インスタンス範囲]** で、インスタンス数の最大値と最小値を選択できます。[自動スケール] により、負荷にかかわりなく、常にこの範囲内に維持されます。
    - **[ターゲット メトリック]** セクションで、パフォーマンス メトリックを定義できます。
7. **[CPU 使用率]** セクションでは、Web ホスティング プラン内にあるすべてのインスタンスを対象とする平均 CPU に関するターゲットを設定することができます。平均 CPU が、定義した最大値を超えたときは、スケール アップが発生します。

自動スケールが有効になっている場合は、[Web サイト] ブレードのパーツ内で **[パフォーマンス]** が表示され、グラフ内でのスケールの履歴を確認できます。

![Scale blade with CPU Percentage](./media/insights-how-to-scale/Insights_ScalePartBladeOn.png) 

Azure プレビュー ポータルで、共有 Web ホスティング プランのインスタンス数を変更できないことに注意してください。

## 詳細なスケール設定

Azure プレビュー ポータルの新機能として、CPU 使用率以外のメトリックに基づいてスケールを設定することや、スケール アップとのスケール ダウンのルールから成る複合セットを使用することもできます。

### 他のパフォーマンス メトリックに基づくスケール変更
CPU に加えて、次のものに基づくスケール変更も利用できます。

- [平均メモリ] - インスタンスで使用されているメモリの平均割合が、指定したしきい値を上回ったか下回った場合は、インスタンスが追加または削除されます。
- [HTTP キューの深さ] または [ディスク キューの深さ] - HTTP 要求キューとディスク キューのどちらかの中にあるメッセージの数が、指定したしきい値を上回ったか下回った場合は、インスタンスが追加または削除されます。

別のメトリックに基づいてスケールを変更する 2 つの方法があります。ただ 1 つのメトリックに基づいてスケールを変更する場合は、**[CPU 使用率]** スライダーの横にある不等号を選択します。[メトリックの詳細] ブレードが表示されます。

![Entry point to scale metrics](./media/insights-how-to-scale/Insights_ScaleMetricChevron.png)

一度に 1 つ以上のメトリックに基づいてスケールを変更するには、コマンド バーの **[メトリックの追加]** をクリックします。

![Add metrics](./media/insights-how-to-scale/Insights_AddMetric.png)

[メトリックの詳細] ブレードには、最適なスケール プロファイルを設定するために必要とされるすべてのコントロールがあります。上部で、スケール変更の基準として使用する新しいメトリックを選択します。

### 複数のステップによるスケール変更

メトリックで構成されるグラフの下には、**[スケール アップルール]** および **[スケール ダウン ルール]** という 2 つのセクションがあります。スケール アップ ルールの**いずれか**が満たされた場合は、サービスはスケール アップされます。逆に、スケール ダウン ルールの**すべて**が満たされた場合に、サービスはスケール ダウンされます。

ルールごとに、次のものを選択します。

- [条件] - [より大きい] または [より小さい]
- [しきい値] - アクションをトリガーするためにこのメトリックが超過する必要のある数値
- [過去の持続時間] - このメトリックの平均を求めるために使用する、分単位の時間
- [スケール アップまたはスケール ダウンの幅] - スケール アクションのサイズ
- [クール ダウン] - 直前のスケール アクションが実施された後、もう一度スケール変更を実施するまでにこのルールが待機する必要のある時間の長さ

![Multiple scale rules](./media/insights-how-to-scale/Insights_MultipleScaleRules.png)

複数のスケール ルールを使用して、パフォーマンスの変化に応じ、より積極的にスケール アップ (またはスケール ダウン) を実施することができます。たとえば、次のような 2 つのスケール ルールを定義できます。

1. CPU 使用率が 60% を超える場合は、インスタンス 1 つ分のスケール アップ
2. CPU 使用率が 85% を超える場合は、インスタンス 3 つ分のスケール アップ

後者の追加ルールにより、スケール アクションが実施される前にロードが 85% を超えた場合は、インスタンス 1 つ分だけではなく、さらに 2 つの追加インスタンスを取得することになります。 

<!--HONumber=46--> 
