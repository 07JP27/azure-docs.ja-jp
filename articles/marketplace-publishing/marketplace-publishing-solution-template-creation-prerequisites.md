<properties
   pageTitle="Marketplace 用のソリューション テンプレートを作成するための技術的前提条件 | Microsoft Azure"
   description="Azure Marketplace でデプロイおよび販売するソリューション テンプレートを作成するための要件について説明します。"
   services="marketplace-publishing"
   documentationCenter=""
   authors="HannibalSII"
   manager=""
   editor=""/>

<tags
   ms.service="marketplace-publishing"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="10/09/2015"
   ms.author="hascipio; v-divte" />

# Azure Marketplace 用のソリューション テンプレートを作成するための技術的前提条件
始める前にプロセスをよく読み、各ステップをどこで、なぜ実行するのかを理解してください。可能な限り、会社の情報と他のデータを準備し、必要なツールをダウンロードし、技術コンポーネントを作成してから、プラン作成プロセスを開始する必要があります。この記事を読んでよく理解してください。

## トポロジの定義とプラットフォームの評価
読者は既に Azure コンピューティング アーティファクトのことをよく理解していて、性格に何を作成する必要があるかを考えているかもしれません。 VM イメージ、拡張機能、ARM テンプレートのどれでしょうか。

アプリケーションを Azure アーティファクトにマップする前に、アプリケーションをオンプレミスにデプロイすることを検討している顧客に推奨している可能性があるソリューションに意味のあるさまざまなテクノロジを理解することが役に立ちます。ほとんどの企業は一般に、評価、概念実証、運用前、運用の 4 つのステージの何らかのバリエーションに従います。通常、パブリッシャーはこれらのステージで顧客と協力して要件を評価し、シナリオに必要な正確なレイアウトとスケールを推奨します。すべての顧客は同じではありませんが、一般に、特定の顧客デプロイメントの規模に対して推奨する一般的なトポロジとサイズがあることを期待します。そのため、ソリューションのデプロイを始める前であっても、アプリケーションに意味のあるレイアウトと、大きなカスタマイズなしで顧客のニーズに対応する方法を考えます。ここでも、常に非常に正確なものを必要とするお客様がいることはわかっていますが、一般的なケースについて考えます。

デプロイメントの各タイプ (評価、概念実証、運用前、運用) について、アプリケーションに必要なレイアウトとトポロジを考えます。どのような階層があるか。 各階層に対して、どのようなサイズのどのようなリソースが必要か。 これらのリソースの作成に必要な構成要素は何か。 運用デプロイメントは、または開発/テスト環境であっても、顧客とそのニーズによって規模が大きく異なることがあります。トポロジの規模 (小、中、大、巨大) によってワークロードがどのようになるかを判断し、成功するために必要な可用性、拡張性、パフォーマンスの要件をよく考えます。

さまざまなトポロジのレイアウトと対応するサイズを検討した後は (顧客へのオンプレミス デプロイメントの経験から既にほとんど完了しているかもしれません)、Azure で提供する必要があるものへの還元を開始します。

Azure リソース マネージャーおよび Azure リソース マネージャー上の Compute で提供するものに対するトポロジ要件を評価します。ほとんどの顧客は小規模なデプロイメントで開始しますが、**最初は大規模なトポロジを導入しない場合であっても、Azure リソース マネージャー上の Compute での大規模なトポロジのパフォーマンス、スケール、能力の要件を評価することを強くお勧めします**。 これは主に、顧客が小規模なソリューションで開始してから大規模なデプロイメントに拡張する余地があることを確認するためです。スケール、パフォーマンス、能力の制限を Microsoft に連絡し、パブリッシャー、Marketplace パートナー、顧客が必要とする改善を行えるようにします。

> [AZURE.TIP]**推奨:** 最終的な顧客の発展に対応できるよう、アプリケーションの予想される最大デプロイメント サイズに合わせてテンプレートを評価および作成します。

## Azure Compute の構成要素
最初に、利用できるコンピューティング アーティファクトと、アーティファクトに関するアプリケーションの検討方法について明らかにします。

### 1\.既存の Virtual Machines の使用
すべての仮想マシンの構成要素は VM イメージです。VM イメージとは仮想マシンの完全なストレージ プロファイルであり、1 個のオペレーティング システム VHD と 0 個以上のデータ ディスクを含みます。VM イメージを作成し、ソフトウェア アプリケーションとオペレーティング システム ビットに加えて必要なデータをパッケージ化できます。たとえば、Azure Marketplace には現在、SQL Server 用の多くの VM イメージがあり、Windows オペレーティング システムと SQL Server アプリケーションがパッケージ化されています。このドキュメントでは、VM イメージの作成と Azure Marketplace での公開については詳しく説明しませんが、アプリケーション ソリューションの構成要素なので、VM イメージとはどのようなものかを理解しておくことが重要です。「[Marketplace 用の VM イメージの作成](marketplace-publishing-vm-image-creation.md)」の手順を参照してください。

### 2\.VM 拡張機能
アプリケーション プロバイダーとしてオペレーティング システムを所有および管理するのが望ましくない場合、イメージでは役に立たないことがあります。Azure Marketplace では現在、多くのオペレーティング システム関連会社が Windows、Linux、Unix を定期的に発行しています。Windows Server、Ubuntu、CentOS ベース、CoreOS、Oracle Linux などのイメージがあります。オペレーティング システムとアプリケーションの両方をパッケージ化した独自の VM イメージを発行する代わりに、VM 拡張機能ハンドラーを作成したり、既存のものを利用したりできます。VM 拡張機能は VM の構成と管理を簡素化するためのソフトウェア メカニズムであり、Azure VM のゲスト エージェント (保護された軽量のプロセス) を利用します。たとえば、カスタム スクリプト拡張機能は、カスタム スクリプトを取得して、VM 内で実行します。これにより、汎用スクリプトで可能なあらゆる種類の構成を実行できます。

従来のイメージのシナリオでは、すべてのものを一からイメージにインストールし、VM の起動の前後にスタートアップ タスクで必要な構成を行います。このイメージは大幅にカスタマイズされていて、簡単に再利用できない場合があります。このような方法が理にかなっていることもあります。一方で、特に軽量のアプリケーションや VM のプロビジョニング後に複雑な構成が必要な場合は、拡張機能モデルが役に立ちます。場合によっては、拡張機能と VM イメージの組み合わせをデプロイし、インストール済みのソリューションを利用しながら、起動後に複雑な構成を行えるようにすることもできます。

イメージと拡張機能は単一の VM を構成するには非常に便利です。しかし、クラウドで高可用性を提供し、増加するトラフィックのニーズを満たすために拡張するには、1 つの VM では十分ではありません。そのため、運用ワークロードでは、可用性セットと負荷分散を使用する複数 VM の高可用性ソリューションを計画することを強くお勧めします。

>[AZURE.TIP]**推奨:** Marketplace のすべての運用ワークロードは、3 つの障害ドメインによる可用性セットにトラフィックを提供し、ロード バランサーを使用する、複数の Virtual Machines を使用してデプロイする必要があります。

アプリケーションでサポートおよび推奨できるこれらのさまざまなデプロイメント トポロジをサポートするため、Azure Marketplace では Azure リソース マネージャー (ARM) と ARM テンプレートが提供されています。Azure リソース マネージャーは、宣言型のモデルに基づくテンプレート言語を使用して、リソースのコレクションのライフサイクルをデプロイおよび管理します。このテンプレートは単なるパラメーター化された JSON ファイルであり、デプロイメントに使用するリソースのセットとそれらの関係を表しています。各リソースはリソース グループに配置されます。リソース グループはリソースのコンテナーです。リソース マネージャーでは、一元化された操作監査、顧客請求のためのリソース タグ付け、エンドユーザー向け、きめ細かいセキュリティのためのリソース ベースのアクセス制御、最高の可用性を実現する 3 コンピューティング障害ドメインなどの非常に役に立つその他の機能セットも顧客のために用意されており、すべての操作はべき等です。

> [AZURE.IMPORTANT]**必須:** 顧客のことを考えるなら、Azure リソース マネージャー テンプレートを使用して Marketplace のすべてのコンテンツをデプロイする必要があります。

ARM および ARM テンプレートを使用すると、VM イメージや VM 拡張機能などの Marketplace の内容を基にして構築される Virtual Machines、ストレージ アカウント、Virtual Network などの Azure リソースのより複雑なデプロイメントを表すことができます。

## 構成要素の開発
最初のステージでアプリケーションのトポロジおよび開発して Marketplace に発行するものが決まったら、VM の構成要素を明らかにして開発します。前述のように、VM の内容を独自の VM イメージとしてパッケージ化して発行するのか、または Azure Marketplace の既存の VM イメージを利用して公開されている拡張機能ハンドラーまたは独自のハンドラーで構成するのかを、決定する必要があります。唯一の正解というようなものはありません。基盤のオペレーティング システムを制御する範囲、およびアプリケーションをインストール、構成、管理する方法の要件に、大きく依存します。イメージと拡張機能の詳細については、MSDN および Azure ブログを参照してください。役に立つ可能性のある資料の一覧については、後の「**関連項目**」セクションを参照してください。

使用するイメージまたは拡張機能ハンドラーはすべて、先に Marketplace で発行されている必要があることに注意してください。

## ARM テンプレートの開発
Azure リソース マネージャーおよび ARM テンプレートを初めて使用する場合は、Azure リソース マネージャーおよび Azure リソース マネージャーの Compute に関するドキュメントを読んでおくことをお勧めします。以下の説明と例は、ARM テンプレート言語および ARM での Compute の使用方法について基本的に理解していることを前提に書かれています。このセクションでは主に、Azure Marketplace 用の適切なテンプレートを開発するための要件とベスト プラクティスについて説明します。これらでは、Ibiza Portal およびプログラムでの顧客向けの統一された、簡単に使える、関連するエクスペリエンスのための要件が考慮されています。

ソリューションは、一連のテンプレートで表されます。これらのテンプレートは、トポロジの論理的な部分です。トポロジの表現を複数のファイルに分割する理由は、開発や管理のしやすさ、特定のサブセットの再利用性、モジュール テスト、テンプレート ソリューションの拡張などさまざまです。多くのパートナーに Azure チームが提案したトポロジ分割方法の 1 つは、VNets やストレージ アカウントなどの共通リソース用の 1 個のテンプレート (共有リソース テンプレート)、オプション リソース用の 0 個以上のテンプレート (オプション リソース テンプレート)、トポロジ固有のリソース用の 1 個以上のテンプレート (既製構成リソース テンプレート) に分ける方法です。

Marketplace の完全なテンプレート ソリューションは、次の項目で構成されます。

1. **1 個のメイン テンプレート (mainTemplate.json)** – これは、ARM JSON テンプレート ファイルで表されるデプロイメント全体へのエントリ ポイントです。これは、テンプレート ソリューションで最初に評価されるファイルであり、テンプレートの他のすべてを結びつける (リンクする) ために使用されます。このファイルには、エンド ユーザーからの必要なすべての入力 (パラメーター) も含まれる必要があります。
2. **0 個以上のリンクされたテンプレート** – メイン テンプレートからリンクされている、ソリューションの完全なトポロジを表すテンプレートの残りの部分です。
3. **0 個以上のスクリプト ファイル** – 仮想マシンの構成に使用される拡張機能への入力としてと想定されているすべての関連スクリプト ファイルです。
4. **1 個の UI 作成定義ファイル (uiDefinition.json createUiDefinition.json)** – これは、ARM テンプレートのパラメーターをユーザー エクスペリエンスの要素にマップするファイルです。このファイルを使用すると、Ibiza で顧客に表示される UI を制御できます。エンド ユーザーから必要なすべての入力を、このファイルで表します。各エントリを使用して、UI ウィジェット、既定値、検証ルール、エラー メッセージなど、各入力に関連する UI のすべての側面を制御できます。完全なトポロジを表現するこれらの各ファイルの開発を始めるときは、Marketplace プランの最適なテンプレートになるように以下のことを考慮します。

## 追加の要件と推奨事項

### ユーザー入力の標準化された最小セット
パラメーターを使用すると、デプロイメント時にユーザーがテンプレートで提供する必要のある値を表すことができます。ユーザー入力は、アプリケーションごと、またはトポロジの階層ごとに、異なる場合があります。パラメーター リストでは、必要な質問の数を少なくすることと、ユーザーが制御できるデプロイメントの範囲の、適正なバランスを考える必要があります。ユーザー入力の完全なリストは必要ありませんが、多くの顧客が制御する必要のある一般的な入力セットをすべての Marketplace テンプレート ソリューションが備える必要があります。次の値のパラメーターを定義するようにします。

1. **場所** – リソースがデプロイされる Azure リージョン。
2.	**Virtual Network 名** – 新しい Virtual Network を作成するデプロイメントの場合、そのリソースを作成するために使用する名前。既存の Virtual Network を使用するデプロイメントの場合は、デプロイする VNet の名前。
3.	**ストレージ アカウント** – 新しいストレージ アカウントを作成するデプロイメントの場合は、作成するストレージ アカウントの名前。既存の Virtual Network を使用するデプロイメントの場合は、使用するストレージ アカウントの名前。
4.	**DNS 名** – エンドユーザーが接続する仮想マシンまたはロード バランサーのドメイン名。
5.	**ユーザー名** – 仮想マシンおよび場合によってはアプリケーションのユーザー名。複数のユーザー名をエンド ユーザーに要求できますが、少なくとも 1 つは要求する必要があります。
6.	**パスワード** – 仮想マシンおよび場合によってはアプリケーションのパスワード。異なる VM またはアプリケーションに対する複数のパスワードをエンド ユーザーに要求できますが、少なくとも 1 つは要求する必要があります。
7.	**SSH 公開キー (Linux VM の場合のみ)** – 仮想マシンの SSH キー。異なる VM に対する複数のキーをエンド ユーザーに要求できますが、少なくとも 1 つは要求する必要があります。

## 次のステップ
前提条件を確認し、必要なタスクを完了したので、「[Guide to create a Solution Template for Azure Marketplace ( Azure Marketplace 用ソリューション テンプレート作成ガイド)](marketplace-publishing-solution-template-creation.md)」で詳述されているソリューション テンプレート プランの作成に進むことができます。

## 関連項目
- [Getting Started: How to publish an offer to the Azure Marketplace (概要: Azure Marketplace へのプランの発行方法)](marketplace-publishing-getting-started.md)
- [Creating a Solution Template Best Practices (ソリューション テンプレート作成のベスト プラクティス)](marketplace-publishing-solution-template-best-practices.md)

[link-acct]: marketplace-publishing-accounts-creation-registration.md

<!---HONumber=Oct15_HO3-->