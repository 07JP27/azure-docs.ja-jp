<properties
	pageTitle="プラットフォームでサポートされているクラシックから Azure Resource Manager への IaaS リソースの移行"
	description="この記事では、プラットフォームでサポートされるサービス管理から Azure Resource Manager への移行サービス機能について説明します。"
	services="virtual-machines-windows"
	documentationCenter=""
	authors="mahthi"
	manager="drewm"
	editor=""
	tags="azure-resource-manager"/>

<tags
	ms.service="virtual-machines-windows"
	ms.workload="infrastructure-services"
	ms.tgt_pltfrm="vm-windows"
	ms.devlang="na"
	ms.topic="article"
	ms.date="05/04/2016"
	ms.author="mahthi"/>

# プラットフォームでサポートされているクラシックから Azure Resource Manager への IaaS リソースの移行

Azure Resource Manager での Virtual Machines のサポートを発表してからほぼ 1 年になります。ここでは、サポートされている機能の強化点と追加機能について詳しく説明します。さらに、仮想ネットワークへのサイト対サイトゲートウェイを使用して、サブスクリプションに共存する 2 つのデプロイ モデルからのリソースの最適な接続および使用方法についても説明します。この記事では、クラシックからリソース マネージャーへの IaaS リソースの移行を有効にする方法を示します。

## 移行の目的

Virtual Machines で利用できる新しいエクスペリエンスと API によって提供される機能はとても充実しています。これにより、いろんな意味でクラウドを使用できる方法が変わります。新しいリリースのモデルを使用すれば、リソース グループで関連サービスをデプロイ、管理、および監視することができます。リソース マネージャーは、テンプレートを使用して複雑なアプリケーションをデプロイでき、VM の拡張機能を使用して仮想マシンを構成し、アクセス管理とタグ付けを統合します。これには、仮想マシンの可用性セットへのスケーラブルな並列デプロイも含まれます。さらに、新しいモデルでは、Compute、Network および Storage の個別のライフサイクル管理が提供されます。特に注目すべき点は、Virtual Network では既定で仮想マシンが適用され、セキュリティが有効になることです。

機能面について言うと、Azure Resource Manager では Compute、Network および Storage に対して一部を除きほとんどすべての機能がサポートされます。この一部の機能についても、今後数か月で完成できるよう積極的に取り組んでいます。また、引き続きユーザー エクスペリエンスを改善し、Azure ポータルにさらに機能を追加することで、エクスペリエンスを橋渡しできるようにします。

新しい Azure Resource Manager でのこの新しい機能と拡張を続けるデプロイ ベースに応じて、お客様がクラシックの既存のデプロイを移行できるようにします。

>[AZURE.NOTE] この発表に伴い、移行サービスのパブリック プレビュー版を導入します。パブリック プレビュー中は、Azure サブスクリプションの開発/テスト ワークロードのみの移行をお勧めします。

## 移行後のオートメーションおよびツールの変更

クラシックからリソース マネージャーへのリソース移行の一環として行う必要がある重要な変更の 1 つは、既存のオートメーションまたはツールの更新です。リソースを移行しても引き続きこれらが機能することを確認してください。

## クラシックからリソース マネージャーへの IaaS リソース移行の意味

詳しく説明する前に、IaaS リソースでのデータ プレーンと管理プレーンの操作の違いについて簡単に説明したいと思います。これらの違いを理解することは、移行のサポートがどのように計画されているかを知ることであるため重要です。

- 管理プレーン - リソースを変更するための管理プレーンまたは API を指します。たとえば、VM の作成、VM の再起動、新しいサブネットでの Virtual Network の更新などです。これらすべての操作で実行中のリソースを管理しますが、インスタンスへの接続には直接影響しません。
- データ プレーン (アプリケーション) – アプリケーション自体の "ランタイム" を指します。Azure API を経由しないインスタンスとの対話が含まれます。Web サイトへのアクセスまたは実行中の SQL Server や mongoDB サーバーからのデータのプルはすべて、データ プレーンまたはアプリケーション対話と見なされます。ストレージ アカウントから BLOB をコピーすることや、パブリック IP アドレスにアクセスして RDP または SSH で仮想マシンに接続することもデータ プレーンです。これらの操作の場合、Compute、Network、および Storage でアプリケーションは実行されたままになります。

>[AZURE.NOTE] 一部の移行シナリオ (詳細については、サポートされていない構成に関する記述を参照) では、仮想マシンの割り当てを解除して再起動します。これにより、短時間のデータ プレーン ダウンタイムが発生します。

## 移行のサポート対象範囲とは

パブリック プレビュー中は、主に Compute および Network を対象とする 2 つの移行範囲を提供します。ストレージ アカウントの移行サポートが計画されており、まもなくリリースされます。ただし、シームレスに移行できるように、クラシック ストレージ アカウントを使用してリソース マネージャー VM のディスクを格納できるようになっています。詳細については、以下を参照してください。

### Virtual Machines の移行 (Virtual Network 外)

リソース マネージャーのデプロイ モデルでは、既定でアプリケーションのセキュリティを適用します。そのため、VM がすべてリソース マネージャー モデルの Virtual Network 内にある必要があります。したがって、移行の一環として、VM を再起動 (割り当てを解除して起動) します。仮想ネットワークについては、いくつかのオプションがあります。
- 新しい Virtual Network を作成し、仮想マシンをその新しい Virtual Network に移行するようにプラットフォームに要求できます。または、
- リソース マネージャーの既存の Virtual Network に仮想マシンを移行するように要求できます。

>[AZURE.NOTE] この移行範囲では、移行中の一定期間は、'管理プレーン' と 'データ プレーン' の両方の操作が許可されない場合があります。

### 仮想マシンの移行 (Virtual Network 内)

この範囲では、ほとんどの VM 構成の場合、クラシックとリソース マネージャー間のメタデータの移行のみを行います。基になる Virtual Machines は、同じネットワーク内の同じストレージを使用する同じハードウェアで実行されます。したがって、クラシックからリソース マネージャーへのメタデータの移行の場合、移行中の一定期間は '管理プレーン' 操作が許可されない可能性があります。ただし、データ プレーンは引き続き機能します。つまり、移行中は Virtual Machines (クラシック) 上で実行されているアプリケーションでダウンタイムが発生することはありません。

現時点では、以下の構成はサポートされていません。ただし、今後、これらのサポートが追加されたときに、この構成の一部の VM でダウンタイムが発生する (割り当てが解除され、再起動される) 場合があります。

-	単一のクラウド サービスに 1 つ以上の可用性セットがある場合
-	単一のクラウド サービスに '1 つ以上の可用性セット' と '可用性セットには存在しない VM' がある場合

>[AZURE.NOTE] この移行範囲では、移行中の一定期間は、'管理プレーン' が許可されない場合があります。上記の特定の特別な構成の場合、'データ プレーン' ダウンタイムが発生します。

### ストレージ アカウントと移行

現在、パブリック プレビューではストレージ アカウントの移行はサポートされていません。ただし、ストレージ アカウントの移行サポートは計画されており、まもなくリリースされます。移行とそのストレージ アカウントの動作については、重要な点が 2 つあります。

- クラシック ストレージ アカウントでリソース マネージャー VM をデプロイできるようする: シームレスに移行できるように、クラシック ストレージ アカウントでリソース マネージャー VM をデプロイできるようにしました。この機能により、ストレージ アカウントとは関係なく、Compute および Network リソースを移行することができます。
- ストレージ アカウントの移行のベスト プラクティス: ストレージ アカウントの移行がサポートされている場合、プラットフォームはストレージ アカウントとは関係なく Compute および Network リソースを適用し、シームレスなエクスペリエンスを可能にします。

## サポートされていない機能と構成

現時点では、特定の機能および構成セットはサポートされていません。現在、これらのサポートの追加に取り組んでいますが、以下のセクションでは推奨事項と計画について説明します。

### サポートされていない機能

パブリック プレビューでは、以下にリストされている機能はサポートされていません。必要に応じて、これらの設定を削除し、VM を移行してからリソース マネージャーのデプロイ モデルに戻し、再度有効にすることができます。これらの機能のほとんどのサポートは計画されており、利用可能になった時点でリリースされます。

リソース プロバイダー | 機能
---------- | ------------
コンピューティング | ブート診断
コンピューティング | 関連付けなし仮想マシン ディスク
コンピューティング | 仮想マシン イメージ
ネットワーク | 関連付けなし予約済み IP (仮想マシンに接続されていない場合)。VM に接続されている予約済み IP はサポートされます。
ネットワーク | 関連付けなしネットワーク セキュリティ グループ (仮想マシンやネットワーク インターフェイスに接続されていない場合)。VNET によって参照される NSG はサポートされます。
ネットワーク | エンドポイント ACL
ネットワーク | 仮想ネットワーク ゲートウェイ (サイト対サイト、Express Route、ポイント対サイト)
Storage | ストレージ アカウント

### サポートされていない構成

パブリック プレビューでは、以下にリストされている構成はサポートされていません。以下の推奨事項を参照してください。これらの構成のいくつかのサポートは計画されており、利用可能になった時点でリリースされます。

サービス | 構成 | 推奨
---------- | ------------ | ------------
リソース マネージャー | クラシック リソース用のロールベースのアクセス制御 | リソースの URI は移行後に変更されるため、移行後に必要な RBAC ポリシーの更新をあらかじめ計画することをお勧めします。
コンピューティング | VM に関連付けられている複数のサブネット | サブネットのみを参照するように、サブネット構成を更新する必要があります。
コンピューティング | Virtual Network に属しているが、明示的なサブネットが割り当てられていない Virtual Machines 。 | 必要に応じて VM を削除することができます。現在、この機能のサポートは計画されています。
コンピューティング | アラートの AutoScale ポリシーが適用されているVirtual Machines | 現時点では、まもなく移行されるため、これらの設定は削除されます。したがって、移行を行う前に環境を評価することを強くお勧めします。移行の完了後にアラート設定を再構成することもできます。
コンピューティング | XML VM 拡張機能 (VS デバッガー、WebDeploy および RemoteDebug) | これはサポートされません。仮想マシンからこれらの拡張機能を削除して、移行を続行することをお勧めします。
コンピューティング | Web/worker ロールを含む Cloud Services | 現在、これはサポートされておらず、計画中です。
ネットワーク | Virtual Machines と Web/worker ロールを含むVirtual Network | 現在、これはサポートされておらず、計画中です。
ネットワーク | 名前にスペースを含むサブネット | この機能のサポートは計画されています。
アプリケーション サービス | App Service 環境を含む Virtual Network | 現在、これはサポートされておらず、計画中です。
HDInsight サービス | HDInsight サービスを含む Virtual Network | 現在、これはサポートされておらず、計画中です。
Dynamics Lifecycle Services | Dynamics Lifecycle Services によって管理されるVirtual Machines を含む Virtual Network | 現在、これはサポートされておらず、計画中です。

## 移行エクスペリエンス

移行エクスペリエンスを開始する前に、以下のいくつかの手順に従うことを強くお勧めします。

1. 移行が計画されているリソースで、サポートされていない機能や構成を利用していないことを確認します。ほとんどの場合、プラットフォームはこれらの問題を検出し、エラーをスローします。
2. Virtual Network 内にない VM は、準備操作時に割り当てが解除されます。したがって、パブリック IP アドレスが失われないように、準備をトリガーする前に IP アドレスの予約を検討してください。ただし、Virtual Network 内にある VM の割り当ては解除されません。
3. Azure では、運用デプロイを移行する前に似たような設定のテスト環境を設定し、リソースを移行することが推奨されます。
4. 移行中に発生する可能性のある予期しないエラーに備え、営業時間外での移行を計画します。
5. 準備手順の完了後に検証しやすいように、PowerShell、CLI コマンドまたは REST API を使用して、Virtual Machines の現在の構成をダウンロードします。
6. 移行を開始する前に、リソース マネージャーのデプロイ モデルを処理する自動/運用スクリプトを更新します。また、必要に応じて、リソースの準備ができた状態で GET 操作を実行することもできます。
7. クラシック IaaS リソースに構成されている RBAC ポリシーを評価し、移行が完了したら計画します。

パブリック プレビューの発表に伴い、REST API、PowerShell および Azure CLI を使用する移行のトリガー サポートを追加しました。クラシックから ARM への移行を視覚化し、説明するための Azure ポータルでの移行サポートは現在計画されています。

![移行のワークフローを示すスクリーンショット](./media/virtual-machines-windows-migration-classic-resource-manager/migration-workflow.png)

1.	準備
	* これは、移行プロセスの最初の手順です。この手順の目的は、クラシックからリソース マネージャー リソースへの IaaS リソースの変換をシミュレートし、これを並行して示し、視覚化することです。アクションの詳細なフローは次のとおりです。
  * 移行を準備する Virtual Network またはホストされるサービス (VNET でない場合) を選択します。
  *	最初は、プラットフォームは常に移行対象のリソースをバックグラウンドでデータ分析し、リソースを移行できるかどうかを示すコード (成功/失敗) を返します。
	*	リソースを移行できない場合は、移行がサポートされていない理由がリストされます。
	* リソースを移行できる場合、プラットフォームは最初に、移行対象のリソースに対する管理プレーン操作をロックします。たとえば、移行中に VM にデータ ディスクを追加することはできません。
  *	次に、プラットフォームはリソースを移行するために、クラシックからリソース マネージャーへのメタデータの移行を開始します。  
  *	準備操作が完了すると、クラシックとリソース マネージャーの両方でリソースを視覚化するためのオプションが表示されます。クラシック デプロイメント モデルの各クラウド サービスに対して、`cloud-service-name>-migrated` というパターンのリソース グループ名が作成されます。

2.	手動またはスクリプト チェック
  * この手順では、必要に応じて、移行が正しく行われていることを検証するために、前の手順でダウンロードした構成を使用できます。また、ポータルにログインし、プロパティとリソースをスポット チェックして、メタデータが正しく移行されていることを検証することもできます。
	* Virtual Network を移行する場合、仮想マシンのほとんどの構成は再開されません。これらの VM のアプリケーションの場合、アプリケーションがまだ稼働していることを検証できます。
	* 監視/オートメーションおよび操作スクリプトをテストすることで、VM が期待どおりに機能しているか、および更新したスクリプトが正しく機能するかを確認できます。リソースが準備された状態でサポートされるのは、GET 操作のみであることに注意してください。
  * 移行を 'コミット' するまでに必要な期間は設定されません。この状態で必要なだけ時間をかけることができます。ただし、'中止' または 'コミット' するまで、これらのリソースに対して管理プレーンがロックされることに注意してください。
  * 問題がある場合は、いつでも移行を '中止' し、'クラシック' デプロイ モデルに戻ることができます。戻ると、リソースに対する管理プレーン操作が開始されるため、クラシック デプロイメント モデルで VM に対する通常の操作を再開できます。

3. 中止
  * これは省略可能な手順です。クラシック デプロイメント モデルへの変更を元に戻し、移行を中止できます。'コミット' 操作をトリガーした後でこの操作を実行できないことに注意してください。 	

4.	コミット
  * 検証が完了したら、移行を 'コミット' することができます。リソースはクラシックで表示されなくなりますが、リソース マネージャーのデプロイ モデルでのみ使用できます。つまり、移行されたリソースは新しいポータルでのみ管理できます。
	* この操作に失敗した場合、2 ～ 3 回再試行することをお勧めします。失敗が続く場合は、サポート チケットを作成するか、[こちら](https://social.msdn.microsoft.com/Forums/azure/ja-JP/home?forum=WAVirtualMachinesforWindows)でフォーラム投稿を作成し、ClassicIaaSMigration タグを付けてください。

>[AZURE.NOTE] 次に示すすべての操作はべき等であることに注意してください。サポートされていない機能や構成エラー以外の場合は、準備、中止またはコミット操作を再試行し、プラットフォームでアクションを再試行することをお勧めします。

## 次のステップ
これで、クラシック IaaS からリソース マネージャーへのリソースの移行について理解できました。次は、リソース マネージャーの移行を開始します。

- [プラットフォームでサポートされているクラシックから Azure Resource Manager への移行に関する技術的な詳細](virtual-machines-windows-migration-classic-resource-manager-deep-dive.md)
- [PowerShell を使用してクラシックから Azure Resource Manager へ IaaS リソースを移行する](virtual-machines-windows-ps-migration-classic-resource-manager.md)
- [CLI を使用してクラシックから Azure Resource Manager へ IaaS リソースを移行する](virtual-machines-linux-cli-migration-classic-resource-manager.md)
- [PowerShell スクリプトを使用して Azure Resource Manager にクラシック仮想マシンを複製する](virtual-machines-windows-migration-scripts.md)

## よく寄せられる質問

**この移行計画は Azure Virtual Machines 上で実行されている既存のサービスやアプリケーションに影響しますか?**

いいえ。Virtual Machines (クラシック) は GA サービスで完全にサポートされているため、引き続きこれらのリソースを利用して、Microsoft Azure クラウドでのフットプリントを拡大できます。

**近日中に移行する予定がない場合、VM はどうなりますか?**

既存のクラシック API やリソース モデルが廃止されることはありません。リソース マネージャーのデプロイ モデルで使用可能な高度な機能を利用すれば、移行はとても簡単です。したがって、[こちら](virtual-machines-windows-compare-deployment-models.md)でリソース マネージャーの IaaS の一部として行われた機能強化をいくつか確認することを強くお勧めします。

**既存のツールにとって、この移行計画はどのような意味がありますか?**

リソース マネージャーのデプロイ モデルへのツールの更新は、移行計画で考慮する必要がある最も重要な変更の 1 つになります。

**管理プレーンのダウンタイムはどれくらいですか?**

移行対象のリソースの数によって異なります。小規模なデプロイ (VM が数十台) の場合、移行全体に要する時間は 1 時間未満です。ただし、大規模なデプロイ (VM が数百台) の場合は、数時間になることがあります。サービスがパブリック プレビュー段階である場合は、開発またはテスト サブスクリプションで実行し、影響を評価することを強くお勧めします。

**リソース マネージャーで移行対象のリソースがコミットされた後で、ロールバックすることはできますか?**

リソースが '準備完了' の状態である限り、移行を中止することはできます。リソースが正常に移行されてからコミット操作を使用してロールバックすることはできません。

**コミット操作が失敗した場合、移行をロールバックすることはできますか?**

コミット操作が失敗した場合、移行を中止することはできません。コミット操作を含むすべての移行操作はべき等です。したがって、しばらくしてから操作を再試行することをお勧めします。エラーが続く場合は、サポート チケットを作成するか、[こちら](https://social.msdn.microsoft.com/Forums/azure/ja-JP/home?forum=WAVirtualMachinesforWindows)でフォーラム投稿を作成し、ClassicIaaSMigration タグを付けてください。

**リソース マネージャーの IaaS を利用する必要がある場合、別の Express Route 回線を購入する必要はありますか?**

いいえ。最近、[クラシックおよびリソース マネージャーでの Express Route 回線の共存](../expressroute/expressroute-howto-coexist-resource-manager.md)が可能になりました。Express Route 回線が既にある場合は、新しいものを購入する必要はありません。

**サポートされていないシナリオを移行リストに追加する場合のロードマップはありますか?**

現時点では、2016 年 H1 に最初のシナリオ セットを展開する予定です。最初のリリース後に、サポートされていない機能のサポートを継続的に追加していく予定です。

**クラシック IaaS リソース用にロールベースのアクセス制御ポリシーを構成した場合はどうすればよいですか?**

移行中に、リソースはクラシックからリソース マネージャーに変換されます。したがって、移行後に必要な RBAC ポリシーの更新をあらかじめ計画することをお勧めします。

**現在、Azure で Azure Site Recovery または Backup サービスを使用している場合はどうすればよいですか?**

リソース マネージャーでの Virtual Machines の Azure Site Recovery および Backup サポートは最近追加されました。また、これらのチームと協力し、リソース マネージャーへの VM の移行をサポートできるよう積極的に取り組んでいます。現時点では、これらの機能を利用する場合、移行を実行しないことをお勧めします。

**サブスクリプションまたはリソースを検証し、移行が可能かどうかを確認することはできますか?**

現時点では、移行準備中のリソースについては、準備操作で暗黙的に検証されます。プラットフォームでサポートされる移行オプションでは、移行準備の最初の手順はリソースを移行できるかどうかを検証することです。検証に失敗しても、リソースにはまったく影響はありません。ただし、より簡単な新しい検証アクションのリリースも計画しています。

**IaaS リソースの移行準備中にクォータ エラーが発生した場合はどうなりますか?**

移行を中止することをお勧めします。その後、VM を移行するリージョンのクォータを増やすサポート要求を記録します。クォータ要求が承認されたら、移行手順の実行を再開してください。

**サポート契約がない場合は、どのように問題をレポートすればよいですか?**

移行の問題や質問については、ClassicIaaSMigration というキーワードを付け、[こちら](https://social.msdn.microsoft.com/Forums/azure/ja-JP/home?forum=WAVirtualMachinesforWindows)から Virtual Machines フォーラムに投稿してください。質問はすべてのこのフォーラムで投稿することをお勧めしますが、サポート契約がある場合には、サポート チケットを記録することもお勧めします。

**移行中にリソース グループに対してプラットフォームで選択された名前が気に入らない場合はどうすればよいですか?**

リソース グループ間でのリソースの移行サポートについては、近日お知らせします。この機能がサポートされれば、任意のリソース グループにリソースを移行することができます。

**移行中にプラットフォームで選択されたリソース名が気に入らない場合はどうすればよいですか?**

クラシック デプロイメント モデルで明示的に名前を指定したリソースはすべて、移行中は保持されます。場合によっては、新しいリソースが作成されます。たとえば、各 VM に対してネットワーク インターフェイスが作成されます。現時点では、移行中に作成されるこれらの新しいリソース名を制御することはできません。[こちら](http://feedback.azure.com)でこの機能の投票を記録してください。

<!---HONumber=AcomDC_0511_2016-->