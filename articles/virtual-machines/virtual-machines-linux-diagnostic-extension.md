	<properties		pageTitle="using linux diagnostic extension to monitor linux vm’s performance and diagnostic data"		description="Learn how to linux diagnostic extension to monitor linux vm’s performance and diagnostic data."		services="virtual-machines"		documentationCenter=""    	authors="Ning"		manager="timlt"		editor=""    	tags=""/>	<tags		ms.service="virtual-machines"		ms.workload="infrastructure-services"		ms.tgt_pltfrm="vm-linux"		ms.devlang="na"		ms.topic="article"		ms.date="06/04/2015"		ms.author="Ning"/>#Linux の診断拡張機能を使用して Linux VM のパフォーマンスと診断データを監視する##はじめに Linux 診断拡張機能は、Azure で実行されている Linux VM を監視するのに役立ちます。次の機能があります。1.	Linux VM のシステム パフォーマンス、診断、syslog データを収集して、ユーザーのストレージ テーブルにアップロードします。2.	ユーザーは収集およびアップロードされるデータ メトリックをカスタマイズできます。	3.	ユーザーは指定したログ ファイルを指定したストレージ テーブルにアップロードできます。バージョン 2.0 では、以下のデータが含まれます。1.	システム、セキュリティ、アプリケーション ログを含む、すべての Linux Rsyslog ログ。2.	この[ドキュメント](https://scx.codeplex.com/wikipage?title=xplatproviders&referringTitle=Documentation "ドキュメント")で指定されているすべてのシステム データ。3.	ユーザーが指定したログ ファイル。##拡張機能を有効にする方法 拡張機能は、Azure 管理ポータル、Azure PowerShell、または Azure CLI スクリプトから有効にできます。[Azure 管理ポータル](https://ms.portal.azure.com/#)から直接、システムおよびパフォーマンス データを表示および構成するには、[こちらの手順](http://azure.microsoft.com/blog/2014/09/02/windows-azure-virtual-machine-monitoring-with-wad-extension/ "Windows ブログへの URL")に従ってください。 この記事では、Azure CLI コマンドを使用して拡張機能を有効化および構成する方法を説明します。直接ストレージ テーブルからデータを読み取って表示できます。##前提条件1. Microsoft Azure Linux エージェント バージョン 2.0.6 またはそれ以降。ほとんどの Azure VM Linux ギャラリー イメージにはバージョン 2.0.6 以降が含まれることに注意してください。WAAgent -version を実行して、VM にインストールされているバージョンを確認できます。VM が 2.0.6 より前のバージョンを実行している場合は、[こちらの説明](https://github.com/Azure/WALinuxAgent "説明")に従って更新できます。2.  [Azure CLI](./xplat-cli.md "Azure CLI") [このガイダンス](./xplat-cli-install.md "このガイダンス")に従って、コンピューターに Azure CLI 環境をセットアップしてください。Azure CLI をインストールした後は、コマンド ライン インターフェイス (Bash、ターミナル、コマンド プロンプト) から azure コマンドを使用して、Azure CLI コマンドにアクセスできます。たとえば、"azure vm extension set --help" を実行すると詳細な使用方法が表示され、"azure login" を実行すると Azure にログインし、"azure vm list" を実行すると Azure 上のすべての仮想マシンが一覧表示されます。3. データを格納するためのストレージ アカウント。データをストレージにアップロードするには、事前にストレージ アカウント名とアクセス キーを作成しておく必要があります。##Azure CLI コマンドを使用して Linux 診断拡張機能を有効にする ###  シナリオ 1. 既定のデータ セットで拡張機能を有効にするバージョン 2.0 以降では、以下のデータが既定で収集されます。 1. すべての Rsyslog 情報 (システム ログ、セキュリティ ログ、アプリケーション ログ)  2. 基本システム データのコア セット。完全なデータ セットについては、この[ドキュメント](https://scx.codeplex.com/wikipage?title=xplatproviders&referringTitle=Documentation "ドキュメント")を参照してください。追加のデータを有効にする場合は、シナリオ 2 および 3 の手順を続行してください。手順 1.次の内容を含む PrivateConfig.json という名前のファイルを作成します。	{     	"storageAccountName":"the storage account to receive data",     	"storageAccountKey":"the key of the account"	}手順 2."azure vm extension set vm_name LinuxDiagnostic Microsoft.OSTCExtensions 2.* --private-config-path PrivateConfig.json" を実行します。###   シナリオ 2. パフォーマンス モニターのメトリックをカスタマイズする  パフォーマンスおよび診断データのテーブルをカスタマイズする場合は、次の手順に従います。手順 1.次の内容で PrivateConfig.json という名前のファイルを作成し、収集する特定のデータを指定します。サポートされているすべてのプロバイダーと変数については、この[ドキュメント](https://scx.codeplex.com/wikipage?title=xplatproviders&referringTitle=Documentation "ドキュメント")を参照してください。スクリプトにさらにクエリを追加することにより、複数のクエリを使用して複数のテーブルにそれを格納することができます。Rsyslog データは既定で常に収集されることに注意してください。	{     	"storageAccountName":"storage account to receive data",     	"storageAccountKey":"key of the account",      	"perfCfg":[           	{"query":"SELECT PercentAvailableMemory, AvailableMemory, UsedMemory ,PercentUsedSwap FROM SCX_MemoryStatisticalInformation","table":"LinuxMemory"           	}             ]	}手順 2."azure vm extension set vm_name LinuxDiagnostic Microsoft.OSTCExtensions 2.* --private-config-path PrivateConfig.json" を実行します。###   シナリオ 3. 独自のログ ファイルをアップロードする特定のログ ファイルを収集してストレージ アカウントにアップロードする場合は、以下の手順に従います。ログ ファイルのパスと、ログを格納するテーブル名を指定する必要があります。複数の file/table エントリをスクリプトに追加することで、複数のログ ファイルを使用できます。手順 1.次の内容を含む PrivateConfig.json という名前のファイルを作成します。	{     	"storageAccountName":"the storage account to receive data",     	"storageAccountKey":"key of the account",      	"fileCfg":[           	{"file":"/var/log/mysql.err",             "table":"mysqlerr"           	}           ]	}手順 2."azure vm extension set vm_name LinuxDiagnostic Microsoft.OSTCExtensions 2.* --private-config-path PrivateConfig.json" を実行します。###   シナリオ 4. Linux の監視拡張機能を無効にする手順 1.次の内容を含む PrivateConfig.json という名前のファイルを作成します。	{     	"storageAccountName":"the storage account to receive data",     	"storageAccountKey":"the key of the account",     	“perfCfg”:[],     	“enableSyslog”:”False”	}手順 2."azure vm extension set vm_name LinuxDiagnostic Microsoft.OSTCExtensions 2.* --private-config-path PrivateConfig.json" を実行します。##データを確認するパフォーマンスおよび診断データは、Azure ストレージ テーブルに格納されます。Azure CLI スクリプトを使用してストレージ テーブルのデータにアクセスする方法については、[この記事](./storage-ruby-how-to-use-table-storage.md "この記事")を参照してください。さらに、次の UI ツールを使用してデータにアクセスすることもできます。1.	Visual Studio のサーバー エクスプローラーを使用します。ストレージ アカウントに移動します。VM が約 5 分間実行した後、既定のテーブルが表示されます。“LinuxCpu”、”LinuxDisk”、”LinuxMemory”、”Linuxsyslog”。データを表示するには、テーブル名をダブルクリックします。 2.	[Azure Storage Explorer](https://azurestorageexplorer.codeplex.com/ "Azure ストレージ エクスプローラー") を使用してデータにアクセスします。 ![image](./media/virtual-machines-linux-diagnostic-extension/no1.png)シナリオ 2 および 3 で fileCfg または perfCfg を指定して有効にした場合、前記のツールで規定以外のデータを表示することもできます。##既知の問題1. バージョン 2.0 の場合、Rsyslog 情報およびユーザー指定のログ ファイルには、スクリプトからのみアクセスできます。2. バージョン 2.0 の場合、最初にスクリプトを使用して Linux 診断拡張機能を有効にすると、ポータルからはデータを表示できません。一方、最初にポータルから拡張機能を有効にした場合は、スクリプトも正常に機能します。どちらの問題も、次のリリースで修正されるはずです。 

<!---HONumber=July15_HO2-->