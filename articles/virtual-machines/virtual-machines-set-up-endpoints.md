<properties 
	pageTitle="Azure 仮想マシンのエンドポイントのセットアップ" 
	description="Azure 上で仮想マシンとの通信を許可するようにクラシック ポータルでエンドポイントをセットアップする方法について説明します。" 
	services="virtual-machines" 
	documentationCenter="" 
	authors="KBDAzure" 
	manager="timlt" 
	editor=""/>

<tags 
	ms.service="virtual-machines" 
	ms.workload="infrastructure-services" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="04/29/2015" 
	ms.author="kathydav"/>

#仮想マシンに対してエンドポイントを設定する方法

同じクラウド サービスまたは仮想ネットワーク内であれば、Azure で作成したすべての仮想マシンが、プライベート ネットワーク チャネルを使用して他の仮想マシンと自動的に通信できます。ただし、インターネットまたは他の仮想ネットワークにあるコンピューターと通信するには、仮想マシンへの着信ネットワーク トラフィックを転送するエンドポイントが必要になります。

Azure の管理ポータルで仮想マシンを作成するとき、リモート デスクトップ、Windows PowerShell リモート処理、Secure Shell (SSH) 用のエンドポイントが自動的に作成されます。必要に応じて、仮想マシンの作成中や作成後に、追加のエンドポイントを構成できます。

各エンドポイントには、パブリック ポートとプライベート ポートがあります。

- パブリック ポートは、インターネットから仮想マシンに発信される着信トラフィックをリッスンするときに、Azure ロード バランサーによって使用されます。 
- プライベート ポートは、一般的に仮想マシンで実行されているアプリケーションまたはサービスを宛先とする着信トラフィックをリッスンする仮想マシンによって使用されます。

周知のネットワーク プロトコルの IP プロトコルと TCP ポートまたは UDP ポートの既定値は、管理ポータルでエンドポイントを作成するときに提示されます。カスタム エンドポイントの場合、正しい IP プロトコル (TCP または UDP) と、パブリック ポートとプライベート ポートを指定する必要があります。着信トラフィックを複数の仮想マシンにランダムに配分するには、複数のエンドポイントで構成される負荷分散セットを作成する必要があります。

エンドポイントを作成した後、アクセス制御リスト (ACL) を使用して、発信元 IP アドレスに基づいて、エンドポイントのパブリック ポートを宛先とする着信トラフィックの許可または拒否に役立つルールを定義できます。ただし、仮想マシンが Azure 仮想ネットワーク内にある場合、ネットワーク セキュリティ グループを代わりに使用する必要があります。詳細については、「[ネットワーク セキュリティ グループについて](https://msdn.microsoft.com/library/azure/dn848316.aspx)」を参照してください。

**重要**: Azure 仮想マシンのファイアウォールの構成は、リモート デスクトップと Secure Shell (SSH) に関連付けられているポートに対して自動的に行われます。Windows PowerShell リモート処理についても、ほとんどの場合は自動的に行われます。他のすべてのエンドポイントに対して指定されているポートについては、仮想マシンのファイアウォールは自動的には構成されません。仮想マシンにエンドポイントを作成するとき、仮想マシンのファイアウォールで、エンドポイントの構成に対応するプロトコルとプライベート ポートでトラフィックが許可されていることを確認する必要があります。

##エンドポイントの作成

1.	まだサインインしていない場合は、[Azure の管理ポータル](http://manage.windowsazure.com/)にサインインします。
2.	**[Virtual Machines]** をクリックし、構成する仮想マシンの名前をクリックします。
3.	**[エンドポイント]** をクリックします。[エンドポイント] ページに仮想マシンの現在のすべてのエンドポイントが示されます。

	![エンドポイント](./media/virtual-machines-set-up-endpoints/endpointswindows.png)
 
4.	タスク バーで **[追加]** をクリックします。
5.	**[仮想マシンにエンドポイントを追加します]** ページで、エンドポイントの種類を選択します。 

	- 負荷分散セットの一部ではないエンドポイントや、新しい負荷分散セットの最初のメンバーである新しいエンドポイントを作成するとき、**[スタンドアロン エンドポイントの追加]** を選択し、左矢印をクリックします。
	- それ以外の場合は、**[既存の負荷分散セットにエンドポイントを追加する]** をクリックし、負荷分散セットの名前を選択して左矢印をクリックします。**[エンドポイントの詳細を指定します]** ページで、**[名前]** にエンドポイントの名前を入力し、チェック マークをクリックして、エンドポイントを作成します。

6.	**[エンドポイントの詳細を指定します]** ページで、**[名前]** にエンドポイントの名前を入力します。ネットワーク プロトコルの名前をリストから選択することもできます。これは、初期値として、**[プロトコル]**、**[パブリック ポート]**、**[プライベート ポート]** に入力されます。
7.	カスタマイズしたエンドポイントの場合、**[プロトコル]** で、**[TCP]** または **[UDP]** を選択します。
8.	カスタマイズしたポートの場合、**[パブリック ポート]** に、インターネットから発信される着信トラフィックを着信するポートの番号を入力します。**[プライベート ポート]** に、仮想マシンがリッスンするポート番号を入力します。このポート番号は別の番号でもかまいません。プロトコル (手順 7.) とプライベート ポートに対応するトラフィックを許可するように、仮想マシン上のファイアウォールが構成されていることを確認します。
9.	このエンドポイントが負荷分散セットの最初のエンドポイントになる場合、**[負荷分散セットの作成]** をクリックし、右矢印をクリックします。**[負荷分散セットの構成]** ページで、負荷分散セットの名前、プローブ プロトコル、ポート、プローブ間隔と送信されるプローブの数を指定します。Azure ロード バランサーは負荷分散セット内の仮想マシンにプローブを送信して、可用性を監視します。Azure ロード バランサーは、プローブに応答しない仮想マシンには、トラフィックを転送しません。右矢印をクリックします。
10.	チェック マークをクリックしてエンドポイントを作成します。

これで、[エンドポイント] ページにエンドポイントが表示されます。

![エンドポイントの作成に成功](./media/virtual-machines-set-up-endpoints/endpointwindowsnew.png)
 
Azure PowerShell コマンドレットを使用してこれを設定するには、[Add-AzureEndpoint](https://msdn.microsoft.com/library/azure/dn495300.aspx) を参照してください。

##エンドポイントの ACL の管理

トラフィックを送信できるコンピューターを定義するために、エンドポイント上の ACL によって、発信元 IP アドレスに基づいてトラフィックを制限できます。エンドポイントの ACL を追加、変更、削除するには、次のステップに従います。

> [AZURE.NOTE]エンドポイントが負荷分散セットの一部である場合、エンドポイントの ACL に対して行った変更はそのセット内のすべてのエンドポイントに適用されます。

仮想マシンが Azure 仮想ネットワーク内にある場合、ネットワーク セキュリティ グループを代わりに使用する必要があります。詳細については、「[ネットワーク セキュリティ グループについて](https://msdn.microsoft.com/library/azure/dn848316.aspx)」を参照してください。


1.	まだサインインしていない場合は、Azure の管理ポータルにサインインします。
2.	**[Virtual Machines]** をクリックし、構成する仮想マシンの名前をクリックします。
3.	**[エンドポイント]** をクリックします。[エンドポイント] ページに仮想マシンのすべてのエンドポイントが示されます。

    ![ACL list](./media/virtual-machines-set-up-endpoints/EndpointsShowsDefaultEndpointsForVM.png)
 
4.	一覧から適切なエンドポイントを選択します。
5.	タスク バーで **[ACL の管理]** をクリックします。**[ACL の詳細の指定]** ダイアログ ボックスが表示されます。

    ![Specify ACL details](./media/virtual-machines-set-up-endpoints/EndpointACLdetails.png)
 
6.	一覧内の行を使用して、ACL のルールの追加、削除、編集を行い、順序を変更します。**[リモート サブネット]** 値は、インターネットからのトラフィックを着信する IP アドレスの範囲です。これを、Azure ロード バランサーがトラフィックの発信元 IP アドレスに基づいて許可または拒否します。CIDR 形式 (アドレス プレフィックス形式とも呼ばれる) で IP アドレスの範囲を指定します。たとえば、「131.107.0.0/16」と入力します。

ルールを使用して、インターネット上のご使用のコンピューターに該当する特定のコンピューターから発信されるトラフィックのみを許可することや、特定の範囲の既知のアドレスから発信されるトラフィックを拒否できます。

ルールの評価は、一覧の最初に示されているルールから開始され、最後に示されているルールで終了します。つまり、一覧には、制限の最も少ないルールから制限の最も多いルールの順に整列されている必要があります。例と詳細については、「[ネットワーク アクセス制御リスト (ACL) について](http://go.microsoft.com/fwlink/p/?linkid=303816)」を参照してください。

Azure PowerShell コマンドレットを使用してこれを設定するには、「[PowerShell を使用したエンドポイントのアクセス制御リスト (ACL) の管理](https://msdn.microsoft.com/library/azure/dn376543.aspx)」を参照してください。

## その他のリソース

[Azure インフラストラクチャ サービスの負荷分散](virtual-machines-load-balance.md)

[ネットワーク アクセス制御リストについて](http://go.microsoft.com/fwlink/p/?linkid=303816)

[ネットワーク セキュリティ グループについて](https://msdn.microsoft.com/library/azure/dn848316.aspx)

<!---HONumber=58--> 