---
title: Azure Load Balancer の概要 | Microsoft Docs
description: Azure Load Balancer の機能の概要、アーキテクチャ、実装。 ロード バランサーの動作とクラウドでの活用について説明します。
services: load-balancer
documentationcenter: na
author: KumudD
manager: jeconnoc
editor: ''
ms.assetid: ''
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/21/2018
ms.author: kumud
ms.openlocfilehash: 3a5d1e897d8ffe063ecf9277bef346c8b7c5092b
ms.sourcegitcommit: d74657d1926467210454f58970c45b2fd3ca088d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2018
---
# <a name="azure-load-balancer-overview"></a>Azure Load Balancer の概要

Azure Load Balancer を使うと、アプリケーションを拡張し、サービスを高可用性にすることができます。 ロード バランサーは、受信と送信のどちらのシナリオもサポートし、低遅延と高スループットを実現できるだけでなく、あらゆる TCP アプリケーションと UDP アプリケーションの数百万ものフローにスケールアップできます。   

ロード バランサーは、ロード バランサーのフロントエンドで到着した新しい受信フローを、ルールと正常性プローブに従って、バックエンド プールのインスタンスに分配します。  

さらに、パブリック ロード バランサーは、プライベート IP アドレスをパブリック IP アドレスに変換することによって、仮想ネットワーク内の仮想マシンの送信接続も提供できます。

Azure Load Balancer は、Basic と Standard の 2 種類の SKU で使用できます。  両者の間には、スケール、機能、および料金の違いがあります。  Basic Load Balancer で可能なシナリオをすべて、Standard Load Balancer でも作成できますが、アプローチは若干異なる場合があります。  Load Balancer について学習するときは、基礎および SKU 固有の違いを理解することが重要です。

## <a name="why-use-load-balancer"></a>ロード バランサーを使用する理由 

Azure Load Balancer は次の目的に使うことができます。

* 仮想マシンへの着信インターネット トラフィックを負荷分散します。 この構成は、[パブリック ロード バランサー](#publicloadbalancer)と呼ばれます。
* 仮想ネットワーク内部の仮想マシン間のトラフィックを負荷分散します。 ハイブリッド シナリオでは、オンプレミスのネットワークからロード バランサー フロントエンドに到達することもできます。 どちらのシナリオでも、[内部ロード バランサー](#internalloadbalancer)と呼ばれる構成が使われます。
* 受信 NAT ルールを使って特定の仮想マシンの特定のポートにトラフィックをポート転送します。
* パブリック ロード バランサーを使って、仮想ネットワーク内の仮想マシンに[送信接続](load-balancer-outbound-connections.md)を提供します。


>[!NOTE]
> Azure では、ユーザーのシナリオのために完全に管理された負荷分散ソリューションのスイートが提供されます。  TLS 終端 ("SSL オフロード") または HTTP/HTTPS 要求によるアプリケーション レイヤーの処理が必要な場合は、「[Application Gateway](../application-gateway/application-gateway-introduction.md)」をご覧ください。  グローバル DNS の負荷分散が必要な場合は、「[Traffic Manager](../traffic-manager/traffic-manager-overview.md)」をご覧ください。  実際のエンド ツー エンドのシナリオでは、必要に応じてこれらのソリューションを組み合わせると役に立つことがあります。

## <a name="what-is-load-balancer"></a>Load Balancer とは

ロード バランサー リソースは、パブリック ロード バランサーまたは内部ロード バランサーとして存在できます。 ロード バランサー リソースの機能は、フロントエンド、ルール、正常性プローブ、およびバックエンド プール定義として表されます。  仮想マシンは、仮想マシンからバックエンド プールを指定することによってバックエンド プールに配置されます。

ロード バランサー リソースはオブジェクトであり、その中では、ユーザーが作成したいシナリオを実現するために Azure がそのマルチ テナント インフラストラクチャをプログラミングする方法を表すことができます。  ロード バランサー リソースと実際のインフラストラクチャの間に直接的な関係はありません。ロード バランサーを作成してもインスタンスは作成されず、容量は常に使用可能です。 

## <a name="fundamental-load-balancer-features"></a>ロード バランサーの基本機能

ロード バランサーは、TCP および UDP アプリケーションに対して次の基本機能を提供します。

* **負荷分散**

    Azure Load Balancer では、負荷分散規則を作成して、フロントエンドに到着したトラフィックをバックエンド プールのインスタンスに分散させることができます。  受信フローの分配にはハッシュ アルゴリズムが使われ、バックエンド プール インスタンスへのフローのヘッダーが適宜書き換えられます。 バックエンド エンドポイントが正常であることを正常性プローブが示している場合、サーバーは新しいフローを受信できます。
    
    既定では、ソース IP アドレス、ソース ポート、接続先 IP アドレス、接続先ポート、IP プロトコル番号から成る 5 タプル ハッシュを使って、使用可能なサーバーにフローをマップします。  特定の規則に 2 または 3 タプルのハッシュをオプトインすることにより、特定のソース IP アドレスにアフィニティを作成できます。  同じパケット フローのすべてのパケットは、負荷分散されたフロントエンドの背後にある同じインスタンスに到着します。  クライアントが同じソース IP アドレスから新しいフローを開始すると、ソース ポートが変化します。 結果として得られる 5 タプルにより、トラフィックは異なるバックエンド エンドポイントに送られることがあります。

    詳しくは、[ロード バランサーの分散モード](load-balancer-distribution-mode.md)に関するページをご覧ください。 次の図は、ハッシュベースの分散を示しています。

    ![ハッシュベースの分散](./media/load-balancer-overview/load-balancer-distribution.png)

    *図 - ハッシュベースの分散*

* **ポート フォワーディング**

    Azure Load Balancer では、受信 NAT 規則を作成して、特定のフロントエンド IP アドレスの特定のポートから、仮想ネットワーク内の特定のバックエンド インスタンスの特定のポートに、トラフィックをポート転送することができます。 これも、負荷分散と同じハッシュ ベースの分散によって実現されます。  この機能の一般的なシナリオは、仮想ネットワーク内の個別の仮想マシン インスタンスへのリモート デスクトップ プロトコル (RDP) または Secure Shell (SSH) セッションです。  複数の内部エンドポイントを、同じフロントエンド IP アドレスの異なるポートにマップできます。 これらを使って、追加のジャンプ ボックスがなくても、インターネット経由で仮想マシンをリモート管理できます。

* **アプリケーションに対する独立性と透過性**

    ロード バランサーは、TCP、UDP、またはアプリケーション レイヤーとは直接対話せず、任意の TCP または UDP ベースのアプリケーション シナリオをサポートできます。  たとえば、ロード バランサーは TLS 自体を終了しませんが、ロード バランサーを使って TLS アプリケーションを作成してスケールアウトし、仮想マシン自体で TLS 接続を終了できます。 ロード バランサーはフローを終了せず、プロトコルのハンドシェイクは常にクライアントとハッシュで選択されたバックエンド プールのインスタンスの間で直接やり取りされます。 たとえば、TCP ハンドシェイクは常に、クライアントと選択されたバックエンド仮想マシンの間で行われます。  また、フロントエンドへの要求に対する応答は、バックエンド仮想マシンから生成される応答です。  ロード バランサーの送信ネットワークのパフォーマンスは、ユーザーが選んだ仮想マシンの SKU によってのみ制限され、アイドル タイムアウトに達しない場合、フローは長期間動作状態のままになります。

* **自動再構成**

    Azure Load Balancer は、インスタンスがスケール アップまたはスケール ダウンされると、すぐに自身を再構成します。 バックエンド プールの仮想マシンを追加または削除すると、ロード バランサー リソースの追加操作なしに、ロード バランサーが再構成されます。

* **正常性プローブ**

    Azure Load Balancer は、ユーザーが定義した正常性プローブを使って、バックエンド プール内のインスタンスの正常性を判断します。 プローブで応答できない場合、ロード バランサーは異常なインスタンスへの新しい接続の送信を停止します。 既存の接続は影響を受けず、アプリケーションがフローを終了するか、アイドル タイムアウトが発生するか、または仮想マシンがシャット ダウンするまで続けられます。

    次の 3 種類のプローブがサポートされています。

    - **HTTP カスタム プローブ:** ユーザーはこれを使って独自のカスタム ロジックを作成し、バックエンド プール インスタンスの正常性を判断できます。 ロード バランサーは、エンドポイントを定期的に調査します (既定では 15 秒ごと)。 タイムアウト期間内 (既定値は 31 秒) にインスタンスが HTTP 200 で応答した場合は、正常な状態であると見なされます。 HTTP 200 以外のすべての状態では、このプローブは失敗します。  これは、ロード バランサーのローテーションからインスタンスを削除する、ユーザー独自のロジックを実装する場合にも役立ちます。 たとえば、インスタンスが CPU の 90% を超えた場合に 200 以外の状態を返すように、インスタンスを構成できます。   このプローブは、既定のゲスト エージェント プローブを上書きします。

    - **TCP カスタム プローブ:** このプローブは、定義済みプローブ ポートへの正常な TCP セッションの確立に依存します。  仮想マシン上に指定されたリスナーが存在する限り、このプローブは成功します。 接続が拒否されると、プローブは失敗します。 このプローブは、既定のゲスト エージェント プローブを上書きします。

    - **ゲスト エージェント プローブ (サービスとしてのプラットフォーム仮想マシンの場合のみ):** ロード バランサーは、仮想マシン内のゲスト エージェントを使うこともできます。 ゲスト エージェントはリッスンし、インスタンスが準備完了状態になっている場合にのみ、HTTP 200 OK で応答します。 エージェントが HTTP 200 OK で応答できない場合、ロード バランサーは、そのインスタンスを応答不能と見なし、インスタンスへのトラフィックの送信を停止します。 ロード バランサーはインスタンスへの到達を試み続けます。 ゲスト エージェントが、HTTP 200 で応答する場合は、ロード バランサーはそのインスタンスへのトラフィックの送信を再開します。  ゲスト エージェント プローブは最後の手段であり、HTTP または TCP のカスタム プローブを構成できるときは、使わないようにする必要があります。 
    
* **送信接続 (Source NAT)**

    仮想ネットワーク内のプライベート IP アドレスから、インターネット上のパブリック IP アドレスへのすべての送信フローは、ロード バランサーのフロントエンド IP アドレスに変換することができます。 パブリック フロントエンドが負荷分散規則によってバックエンドの仮想マシンに関連付けられていると、Azure は送信接続がパブリック フロントエンドの IP アドレスに自動的に変換されるようにプログラムします。 これは Source NAT (SNAT) とも呼ばれます。 SNAT には重要な利点があります。

    + フロントエンドを別のサービス インスタンスに動的にマップできるため、サービスのアップグレードやディザスター リカバリーが簡単にできます。
    + アクセス制御リスト (ACL) の管理が容易になります。 フロントエンド IP で表わされる ACL は、サービスをスケールアップ、スケールダウン、または再デプロイしても変更されません。

    この機能について詳しくは、[送信接続](load-balancer-outbound-connections.md)に関する記事をご覧ください。

Standard Load Balancer には、これらの基礎には含まれない追加の SKU 固有機能があります。  詳しくは、この記事の残りの部分をご覧ください。

## <a name="skus"></a> Load Balancer の SKU の比較

Azure Load Balancer では、Basic と Standard の 2 種類の SKU がサポートされています。  両者の間には、シナリオのスケール、機能、および料金の違いがあります。  Basic Load Balancer で可能なシナリオをすべて、Standard Load Balancer でも作成できます。  実際、両方の SKU の API は似ており、SKU を指定することによって呼び出されます。  Load Balancer の SKU とパブリック IP をサポートするための API は、2017-08-01 API から使用できるようになりました。  一般的な API と構造は、どちらの SKU でも同じです。

ただし、どちらの SKU を選ぶかにより、完全なシナリオ構成の詳細は若干異なる可能性があります。 Load Balancer のドキュメントでは、記事が特定の SKU だけに適用される場合は、そのことが示されています。 次の表を参照し、違いを比較して理解してください。  詳しくは、「[Azure Standard Load Balancer の概要](load-balancer-standard-overview.md)」をご覧ください。

>[!NOTE]
> 新しい設計では、Standard Load Balancer の使用を検討する必要があります。 

スタンドアロン仮想マシン、可用性セット、および仮想マシン スケール セットは、どちらか一方の SKU にのみ接続でき、両方には接続できません。 パブリック IP アドレスで使うときは、Load Balancer とパブリック IP アドレスの SKU が一致していなければなりません。 Load Balancer とパブリック IP の SKU は変更できません。

"_まだ必須ではありませんが、SKU を明示的に指定するのが最善の方法です。_"  現時点では、必要な変更は最小限に抑えられています。 SKU を指定しないと、2017-08-01 API バージョンの Basic SKU を使用する意図があるものと解釈されます。

>[!IMPORTANT]
>Standard Load Balancer は新しい Load Balancer 製品であり、基本的に Basic Load Balancer のスーパーセットです。  両方の製品の間には重要で意図的な違いがあります。  Basic Load Balancer で可能なエンド ツー エンドのシナリオはすべて、Standard Load Balancer でも作成できます。  Basic Load Balancer を既に使ったことがある場合は、Standard Load Balancer に使い慣れて、Standard と Basic の動作の間にある重要な違いと、その影響を理解する必要があります。 このセクションの内容を慎重に検討してください。

| | [Standard SKU](load-balancer-standard-overview.md) | Basic SKU |
| --- | --- | --- |
| バックエンド プールのサイズ | 最大 1000 インスタンス | 最大 100 インスタンス |
| バックエンド プール エンドポイント | 仮想マシン、可用性セット、仮想マシン スケール セットの組み合わせを含む、単一の仮想ネットワーク内の任意の仮想マシン | 単一の可用性セットまたは仮想マシン スケール セット内の仮想マシン |
| 可用性ゾーン | 受信と送信に対するゾーン冗長とゾーン フロントエンド、送信フロー マッピングによりゾーン障害に耐久、ゾーン間の負荷分散 | / |
| 診断 | Azure Monitor、バイト カウンターとパケット カウンターを含む多次元メトリック、正常性プローブの状態、接続試行 (TCP SYN)、送信接続の正常性 (SNAT 成功および失敗のフロー)、アクティブなデータ プレーン測定 | パブリック ロード バランサーに対する Azure Log Analytics のみ、SNAT 枯渇アラート、バックエンド プール正常性カウント |
| HA ポート | 内部ロード バランサー | / |
| 既定でのセキュリティ保護 | パブリック IP とロード バランサー エンドポイントに対して既定でクローズ、トラフィックが流れるためにはネットワーク セキュリティ グループを使ってホワイト リストへの明示的な登録が必要 | 既定でオープン、ネットワーク セキュリティ グループは任意 |
| 送信接続 | ルールによるオプトアウトを使用する複数のフロントエンド。仮想マシンが送信接続を使用できるためには、送信シナリオを明示的に作成する "_必要があります_"。  [VNet サービス エンドポイント](../virtual-network/virtual-network-service-endpoints-overview.md)には送信接続なしで到達でき、処理されたデータにはカウントされません。  VNet サービス エンドポイントとして使用できない Azure PaaS サービスなどのすべてのパブリック IP アドレスは、送信接続を介して到達する必要があり、処理されたデータにカウントされます。 内部ロード バランサーだけが仮想マシンに対応しているときは、既定の SNAT による送信接続は利用できません。 送信 SNAT プログラミングは、受信負荷分散ルールのプロトコルに基づくトランスポート プロトコル固有です。 | 単一のフロントエンド。複数のフロントエンドが存在する場合は、ランダムに選ばれます。  内部ロード バランサーだけが仮想マシンに対応している場合は、既定の SNAT が使われます。 |
| 複数のフロントエンド | 受信および送信 | 受信のみ |
| 管理操作 | ほとんどの操作は 30 秒未満 | 一般に 60 ～ 90 秒以上 |
| SLA | 2 つの正常な仮想マシンが存在するデータ パスで 99.99% | VM SLA で暗黙 | 
| 価格 | ルールの数、リソースに関連付けられた受信または送信で処理されたデータに基づいて課金  | 課金なし |

[Load Balancer のサービスの制限](https://aka.ms/lblimits)に関する記事をご覧ください。  Standard Load Balancer については、[概要](load-balancer-standard-overview.md)、[価格](https://aka.ms/lbpricing)、[SLA](https://aka.ms/lbsla) に関するページもご覧ください。

## <a name="concepts"></a>概念

### <a name = "publicloadbalancer"></a>パブリック ロード バランサー

パブリック ロード バランサーは、着信トラフィックのパブリック IP アドレスとポート番号を仮想マシンのプライベート IP アドレスとポート番号にマップし、仮想マシンからの応答トラフィックはその逆にマップします。 負荷分散規則を使用すると、複数の仮想マシンまたはサービスに特定の種類のトラフィックを分散させることができます。 たとえば、複数の Web サーバー間で Web 要求のトラフィックの負荷を分散できます。

次の図は、Web トラフィック用の負荷分散されたエンドポイントを示しています。このエンドポイントは、パブリックとプライベートの TCP ポートが 80 である 3 台の仮想マシン間で共有されています。 この 3 台の仮想マシンは、1 つの負荷分散セット内にあります。

![パブリックのロード バランサーの例](./media/load-balancer-overview/IC727496.png)

**図 1: パブリック ロード バランサーを使った Web トラフィックの負荷分散**

複数のインターネット クライアントが TCP ポート 80 で Web アプリのパブリック IP アドレスに Web ページ要求を送信すると、Azure Load Balancer は負荷分散セット内の 3 台の仮想マシンにこれらの要求を分散します。 ロード バランサーのアルゴリズムの詳細については、[ロード バランサーの概要に関するページ](load-balancer-overview.md#load-balancer-features)をご覧ください。

既定では、Azure Load Balancer は、ネットワーク トラフィックを複数の仮想マシン インスタンスに均等に分散させます。 セッション アフィニティを構成することもできます。 詳しくは、[ロード バランサーの分散モード](load-balancer-distribution-mode.md)に関するページをご覧ください。

### <a name = "internalloadbalancer"></a> 内部ロード バランサー

内部ロード バランサーは、仮想ネットワーク内のリソースまたは VPN を使って Azure インフラストラクチャにアクセスするリソースにのみトラフィックを送信します。 この点で、内部ロード バランサーはパブリック ロード バランサーと異なります。 Azure インフラストラクチャでは、仮想ネットワークの負荷分散フロントエンド IP アドレスへのアクセスが制限されます。 フロントエンド IP アドレスと仮想ネットワークは、インターネット エンドポイントに直接公開されることはありません。 社内の基幹業務アプリケーションは Azure で実行され、Azure 内またはオンプレミス リソースからアクセスされます。

内部ロード バランサーにより、次の種類の負荷分散が可能になります。

* 仮想ネットワーク内: 仮想ネットワーク内の VM から、同じ仮想ネットワーク内に存在する一連の VM に負荷を分散する。
* クロスプレミス仮想ネットワークの場合: オンプレミスのコンピューターから、同じ仮想ネットワーク内に存在する一連の VM に負荷を分散する。 
* 多層アプリケーションの場合: バックエンド層がインターネットに接続しない、インターネットに接続する多層アプリケーションの負荷を分散する。 バックエンド層では、インターネットに接続する層からのトラフィックを負荷分散する必要があります (図 2 を参照)。
* 基幹業務アプリケーションの場合: ロード バランサーのハードウェアやソフトウェアを追加せずに、Azure でホストされている基幹業務アプリケーションの負荷を分散する。 このシナリオには、トラフィックが負荷分散されるコンピューターのセットに含まれるオンプレミスのサーバーが含まれます。

![内部ロード バランサーの例](./media/load-balancer-overview/IC744147.png)

**図 2 - パブリック ロード バランサーと内部ロード バランサーの両方を使った、多層アプリケーションの負荷分散**

## <a name="pricing"></a>価格
Standard Load Balancer は、構成された負荷分散ルールの数と、処理されたすべての受信および送信データの数に基づいて課金される製品です。 Standard Load Balancer の価格の情報については、[Load Balancer の価格](https://azure.microsoft.com/pricing/details/load-balancer/)に関するページをご覧ください。

Basic Load Balancer は無料で提供されます。

## <a name="sla"></a>SLA

Standard Load Balancer の SLA については、[Load Balancer の SLA](https://aka.ms/lbsla) に関するページをご覧ください。 

## <a name="next-steps"></a>次の手順

- [Standard Load Balancer の詳細](load-balancer-standard-overview.md)を確認する
- [Standard Load Balancer と可用性ゾーン](load-balancer-standard-availability-zones.md)の使用について学習する
- [送信接続に対する Load Balancer](load-balancer-outbound-connections.md) の使用について学習する
- [Load Balancer の HA ポート](load-balancer-ha-ports-overview.md)について学習する
- [複数のフロントエンドでの Load Balancer](load-balancer-multivip-overview.md) について学習する
- [VNET サービス エンドポイント](../virtual-network/virtual-network-service-endpoints-overview.md)について学習する
- [パブリック Basic Load Balancer](load-balancer-get-started-internet-portal.md) の作成方法について学習する

