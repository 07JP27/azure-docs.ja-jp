<properties 
	pageTitle="Logic Apps の機能を使用する |Microsoft Azure" 
	description="ロジック アプリの高度な機能の使用方法について説明します。" 
	authors="stepsic-microsoft-com" 
	manager="dwrede" 
	editor="" 
	services="app-service\logic" 
	documentationCenter=""/>

<tags
	ms.service="app-service-logic"
	ms.workload="integration"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="01/04/2016"
	ms.author="stepsic"/>
	
# Logic Apps の機能を使用する

[前のトピック][Create a new logic app]では、初めてのロジック アプリを作成しました。ここでは、App Services Logic Apps を使用してさらに詳細なプロセスを構築する方法を説明します。このトピックでは、新しい Logic Apps の概念について説明します。

- 条件付きロジック。特定の条件が満たされる場合にのみアクションを実行します。
- アクションの繰り返し。
- 既存のロジック アプリを編集するためのコード ビュー。
- ワークフローを開始するためのオプション。

このトピックを完了する前に、「[新しいロジック アプリを作成する]」の手順を完了する必要があります。[Azure ポータル]でロジック アプリを参照し、概要の **[トリガーとアクション]** をクリックしてロジック アプリの定義を編集します。

## 参考資料

次の資料が役立つ場合があります。

- [Management and runtime REST APIs (管理 REST API およびランタイム REST API)](https://msdn.microsoft.com/library/azure/dn948513.aspx) - Logic Apps を直接起動する方法が記載されています。
- [Language reference (言語リファレンス)](https://msdn.microsoft.com/library/azure/dn948512.aspx) - サポートされるすべての関数/式の包括的な一覧
- [Trigger and action types (トリガーおよびアクションのタイプ)](https://msdn.microsoft.com/library/azure/dn948511.aspx) - 各種アクションとそれらで使用される入力値
- [Overview of App Service (App Service の概要)](app-service-value-prop-what-is.md) - ソリューションを作成するときに選択するコンポーネントの説明

## 条件付きロジックと繰り返しの追加

元のフローが機能していても、改良できる領域もあります。まず、アクションが送信するのは、最も返信されたツイートのみです。理論上、キーワードを使用しているツイートをすべて受信する必要があります。返信されたツイートなどのアイテムの一覧に対してアクションを繰り返すには、`repeat` プロパティを使用する必要があります。

### 繰り返しの実行
繰り返しは、項目の一覧を受け取り、その一覧にある各項目に対してアクションを実行します。次の手順では、既存のアクションを更新して繰り返しを使用します。これは、ツイートの一覧をさらに意味のあるものにします。

1. 作成したワークフローに戻り、**[Essentials]** の **[定義]** リンクをクリックします。 

2. **Dropbox コネクタ** アクションを編集するには、鉛筆アイコンをクリックします。

3. 歯車アイコンをクリックし、**[リストに対して繰り返す]** を選択します。
 
2. **[繰り返し]** ボックスの横にある [`...`] をクリックし、**[本文]** を選択します。次のように入力されます。

    	@body('twitterconnector')

	入力先はテキスト ボックスです。この関数はツイートの一覧を出力します。

3. **[コンテンツ]** ボックスのテキストすべてを選択して削除します。次に、`...` をクリックして、**[ツイートのテキスト]** を選択します。これにより、一覧の各要素を返す **repeatItem()** 関数が挿入されます。

最後に、繰り返しのアクションの出力が特別である点に注意してください。たとえば、Dropbox 操作の結果を参照する場合、通常の `@actions('dropboxconnector').outputs.body` は実行できません。代わりに、`@actions('dropboxconnector').outputs.repeatItems` を実行します。これは、それぞれの出力と、操作を実行した時間をすべて一覧で返します。たとえば、`@first(actions('dropboxconnector').outputs.repeatItems).outputs.body.FilePath` はアップロードされた最初のファイルのパスを返します。

### 条件付き
このロジック アプリによって、Dropbox に大量のファイルもアップロードされます。次の手順では、ロジックを追加して、特定の回数リツイートされたツイートのみを受信するようにします。

1. アクションの上部にある歯車アイコンをクリックして **[満たされる条件を追加する]** を選択します。

2. テキスト ボックスに次のように入力します。

    	@greater(repeatItem().Retweet_Count , 5)
    
	関数 **greater** は、2 つの値を比較し、最初の値が 2 番目の値を超える場合にのみ、アクションの実行を許可します。上の例のように、ドット (.) の後に `.Retweet_Count` などのプロパティ名を追加して、特定のプロパティにアクセスします。

3. チェック マークをクリックして、Dropbox アクションを保存します。

## コード ビューを使用したロジック アプリの編集

デザイナー以外でも、次のようにロジック アプリを定義するコードを直接編集することができます。

1. コマンド バーの **[コード ビュー]** をクリックします。 

	全画面のエディターが開き、先ほど編集した定義が表示されます。

	![コード ビュー](./media/app-service-logic-use-logic-app-features/codeview.png)

    テキスト エディターを使用することで、同じロジック アプリ内やロジック アプリ間で任意の数のアクションをコピーして貼り付けることができます。定義からセクション全体を追加または削除することも簡単です。他のユーザーと定義を共有することもできます。

2. コード ビューで変更を加えた後に、**[保存]** をクリックします。

### パラメーター
Logic Apps の一部の機能はコード ビューのみで使用できます。その例がパラメーターです。パラメーターを使用すると、ロジック アプリ全体にわたって簡単に値を再利用できます。たとえば、いくつかの操作で使用する電子メール アドレスがある場合、電子メール アドレスをパラメーターとして定義します。

次に、クエリ用語でパラメーターを使用するように既存のロジック アプリを更新します。

1. コード ビューで `parameters : {}` オブジェクトを検索し、次の topic オブジェクトを挿入します。

	    "topic" : {
		    "type" : "string",
		    "defaultValue" : "MicrosoftAzure"
	    }
    
2. `twitterconnector` アクションまでスクロールし、クエリの値を探して `#@{parameters('topic')}` に置き換えます。**concat** 関数を使用して 2 つ以上の文字列を結合することもできます。たとえば `@concat('#',parameters('topic'))` は上記と同じです。
 
3. 最後に、`dropboxconnector` アクションに移動して、次のように topic パラメーターを追加します。

    	/tweets/@{parameters('topic')}/@{repeatItem().TweetID}.txt

パラメーターは、よく変更する可能性がある値を抜き出すための優れた手段です。さまざまな環境でパラメーターを上書きする必要がある場合に特に便利です。環境に基づいてパラメーターを上書きする方法の詳細については、[REST API のドキュメント](http://go.microsoft.com/fwlink/?LinkID=525617&clcid=0x409)を参照してください。

次に、**[保存]** をクリックすると、新しいツイートが 6 回以上リツイートされるたびに Dropbox の **tweets** というフォルダーに配信されます。

Logic App 定義の詳細については、[「Author Logic App definitions (Logic App 定義のオーサリング](app-service-logic-author-definitions.md)」を参照してください。

## ロジック アプリ ワークフローの開始
ロジック アプリで定義されているワークフローを開始するためのオプションは数種類あります。ワークフローはいつでも、[Azure ポータル]からオンデマンドで開始できます。

### 定期実行のトリガー
定期実行のトリガーは、指定した間隔で実行されます。トリガーに条件付きロジックが設定されている場合は、トリガーによって、ワークフローを実行する必要があるかどうかが判断されます。`200` の状態コードが返された場合は、トリガーを実行する必要があることを示しています。実行する必要がないときは、`202` の状態コードが返されます。

### REST API を使用したコールバック
サービスは、ロジック アプリのエンドポイントを呼び出して、ワークフローを開始することができます。ロジック アプリのコマンド バーの **[設定]** をクリックして **[プロパティ]** ブレードに移動し、アクセスするエンドポイントを見つけることができます。

このコールバックを使用すると、カスタム アプリケーション内から、ロジック アプリを起動することができます。**基本**認証を使用する必要があります。`default` のユーザー名が作成され、パスワードは **[プロパティ]** ブレードの**プライマリ アクセス キー** フィールドの値になります。次に例を示します。

        POST https://<< your endpoint >>/run?api-version=2015-02-01-preview
        Content-type: application/json
        Authorization: Basic << base-64 encoded string of default:<access key> >>
        {
            "name" : "nameOfTrigger",
            "outputs" : { "property" : "value" }
        }

出力をワークフローに渡し、ワークフロー内で参照できます。たとえば、前のトリガーでは、`@triggers().outputs.property` を使用すると、`value` が返されます。

詳細については、[REST に関するドキュメント](http://go.microsoft.com/fwlink/?LinkID=525617&clcid=0x409)を参照してください。

### 手動実行
トリガーのないロジック アプリを定義することができます。この場合、ワークフローをオンデマンドで開始する必要があります。この種類のロジック アプリは、断続的に実行する必要のあるプロセスに最適です。トリガーのないロジック アプリを作成するには、デザイナーの **[ロジックを開始]** ボックスで **[このロジックを手動で実行]** をオンにします。

ロジック アプリをオンデマンドで開始するには、コマンド バーの **[今すぐ実行]** をクリックします。

<!-- Shared links -->
[Create a new logic app]: app-service-logic-create-a-logic-app.md
[新しいロジック アプリを作成する]: app-service-logic-create-a-logic-app.md
[Azure ポータル]: https://portal.azure.com

<!---HONumber=AcomDC_0107_2016-->