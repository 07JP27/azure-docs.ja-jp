<properties 
   pageTitle="StorSimple Virtual Array のベスト プラクティス | Microsoft Azure"
   description="StorSimple Virtual Array のデプロイと管理のベスト プラクティスについて説明します。"
   services="storsimple"
   documentationCenter="NA"
   authors="alkohli"
   manager="carmonm"
   editor="" />
<tags 
   ms.service="storsimple"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="07/08/2016"
   ms.author="alkohli" />

# StorSimple Virtual Array のベスト プラクティス

## 概要

Microsoft Azure StorSimple Virtual Array は、ハイパーバイザーで実行されるオンプレミスの仮想デバイスと Microsoft Azure のクラウド ストレージとの間でストレージ タスクを管理する統合ストレージ ソリューションです。8000 シリーズの物理アレイに代わる効率的かつ経済的な選択肢となります。この仮想アレイは、既にあるハイパーバイザー インフラストラクチャ上で動作し、iSCSI と SMB の両方のプロトコルに対応します。特に、リモート オフィス/支社のシナリオに適しています。StorSimple ソリューションの詳細については、[Microsoft Azure StorSimple の概要](https://www.microsoft.com/ja-JP/server-cloud/products/storsimple/overview.aspx)のページを参照してください。

この記事では、StorSimple Virtual Array の初回セットアップ時やデプロイ時、管理時におけるベスト プラクティスについて取り上げます。仮想アレイのセットアップと管理を対象とした検証済みのガイドラインとなっています。この記事の対象読者は、データセンターの仮想アレイのデプロイと管理を担当する IT 管理者です。

セットアップや操作の流れに変更が生じてもデバイスの準拠状態を確実に保つために、ベスト プラクティスは定期的に再読することをお勧めします。万一仮想アレイにベスト プラクティスを適用する過程で問題が生じた場合は、[Microsoft サポートにお問い合わせ](storsimple-contact-microsoft-support.md)ください。

## 構成のベスト プラクティス 

ベスト プラクティスでは、仮想アレイの初回セットアップとデプロイ時に守るべきガイドラインについて取り上げています。たとえば仮想マシンのプロビジョニングやグループ ポリシーの設定、サイズ変更、ネットワークの設定、ストレージ アカウントの構成、仮想アレイに使用するボリュームや共有の作成に関連したベスト プラクティスについて説明しています。

### プロビジョニング 

StorSimple Virtual Array は、ホスト サーバーのハイパーバイザー (Hyper-V または VMware) にプロビジョニングされる仮想マシン (VM) です。仮想マシンをプロビジョニングするときは、最低限必要なリソースをホストに確保してください。詳細については、アレイをプロビジョニングするための[最低リソース要件](storsimple-ova-deploy2-provision-hyperv.md#step-1-ensure-that-the-host-system-meets-minimum-virtual-device-requirements)に関するページを参照してください。

仮想アレイをプロビジョニングする際は、次のベスト プラクティスに従ってください。


| | Hyper-V | VMware |
|------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------|
| **仮想マシンのタイプ** | **第 2 世代**の VM (Windows Server 2012 以降の場合) と *.vhdx* イメージ。<br></br> **第 1 世代**の VM (Windows Server 2008 以降の場合) と *.vhd* イメージ。 | *.vmdk* イメージを使用するときは、仮想マシン バージョン 8 ～ 11 を使用します。 |
| **メモリの種類** | **静的メモリ**として構成します。<br></br> **動的メモリ**は選択しないでください。 | |
| **データ ディスクの種類** | **容量可変**としてプロビジョニングします。<br></br> **容量固定**は、時間がかかります。<br></br> **差分**オプションは選択しないでください。 | **シン プロビジョニング** オプションを使用します。 |
| **データ ディスクの変更** | 拡張と縮小は許可されません。そのような操作を試みると、デバイス上のローカル データがすべて失われます。 | 拡張と縮小は許可されません。そのような操作を試みると、デバイス上のローカル データがすべて失われます。 |

### サイズ変更

StorSimple Virtual Array のサイズを変更するときは、次の点を考慮する必要があります。

- ローカルにおけるボリュームまたは共有の予約。ローカル階層には、プロビジョニングされた階層化ボリューム (または階層化共有) ごとに約 12% の領域が予約されます。またファイル システムのローカル固定ボリュームについても、約 10% の領域が予約されます。
- スナップショットのオーバーヘッド。スナップショットには、ローカル階層に約 15% の領域が予約されます。
- 復元の必要性。サイズ変更では、復元に必要な領域を考慮する必要があります (新しい操作として復元を行う場合)。復元の対象となる共有またはボリュームは、同じサイズかそれよりも大きいことに注意してください。
- 想定外の拡大に備えて、ある程度のバッファーを割り当てる必要があります。

以上の点を踏まえると、サイズ変更の要件は次の数式で表すことができます。

`Total usable local disk size = (Total provisioned locally pinned volume/share size including space for file system) + (Max (local reservation for a volume/share) for all tiered volumes/share) + (Local reservation for all tiered volumes/shares)`

`Data disk size = Total usable local disk size + Snapshot overhead + buffer for unexpected growth or new share or volume`


以降の例では、仮想アレイのサイズを要件に応じて変更する方法について説明します。

#### 例 1:
仮想アレイで次の要件に対応する必要があるとします。

- 2 TB の階層化ボリュームまたは階層化共有をプロビジョニング
- 1 TB の階層化ボリュームまたは階層化共有をプロビジョニング
- 300 GB のローカル固定ボリュームまたはローカル固定共有をプロビジョニング


このボリュームまたは共有について、ローカル階層に必要な領域を計算してみましょう。

まず、階層化ボリューム/共有ごとに、そのサイズの 12% 以上をローカルに予約します。ローカル固定ボリューム/共有ごとに、そのサイズの 10% をローカルに予約します。この例で必要な予約サイズは次のようになります。

- 240 GB のローカル予約 (2 TB の階層化ボリューム/共有)
- 120 GB のローカル予約 (1 TB の階層化ボリューム/共有)
- 330 GB (ローカル固定ボリュームまたはローカル固定共有)

ここまででローカル階層に必要な合計領域は 690 GB (= 240 GB + 120 GB + 330 GB) となります。

次にローカル階層には、単一の予約と同じかそれ以上の領域が必要です。万一クラウドにあるスナップショットからの復元が必要となった場合に、この予備領域が使用されます。この例で、ローカルの最大予約サイズは 330 GB (ファイル システムの予約サイズを含む) です。したがってそれを 660 GB に加算することになります (660 GB + 330 GB = 990 GB)。それ以降、仮に別の復元操作を実行することになった場合でも、先行する復元操作で使用した領域はいつでも解放することができます。

次に、これまで計算した合計ローカル領域の 15% が、ローカル スナップショットを格納するための領域として必要です。つまり利用できる領域は 85% のみとなります。この例では、それに対応する領域が約 990 GB (= 0.85 × プロビジョニングするデータ ディスクの TB サイズ)。*したがって、プロビジョニングするデータ ディスクは、(990*(1/0.85))= 1164 GB = 1.16 TB = 約 1.25 TB (最も近い四分位数で丸める) となります。

想定外の拡大や新たな復元操作を考慮すると、約 1.25 ～ 1.5 TB のローカル ディスクをプロビジョニングする必要があります。

> [AZURE.NOTE] またローカル ディスクは、シン プロビジョニングすることをお勧めします。復元領域が必要になるのは、5 日より前のデータを復元するときだけであるためです。項目レベルの回復では、過去 5 日以内のデータなら余分な領域を使わずに復元することができます。

#### 例 2: 
仮想アレイで次の要件に対応する必要があるとします。

- 2 TB の階層化ボリュームをプロビジョニング
- 300 GB のローカル固定ボリュームをプロビジョニング

ローカルに予約する領域は、階層化ボリューム/共有の 12% とローカル固定ボリューム/共有の 10% であるため、次の領域が必要となります。

- 240 GB のローカル予約 (2 TB の階層化ボリューム/共有)
- 330 GB (ローカル固定ボリュームまたはローカル固定共有)

ローカル階層に必要な合計領域は 570 GB (= 240 GB + 330 GB) となります。

この場合、復元に必要な最小ローカル領域は 330 GB となります。

スナップショットの格納用に合計ディスクの 15% が使用されるので、利用できる領域は 0.85 のみとなります。したがってディスク サイズは、(900*(1/0.85)) = 1.06 TB = 約 1.25 TB (最も近い四分位数で丸める) となります。

想定外の拡大を考慮して、1.25 ～ 1.5 TB のローカル ディスクをプロビジョニングすることになります。


### グループ ポリシー

グループ ポリシーは、ユーザーとコンピューターに対して特定の構成を実装できるインフラストラクチャです。グループ ポリシーの設定は、グループ ポリシー オブジェクト (GPO) に格納されます。グループ ポリシー オブジェクトは、Active Directory ドメイン サービス (AD DS) のコンテナーであるサイトやドメイン、組織単位 (OU) に関連付けられています。

仮想アレイがドメインに参加している場合は、そのドメインに GPO を適用することができます。これらの GPO によってウイルス対策ソフトウェアなどのアプリケーションがインストールされ、StorSimple Virtual Array の動作に悪影響が生じる場合があります。

そこで、次のことをお勧めします。

-   Active Directory に対し、仮想アレイを専用の組織単位 (OU) に配置します。

-   グループ ポリシー オブジェクト (GPO) が仮想アレイに適用されないようにします。仮想アレイ (子ノード) が親から GPO を自動的に継承することのないよう、継承はブロックすることができます。詳細については、「[継承をブロックする](https://technet.microsoft.com/library/cc731076.aspx)」を参照してください。


### ネットワーク

仮想アレイのネットワーク構成は、ローカル Web UI で行います。仮想ネットワーク インターフェイスは、仮想アレイがプロビジョニングされているハイパーバイザーを通じて有効にします。[[ネットワークの設定]](storsimple-ova-deploy3-fs-setup.md) ページを使用して、仮想ネットワーク インターフェイスの IP アドレス、サブネット、ゲートウェイを構成します。プライマリ DNS サーバーとセカンダリ DNS サーバー、時刻設定、デバイスのプロキシ設定 (任意) を構成することもできます。ネットワーク構成のほとんどは 1 回限りの設定です。仮想アレイをデプロイする前に、[StorSimple のネットワーク要件](storsimple-ova-system-requirements.md#networking-requirements)をお読みください。

仮想アレイをデプロイするときは、次のベスト プラクティスに従うようお勧めします。

-   仮想アレイのデプロイ先となるネットワークに、5 Mbps (またはそれ以上) のインターネット帯域幅を常時使用できるだけの容量を確保します。

    -   必要なインターネット帯域幅は、ワークロードの特性やデータの変化率によって変わります。

    -   処理できるデータの変更は、ご使用のインターネット帯域幅に正比例します。たとえば 5 Mbps の帯域幅でバックアップを行う場合、8 時間につき約 18 GB のデータ変更に対応できます。その 4 倍の帯域幅 (20 Mbps) では、対応できるデータ変更も 4 倍となります (72 GB)。

-   常時インターネットに接続できる状態を確保します。デバイスとのインターネット接続が不安定だったり信頼性が低かったりすると、クラウドのデータへのアクセスが失われ、サポート不能な構成に陥るおそれがあります。

-   デバイスを iSCSI サーバーとしてデプロイする予定がある場合は、次の点を徹底してください。
	-   **[IP アドレスを自動で取得する]** オプション (DHCP) は無効にするようお勧めします。
	-   静的 IP アドレスを構成します。また、プライマリ DNS サーバーとセカンダリ DNS サーバーも構成する必要があります。

	-   仮想アレイに複数のネットワーク インターフェイスを定義する場合、クラウドに到達できるのは 1 つ目のネットワーク インターフェイス (既定では**イーサネット**) のみであることに注意してください。トラフィックの種類を制御するには、(iSCSI サーバーとして構成された) 仮想アレイに複数の仮想ネットワーク インターフェイスを作成し、それらを異なるサブネットに接続することができます。

-   (仮想アレイで使用される) クラウドの帯域幅のみを調整するには、ルーターまたはファイアウォールでスロットルを構成します。ハイパーバイザーでスロットルを定義した場合、クラウドの帯域幅だけでなく、iSCSI と SMB を含むすべてのプロトコルが帯域幅調整の対象となります。

-   ハイパーバイザーの時刻同期は必ず有効にしてください。Hyper-V を使用している場合は、Hyper-V マネージャーで目的の仮想アレイを選択し、**[設定]、[Integration Services]** の順に選択して、**[時刻の同期]** チェック ボックスがオンになっていることを確認します。

### ストレージ アカウント

StorSimple Virtual Array は、1 つのストレージ アカウントに関連付けることができます。このストレージ アカウントは、自動的に生成されたストレージ アカウントか、サービスと同じサブスクリプション内のアカウント、別のサブスクリプションに関連付けられたストレージ アカウントのいずれかとなります。詳細については、[仮想アレイのストレージ アカウントを管理する方法](storsimple-ova-manage-storage-accounts.md)に関するページを参照してください。

仮想アレイに関連付けるストレージ アカウントに関しては、次のことをお勧めします。

-   単一のストレージ アカウントに複数の仮想アレイを関連付けるときは、仮想アレイの最大容量 (64 TB) とストレージ アカウントの最大サイズ (500 TB) を考慮に入れてください。したがって、そのストレージ アカウントに関連付けることのできるフルサイズの仮想アレイの数は約 7 台が上限となります。

-   新しいストレージ アカウントを作成するときは、次の点を考慮してください。
	-   遅延を最小限に抑えるために、ストレージ アカウントは、StorSimple Virtual Array のデプロイ先となるリモート オフィス/支社に最も近いリージョンに作成することをお勧めします。

	-   異なるリージョン間でストレージ アカウントを移動することはできないことに注意してください。同様に、異なるサブスクリプション間でサービスを移動することもできません。

	-   データセンター間の冗長性が確保されたストレージ アカウントを使用してください。geo 冗長ストレージ (GRS)、ゾーン冗長ストレージ (ZRS)、ローカル冗長ストレージ (LRS) はいずれも、仮想アレイで使用することができます。各種ストレージ アカウントの詳細については、「[Azure Storage のレプリケーション](../storage/storage-redundancy.md)」を参照してください。


### 共有とボリューム

StorSimple Virtual Array には、共有 (ファイル サーバーとして構成されているとき) またはボリューム (iSCSI サーバーとして構成されているとき) をプロビジョニングすることができます。共有やボリュームを作成するうえでのベスト プラクティスは、そのサイズや、構成されているタイプに関係します。

#### ボリューム/共有サイズ

仮想アレイには、共有 (ファイル サーバーとして構成されているとき) またはボリューム (iSCSI サーバーとして構成されているとき) をプロビジョニングすることができます。共有やボリュームを作成するうえでのベスト プラクティスは、そのサイズや、構成されているタイプに関係します。

仮想デバイスに共有またはボリュームをプロビジョニングするうえでのベスト プラクティスは次のとおりです。

-   階層化共有のプロビジョニング サイズに対する相対的なファイル サイズが、階層化のパフォーマンスに影響する場合があります。処理するファイルが大きいと、階層化に時間がかかる可能性があります。大きなファイルを処理するときは、最も大きなファイルのサイズを共有のサイズの 3% 未満にすることをお勧めします。

-   仮想アレイには最大 16 ボリューム/共有を作成できます。ボリューム/共有のサイズは、ローカル固定の場合で 50 GB ～ 2 TB にすることができます。階層化されているボリューム/共有のサイズは 500 GB ～ 20 TB にする必要があります。

-   ボリュームを作成するときは、想定されるデータ消費量と将来的な増大を考慮してください。ボリュームを後から拡大することはできませんが、より大きなボリュームに復元することは常時可能です。

-   ボリュームの作成後に、StorSimple 上のボリュームのサイズを縮小することはできません。
   
-   StorSimple 上の階層化ボリュームへの書き込み時に、ボリューム データが特定の (そのボリューム用に予約されたローカル領域に対する相対的な) しきい値に達すると、IO がスロットルされることに注意してください。このボリュームに書き込みを継続すると、IO 速度が著しく低下します。プロビジョニング済みの容量を超えて階層化ボリュームに書き込みを行うこともできますが (プロビジョニング済みの容量を超える書き込みができないよう積極的に措置を講じることはしていません)、サブスクリプションの上限を超えている旨の警告通知が表示されます。この警告が表示されたら、ボリューム データを削除したり、これまでより大きなボリュームに復元したりする (ボリュームの拡大は現在サポートされていません) など、必ず改善措置を講じてください。

-   許容される共有/ボリュームの数は 16 で、並列に処理できる共有/ボリュームの最大数も 16 であるため、共有/ボリュームの数は、障害復旧における RPO や RTO とは関係ありません。

#### ボリューム/共有の種類

StorSimple はその用途に応じて、"ローカル固定" と "階層化" という 2 種類のボリューム/共有をサポートします。ローカル固定ボリューム/共有がシック プロビジョニングで、階層化ボリューム/共有はシン プロビジョニングとなります。

StorSimple のボリューム/共有を構成するときは、次のベスト プラクティスに従うようお勧めします。

-   デプロイする予定のワークロードに合ったボリュームの種類を見極めたうえで、ボリュームを作成してください。(クラウドの障害が発生した場合でも) ローカル データの存在が保証されるべきワークロードや、クラウドとのやり取りで生じる長い遅延が許されないようなワークロードには、ローカル固定ボリュームを使用します。いったん仮想アレイにボリュームを作成した後で、ローカル固定から階層化 (または "*その逆*") へとボリュームの種類を変更することはできません。たとえば、仮想マシン (VM) のホストとなるワークロードや SQL ワークロードをデプロイするときはローカル固定ボリュームを作成します。一方、ファイル共有のワークロードには、階層化ボリュームを使用します。


-   大きなファイル サイズを扱うときは、使用頻度の低いアーカイブ データのオプションをオンにします。このオプションをオンにすると、クラウドへのデータ転送を効率よく行うために、重複除去のチャンク サイズが 512 K に増やされます。

#### ボリュームのフォーマット

iSCSI サーバーに StorSimple ボリュームを作成した後、ボリュームを初期化してマウントし、フォーマットする必要があります。この操作は、StorSimple デバイスに接続されているホストで実行します。StorSimple ホストでボリュームをマウントしてフォーマットする際は、ベスト プラクティスに従うことをお勧めします。

-   すべての StorSimple ボリュームに対してクイック フォーマットを実行します。

-   StorSimple ボリュームをフォーマットするときのアロケーション ユニット サイズ (AUS) は 64 KB を使用します (既定値は 4 KB)。64 KB という AUS は、StorSimple の一般的なワークロードやその他のワークロードに対して社内で実施されたテストに基づきます。

-   iSCSI サーバーとして構成された StorSimple Virtual Array を使用するときは、スパン ボリュームやダイナミック ディスクを使用しないでください。StorSimple ではサポートされません。

#### 共有へのアクセス

仮想アレイのファイル サーバー上に共有を作成するときは、次のガイドラインに従ってください。

-   共有を作成するとき、共有の管理者として単一のユーザーではなくユーザー グループを割り当てます。

-   共有の作成後、エクスプローラーを通じて共有を編集することで、NTFS アクセス許可を管理できます。

#### ボリュームへのアクセス

StorSimple Virtual Array 上に iSCSI ボリュームを構成するときは、必要な場所へのアクセスを制御することが大切です。どのホスト サーバーにボリュームへのアクセスを許可するかは、アクセス制御レコード (ACR) を作成して StorSimple ボリュームに関連付けることによって設定します。

StorSimple ボリュームの ACR を構成する際は、次のベスト プラクティスに従ってください。

-   ボリュームには必ず、少なくとも 1 つの ACR を関連付けます。

-   複数の ACR は、クラスター環境でのみ定義するようにします。

-   1 つのボリュームに複数の ACR を割り当てるときは、複数の非クラスター化ホストから同時にアクセスできるような方法でボリュームが公開されることのないように注意してください。1 つのボリュームに複数の ACR を割り当てた場合、構成内容を確認するよう求める警告メッセージが表示されます。

### データ セキュリティと暗号化

StorSimple Virtual Array には、データの機密性と整合性を確保するデータ セキュリティと暗号化の機能が備わっています。これらの機能を使用するときは、次のベスト プラクティスに従うようお勧めします。

-   データが仮想アレイからクラウドに送信される前に AES-256 暗号化を適用するためにクラウド ストレージの暗号化キーを定義します。データが最初に暗号化される場合、このキーは不要です。キーは、[Azure Key Vault](../key-vault/key-vault-whatis.md) などのキー管理システムを使用して生成し、安全に保管することができます。

-   StorSimple Manager サービスを介してストレージ アカウントを構成する際は、必ず SSL モードを有効にし、StorSimple デバイスとクラウド間のネットワーク通信に安全なチャネルを作成します。

-   一連の管理者に変更が生じたことによるアクセスの変化に対応するために、ストレージ アカウントのキーは、(Azure Storage サービスにアクセスして) 定期的に再生成します。

-   仮想アレイ上のデータは圧縮され、重複除去されてから、Azure に送信されます。Windows Server ホストでデータ重複除去役割サービスを使用することはお勧めできません。


## 運用上のベスト プラクティス

運用上のベスト プラクティスは、日常的な仮想アレイの管理時や運用時に従うべきガイドラインです。バックアップの作成、バックアップ セットからの復元、フェールオーバーの実行、アレイの非アクティブ化と削除、システムの使用状況や正常性の監視、仮想アレイに対するウイルス スキャンの実行など、特定の管理タスクが対象となります。

### バックアップ

クラウドには、仮想アレイ上のデータが 2 とおりの方法でバックアップされます。1 つは、既定のバックアップ方法で、毎日 22 時 30 分に自動的にデバイス全体のバックアップが開始されます。もう 1 つは、手動によるオンデマンド バックアップです。既定では、デバイス上に存在するすべてのデータのクラウド スナップショットが毎日、デバイスによって自動的に作成されます。詳しくは、「[StorSimple Virtual Array をバックアップする](storsimple-ova-backup.md)」をご覧ください。

既定のバックアップに関連付けられている頻度とリテンション期間は変更できませんが、日次バックアップが毎日開始される時刻を設定によって変更することはできます。自動化されたバックアップの開始時刻を構成するうえでの推奨事項は次のとおりです。

-   バックアップはピーク時間帯を避けてスケジューリングします。バックアップの開始時刻が多数のホスト IO と重ならないようにしてください。

-   デバイスのフェールオーバーを予定しているときやメンテナンス期間の前に、手動でのオンデマンド バックアップを実行して仮想アレイ上のデータを保護します。

### 復元

バックアップ セットは 2 とおりの方法で復元できます。別のボリュームまたは共有に対して復元する方法と、項目レベルの回復 (ファイル サーバーとして構成された仮想アレイでのみ利用可能) を実行する方法です。項目レベルの回復を使用すると、StorSimple デバイス上のすべての共有のクラウド バックアップから、ファイルとフォルダーを細かいレベルで復元できます。詳細については、[バックアップからの復元](storsimple-ova-restore.md)に関するページを参照してください。

復元を実行するときは、次のガイドラインを考慮してください。

-   StorSimple Virtual Array は、インプレース復元をサポートしません。ただしこれは、仮想アレイに領域を確保し、別のボリューム/共有に復元する、という 2 段階のプロセスで簡単に実現できます。

-   復元は実行に時間のかかる操作です。ローカル ボリュームから復元する際は注意してください。ボリュームはすぐにオンラインになりますが、データは引き続きバックグラウンドでハイドレートされます。

-   ボリュームの種類は、復元プロセス中も維持されます。階層化ボリュームは別の階層化ボリュームに復元され、ローカル固定ボリュームは別のローカル固定ボリュームに復元されます。

-   バックアップ セットからボリュームまたは共有を復元するとき、復元ジョブが失敗したのに、ポータルでターゲットのボリュームまたは共有が作成されることがあります。将来、これに起因して発生する問題を最小限に抑えるために、この未使用のターゲット ボリュームまたは共有を削除することが重要です。

### フェールオーバーと障害復旧

デバイスのフェールオーバーにより、データをデータセンターの*ソース* デバイスから、同じ場所または別の場所にある*ターゲット* デバイスに移行できます。デバイスのフェールオーバーは、デバイス全体に対して行われます。フェールオーバーの間、ソース デバイスのクラウド データの所有権はターゲット デバイスに移ります。

StorSimple Virtual Array は、同じ StorSimple Manager サービスによって管理された別の仮想アレイにしかフェールオーバーできません。8000 シリーズ デバイスへのフェールオーバーや、(フェールオーバー元のデバイスとは) 異なる StorSimple Manager サービスによって管理されたアレイへのフェールオーバーは実行できません。フェールオーバーの考慮事項について詳しくは、[デバイスのフェールオーバーの前提条件](storsimple-ova-failover-dr.md)に関するページをご覧ください。

仮想アレイのフェールオーバーを実行するときは、次の点に注意してください。

-   計画されたフェールオーバーでは、すべてのボリューム/共有をオフラインにしてから、フェールオーバーを開始するようお勧めします。オペレーティング システムごとの手順に従って、ボリューム/共有をまずホスト上でオフラインにした後、仮想デバイス上でそれらをオフラインにしてください。

-   ファイル サーバーの障害復旧 (DR) の場合は、共有のアクセス許可が自動的に解決されるよう、ソース デバイスと同じドメインにターゲット デバイスを参加させることをお勧めします。このリリースでは、同じドメイン内のターゲット デバイスへのフェールオーバーのみがサポートされます。

-   DR が正常に完了すると、ソース デバイスは自動的に削除されます。デバイスは使用できなくなりますが、ホスト システムにプロビジョニングした仮想マシンは引き続きリソースを消費します。料金が発生しないように、この仮想マシンをホスト システムから削除することをお勧めします。

-   万一フェールオーバーが失敗したとしても、**クラウド内のデータは常に無傷です**。フェールオーバーが正常に完了しないケースとして、次の 3 つのシナリオに注意してください。

    -   フェールオーバーの初期段階 (DR の事前チェックの実行中など) で障害が発生した。この状況では、ターゲット デバイスを引き続き使用できます。同じターゲット デバイスに対してフェールオーバーを再試行できます。

    -   実際のフェールオーバー プロセス中にエラーが発生した。このケースでは、ターゲット デバイスが使用不可としてマークされます。フェールオーバーには、別のターゲット仮想アレイをプロビジョニングして構成し、使用する必要があります。

    -   フェールオーバーが完了し、その後ソース デバイスが削除されたが、ターゲット デバイスに問題があって、ユーザーがデータにアクセスできなくなった。クラウドのデータは無傷なままです。別の仮想アレイを作成し、それを DR のターゲット デバイスとして使用することにより、そのデータを簡単に取得できます。

### 非アクティブ化

StorSimple Virtual Array を非アクティブ化する場合は、デバイスとこれに対応する StorSimple Manager サービスの接続を切断します。非アクティブ化は**永続的**な操作であるため、元に戻すことはできません。非アクティブ化されたデバイスを StorSimple Manager サービスに再び登録することはできません。詳しくは、[StorSimple Virtual Array の非アクティブ化と削除](storsimple-deactivate-and-delete-device.md)に関するページをご覧ください。

仮想アレイを非アクティブ化する際は、次のベスト プラクティスに従ってください。

-   仮想デバイスを非アクティブ化する前に、すべてのデータのクラウド スナップショットを作成します。仮想アレイを非アクティブ化すると、ローカル デバイスのすべてのデータが失われます。クラウド スナップショットを作成することによって、後からデータを復元することができます。

-   StorSimple Virtual Array を非アクティブ化する前に、そのデバイスに依存するクライアントとホストを必ず停止または削除してください。

-   非アクティブ化したデバイスは、今後使用しないのであれば、料金が発生しないよう削除してください。

### 監視

StorSimple Virtual Array を絶えず正常な状態に保つためには、そのアレイを監視し、警告などの情報を確実にシステムから取得する必要があります。仮想アレイの全体的な正常性を監視するために、以下のベスト プラクティスを実践してください。

- 仮想アレイのデータ ディスクと OS ディスクの使用量を追跡するための監視を構成します。Hyper-V を実行している場合、System Center Virtual Machine Manager (SCVMM) と System Center Operations Manager (SCOM) を使用して仮想化ホストを監視することができます。

- 特定の使用率に達したときに警告を送信するように仮想アレイの電子メール通知を構成します。

### インデックス検索とウイルス スキャン アプリケーション

StorSimple Virtual Array では、ローカル階層から Microsoft Azure クラウドへとデータを自動的に階層化することができます。StorSimple に格納されているデータをインデックス検索またはウイルス スキャンなどのアプリケーションでスキャンするときは、クラウド データがアクセスされてローカル階層に引き戻されることのないように注意する必要があります。

仮想アレイに対するインデックス検索またはウイルス スキャンを構成する際は、次のベスト プラクティスに従うようお勧めします。

-   自動的に構成されたフル スキャン操作があれば無効にします。

-   階層化ボリュームの場合、増分スキャンを実行するようにインデックス検索またはウイルス スキャン アプリケーションを構成します。この場合、スキャンの対象は新しいデータのみで、そのようなデータは高い確率でローカル階層に存在します。クラウドに階層化されたデータは、増分操作時にはアクセスされません。

-   意図した種類のファイルだけがスキャン対象となるように検索フィルターと検索設定を正しく構成します。たとえばインデックスの増分再構築時や完全再構築時は、画像ファイル (JPEG、GIF、TIFF) や図面データをスキャンの対象外にします。

Windows のインデックス作成プロセスを使用する場合、次のガイドラインに従います。

-   階層化ボリュームに Windows Indexer は使用しないでください。インデックスを頻繁に再構築する必要がある場合、TB 規模の大量のデータがクラウドから呼び戻されます。インデックスを再構築した場合、すべてのファイル タイプが取得され、その内容のインデックスが作成されます。

-   ローカル固定ボリュームには、Windows のインデックス作成プロセスを使用します。この場合は、ローカル階層のデータにのみアクセスしてインデックスが構築されます (クラウド データはアクセスされません)。

### バイト範囲ロック

ファイル内の特定の範囲のバイトがアプリケーションによってロックされている場合があります。StorSimple への書き込みを行っているアプリケーションでバイト範囲ロックが有効になっている場合、仮想アレイで階層化が正しく機能しません。階層化が正しく機能するためには、アクセスしたファイルのすべての領域をロック解除する必要があります。仮想アレイ上の階層化ボリュームでは、バイト範囲ロックはサポートされません。

この制限を緩和するために、次の対策をお勧めします。

-   アプリケーション ロジックでバイト範囲ロックを無効にします。

-   このアプリケーションに関連付けられているデータには、(階層化ボリュームではなく) ローカル固定ボリュームを使用します。ローカル固定ボリュームは、クラウドに階層化されません。

-   バイト範囲ロックを有効にしてローカル固定ボリュームを使用しているときは、復元が完了する前にボリュームがオンラインに移行できることに注意してください。このような場合は、復元が完了するまで待機してください。

## 複数のアレイ

データのワーキング セットが大きくなってクラウドにまで溢れ、デバイスのパフォーマンスへの影響が懸念される場合、その対策として複数の仮想アレイをデプロイすることが必要になることがあります。この場合、ワーキング セットの増大に応じてデバイスを拡張することをお勧めします。そのためには、オンプレミスのデータ センターにデバイスを追加する必要があります。デバイスを追加するときに、次のことを検討してください。

-   現在のデータのセットを分割します。
-   新しいワークロードを新しいアプライアンスにデプロイします。
-   複数の仮想アレイをデプロイする場合、負荷分散の観点から、複数のハイパーバイザー ホストにアレイを分散させます。

-  ファイル サーバーまたは iSCSI サーバーとして構成されている複数の仮想アレイは、分散ファイル システムの名前空間にデプロイすることができます。詳しい手順については、『[Distributed File System Namespace Solution with Hybrid Cloud Storage Deployment Guide (分散ファイル システム名前空間ソリューションとハイブリッド クラウド ストレージ デプロイ ガイド)](https://www.microsoft.com/download/details.aspx?id=45507)』を参照してください。現時点では、分散ファイル システム レプリケーションを仮想アレイで使用することは推奨されません。


## 関連項目
StorSimple Manager サービスを介して [StorSimple Virtual Array を管理する方法](storsimple-ova-manager-service-administration.md)を学習します。

<!---HONumber=AcomDC_0727_2016-->