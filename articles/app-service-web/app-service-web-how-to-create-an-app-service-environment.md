<properties 
	pageTitle="App Service 環境の作成方法" 
	description="App Service 環境の作成フローの説明" 
	services="app-services\web" 
	documentationCenter="" 
	authors="ccompy" 
	manager="stefsch" 
	editor=""/>

<tags 
	ms.service="app-services-web" 
	ms.workload="web" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="04/27/2015" 
	ms.author="ccompy"/>

# App Service 環境の作成方法 #

App Service 環境 (ASE) は、現在プレビュー段階にある Azure App Service の Premium サービスの 1 つのオプションです。App Service 環境 (ASE) は、マルチテナント スタンプでは使用できない高度な構成機能を提供します。App Service 環境が提供される機能の詳細については、[App Service 環境の概要][WhatisASE]に関するページを参照してください。

### 概要 ###

ASE 機能は、基本的に、Azure App Service を顧客の VNET にデプロイします。そのためには、次の条件が満たされている必要があります。

- 地域 VNET が 512 (/23) 個以上のアドレスを持つ。
- この VNET 内のサブネットが 256 (/24) 個以上のアドレスを持つ。

App Service 環境をホストするための VNET をまだ用意していない場合は、App Service 環境の作成時に作成できます。

それぞれの ASE デプロイメントは、Azure によって管理および保守されるホステッド サービスです。お客様は、ASE システム ロールをホストするコンピューティング リソースにアクセスすることはできませんが、インスタンスの数量とそのサイズを管理できます。

## App Service 環境の作成 ##

ASE の作成用 UI にアクセスするには、2 つの方法があります。1 つは Azure Marketplace で ***App Service 環境*** を検索する方法、もう 1 つは [新規]、[Web + モバイル] の順に選択する方法です。

### Quick create ###
作成用 UI を開いた後、デプロイメントの名前を入力するだけで ASE をすばやく作成できます。この場合、512 個のアドレスを持つ VNET、その VNET 内に 256 個のアドレスを持つサブネット、ワーカー プール 1 に 2 つのフロントエンドと 2 つのワーカーを持つ ASE 環境が作成されます。システムを配置する場所とそこに配置するサブスクリプションを必ず選択してください。ASE を使用してコンテンツをホストできる唯一のアカウントは、その作成に使用されたサブスクリプションに属している必要があります。

ASE 用に指定した名前は、ASE で作成される Web アプリに使用されます。たとえば、ASE の名前が appsvcenvdemo の場合、ドメイン名は .*appsvcenvdemo.p.azurewebsites.net* になります。ここで mytestapp という名前の Web アプリを作成した場合、この Web アプリのアドレスは *mytestapp.appsvcenvdemo.p.azurewebsites.net* となります。名前に空白文字は使用できません。名前に大文字を使用した場合、ドメイン名はその名前をすべて小文字で表記したバージョンになります。


![][1]

### コンピューティング リソース プール ###

App Service 環境用に使用されるコンピューティング リソースは、コンピューティング リソース プールで管理されます。これにより、サイズに加え、プール内のコンピューティング リソース インスタンスの構成方法を管理できます。App Service 環境は、フロントエンド サーバーとワーカーで構成されます。フロントエンド サーバーはアプリの接続の負荷を処理し、ワーカーはアプリのコードを実行します。フロントエンド サーバーは、専用のコンピューティング リソース プールで管理されます。ワーカーは、次の名前を持つ 3 つの別個のコンピューティング リソース プールで管理されます。

- ワーカー プール 1
- ワーカー プール 2
- ワーカー プール 3

多数の要求が発生する単純な Web アプリの場合、通常はフロントエンドをスケールアップして、ワーカーの数を少なくします。トラフィック量が少ない一方で CPU またはメモリを多く使用する Web アプリの場合、通常はフロントエンドの数を多くする必要はありませんが、より多くのワーカーやサイズの大きなワーカーが必要になります。

コンピューティング リソースのサイズに関係なく、最小フット プリントには 2 つのフロントエンド サーバーと 2 つのワーカーが含まれます。App Service 環境は合計 55 個までのコンピューティング リソースを使用するように構成できます。この 55 個のコンピューティング リソースのうち、ワークロードのホストに使用できるのは 50 個のみです。その理由は 2 つあります。フロントエンドのコンピューティング リソースは最小で 2 つです。これにより、ワーカー プールの割り当てのサポートには最大で 53 個残ります。ただし、フォールト トレランスを提供するには、次のルールに従い、追加のコンピューティング リソースを割り当てる必要があります。

- 各ワーカー プールには 1 つ以上の追加のコンピューティング リソースが必要で、これをワークロードに割り当てることはできません。
- プール内のコンピューティング リソースの数量が特定の値を超えた場合、別のコンピューティング リソースが必要になります。

1 つのワーカー プール内でのフォールト トレランスの要件は、ワーカー プールに割り当てられたリソースの任意の値 X について、

- X が 2 ～ 20 の場合、ワークロードに使用できるコンピューティング リソースの数は X-1 です。
- X が 21 ～ 40 の場合、ワークロードに使用できるコンピューティング リソースの数は X-2 です。
- X が 41 ～ 53 の場合、ワークロードに使用できるコンピューティング リソースの数は X-3 です。

任意のプールに割り当てることのできるコンピューティング リソースの数量を管理できるだけでなく、サイズを制御することもできます。App Service 環境では、P1 ～ P4 のラベルが付けられた 4 種類のサイズから選択することができます。これらのサイズとその料金設定の詳細については、「[アプリ サービス料金][AppServicePricing]」を参照してください。P1 ～ P3 のコンピューティング リソース サイズは、マルチテナント環境で利用できるものと同様です。P4 コンピューティング リソースでは、8 つのコアと 14 GB の RAM が提供され、App Service 環境でのみ利用できます。

App Service 環境の価格設定は、割り当てられるコンピューティング リソースを対象としています。ワークロードをホストしているかどうかに関係なく、App Service 環境に割り当てられているコンピューティング リソースに対する料金を支払うことになります。



### VNET の作成 ###
自動的に新しい VNET を作成する簡易作成機能が用意されているほか、既存の VNET を選択することも、VNET を手動で作成することもできます。既存の VNET が App Service 環境のデプロイメントをサポートするのに十分な大きさを持つ場合は、これを選択できます。VNET は、512 個以上のアドレスを持つ必要があります。既存の VNET を選択する場合は、使用するサブネットを指定するか、または新しいサブネットを作成する必要があります。サブネットは、256 個以上のアドレスを持つ必要があります。

VNET の作成用 UI を使用する場合は、次の項目を指定する必要があります。

- VNET 名
- VNET アドレス範囲 (CIDR 表記)
- サブネット名
- サブネット範囲 (CIDR 表記)

CIDR 表記とは 10.0.0.0/22 形式の表記法で、/22 は範囲を指定します。この例の /22 は、10.0.0.0 ～ 10.0.3.255 範囲の 1,024 個のアドレスを意味します。/23 は、512 個のアドレスを意味します。

![][2]

### App Service 環境のサイズの定義 ###

次に構成する項目は、システムのスケールです。既定では、2 つのフロントエンド P2 コンピューティング リソース、2 つの P1 ワーカー、および 1 個の IP アドレスが提供されます。2 つのフロントエンドは、高可用性を実現すると共に負荷を分散するために用意されています。フロントエンドの最小サイズは、中程度のサイズのシステムをサポートするのに十分な容量を確保できるように、P2 となっています。システムでより多くの要求をサポートする必要があることがわかっている場合は、フロントエンドの数と使用するサーバーのサイズを調整できます。

既に説明したように、ASE には、お客様が定義できる 3 つのワーカー プールがあります。コンピューティング リソースのサイズには、P1 ～ P4 があります。既定では、ワーカー プール 1 に 2 つの P1 ワーカーのみが構成されます。これは、インスタンスが 1 つの単独の App Service プランをサポートするのに十分です。

スライダーは、App Service 環境で使用可能な合計コンピューティング容量を反映するように自動的に調整されます。任意の 1 つのプール内でスライダーを調整すると、他のスライダーは、55 に達するまでに使用できる残されたコンピューティング リソースの数を反映するように変化します。
 
![][3]

新しいインスタンスを追加してもすぐには使用できるようになりません。追加のコンピューティング リソースが必要になることがわかっている場合は、十分余裕を持ってプロビジョニングする必要があります。プロビジョニングに要する時間は、システムに追加するリソースの数によっては数時間に及ぶことがあります。システムが確実にフォールト トレランスの要件を満たすためには、すべての ASE で各ワーカー プールに使用可能な予約インスタンスを配置する必要があることに注意してください。

既定では、ASE は、IP SSL で利用可能な 1 個の IP アドレスを持ちます。さらに多くの IP アドレスが必要になることがわかっている場合は、ここで設定を指定するか、または作成後に設定を管理することができます。
  
### App Service 環境を作成した後 ###

ASE を作成した後は、次の項目を調整できます。

- フロントエンドの数 (最小: 2)
- ワーカーの数 (最小: 2)
- IP アドレスの数
- フロントエンドまたはワーカーによって使用されるコンピューティング リソースのサイズ (フロントエンドの最小サイズは P2)

次の項目は変更できません。

- 場所
- [サブスクリプション]
- リソース グループ
- 使用する VNET
- 使用するサブネット

App Service 環境の管理と監視の詳細については、[App Service 環境を構成する方法][ASEConfig]に関するページを参照してください。

データベース、ストレージなど、カスタマイズできない追加の依存関係があります。これらは Azure によって処理され、システムに付属しています。システム ストレージでは、App Service 環境全体で 500 GB までサポートされます。


## 使用の開始

App Service 環境の使用を開始するには、「[App Service 環境の概要][WhatisASE]」を参照してください。

Azure App Service プラットフォームの詳細については、[Azure App Service][AzureAppService] に関するページを参照してください。



<!--Image references-->
[1]: ./media/app-service-web-how-to-create-an-app-service-environment/createaseblade.png
[2]: ./media/app-service-web-how-to-create-an-app-service-environment/createasenetwork.png
[3]: ./media/app-service-web-how-to-create-an-app-service-environment/createasescale.png

<!--Links-->
[WhatisASE]: http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-intro/
[ASEConfig]: http://azure.microsoft.com/documentation/articles/app-service-web-configure-an-app-service-environment/
[AppServicePricing]: http://azure.microsoft.com/pricing/details/app-service/
[AzureAppService]: http://azure.microsoft.com/documentation/articles/app-service-value-prop-what-is/
<!--HONumber=52-->
 