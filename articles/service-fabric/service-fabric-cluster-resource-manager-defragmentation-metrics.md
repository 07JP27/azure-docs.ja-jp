<properties
   pageTitle="プロアクティブ メトリック パッキング | Microsoft Azure"
   description="Service Fabric でのプロアクティブ メトリック パッキング (最適化) の使用の概要"
   services="service-fabric"
   documentationCenter=".net"
   authors="masnider"
   manager="timlt"
   editor=""/>

<tags
   ms.service="Service-Fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="03/10/2016"
   ms.author="masnider"/>

# Service Fabric のメトリックと負荷の最適化
Service Fabric クラスター リソース マネージャーは主に負荷分散の面で分散機能に関与します。すべてのノードが均等に活用されるようにします。どのような障害が発生してもほとんどのワークロードが失われることはないので、通常、これは障害対応の観点から最も安全で賢明なレイアウトです。Service Fabric リソース マネージャーは、最適化と呼ばれる別の戦略もサポートしています。最適化は一般に、クラスター全体にメトリックの使用を分散させようとするのではなく、実際にはその統合を試みる必要があることを意味します。実際にその実装はそれほど難しくありませんでした。特定のメトリックのメトリック負荷の平均標準偏差の最小化に基づいてソリューションのスコアを上げる代わりに、スコアを下げるのです (言い方を変えれば、偏差を最小にしようとするのではなく、偏差を大きくすることで最適化を始めます)。しかし、なぜこのような戦略が必要なのでしょうか。

クラスター内のノード間に負荷を均等に分散させた場合、ノードが提供する必要のあるリソースの一部がすべて消費されます。通常であればこれは問題になりませんが、非常に大きくてノードの大部分を消費するようなサービスを一部のワークロードが作成することがあります。たとえば、ノードのリソースの 75% ～ 95% が 1 つのサービス専用になります。これは問題ではありません。リソース マネージャーはこの大きなワークロードのためのリソースを確保するためにクラスターの再構成が必要であることを作成時に検出し、すぐに着手しますが、その間ワークロードは待機する必要があります。

新しいワークロードのスケジュール設定は少なくとも少しは遅延時間の影響を受けやすいことが普通なので、何かのやり方を変えないと、移動するサービスと状態が多数ある場合は SLA に影響が出る可能性があります。実際に、実際のクラスター データに基づくシミュレーションでの作成時間の測定では、サービスが十分に大きく、クラスターを均等に利用した場合、大きいサービスの作成は遅くなり、最適化メトリックの概念を導入することによって改善できました。

コンピューターのハード ディスクが断片化しているとファイルの作成やアクセスが遅くなり、ドライブを最適化すると速くなるのと同じように、最適化メトリックを構成して、リソース マネージャーが先手を打ってサービスの負荷を少数のノードに圧縮して (ほとんど) 常に大きいサービスのための余裕があるようにすると、サービスを速く作成できます。通常のサービスは小さく (むしろ微小)、リソースを見つけるのは難しくないので、ほとんどの場合はこのようなことは必要ありませんが、大きいサービスがあり、すばやく作成する必要がある場合は (そして他のトレードオフを許容できる場合)、最適化メトリックが役に立ちます。

## 最適化の長所と短所
他の概念的トレードオフとはどのようなものでしょうか。 最適化メトリックを有効にする前に、ワークロードを詳細に測定することをお勧めします。次の表は考慮すべきことを簡単にまとめたものです。

| 最適化の長所 | 最適化の短所 |
|----------------------|----------------------|
|大きいサービスを短時間で作成できる |	少数のノードに負荷をまとめるので、競合が増える
|作成の間のデータ移動が減る | 障害の影響を受けるサービスが増え、混乱が増す
|要件の記述を増やし領域を再利用できる |	全体的なリソース管理構成が複雑になる

最適化されたメトリックと通常のメトリックを同じクラスター内に混在させることができ、リソース マネージャーはできる限り多くの最適化されたメトリックが統合されて残りが分散される最善のレイアウトの作成を試みます。正確な結果は、分散メトリックの数と最適化メトリックの数の比、それらの重みなどによって変わります。

## 最適化メトリックを構成する
最適化メトリックの構成はクラスターでのグローバルな決定であり、最適化対象としてメトリックを個別に選択できます。

ClusterManifest.xml:

```xml
<Section Name="DefragmentationMetrics">
    <Parameter Name="Disk" Value="true" />
    <Parameter Name="CPU" Value="false" />
</Section>
```

## 次のステップ
- クラスター リソース マネージャーには、クラスターを記述するためのさまざまなオプションがあります。オプションの詳細については、[Service Fabric クラスターの記述](service-fabric-cluster-resource-manager-cluster-description.md)に関する記事を参照してください。
- メトリックは、Service Fabric クラスター リソース マネージャーが管理するクラスターの利用量と容量を表します。メトリックの詳細とその構成方法については、[この記事](service-fabric-cluster-resource-manager-metrics.md)を参照してください。

[Image1]: ./media/service-fabric-resource-balancer-proactive-metric-packing/PMP.png

<!---HONumber=AcomDC_0316_2016-->