---
title: "Azure Service Fabric でのメトリックの最適化 | Microsoft Docs"
description: "Service Fabric でのメトリック向け戦略としての最適化またはパッキングの使用の概要"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: e5ebfae5-c8f7-4d6c-9173-3e22a9730552
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/19/2016
ms.author: masnider
translationtype: Human Translation
ms.sourcegitcommit: 219dcbfdca145bedb570eb9ef747ee00cc0342eb
ms.openlocfilehash: 68183597e19347f10a0ffe24a418dbcac409cb14


---
# <a name="defragmentation-of-metrics-and-load-in-service-fabric"></a>Service Fabric のメトリックと負荷の最適化
Service Fabric クラスター リソース マネージャーは主に負荷分散の面で分散機能に関与します。クラスター内のすべてのノードが均等に活用されるようにします。 どのような障害が発生しても指定されたワークロードのかなりの割合が失われることはないので、通常、これは障害対応の観点から最も安全で賢明なレイアウトです。 Service Fabric クラスター リソース マネージャーは、最適化と呼ばれる別の戦略もサポートしています。 最適化は一般に、クラスター全体にメトリックの使用を分散させようとするのではなく、実際にはその統合を試みる必要があることを意味します。 これは通常の戦略の転換です – 特定のメトリックのメトリック負荷の平均標準偏差の最小化に基づいてクラスターを最適化する代わりに、偏差を大きくすることで最適化を始めます。 しかし、なぜこのような戦略が必要なのでしょうか。

クラスター内のノード間に負荷を均等に分散させた場合、ノードが提供する必要のあるリソースの一部がすべて消費されます。 通常であればこれは問題になりませんが、非常に大きくてノードの大部分を消費するようなサービスを一部のワークロードが作成することがあります。たとえば、ノードのリソースの 75% ～ 95% が 1 つのサービス インスタンスまたはレプリカ専用になります。 これは問題ではありません。クラスター リソース マネージャーはこの大きなワークロードのための領域を確保するためにクラスターの再構成が必要であることをサービス作成時に検出し、すぐに着手しますが、その間ワークロードはクラスター内にスケジュールされるのを待機する必要があります。

新しいワークロードのスケジュール設定は少なくとも少しは遅延時間の影響を受けやすいことが普通なので、何かのやり方を変えないと、移動するサービスと状態が多数ある場合、特にクラスターのワークロードが概して大きい場合 (従って、クラスターでの移動に比較的時間がかかる場合)、SLA に影響が出る可能性があります。 実際に、実際のクラスター データに基づくシミュレーションでの作成時間の測定では、サービスが十分に大きく、クラスターを均等に利用した場合、大きいサービスの作成は遅くなり、最適化メトリックのポリシーを導入することによって改善できました。

コンピューターのハード ディスクが断片化しているとファイルの作成やアクセスが遅くなり、ドライブを最適化して、連続した大規模なブロックを使用できるようにすると速くなるのと同じように、最適化メトリックを構成して、クラスター リソース マネージャーが先手を打ってサービスの負荷を少数のノードに圧縮して (ほとんど) 常に大きいサービスのための余裕があるようにすると、サービスを速く作成できます。 通常のサービスは小さく、領域を見つけるのは難しくないので、ほとんどの場合はこのようなことは必要ありませんが、大きいサービスがあり、すばやく作成する必要がある場合は (そして、障害の影響の増加や、一部のリソースがワークロードがスケジュールされるのを待機する間に使用されないままであることなど、他のトレードオフを許容できる場合)、最適化の戦略が役に立ちます。

次の図は、2 つの異なるクラスターの視覚的な表現を示しています。一方は最適化され、もう一方は最適化されていません。 分散されている場合、即座にノード 4 または 5 に配置できる、最適化されたクラスターと比較して、新しいサービス オブジェクトを作成する場合、最も大きなサービス オブジェクトのうちいずれかを配置するのに必要な移動を検討してください。

![分散および最適化されたクラスターの比較][Image1]

## <a name="defragmentation-pros-and-cons"></a>最適化の長所と短所
他の概念的トレードオフとはどのようなものでしょうか。 最適化メトリックを有効にする前に、ワークロードを詳細に測定することをお勧めします。 次の表は考慮すべきことを簡単にまとめたものです。

| 最適化の長所 | 最適化の短所 |
| --- | --- |
| 大きいサービスを短時間で作成できる |少数のノードに負荷をまとめるので、競合が増える |
| 作成の間のデータ移動が減る |障害の影響を受けるサービスが増え、混乱が増す |
| 要件の記述を増やし領域を再利用できる |全体的なリソース管理構成が複雑になる |

最適化されたメトリックと通常のメトリックを同じクラスター内に混在させることができ、リソース マネージャーはできる限り多くの最適化されたメトリックが統合されて残りが分散される最善のレイアウトの作成を試みます。 正確な結果は、分散メトリックの数と最適化メトリックの数の比、それらの重み、現在の負荷などによって変わります。

## <a name="configuring-defragmentation-metrics"></a>最適化メトリックを構成する
最適化メトリックの構成はクラスターでのグローバルな決定であり、最適化対象としてメトリックを個別に選択できます。

ClusterManifest.xml:

```xml
<Section Name="DefragmentationMetrics">
    <Parameter Name="Disk" Value="true" />
    <Parameter Name="CPU" Value="false" />
</Section>
```

## <a name="next-steps"></a>次のステップ
* クラスター リソース マネージャーには、クラスターを記述するためのさまざまなオプションがあります。 オプションの詳細については、 [Service Fabric クラスターの記述](service-fabric-cluster-resource-manager-cluster-description.md)
* メトリックは、Service Fabric クラスター リソース マネージャーが管理するクラスターの利用量と容量を表します。 メトリックの詳細とその構成方法については、 [この記事](service-fabric-cluster-resource-manager-metrics.md)

[Image1]:./media/service-fabric-cluster-resource-manager-defragmentation-metrics/balancing-defrag-compared.png



<!--HONumber=Nov16_HO3-->


