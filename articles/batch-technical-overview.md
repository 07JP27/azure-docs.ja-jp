<properties linkid="batch-technical-overview" urlDisplayName="" pageTitle="Azure Batch の技術概要" metaKeywords="" description="Azure Batch サービスの概念、ワークフロー、シナリオについて説明します。" metaCanonical="" services="batch" documentationCenter="" title="Azure Batch technical overview" authors="danlep" solutions="" manager="timlt" editor="tysonn" />

<tags ms.service="batch" ms.workload="big-compute" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="12/08/2014" ms.author="danlep" />


#Azure Batch の技術概要
Azure Batch は、コンピューティング リソースのジョブ スケジューリングおよび自動スケーリングをプラットフォーム サービスとして提供して、大規模な並列および高パフォーマンス コンピューティング (HPC) アプリケーションをクラウドで容易に実行できるようにします。Batch SDK と Batch サービスを使用すると、管理された仮想マシンのコレクションでオンデマンド実行またはスケジュール実行するようにバッチ ワークロードを構成できます。基になるプラットフォームでのジョブのスケジューリングやリソースの管理に伴う複雑さに悩む必要はありません。
 
>[WACOM.NOTE]Batch はプレビュー段階です。Batch を使用するには、Azure のアカウントが必要です。さらに、サブスクリプションで Batch プレビューを有効にする必要があります。アカウントがない場合は、無料の試用アカウントを数分で作成することができます。詳細については、[Azure アカウントの作成](http://www.windowsazure.com/ja-jp/develop/php/tutorials/create-a-windows-azure-account/)に関するページを参照してください。 


この記事では、次の項目について概説します。
 
* [ユース ケース](#BKMK_Scenarios)
* [開発者シナリオ](#BKMK_Approaches)
* [Batch の概念](#BKMK_Entities)
* [作業項目のワークフロー](#BKMK_Workflow_workitems)
* [アプリケーションを発行および実行するためのワークフロー](#BKMK_Workflow_cloudappss)
* [その他のリソース](#BKMK_Resources)

<h2 id="BKMK_Scenarios">ユース ケース</h2>

Batch は、クラウドの弾力性とスケールを *バッチ処理* または *バッチ コンピューティング* に利用して、似たような大量のタスクをプログラムで容易に実行できるようにします。コマンド ライン プログラムまたはスクリプトがデータ ファイルのセットを入力として受け取り、データを一連のタスクで処理して、一連の出力ファイルを生成します。最終的な結果または大規模なワークフローの中間ステップが出力ファイルとなります。       
 
バッチ コンピューティングは、定期的にまたはオンデマンドで大量のデータの処理、変換、および分析を行う組織にとって一般的なパターンです。これには、銀行の日次リスク レポートや定期的に行う必要がある給与処理などのサイクル末期処理が含まれます。また、一般に計算クラスターまたはグリッドのツールやリソースを必要とする大規模なビジネス、科学、エンジニアリング アプリケーションも含まれます。このようなアプリケーションには、自動車の設計、石油やガスの探査、生命科学研究、デジタル コンテンツの制作などの分野での専門的なワークロードだけでなく、流体力学シミュレーションなどの従来の HPC アプリケーションも含まれます。 
 
Batch は、本質的に並列な ("並列性がきわめて高い" とも呼ばれます) アプリケーションまたはワークロードに対応するため、複数のコンピューター (たとえば、Batch サービスによって管理されるコンピューティング VM) で並列タスクを実行するのに役立ちます。図 1 を参照してください。  

![Parallel tasks][parallel]

**図 1.複数のコンピューターで実行される並列タスク**

例については、次のとおりです。

* 財務リスクのモデリング 
* 画像のレンダリングと画像処理
* メディアのエンコードとトランスコード
* 遺伝子配列の分析
* ソフトウェアのテスト

また、Batch を使用して並列計算を実行すると、最終的により少ないステップで、より複雑で非循環型ではない他の並列ワークロードを処理できます。 

>[WACOM.NOTE]現在、Batch プレビューでは、Message Passing Interface (MPI) アプリケーションはサポートされていません。

<h2 id="BKMK_Approaches">開発者シナリオ</h2>

REST ベースの Batch API は、Batch サービスでバッチ ワークロードを構成および実行するのに役立つ 2 つの開発者シナリオをサポートしています。
 
1. **計算を作業項目として配布する** - *Batch* API を使用して、コンピューティング VM の柔軟性の高いプールを作成および管理し、そこで実行する作業項目を指定します。これによりリソースを完全に制御できますが、クライアントでタスク実行パイプラインを管理する必要があります。そのためには、Batch REST API またはオプションで作業項目のジョブ マネージャー機能を使用して実装できる、ワークフロー マネージャーまたはメタスケジューラを使用します。計算クラスターを設定したり、ジョブのキューイングやスケジュール設定のためのコードを記述したりする代わりに、計算ジョブのスケジュール設定を自動化し、ジョブを実行するコンピューティング VM のプールを拡張または縮小できます。作業項目を指定する操作の一部として、すべての依存関係を定義し、入力ファイルおよび出力ファイルの移動を定義します。 

2. **Batch サービスを使用してアプリケーションを発行および実行する** - *Batch Apps* API は、Batch サービスによってホストされる高いレベルの抽象化およびジョブ実行パイプラインを提供します。Batch Apps を使用すると、現在クライアント ワークステーションや計算クラスター上で実行されているアプリケーションからバッチ ワークロードをクラウドのサービスとして作成できます。Batch Apps を使用すると、既存のバイナリおよび実行可能ファイルをラップして発行することにより、Batch サービスによって作成されバックグラウンドで管理されるプール内の VM 上でそれらを実行できます。Batch Apps フレームワークは、入力および出力ファイルの移動、ジョブの実行、ジョブの管理、およびデータの永続性を処理します。また、Batch Apps では、データを分割する方法やジョブの複数のステップに関してタスクをモデル化できます。REST ベースの API と Batch Apps ポータルが含まれています。このポータルは Azure の管理ポータルからアクセスでき、送信したジョブを監視するために使用できます。


<h2 id="BKMK_Entities">Batch の概念</h2>

Batch サービスと API を操作するための主要な概念を次のセクションで概説します。詳細については、「[Azure Batch の API の基本](http://azure.microsoft.com/ja-jp/documentation/articles/batch-api-basics)」を参照してください。 

* [Batch アカウント](#BKMK_Account)
* [タスク仮想マシンとプール](#BKMK_TVM)
* [作業項目、ジョブ、タスク](#BKMK_Workitem)
* [ファイルとディレクトリ](#BKMK_Files)

<h3 id="BKMK_Account">Batch アカウント</h3>
Batch サービスを操作するには、一意の **Batch アカウント**が必要です。Batch サービスを使用して API 操作を行う場合、アカウントの URL とそれに関連付けられたアクセス キーを使用して要求を認証します。Batch アカウントは、Batch Apps ポータルにアクセスする場合にも必要になります。
 
Batch アカウントの作成とアカウントのアクセス キーの管理は Azure の管理ポータルで行います。

Batch アカウントを作成するには、次の手順を実行します。

1. [Azure 管理ポータル](https://manage.windowsazure.com)にサインインします。
2. **[新規]**、**[コンピューティング]**、**[Batch サービス]**、**[簡易作成]** の順にクリックします。
![Create a Batch account][account_portal]

3. 次の情報を入力します。

	* **[アカウント名]** に、Batch アカウントの URL に使用する一意の名前を入力します。
	* **[リージョン]** で、Batch が使用可能なリージョンを選択します。
	* 複数のサブスクリプションがある場合は、**[サブスクリプション]** で、Batch の使用に関して課金される、使用可能なサブスクリプションを選択します。

 
<h3 id="BKMK_TVM">タスク仮想マシンとプール</h3>

**タスク仮想マシン** (TVM) は、Batch サービスがアプリケーションの特定のワークロード (タスク) の実行専用に使用する Azure VM です。このようなワークロードには、実行可能ファイル (.exe) や、Batch Apps のアプリケーション イメージに含まれる 1 つまたは複数のプログラムがあります。一般的な Azure VM とは異なり、お客様は TVM を直接プロビジョニングしたり管理したりはしません。図 2. に示すように、Batch サービスがお客様に代わって、類似した構成を持つコンピューティング リソースの**プール**として TVM を作成および管理します。 

![Pool and TVMs][TVM_pool]

**図 2.TVM のプール**

Batch API を使用すると、プールを直接作成できます。また、実行する操作を指定したときに自動的にプールを作成するように Batch サービスを構成することもできます。Batch Apps API を使用した場合は、クラウド対応アプリケーションを実行したときにプールが自動的に作成されます。


プールの属性は、次のとおりです。

* TVM の[サイズ](http://msdn.microsoft.com/library/azure/dn197896.aspx) 
* TVM 上で実行されるオペレーティング システム
* TVM の最大数
* プールのスケーリング ポリシー - 現在のワークロードとリソースの使用量に基づいてタスクを処理する TVM の数を動的に調整するための式
* プール内通信を行うために TVM 上のファイアウォール ポートを有効にするかどうか
* TVM にインストールされる証明書。たとえば、ストレージ アカウントへのアクセスの認証用
* TVM の開始タスク。アプリケーションのインストールやタスクで使用するデータのダウンロードなど、1 回限りの操作用

>[WACOM.NOTE]現在、TVM では、Windows Server 2012 R2、Windows Server 2012、または Windows Server 2008 R2 SP1 オペレーティング システムのみを実行できます。

プールは、そのプールを作成した Batch アカウントのみが使用できます。1 つの Batch アカウントで複数のプールを持つことができます。

プールに追加されたすべての TVM に対し、一意の名前と関連 IP アドレスが割り当てられます。TVM をプールから削除すると、オペレーティング システム、そのローカル ファイル、その名前、およびその IP アドレスに加えられた変更は失われます。TVM をプールから削除すると、その有効期間が終了します。


<h3 id="BKMK_Workitem">作業項目、ジョブ、およびタスク</h3>

**作業項目**は、プール内の TVM でアプリケーションを実行する方法を指定するテンプレートです。**ジョブ**は、作業項目のスケジュールされたインスタンスで、1 回または複数回実行されますジョブは、**タスク**のコレクションで構成されます。図 3. に、これらの基本的な関係を示します。    
 
![Work item, job, and tasks][job_task]

**図 3.作業項目、ジョブ、およびタスク**

Batch を使用した開発で使用する API に応じて、作業項目、ジョブ、およびタスクに関して管理する必要がある項目の数が増減します。

* 低レベルの Batch API でアプリケーションを開発する場合は、プログラムを使用して Batch サービスが実行するすべての作業項目、ジョブ、およびタスクを定義し、タスクを実行する TVM プールを構成する必要があります。

* Batch Apps API とツールを使用してクライアント アプリケーションを統合する場合は、自動的にジョブをタスクに分割し、タスクを処理して個々のタスクの結果を最終的なジョブの結果にマージするコンポーネントを使用することができます。ワークロードを Batch サービスに送信すると、Batch Apps フレームワークがジョブを管理し、基になるコンピューティング リソース上でタスクを実行します。 



<h3 id="BKMK_Files">ファイルとディレクトリ</h3>

ファイルは、ジョブのタスクへの入力として使用されるデータです。タスクには、0 個、1 個、または複数個の入力ファイルを関連付けることができます。また、同じファイルを複数のタスクで使用することもできます。たとえば、ムービー レンダリング ジョブのタスクに対しては、よく使用するテクスチャやモデルがある場合があります。データ分析ジョブのタスクに対しては、一式の観測値または測定値を含むファイルを使用します。

各タスクは、作業ディレクトリを持ちます。この作業ディレクトリ内に、タスクによって実行されるプログラム、タスクによって処理される入力データ、およびタスクによって実行された処理の出力を格納するために必要なディレクトリとファイルが作成されます。これらのディレクトリとファイルは、ジョブの実行中に他のタスクから使用できます。TVM 上のすべてのタスク、ファイル、およびディレクトリは、単一のユーザー アカウントによって所有されます。

繰り返しになりますが、Batch で使用する API に応じて、ジョブとタスクの入力および出力ファイルの場所と移動に関して管理する必要がある項目の数が増減します。低レベルの Batch API を使用して開発を行う場合は、これらの依存関係とファイルの移動を明示的に指定します。Batch Apps の場合は、フレームワークによってこれらの項目のほとんどが処理されます。 

<h2 id="BKMK_Workflow_workitems">作業項目のワークフロー</h2>
図 4. に Batch API を使用して TVM のプールに計算を配布するための標準的なワークフローを示します。

![Work items workflow][work_item_workflow]

**図 4.プール内の VM に作業項目を割り当てるためのワークフロー**

1.	ジョブに必要な入力ファイル (ソース データやイメージ) を Azure ストレージ アカウントにアップロードします。これらのファイルは、Batch サービスがアクセスできるように、ストレージ アカウントに配置する必要があります。これらのファイルは、Batch サービスによってタスクの実行時に TVM に読み込まれます。
2.	依存バイナリ ファイルをストレージ アカウントにアップロードします。バイナリ ファイルとは、タスクによって実行されるプログラムと依存アセンブリを表します。これらのファイルはストレージからもアクセスできる必要があります。これらのファイルは、TVM に読み込まれます。
3.	TVM のプールを作成し、プール内の TVM のサイズ、実行する OS、およびその他のプロパティを指定します。タスクを実行すると、このプールから TVM が割り当てられます。
4.	作業項目を作成します。作業項目を作成すると、ジョブが自動的に作成されます。作業項目を使って、タスクのジョブを管理できます。
5.	ジョブにタスクを追加します。各タスクは、アップロードされたプログラムを使用して、アップロードされたファイルの情報を処理します。
6.	アプリケーションを実行し、出力の結果を監視します。

<h2 id="BKMK_Workflow_cloudapps">アプリケーションを発行および実行するためのワークフロー </h2>
図 5. は、Batch Apps API を使用してアプリケーションを発行した後、Batch によって有効になっているアプリケーションにジョブを送信するための基本的なワークフローを示しています。

![Application publishing workflow][app_pub_workflow]

**図 5.Batch Apps を使用してアプリケーションを発行および実行するためのワークフロー**

1.	**アプリケーション イメージ** (既存のアプリケーション実行可能ファイルと必要なサポート ファイルの zip ファイル) を準備します。従来のサーバー ファームまたはクラスターで実行するのと同じ実行可能ファイルを使用できる場合があります。
2.	ワークロードを呼び出して Batch サービスにディスパッチする**クラウド アセンブリ**の zip ファイルを作成します。これには、SDK を介して利用できる 2 つのコンポーネントが含まれます。

	a. **ジョブ スプリッター** - ジョブを個別に処理できるタスクに分割します。たとえば、アニメーション シナリオで、ジョブ スプリッターは、ムービー レンダリング ジョブを受け取って個々のフレームに分割します。

	b. **タスク プロセッサ** - 特定のタスクに対してアプリケーション実行可能ファイルを呼び出します。たとえば、アニメーション シナリオで、タスク プロセッサはレンダリング プログラムを起動して、タスクで指定された 1 つのフレームをレンダリングします。 

3.	Batch Apps API または開発者ツールを使用して、前の 2 つの手順で準備した zip ファイルを Azure ストレージ アカウントにアップロードします。これらのファイルは、Batch サービスがアクセスできるように、ストレージ アカウントに配置する必要があります。通常、この操作は、サービス管理者がアプリケーションごとに 1 回行います。
4.	Azure で有効になっているアプリケーション サービスにジョブを送信する方法を提供します。これには、アプリケーションの UI のプラグインや Web ポータルを使用できます。また、バックエンド システムの一部としての自動サービスを使用することもできます。SDK には、さまざまなオプションを示すサンプルが用意されています。 

	ジョブを実行するには、次の手順を実行します。

	a. ユーザーのジョブに固有の入力ファイル (ソース データやイメージ) をアップロードします。これらのファイルは、Batch サービスがアクセスできるように、ストレージ アカウントに配置する必要があります。

	b. 必要なパラメーターおよびファイルと共にジョブを送信します。
	
	c. API または Batch Apps ポータルを使用してジョブの進行状況を監視します。
	
	d. 出力をダウンロードします。
	
<h2 id="BKMK_Resources">その他のリソース</h2>

* [.NET 向け Azure Batch ライブラリの概要](http://azure.microsoft.com/ja-jp/documentation/articles/batch-dotnet-get-started/)
* [Azure Batch 開発ライブラリおよびツール](http://azure.microsoft.com/ja-jp/documentation/articles/batch-development-libraries-tools/)
* [Azure Batch REST API リファレンス](http://go.microsoft.com/fwlink/p/?LinkId=517803)
* [Azure Batch Apps REST API リファレンス](http://go.microsoft.com/fwlink/p/?LinkId=517804)

[parallel]: ./media/batch-technical-overview/parallel.png
[TVM_pool]: ./media/batch-technical-overview/TVM_pool.png
[job_task]: ./media/batch-technical-overview/job_task.png
[account_portal]: ./media/batch-technical-overview/account_portal.png
[work_item_workflow]: ./media/batch-technical-overview/work_item_workflow.png
[app_pub_workflow]: ./media/batch-technical-overview/app_pub_workflow.png

<!--HONumber=35.2-->
