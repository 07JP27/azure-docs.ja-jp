<properties linkid="develop-dotnet-performance" urlDisplayName="Performance" pageTitle="Performance best practices - Azure" metaKeywords="Azure optimization, Azure best practice performance" description="Learn about best practices for performance in Azure." metaCanonical="" services="cloud-services,sql-database,storage,service-bus,virtual-network" documentationCenter=".NET" title="" authors="robb" solutions="" manager="johndaw" editor="" />

<tags ms.service="multiple" ms.workload="multiple" ms.tgt_pltfrm="na" ms.devlang="na" ms.topic="article" ms.date="01/01/1900" ms.author="robb" />

# Azure アプリケーションのパフォーマンスに関するベスト プラクティス

このガイドでは、Azure アプリケーションのパフォーマンスを最適化するためのベスト プラクティスと手法に関する規範的なガイダンスについて説明しています。

Azure を使用する利点はたくさんあります。パフォーマンスは、Windows Azure の利点の 1 側面にしかすぎませんが、このホワイト ペーパーでは、主にパフォーマンスに焦点を当てます。パフォーマンスがそれほど重要ではないシナリオも複数あります。たとえば、Azure に物理ハードウェア管理をオフロードするシナリオや、"従量課金" の機能がより重要なシナリオがあります。このホワイト ペーパーでは、パフォーマンスの優先度が低いシナリオについては検討しません。

## 概要

パフォーマンスは、「[使用される時間とリソースに比較して、達成された有用な処理の量][使用される時間とリソースに比較して、達成された有用な処理の量]」のように定義することができます。

この定義には 2 つの側面があります。メトリックとリソースです。パフォーマンス メトリックとは、ビジネス要件を満たすために達成しなければならない数値です。応答時間、スループット、可用性などがメトリックとして数値化されます。また、パフォーマンスには、特定のレベルのパフォーマンス メトリックに達するために必要なリソース使用量も含まれます。コストは常にビジネス要件となり、リソースにはコストが発生するため、パフォーマンスを高めるには、リソースをできるだけ効率的に使用する必要があります。

### パフォーマンスのライフ サイクル

アプリケーションのライフ サイクルにおいては、2 つの点からパフォーマンスに影響を及ぼすことができます。

-   パフォーマンスに影響を及ぼす基盤のアーキテクチャを決定する、設計時。
-   ボトルネックを特定し、監視や測定などを実行する、実行時。

どちらのアクティビティも欠かすことはできません。このホワイト ペーパーでは、主に設計フェーズに焦点を当てます。アーキテクチャに関する誤りは、実行時には修正が難しいためです。

#### アプリケーションのモデリング

アプリケーションの最も重要な顧客シナリオに対してモデルを構築することが重要です。ここでいう「重要」とは、パフォーマンスに対して大きなの影響を持つ、というとです。これらのシナリオを区別し、そして必要なアプリケーション アクティビティを特定することで、概念実証テストを実行できるようになります。

#### 概念実証のパフォーマンス テスト

アプリケーションの設計と展開のフェーズにおいて、完全なエンド ツー エンドのパフォーマンス テストはクリティカルなステップです。Azure アプリケーションは多くのパーツで構成されています。Microsoft が提供するコンポーネントに加えて、カスタムビルドのコンポーネントも使用されています。Microsoft が、これらのコンポーネントすべての組み合わせに対してパフォーマンス テストを実施することはできません。したがって、どのような展開であっても、アプリケーションの完全かつ適切なパフォーマンス テストを実施することはクリティカルなステップです。

作成したモデルに基づき、次のステップとして、できるだけ早い段階でアプリケーションの概念実証テストを実施する必要があります。また、ロード テストでアプリケーション アーキテクチャを検証し、スケーラビリティと遅延の面で、そのアプリケーションがパフォーマンス要件を満たしていることを確認します。初期の段階でアーキテクチャと想定を検証することがきわめて重要です。運用を開始してから、アプリケーションが予想される負荷に耐えられないことが判明するような事態は避けなければなりません。「[Azure の Visual Studio ロード テストの概要][Azure の Visual Studio ロード テストの概要]」で説明しているように、Visual Studio にはロード テスト用の機能があります。

### Azure のパフォーマンスの特徴

Azure アプリケーションのパフォーマンスの大幅な改善は、リソースのスケール アウトとパーティション分割によって実現できます。Azure でスケーラブルなアプリケーションを作成するには、物理的なパーティション分割によるリソースのスケール アウトを活用する必要があります (SQL データベース、ストレージ、計算ノードなどのリソース)。Azure では、データ センター全体のリソースを利用でき、物理的なパーティション分割をユーザーに代わって管理します。パーティション分割によって、アプリケーション タスクを並列に実行できるようになるため、パーティション分割は高パフォーマンスの基本となります。このようなレベルの全体的なパフォーマンスを実現するには、適切なスケールアウトの設計パターンを使用する必要があります。

逆説的になりますが、Azure では、アプリケーション全体としての高パフォーマンスを実現する一方、個々の処理のパフォーマンスは、内部設置型の同等製品のパフォーマンスよりも劣ります。これは、ネットワーク待ち時間の増加、フェールオーバー処理による信頼性の強化などのためです。しかし、リソースのパーティション分割を適切に使用することで可能な並行処理によって、個々のパフォーマンスの低下を上回る利点を得られます。

### 必要な設計アクティビティ

一部のパフォーマンス要素は、アプリケーション シナリオによって変化します。次の章では、これらについて説明します。具体的には、リソースの拡張とパーティション分割、適切なデータ配置、Azure サービスの使用の最適化についてです。

その次の章では、ネットワーク待ち時間や一時接続など、Azure アプリケーションに関するパフォーマンス要素について説明します。

## クラウド環境におけるパフォーマンスのための設計

Azure アプリケーションを設計するとき、または内部設置型アプリケーションを Azure に移行するときは、シナリオに依存する次の領域について検討する必要があります。

-   リソースのスケール アウトとパーティション分割: 並列化し、高パフォーマンスを実現する上で基盤となるメカニズムです。
-   データ アーキテクチャ: アプリケーションのさまざまデータに対してどの種類のデータ ストレージを使用するかを検討します。
-   個々の Azure サービスの最適化

Azure では、リソースのスケール アウトとパーティション分割を活用することで多数のアクティビティが並列化され、最大限のパフォーマンスが実現します。この特徴は、大規模な Azure SQL データベースを見れば明らかですが、ボトルネックになる可能性があるすべてのリソースにも当てはまります。

Azure では、データ ストレージに関して次の選択肢があり、適切に選択することによって、パフォーマンスが大幅に向上します。

-   Azure SQL データベース
-   Azure Cache
-   Azure テーブル ストレージ
-   Azure BLOB ストレージ
-   Azure Drive
-   Azure キュー
-   Azure Service Bus 仲介型メッセージング
-   Hadoop などの "Big Data" ストレージ ソリューション

仕様はさまざまに異なるため、次のシナリオを対象として検討します。

-   SQL データベースを使用する Azure クラウド サービス
-   大量のストレージ キューを使用する Azure クラウド サービス
-   MySQL をバックエンド データベースとして使用する Azure Website
-   "Big Data" アプリケーション
-   MySQL バックエンド データベースを使用するアプリケーション

### シナリオ: クラウド サービスの SQL データベース

優れたデータベース設計に関する多くの原則は、Azure SQL データベースにも適用されます。効果的な SQL Server スキーマや Azure SQL データベース スキーマの設計方法を説明した資料は多数あります。SQL データベース スキーマ設計に関する参照資料は次のとおりです。

-   [Database Design and Modeling Fundamentals (データベース設計およびモデリングの基礎)][Database Design and Modeling Fundamentals (データベース設計およびモデリングの基礎)]
-   [Stairway to Database Design (データベース設計の段階)][Stairway to Database Design (データベース設計の段階)]
-   [Database Design (データベース設計)][Database Design (データベース設計)]

Azure においては異なる重要な設計アクティビティが 2 つあります。

-   適切なデータ配置: これには、一部のリレーショナル データを Azure BLOB、または Azure テーブルに適切に移動する作業が伴います。
-   最大限のスケーラビリティの確保: データをパーティション分割するか、パーティション分割する場合はその方法を決定します。

#### データ アーキテクチャ: SQL データベースからのデータの移動

内部設置型の SQL Server 上の一部のデータを、Azure 上に移動する必要があります。

##### Azure BLOB へのデータの移動

イメージやドキュメントなどの BLOB データは、SQL データベースには保存せず、Azure BLOB ストレージに保存する必要があります。このようなデータが内部設置型 SQL Server に保存されることは珍しくありませんが、クラウドでは、BLOB ストレージを使用した方が低コストです。BLOB データを取得できる状態を維持するため、一般的に、BLOB データを指す外部キーを BLOB ストレージの識別子に置換し、データを参照するクエリを変更する必要があります。

##### Azure テーブル ストレージへの SQL テーブルの移動

Azure テーブル ストレージを使用するかどうかを決定するときには、コストとパフォーマンスを検討する必要があります。テーブル ストレージは、SQL データベースに保存された同じデータよりも経済的です。ただしデータが、結合、フィルタリング、クエリなどの SQL のリレーショナル機能をどの程度使用するかを慎重に考慮する必要があります。これらの機能をほとんど使用しないデータの場合は、Azure テーブルのストレージに適しています。

テーブル ストレージの使用を検討する一般的な設計パターンの 1 つが、Adventure Works サンプル データベースの Customers テーブルのように、大部分の Customer は使用せず、ほんの少数の Customers が使用する列が多数あるテーブルの場合です。列を (CustomerMiscellany のような名前の) 2 つ目のテーブルに分割するのは、一般的な設計パターンです。必要に応じて、Customer と 2 つ目のテーブルの間に 1 対 0 のリレーションシップを定義します。2 つ目のテーブルをテーブル ストレージに移動することを検討してください。コスト効率に優れた方法を選択するには、テーブルのサイズを評価し、評価パターンについて検討する必要があります。

テーブル ストレージの詳細については、次の資料を参照してください。

-   [Azure テーブル ストレージと Azure SQL データベースの比較][Azure テーブル ストレージと Azure SQL データベースの比較]
-   [Azure Table Storage Performance Considerations (Azure テーブル ストレージ)][Azure Table Storage Performance Considerations (Azure テーブル ストレージ)]
-   [SQL データベースと Azure テーブル ストレージ][SQL データベースと Azure テーブル ストレージ]
-   [Azure テーブル ストレージ挿入のバッチ処理によるパフォーマンスの向上に関するページ][Azure テーブル ストレージ挿入のバッチ処理によるパフォーマンスの向上に関するページ]。一部のパフォーマンス結果について説明しています。
-   [SQL データベースのパフォーマンスと弾力性に関するガイド][SQL データベースのパフォーマンスと弾力性に関するガイド]

#### データのパーティション分割

最も頻繁にパーティション分割されるリソースの 1 つはデータです。Azure クラウド サービスを作成する場合、フェデレーションによって利用可能な、SQL データベースのビルトイン シャーディングを使用すること検討してください。

SQL データベースのフェデレーションの概要については、「[Windows Azure SQL データベースでのフェデレーション][Windows Azure SQL データベースでのフェデレーション]」を参照してください。

##### SQL フェデレーションのための設計タスク

Azure クラウド サービスで SQL データベースのフェデレーションを使用するには、従来の設計原理を一部変更する必要があります。ただし、内部設置型 SQL Server データベースの優れた設計に該当する原理は、SQL データベースのフェデレーションを設計するために必要な開始点です。2 つの重要な設計タスクがあり、次の項目を決定します。

-   何を統合するか

-   非フェデレーション テーブルをどこに配置するか

何を統合するかを決定するには、データベース スキーマを調査し、関連テーブルの集計を識別する必要があります。集計はテーブルのセットであり、それらのテーブルはすべて、外部キーによって 1 対多のリレーションシップに関連付けられます (集計のルートを除く)。

たとえば、AdventureWorks サンプル データベースの場合に考えられる集計の 1 つは、{Customer, Order, OrderLine, およびその他いくつか} というセットです。もう 1 つ考えられる集計の例が、{Supplier, Product, OrderLine, Order} です。

各集計がフェデレーションの候補となります。どの場所でサイズの増加が予測されるかを評価し、アプリケーションのワーク ロードを調査する必要があります。フェデレーション スキームに "よく適合する" クエリ、つまり、複数のフェデレーション メンバーからのデータを必要としないクエリは、うまく機能します。適合しない場合は、アプリケーション レベルでロジックが必要となります。現在のところ、SQL データベースでは、複数データベースの結合がサポートされていないためです。

フェデレーションのために AdventureWorks データベースについて調査し、設計に関する考慮事項を、手順をおって説明しています。設計解析の例については、「[フェデレーションを使用したデータベース設計に対するスケール優先のアプローチ: パート 1 - フェデレーションのピッキングとフェデレーション キーのピッキング][フェデレーションを使用したデータベース設計に対するスケール優先のアプローチ: パート 1 - フェデレーションのピッキングとフェデレーション キーのピッキング]」を参照してください。

フェデレーションを行うテーブルを決定したら、集計のルート テーブルのプライマリ キーを、各関連テーブルに列として追加します。

フェデレーションを行うテーブルを決定した後、次の課題は、他のデータベース オブジェクトと参照テーブルの場所です。これについては、「[フェデレーションを使用したデータベース設計に対するスケール優先のアプローチ: パート 2 - フェデレーションのスキーマの注釈とデプロイ][フェデレーションを使用したデータベース設計に対するスケール優先のアプローチ: パート 2 - フェデレーションのスキーマの注釈とデプロイ]」で詳しく説明しています。高度なクエリの実行については、[パート 2][パート 2] のページで詳しく説明しています。

##### 手動によるパーティション分割

データをパーティション分割する方法について、たくさんの例が用意されています。SQL データベース インスタンスのパーティション分割にフェデレーションを使用しない場合は、アプリケーションに対して適切なパーティション分割の方法を選択する必要があります。次に例をいくつか示します。

-   「[SQL データベースでのシャードの方法][SQL データベースでのシャードの方法]」は、フェデレーションのリリース前に書かれた包括的な説明です。
-   [SQL Server and SQL Database Shard Library (SQL Server と SQL データベースのシャード ライブラリ)][SQL Server and SQL Database Shard Library (SQL Server と SQL データベースのシャード ライブラリ)]

##### その他のリソースのパーティション分割

SQL データベース以外のリソースをパーティション分割することができます。例として、アプリケーション サーバーをパーティション分割して、特定のデータベースに専用のパーティションを作成する場合で考えてみましょう。N 個アプリケーション サーバーを含むアプリケーションがあり、データベースが N 個あるとします。各アプリケーション サーバーがそれぞれのデータベースにアクセスできる場合、使用されるデータベース接続数は N の 2 乗個となり、環境によっては Azure のハードウェアの上限に達します。ただし、各アプリケーション サーバーのデータベース数を少数に制限すれば、使用される接続数を大幅に削減できます。

アプリケーションによっては、他のリソースにも同様の考え方を適用できます。

#### Caching

Azure Caching Service は、ASP.NET セッション状態のキャッシュや、SQL データベース参照テーブルから一般的に参照される値に対して、分散型の柔軟なメモリを提供します。オブジェクトが分散型メモリに格納されるため、パフォーマンスをかなり向上させることができます。キャッシュ用のインフラストラクチャは Azure によって処理されるため、実装するときの開発コストはごくわずかです。

頻繁にアクセスされるオブジェクトをキャッシングできるように、キャッシング用の十分な容量を確保するように計画します。SQL データベースの場合、数値コードをわかりやすい長い文字列に変換するために、参照テーブルがよく使用されます。これらのテーブルには、通常、Country 名および City 名、有効な Postal Code 値、会社内の Departments 名などのデータが含まれます。小さいテーブルの場合は、テーブル全体をキャッシュに保存することが合理的です。それ以外のテーブルの場合は、最も頻繁に使用される値のみを保存するとよいでしょう。このデータに関するマルチ結合クエリでは、パフォーマンスが向上します。キャッシュにある値に関して、複数のディスク アクセスが節約されます。「[Azure Caching サービスの概要][Azure Caching サービスの概要]」は、Azure のパフォーマンスとキャッシュに関するお勧めの手引き書です。技術的な詳しい説明も記載されています。キャッシングに関する最新のブログ投稿については、「[Windows \#Azure Caching – Performance considerations (Windows \#Azure の Caching – パフォーマンスの考慮事項)][Windows \#Azure Caching – Performance considerations (Windows \#Azure の Caching – パフォーマンスの考慮事項)]」を参照してください。

#### シナリオ: Azure アプリケーションでのキューの使用

このシナリオの例では、StreamInsight を使用して、後で処理するメッセージのキューを生成します。

Azure キューはメッセージを渡すために使用されます。一時的にサブシステムの結合を解除し、負荷分散と負荷平準化を行います。

Azure には 2 種類のキュー テクノロジがあります。Azure のストレージ キューと Service Bus です。

Azure のストレージ キューには、大きなサイズのキュー、進行状況の追跡などの機能があります。サービス バスには、発行/サブスクライブ、Windows Communication Foundation (WCF) との完全統合、重複データの自動排除、先入れ先出し型 (FIFO) の配信機能などがあります。

2 つのテクノロジ全体の詳細な比較については、「[Azure キューと Azure Service Bus キューの比較][Azure キューと Azure Service Bus キューの比較]」を参照してください。

サービス バスのパフォーマンスについては、「[サービス バスで仲介型メッセージングを使用したパフォーマンス向上のヒント集][サービス バスで仲介型メッセージングを使用したパフォーマンス向上のヒント集]」を参照してください。

#### シナリオ: "Big Data" アプリケーション

「Big Data」という言葉は、他のシステムやアプリケーションの副産物を表す場合に使用されることがよくあります。たとえば、次のような文脈で使用されています。

-   Web ログ

-   他の診断、監査、および監視ファイル

-   石油会社の地震記録

-   インターネット上を渡り歩くユーザーが残すクリック データなどの情報

「Big Data」の判断基準は次のとおりです。

-   サイズ (通常は数百テラバイト以上)

-   次のコマンドを入力します。非リレーショナル、可変スキーマ、ファイル システムのファイル

この種のデータは、通常は、リレーショナル データベースでの処理に向いていません。

非 SQL データ ストレージは主に 4 つの種類があります。

-   キー値

-   ドキュメント

-   グラフ

-   列ファミリ

Azure は Hadoop を直接サポートしており、他のテクノロジも利用することができます。Azure の HDInsight サービスについては、以下の項目を参照してください。

-   [ビッグ データ][ビッグ データ]
-   [Azure HDInsight サービス][Azure HDInsight サービス]
-   [Azure HDInsight サービスの概要][Azure HDInsight サービスの概要]

さまざまな noSQL ストレージに関する話題については、以下の資料を参照してください。

-   [Azure での NoSQL の利用について][Azure での NoSQL の利用について]
-   [AggregateOrientedDatabase (集計指向のデータベース)][AggregateOrientedDatabase (集計指向のデータベース)]
-   [PolyglotPersistence (Polyglot の永続化機能)][PolyglotPersistence (Polyglot の永続化機能)]

#### Azure のその他のサービスのパフォーマンス最適化

Azure の多くのサービスには、パフォーマンスを大幅に改善できる機能や設定がそれぞれ用意されています。個別に見ていきましょう。

##### Azure Drive

Azure Drive を使用すると、既存のアプリケーションのハード ドライブ使用量をシミュレートすることができます。Windows BLOB が基盤となっているため、個々のマシンに障害が発生しても、全体的な永続性が実現します。

##### ローカル ストレージ

マシンの故障が発生したときの永続性はありませんが、頻繁にアクセスされる情報の保存や、別の場所で使用される中間的な結果の保存に使用できます。使用しても課金されないため、コスト効率に優れた方法です。

##### Azure Access Control Service (ACS)

ACS のリソース使用量とパフォーマンスに影響する 2 つの主な要素は、トークン サイズと暗号化です。詳細については、[ACS のパフォーマンスに関するガイドライン][ACS のパフォーマンスに関するガイドライン]を参照してください。

##### シリアル化

シリアル化は、パフォーマンス最適化の明確な要素ではありませんが、アプリケーション シナリオによっては、ネットワーク トラフィックを大幅に減らすことができます。シリアル化のサイズがプロトコルごとにどのように変化するかについては、「[Azure 対応の Web アプリケーションとシリアル化][Azure 対応の Web アプリケーションとシリアル化]」を参照してください。

移動するデータの量がパフォーマンス上の問題となる場合は、利用可能な最小サイズのシリアル化を使用します。シリアル化のパフォーマンスが十分でない場合は、カスタムのシリアル化形式やサード パーティのシリアル化形式を使用することを検討してください。シリアル化を使用する場合も、概念実証のパフォーマンス テストが重要です。

### MySQL を使用する Azure Website

以下のリンク先では、MySQL のパフォーマンスに関するヒントを紹介しています。

-   [][]<http://mysql.com></a> で「*パフォーマンス*」を検索すると、さまざまなリソースが表示されます。
-   [][1]<http://forums.mysql.com/list.php?24></a> のフォーラムからも、さまざまなリソースを利用できます。

## 共有システムのための設計

Azure は、フェールオーバー用に複数のマシン上に複製された複数のアプリケーションの同時実行向けに設計されています。これは、さまざまな点でアプリケーションのパフォーマンスに影響します。

-   一時接続

-   最大使用量を制限するリソース調整

-   ネットワーク待ち時間

-   サービスの物理的な場所

これらの考慮事項はすべてのアプリケーション アーキテクチャに適用されます。いずれの項目も Azure データ センターの物理インフラストラクチャによって決まるからです。詳細については、[SQL データベースのパフォーマンスと弾力性に関するガイド][2]を参照してください。

### ネットワーク待ち時間

Azure は、共有リソースのサービスベースのプラットフォームであり、2 種類の待ち時間または中断が定期的に発生します。最初の待ち時間は、要求を作成し、インターネット上で応答を受信ときにかかる時間です。これらの要求と応答は、クライアントに戻る前に多数のルーターを経由することがあり、ローカルの固定ネットワークよりもタイムアウトや切断が頻繁に発生します。2 つ目の待ち時間は、Azure のような共有リソース システムが持続性を確保するためにデータのバックアップを作成するのにかかる時間、および削除済みのインスタンスに対する要求の置換と経路変更にかかる時間です。これらの待ち時間と障害は、アプリケーションにおけるパフォーマンス要件を満たす状況を理解するにあたって重要です。実際の環境レベルでロード テストを実行すると、待ち時間に関してより多くの情報を得ることができます。

クラウド データ センターは内部設置型サーバーよりも物理的に遠い場所にあるため、これらがより重要です。

### サービスの物理的な場所

可能であれば、異なるノードまたはアプリケーション レイヤーを同一のデータ センター内に配置します。そうしないと、ネットワーク待ち時間およびコストが増加します。

たとえば、Web アプリケーションを、別のデータ センターではなく、アクセス対象の SQL データベースと同じデータ センターに、または内部設置で配置します。

### 一時接続

ドロップされた接続は、アプリケーションで処理できなければなりません。クラウド アーキテクチャの性質上、接続のドロップは避けられません (たとえば、機能停止のノードの置き換え、SQL データベースでのフェデレーション メンバーの分割などの操作で接続がドロップされます)。現時点での最適なフレームワークは、[Transient Fault Handling Application Block (一時的なエラー処理アプリケーション ブロック)][Transient Fault Handling Application Block (一時的なエラー処理アプリケーション ブロック)] です。

### 調整

サービスの世界では、リソースは細分化が進んでおり、ユーザーは必要なサービスにのみ料金を支払います。ただし、いずれのリソースも、サイズ、速度、またはスループット (たとえば、特定のサイズより大きいデータベースを使用する場合に重要です) について最小限の保証が存在します。一方で、重要なサービスには上限が設けられていることがあります。Azure アプリケーションは他のアプリケーションと共有の環境で実行されるため、Azure は、多数のリソース調整を適用します。これを考慮する必要があります。リソースの調整限度を超えると、リソースに対する以降の要求では、例外が発生します。

### 物理容量

パフォーマンス計画の必須項目の 1 つが、容量計画です。各種のストレージを十分に提供できない場合、アプリケーションはまったく機能しません。メモリやプロセッサが不十分な場合と同様、容量の不足はアプリケーションの実行速度を大幅に低下させます。

Azure は、容量計画に関する作業を劇的に減少させます。従来からある多くのアクティビティ (特にコンピューターの取得とプロビジョニング) は劇的に変化しているからです。Azure の容量計画では、コンピューティングの物理要素はもはや重要ではありません。その代わりに、より抽象的なレベルで、次の項目がそれぞれいくつ必要であるかを検討します。

-   計算ノード
-   BLOB ストレージ
-   テーブル ストレージ
-   キューなど

Azure はスケーラビリティに優れているため、初期の容量決定が確定となるわけではありません。Azure リソースの拡張/縮小は比較的簡単です。とはいうものの、容量計画は正確に行うことが重要です。アプリケーションの運用を開始するときに、容量について試行錯誤する時間はないからです。

時間の経過と共にリソースを増減する必要があるアプリケーションについては、[オートスケーリング アプリケーション ブロック][オートスケーリング アプリケーション ブロック]の使用を検討してください。このブロックでは、ロール インスタンスの拡張/縮小に関するルールを設定できます。次の 2 種類のルールを設定します。

-   時間内のインスタンスの最大/最小数を設定する制約規則

-   CPU 使用率などの条件に従って有効になるリアクティブ規則

カスタム ルールも定義できます。詳細については、[オートスケーリング アプリケーション ブロック][オートスケーリング アプリケーション ブロック]のページを参照してください。

容量計画には、独自の専門知識が必要です。このホワイト ペーパーでは、容量計画は作成済みであることを前提としています。Azure の容量計画の詳細については、「[Service Bus のキューおよびトピックのキャパシティ プランニング][Service Bus のキューおよびトピックのキャパシティ プランニング]」を参照してください。

## 実行時のパフォーマンス監視およびチューニング

どれほど慎重に設計しても、実行時に発生するパフォーマンスの問題をゼロにすることはできません。そのため、アプリケーション パフォーマンスを継続的に監視して、所定のパフォーマンス メトリックを達成していることを確認し、未達の場合は状況を修正する必要があります。適切に設計されたアプリケーションであっても、使用量の急増などの予測できないイベントが発生したり、実行時の環境が変更することがあり、その結果、チューニングが必要なパフォーマンスの問題が発生します。多くの場合、ボトルネックの特定と解決は、このプロセスにおいて重要です。

実行時に発生するパフォーマンスの問題をトラブルシューティングするには、ログを作成し、例外を適切に処理するための事前作業が必要です。問題が発生した時点でトラブルシューティングできるようにします。この領域に関する包括的な手順については、[Azure アプリケーション開発のトラブルシューティングに関するベスト プラクティスのページ][Azure アプリケーション開発のトラブルシューティングに関するベスト プラクティスのページ]を参照してください。

すべての Azure サービスのパフォーマンスを継続的に監視できるツールがあります。ログに加えて、トラブルシューティングおよびパフォーマンスの問題を解決するのに必要な詳細情報を提供するアプリケーションを施設に導入する必要があります。

### SQL Database

現時点では、Azure では SQL Profiler を使用できません。必要なパフォーマンス情報を得るための代替方法は複数あります。1 つは、開発中に、SQL Profiler が利用できるデータベースの内部設置型バージョンで初期テストを実施する方法です。

Transact-SQL コマンド SET STATISTICS を使用し、SQL Server Management Studio で、クエリによって生成された実行プランを表示する方法です。効率的なクエリをコーディングすることは、パフォーマンスにとって重要であるからです。詳細な説明と手順については、[SQL データベースのパフォーマンスに関する考察のページ][SQL データベースのパフォーマンスに関する考察のページ]を参照してください。もう 1 つの興味深い方法は、[内部設置型 SQL データベースと SQL Server][内部設置型 SQL データベースと SQL Server] 間のパフォーマンスを分析する方法です。

動的管理ビューについては次の 2 つのトピックを参照してください。

-   [動的管理ビューを使用した Windows Azure SQL データベースの監視][動的管理ビューを使用した Windows Azure SQL データベースの監視]
-   [SQL Profiler がない場合に SQL データベースを分析するのに便利な DMV][SQL Profiler がない場合に SQL データベースを分析するのに便利な DMV]

### 分析リソースとツール

さまざまなサード パーティから Azure のパフォーマンス監視用ツールが提供されています。

-   [Cerebrata][Cerebrata]
-   [SQL Server および SQL データベースのパフォーマンスのテスト:Enzo SQL Baseline][SQL Server および SQL データベースのパフォーマンスのテスト:Enzo SQL Baseline]

その他のリソース

-   [SQL データベースのパフォーマンスと弾力性に関するガイド][2]
-   [SQL Database][SQL Database]
-   [ストレージ][ストレージ]
-   [ネットワーク][ネットワーク]
-   [Service Bus][Service Bus]
-   [Azure のプランニング – 既存環境への Azure の統合に関する意思決定後のガイド][Azure のプランニング – 既存環境への Azure の統合に関する意思決定後のガイド]

  [使用される時間とリソースに比較して、達成された有用な処理の量]: http://go.microsoft.com/fwlink/?LinkId=252650
  [Azure の Visual Studio ロード テストの概要]: http://www.visualstudio.com/get-started/load-test-your-app-vs
  [Azure テーブル ストレージと Azure SQL データベースの比較]: http://msdn.microsoft.com/ja-jp/library/jj553018.aspx
  [SQL データベースと Azure テーブル ストレージ]: http://go.microsoft.com/fwlink/?LinkId=252664
  [Azure テーブル ストレージ挿入のバッチ処理によるパフォーマンスの向上に関するページ]: http://go.microsoft.com/fwlink/?LinkID=252665
  [SQL データベースのパフォーマンスと弾力性に関するガイド]: http://go.microsoft.com/fwlink/?LinkId=221876
  [Windows Azure SQL データベースでのフェデレーション]: http://go.microsoft.com/fwlink/?LinkId=252668
  [フェデレーションを使用したデータベース設計に対するスケール優先のアプローチ: パート 1 - フェデレーションのピッキングとフェデレーション キーのピッキング]: http://go.microsoft.com/fwlink/?LinkId=252671
  [フェデレーションを使用したデータベース設計に対するスケール優先のアプローチ: パート 2 - フェデレーションのスキーマの注釈とデプロイ]: http://go.microsoft.com/fwlink/?LinkId=252672
  [パート 2]: http://go.microsoft.com/fwlink/?LinkId=252673
  [SQL データベースでのシャードの方法]: http://go.microsoft.com/fwlink/?LinkId=252678
  [Azure Caching サービスの概要]: http://go.microsoft.com/fwlink/?LinkId=252680
  [Azure キューと Azure Service Bus キューの比較]: http://go.microsoft.com/fwlink/?LinkId=252682
  [サービス バスで仲介型メッセージングを使用したパフォーマンス向上のヒント集]: http://go.microsoft.com/fwlink/?LinkID=252683
  [ビッグ データ]: /ja-jp/solutions/big-data/
  [Azure HDInsight サービス]: /ja-jp/documentation/services/hdinsight/
  [Azure HDInsight サービスの概要]: /ja-jp/documentation/articles/hdinsight-get-started/
  [Azure での NoSQL の利用について]: http://go.microsoft.com/fwlink/?LinkId=252729
  [ACS のパフォーマンスに関するガイドライン]: http://go.microsoft.com/fwlink/?LinkId=252747
  [Azure 対応の Web アプリケーションとシリアル化]: http://go.microsoft.com/fwlink/?LinkId=252749
  []: http://go.microsoft.com/fwlink/?LinkId=252775
  [1]: http://go.microsoft.com/fwlink/?LinkId=252776
  [2]: http://go.microsoft.com/fwlink/?LinkID=252666
  [オートスケーリング アプリケーション ブロック]: http://go.microsoft.com/fwlink/?LinkId=252873
  [Service Bus のキューおよびトピックのキャパシティ プランニング]: http://go.microsoft.com/fwlink/?LinkId=252875
  [Azure アプリケーション開発のトラブルシューティングに関するベスト プラクティスのページ]: http://go.microsoft.com/fwlink/?LinkID=252876
  [SQL データベースのパフォーマンスに関する考察のページ]: http://go.microsoft.com/fwlink/?LinkId=252877
  [内部設置型 SQL データベースと SQL Server]: http://go.microsoft.com/fwlink/?LinkId=252878
  [動的管理ビューを使用した Windows Azure SQL データベースの監視]: http://go.microsoft.com/fwlink/?LinkId=236195
  [SQL Profiler がない場合に SQL データベースを分析するのに便利な DMV]: http://go.microsoft.com/fwlink/?LinkId=252879
  [Cerebrata]: http://go.microsoft.com/fwlink/?LinkId=252880
  [SQL Server および SQL データベースのパフォーマンスのテスト:Enzo SQL Baseline]: http://enzosqlbaseline.codeplex.com/
  [SQL Database]: http://go.microsoft.com/fwlink/?LinkId=246930
  [ストレージ]: http://go.microsoft.com/fwlink/?LinkId=246933
  [ネットワーク]: http://go.microsoft.com/fwlink/?LinkId=252882
  [Service Bus]: http://go.microsoft.com/fwlink/?LinkId=246934
  [Azure のプランニング – 既存環境への Azure の統合に関する意思決定後のガイド]: http://go.microsoft.com/fwlink/?LinkId=252884
