<properties
   pageTitle="Azure Backup - Azure Import/Export サービスを使用したオフライン バックアップまたは初期シード処理 | Microsoft Azure"
   description="Azure Backup の Azure Import/Export サービスを使用してネットワークからデータを送信する方法について説明します。この記事では、Azure Import Export サービスの使用による初期バックアップ データのオフライン シード処理について説明します。"
   services="backup"
   documentationCenter=""
   authors="saurabhsensharma"
   manager="shivamg"
   editor=""/>
<tags
   ms.service="backup"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="storage-backup-recovery"
   ms.date="08/16/2016"
   ms.author="jimpark;saurabhsensharma;nkolli;trinadhk"/>

# Azure Backup でのオフライン バックアップのワークフロー
Azure Backup はさまざまな面で効率性に優れ、Azure への初回 "完全" バックアップ中に、ネットワークとストレージのコストを抑えます。初回 "完全" バックアップでは、通常、大量のデータが転送されます。このため、その後の差分/増分のみを転送するバックアップと比べると、多くのネットワーク帯域幅が必要です。Azure バックアップでは、初回バックアップを圧縮するだけではありません。オフライン シード処理プロセスにより、圧縮された初回バックアップ データを、オフラインでディスクから Azure にアップロードするメカニズムも用意されています。

Azure Backup のオフライン シード処理プロセスは [Azure Import/Export サービス](../storage/storage-import-export-service.md)と緊密に統合されており、ディスクを使用して、データを Azure にすばやく転送できます。待ち時間が長く、低帯域幅のネットワークで転送する必要がある数テラバイトの初回バックアップ データがある場合は、オフライン シード処理ワークフローを使用して、1 台以上のハード ドライブ上にある初回バックアップ コピーを Azure データ センターに発送できます。この記事では、このワークフローを完了するのに必要な手順の概要について説明します。

## Overview

Azure Backup のオフライン シード処理機能と Azure Import/Export を使用すると、オフラインでディスクから Azure に簡単にデータをアップロードできます。ネットワーク経由で完全な初期コピーを転送する代わりに、*ステージング場所*にバックアップ データを書き込みます。"*ステージング場所*" への初回コピーが完了すると、このデータは、"*Azure Import/Export ツール*" を使用して、初回バックアップのサイズに応じて 1 台以上の SATA ドライブに書き込まれ、最終的には、このドライブが、最も近くにある Azure データ センターに最終的に発送されます。

[Azure Backup の更新プログラム 2016 年 8 月 (以降)](http://go.microsoft.com/fwlink/?LinkID=229525&clcid=0x409) には、**AzureOfflineBackupDiskPrep** という名前の "*Azure Disk Preparation ツール*" が付属しています。このツールでは、次の操作を行うことができます。

   - Azure Import/Export ツールを使用して、Azure インポート用ドライブを容易に準備できるようサポートする
   - [Azure クラシック ポータル](https://manage.windowsazure.com)で、Azure Import/Export サービスの Azure インポート ジョブを自動的に作成する。以前の Azure Backup では手動で作成する必要がありました

Azure へのバックアップ データのアップロードが完了したら、Azure Backup はバックアップ データをバックアップ資格情報コンテナーにコピーし、増分バックアップをスケジュールします。

  > [AZURE.NOTE] Azure Disk Preparation ツールを使用するには、Azure Backup の更新プログラム 2016 年 8 月 (以降) を確実にインストールしておきます。ワークフローの手順はすべて、その更新プログラムを使用して実行します。以前の Azure Backup を使用している場合、"*Azure Import/Export ツール*" で SATA ドライブを準備する方法については、この記事の後のセクションで詳しく説明します。

## 前提条件

1. Azure Import/Export のワークフローを理解することが重要です (詳しくは[こちら](../storage/storage-import-export-service.md)をご覧ください)。
2. ワークフローを開始する前に、Azure Backup 資格情報コンテナーの作成、資格情報コンテナーの資格情報のダウンロード、Windows Server、Windows クライアント、または System Center Data Protection Manager (SCDPM) サーバーへの Azure Backup エージェントのインストール、および Azure Backup 資格情報コンテナーへのコンピューター登録が完了していることを確認します。
3. データをバックアップするコンピューターで、[こちら](https://manage.windowsazure.com/publishsettings)から Azure 発行ファイル設定をダウンロードします。
4. "*ステージング場所*" を準備します。これは、コンピューター上のネットワーク共有や追加ドライブにすることができます。ステージング場所は "一時ストレージ" であり、このワークフロー中に一時的に使用されます。ステージング場所には、初期コピーを保持するのに十分なディスク領域があることを確認します。たとえば、500 GB のファイル サーバーをバックアップする場合は、ステージング領域が 500 GB 以上あることを確認します (圧縮されているため、使用量はこれよりも少なくなります)。
5. 1 つまたは複数の 3.5 インチ SATA II/III 内部ハード ドライブ。Azure Import/Export サービスで使用できるのは、3.5 インチ SATA II/III 内部ハード ドライブだけです。10 TB を超えるハード ドライブはサポートされていません。これらのハード ドライブは、互換性のある SATA コネクタを使用して内部に接続するか、SATA II/III USB アダプターを使用して外部に接続することができます。サービスでサポートされている最新のハードドライブと SATA USB アダプターについては、[Azure Import/Export のドキュメント](../storage/storage-import-export-service.md)をご確認ください。
6. SATA ドライブ ライターが接続されているコンピューターで BitLocker を有効にします。
7. [こちら](http://go.microsoft.com/fwlink/?LinkID=301900&clcid=0x409)から、SATA ドライブ ライターが接続されているコンピューターに Azure Import/Export ツールをダウンロードします。Azure Backup の更新プログラム 2016 年 8 月 (以降) をインストールした場合、この手順は不要です。

## ワークフロー
このセクションで提供される情報は、**オフライン バックアップ** ワークフローを完了するためのものなので、このデータを Azure データ センターに配信したり、Azure Storage にアップロードしたりできます。インポート サービスやプロセスの他の側面について質問がある場合は、上記で参照した[インポート サービスの概要](../storage/storage-import-export-service.md)をご覧ください。

### オフライン バックアップを開始する

1. バックアップのスケジュール設定の一部として、次の画面が表示されます (Windows Server、Windows クライアント、SCDPM 上)。

    ![インポート画面](./media/backup-azure-backup-import-export/offlineBackupscreenInputs.png)
    
    SCDPM の対応する画面は、次のように表示されます。<br/> ![DPM のインポート画面](./media/backup-azure-backup-import-export/dpmoffline.png)

    この画面では、次の内容を入力します。

    - **ステージング場所** - 初回バックアップ コピーが書き込まれる一時的なストレージの場所です。これは、ネットワーク共有やローカル コンピューターにすることができます。"*コピー用コンピューター*" と "*ソース コンピューター*" が異なる場合は、ステージング場所の完全なネットワーク パスを指定することをお勧めします。
    - **Azure インポート ジョブ名** - ディスクを使用して Azure に送信されたデータを、Azure インポート サービスと Azure Backup が追跡するときに使用する一意の名前です。
    - **Azure 発行設定** - サブスクリプション プロファイルに関する情報が含まれる XML ファイル。サブスクリプションに関連付けられている、セキュリティで保護された資格情報も含まれています。このファイルは[こちら](https://manage.windowsazure.com/publishsettings)からダウンロードできます。発行設定ファイルへのローカル パスを指定します。
    - **Azure サブスクリプション ID** - Azure インポート ジョブを開始する Azure サブスクリプション ID。複数の Azure サブスクリプションを使用している場合は、インポート ジョブに関連付ける ID を使用します。
    - **Azure ストレージ アカウント** - 指定された Azure サブスクリプションの "クラシック" タイプのストレージ アカウント。Azure インポート ジョブに関連付けられます。
    - **Azure ストレージ コンテナー** - このジョブのデータをインポートする先の Azure ストレージ アカウントのストレージ BLOB の名前。
    
    > [AZURE.NOTE] バックアップの[新しい Azure ポータル](https://ms.portal.azure.com)から Recovery Services コンテナーにサーバーを登録した場合、クラウド サービス プロバイダー (CSP) サブスクリプションがないときは、引き続き新しい Azure ポータルから "クラシック" タイプのストレージ アカウントを作成して、オフライン バックアップ ワークフローで使用できます。
    
    この情報は後の手順で再入力する必要があるため、すべて別に保存しておいてください。"*Azure Disk Preparation ツール*" を使用してディスクを準備する場合は、"*ステージング場所*" のみが必須です
    

2. ワークフローが完了したら、Azure Backup 管理コンソールで **[今すぐバックアップ]** を選択して、オフラインのバックアップ コピーを開始します。初期バックアップが、この手順の一部としてステージング領域に書き込まれます。

    ![今すぐバックアップ](./media/backup-azure-backup-import-export/backupnow.png)
    
    **[保護グループ]** を右クリックし、**[回復ポイントの作成]** オプションを選択して、SCDPM の対応するワークフローを有効にします。次に、**[オンライン保護]** オプションを選択します。

    ![DPM の今すぐバックアップ](./media/backup-azure-backup-import-export/dpmbackupnow.png)

    操作が完了すると、ステージング場所を使用して、ディスクを準備できるようになります

    ![出力](./media/backup-azure-backup-import-export/opbackupnow.png)

###"*Azure Disk Preparation ツール*" での SATA ドライブの準備と Azure インポート ジョブの作成
"*Azure Disk Preparation ツール*" は、次のパスにある Microsoft Azure Recovery Services エージェント (更新プログラム 2016年 8 月以降) のインストール ディレクトリで使用できます。

   *\\Microsoft* *Azure* *Recovery* *Services* *Agent\\Utils*

1. このディレクトリに移動し、**AzureOfflineBackupDiskPrep** ディレクトリを、準備するドライブがマウントされている "*コピー用コンピューター*" にコピーします。"*コピー用コンピューター*" について、次を確認します

      - "*コピー用コンピューター*" が、**オフライン バックアップの開始**ワークフロー中に指定されたネットワーク パスを使用して、オフライン シード処理ワークフローに対して指定された "*ステージング場所*" にアクセスできる
      
      - コンピューターで BitLocker が有効になっている。
      
      - コンピューターが Azure ポータルにアクセスできる
      
      必要に応じて、"*コピー用コンピューター*" を "*ソース コンピューター*" と同じにすることができます。

2. コピー用コンピューターで、Azure Disk Preparation ツールのディレクトリを現在のディレクトリとして使用して管理者特権のコマンド プロンプトを開き、次のコマンドを実行します

      *.\\AzureOfflineBackupDiskPrep.exe* s:<*ステージング場所のパス*> [p:<*PublishSettingsFile へのパス*>]

| パラメーター | Description
|-------------|-------------|
|s:<*ステージング場所のパス*> | 必須。オフライン バックアップを開始するときに入力したステージング場所へのパスを指定します |
|p:<*PublishSettingsFile へのパス*> | オプション。オフライン バックアップを開始するときに入力した発行設定ファイルへのパスを指定します |

   > [AZURE.NOTE] "*コピー用コンピューター*" と "*ソース コンピューター*" が異なる場合は、発行設定ファイルを必ず入力する必要があります

コマンドの実行時に、準備する必要があるドライブに対応する Azure インポート ジョブを選択するよう求められます。指定されたステージング場所に関連付けられているインポート ジョブが 1 つだけの場合は、次のような画面が表示されます。

   ![Azure Disk Preparation ツールの入力](./media/backup-azure-backup-import-export/azureDiskPreparationToolDriveInput.png) <br/>
3. Azure への転送を準備する、マウント済みディスクの**ドライブ文字**を入力します (末尾のコロンを除く)。その後、メッセージが表示されたら、ドライブをフォーマットすることを確認します。

これにより、バックアップ データでのディスクの準備が開始されます。用意されたディスクに、バックアップ データを格納するための領域が十分にない場合は、メッセージが表示されるので、追加のディスクをアタッチする必要があります。<br/>

ツールが適切に実行されたら、指定した 1 つ以上のディスクを Azure に発送する準備は完了です。Azure クラシック ポータルには、**オフライン バックアップの開始**ワークフローで指定した名前のインポート ジョブが作成されます。また、ディスクの送付先 Azure データセンターの住所と、Azure クラシック ポータルでインポート ジョブを特定するためのリンクも表示されます。

   ![Azure Disk Preparation の完了](./media/backup-azure-backup-import-export/azureDiskPreparationToolSuccess.png)<br/>
4. 表示された住所にディスクを発送し、後で参照できるように追跡番号を控えておきます。<br/>
5. 表示されたリンクに移動すると、オフライン バックアップ ワークフロー中に指定した **Azure ストレージ アカウント**が表示されます。このストレージ アカウントの **[インポート/エクスポート]** タブで、新しく作成されたインポート ジョブを確認できます

   ![作成したインポート ジョブ](./media/backup-azure-backup-import-export/ImportJobCreated.png)<br/>
6. ページ下部の **[発送情報]** をクリックすると、次に示すように、**[連絡先の詳細]** が更新されます。インポート ジョブが完了したら、Microsoft ではこの情報を使用してディスクを返送します。

   ![連絡先情報](./media/backup-azure-backup-import-export/contactInfoAddition.PNG)<br/>
7. 次に、以下に示す **[発送の詳細]** 画面が表示されます。[配送業者] と [追跡番号] に、Azure データセンターに発送したディスクの詳細情報を入力します
   
   ![発送情報](./media/backup-azure-backup-import-export/shippingInfoAddition.PNG)<br/>

### ワークフローの完了
インポート ジョブが完了すると、初回バックアップ データをストレージ アカウントで使用できます。その後、Microsoft Azure Recovery Services エージェントは、データの内容を、このアカウントから、使用可能なバックアップ コンテナーまたは Recovery Services コンテナーにコピーします。次回のスケジュール バックアップでは、Azure Backup エージェントは、初回バックアップ コピーに対する増分バックアップを実行します。


> [AZURE.NOTE] 以降のセクションは、"*Azure Disk Preparation ツール*" にアクセスしない以前の Azure Backup のユーザーに適用されます

### SATA ドライブを準備する

1. [Microsoft Azure Import/Export ツール](http://go.microsoft.com/fwlink/?linkid=301900&clcid=0x409)を*コピー用コンピューター*にダウンロードします。ステージング場所 (前の手順の) が、次の一連のコマンドを実行するコンピューターからアクセスできることを確認します。必要に応じて、コピー用コンピューターはソース コンピューターと同じにすることができます。

2. *WAImportExport.zip* ファイルを解凍します。*WAImportExport* ツールを実行すると、SATA ドライブがフォーマットされ、SATA ドライブにバックアップ データが書き込まれて暗号化されます。次のコマンドを実行する前に、BitLocker がコンピューターで有効になっていることを確認します。<br/>

    *.\\WAImportExport.exe PrepImport* /j:<*ジャーナル ファイル*>.jrn /id: <*セッション ID*> /sk:<*ストレージ アカウント キー*> /BlobType:*PageBlob* /t:<*ターゲット ドライブ文字*> /format /encrypt /srcdir:<*ステージング場所*> /dstdir: <*コピー先 BLOB 仮想ディレクトリ*>/
    
    > [AZURE.NOTE] Azure Backup の更新プログラム 2016 年 8 月 (以降) をインストールした場合は、入力された "*ステージング場所*" が、**[今すぐバックアップ]** 画面に表示されているものと同じであること、また、このステージング場所に *AIB* と "*基本 BLOB*" が含まれていることを確認します。

| パラメーター | Description
|-------------|-------------|
| /j:<*ジャーナル ファイル*>| ジャーナル ファイルへのパス。各ドライブには、ジャーナル ファイルが必ず 1 つあります。ターゲット ドライブには、ジャーナル ファイルは存在しません。ジャーナル ファイルの拡張子は .jrn で、このコマンドの実行の一部として作成されます。|
|/id:<*セッション ID*> | セッション ID は*コピー セッション*を識別します。中断されたコピー セッションを正しく復元するために使用されます。コピー セッションでコピーされるファイルは、ターゲット ドライブ上のセッション ID の名前が付いたディレクトリに格納されます。|
| /sk:<*ストレージ アカウント キー*> | データのインポート先ストレージ アカウントのアカウント キー。キーは、バックアップ ポリシー/保護グループ作成時に入力されたものと同じにする必要があります。|
| /BlobType | **PageBlob** を指定します。このワークフローは、PageBlob オプションが指定されている場合にのみ成功します。これは既定のオプションではありません。このコマンドに記述する必要があります。 |
|/t:<*ターゲット ドライブ文字*> | 現在のコピー セッションのターゲットのハード ドライブのドライブ文字 (後ろにコロンが続きません)。|
|/format | ドライブをフォーマットする必要がある場合は、このパラメーターを指定します。それ以外の場合は省略します。ツールがドライブをフォーマットする前に、コンソールから確認を求めるメッセージが表示されます。確認メッセージを非表示にするには、/silentmode パラメーターを指定します。|
|/encrypt | ドライブが BitLocker で暗号化されていないため、ツールで暗号化する必要がある場合は、このパラメーターを指定します。ドライブが既に BitLocker で暗号化されている場合は、このパラメーターを省略して /bk パラメーターを指定し、既存の BitLocker キーを入力します。/format パラメーターを指定する場合も、/encrypt パラメーターを指定する必要があります。 |
|/srcdir:<*ソース ディレクトリ*> | ターゲット ドライブにコピーされるファイルを含むソース ディレクトリ。ここで指定するディレクトリ名が (相対パスではなく) 完全パスであることを確認してください。|
|/dstdir:<*コピー先 BLOB 仮想ディレクトリ*> | Microsoft Azure ストレージ アカウントのコピー先の仮想ディレクトリへのパス。コピー先の仮想ディレクトリや BLOB を指定する場合は、有効なコンテナー名を使用してください。コンテナー名は小文字にする必要があります。このコンテナー名は、バックアップ ポリシー/保護グループ作成時に入力されたものと同じにする必要があります。|

  > [AZURE.NOTE] ジャーナル ファイルは WAImportExport フォルダーに作成され、ワークフロー全体の情報を収集します。このファイルは、Azure ポータルでインポート ジョブを作成するときに必要です。

  ![PowerShell の出力](./media/backup-azure-backup-import-export/psoutput.png)

### Azure ポータルでインポート ジョブを作成する
1. [Azure クラシック ポータル](https://manage.windowsazure.com/)でストレージ アカウントに移動し、作業ウィンドウで **[Import/Export]**、**[インポート ジョブの作成]** の順にクリックします。

    ![ポータル](./media/backup-azure-backup-import-export/azureportal.png)

2. ウィザードの手順 1 で、ドライブの準備ができており、ドライブのジャーナル ファイルが使用可能であることを示します。ウィザードのステップ 2. で、このインポート ジョブの担当者の連絡先情報を入力します。
3. ステップ 3. で、前のセクションで取得したドライブのジャーナル ファイルをアップロードします。
4. 手順 4 では、バックアップ ポリシー/保護グループ作成時に入力されたインポート ジョブにわかりやすい名前を入力します。名前に含めることができるのは、アルファベットの小文字、数字、ハイフン、アンダースコアだけです。また、先頭の文字はアルファベットにします。スペースを含めることはできません。選択した名前を使って、ジョブの進行中だけでなく完了後も、そのジョブを追跡します。
5. 次に、データ センターのリージョンを一覧から選択します。データ センターのリージョンに、パッケージの発送先となるデータ センターとその住所が示されます。

    ![DC](./media/backup-azure-backup-import-export/dc.png)

6. ステップ 5. で、返送に利用する宅配業者を一覧から選択し、業者のアカウント番号を入力します。マイクロソフトでは、インポート ジョブの完了後、このアカウントを使用してドライブを返送します。

7. ディスクを発送して問い合わせ番号を入力し、出荷の状態を追跡します。ディスクがデータ センターに到着すると、ストレージ アカウントにコピーされ、状態が更新されます。

    ![完了状態](./media/backup-azure-backup-import-export/complete.png)

### ワークフローの完了
ストレージ アカウントで初回バックアップ データが使用可能になると、Microsoft Azure Recovery Services エージェントは、データの内容を、このアカウントから、使用可能なバックアップ コンテナーまたは Recovery Services コンテナーにコピーします。次回のスケジュール バックアップで、Azure Backup エージェントは初期バックアップ コピーの上に増分バックアップを実行します。

## 次のステップ
- Azure Import/Export ワークフローに関するご質問は、こちらの[記事](../storage/storage-import-export-service.md)をご覧ください。
- ワークフローに関するご質問は、Azure Backup [FAQ](backup-azure-backup-faq.md) のオフライン バックアップのセクションをご覧ください。

<!---HONumber=AcomDC_0824_2016-->