<properties
   pageTitle="Azure Backup - Azure Import/Export サービスを使用したオフライン バックアップまたは初期シード処理 | Microsoft Azure"
   description="Azure Backup の Azure Import/Export サービスを使用してネットワークからデータを送信する方法について説明します。この記事では、Azure Import Export サービスの使用による初期バックアップ データのオフライン シード処理について説明します。"
   services="backup"
   documentationCenter=""
   authors="Jim-Parker"
   manager="jwhit"
   editor=""/>
<tags
   ms.service="backup"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="storage-backup-recovery"
   ms.date="01/28/2016"
   ms.author="jimpark;"/>

# Azure Backup でのオフライン バックアップのワークフロー
Azure Backup はさまざまな面で効率性に優れ、ネットワークとストレージのコストを抑えます。Azure Backup はデータを圧縮するだけでなく、一度だけ全コンテンツをバックアップし、その後は差分/増分をバックアップするという作業も行います。そのため、10TB ファイル ボリュームがバックアップされている場合、Azure Backup は初期レプリケーション (IR) として 10TB を送信し、差分レプリケーションとして差分のみを送信します。そのため、IR の際に最大 WAN 帯域幅が必要になります。IR で WAN の依存関係を減らすために、Azure Backup は Azure Import/Export サービスによるオフライン バックアップをサポートします。

Azure Backup は Azure Import/Export サービスと密接に統合されており、初期バックアップ データをすばやく転送できます。待ち時間が長く、低帯域幅のネットワークで転送する必要がある数テラバイトの初期バックアップ データがある場合は、Azure Import/Export サービスを使用して、1 つ以上のハード ドライブ上にある初期バックアップ コピーを Azure データ センターに発送できます。この記事では、このワークフローを完了するのに必要な手順の概要について説明します。

## 概要

Azure Backup と Azure Import/Export を使用すると、オフラインでディスクから Azure に簡単にデータをアップロードできます。ネットワーク経由で完全な初期コピーを転送する代わりに、*ステージング場所*にバックアップ データを書き込みます。ステージング場所は、直接接続されたストレージやネットワーク共有にすることができます。初期コピーが完了すると、このデータは *Azure Import/Export ツール*を使用して SATA ドライブに書き込まれ、最終的に Azure データ センターに発送されます。初期バックアップのサイズによっては、この操作を完了するのに 1 つ以上の SATA ドライブが必要な場合があります。Azure Import/Export ツールは、これらのシナリオを説明します。バックアップがディスクに書き込まれると、Azure にアップロードするために最も近いデータ センターの場所に発送されます。Azure Backup はバックアップ データをバックアップ資格情報コンテナーにコピーし、増分バックアップをスケジュールします。

## 前提条件

1. Azure Import/Export のワークフローを理解することが重要です (詳しくは[こちら](../storage/storage-import-export-service.md)をご覧ください)。
2. ワークフローを開始する前に、Azure Backup 資格情報コンテナーが作成され、資格情報コンテナーの資格情報がダウンロードされ、Azure Backup エージェントが Windows Server、Windows クライアント、System Center Data Protection Manager (SCDPM) サーバーのいずれかにインストールされ、Azure Backup 資格情報コンテナーにコンピューターが登録されていることを確認します。
3. データをバックアップするコンピューターで、[こちら](https://manage.windowsazure.com/publishsettings)から Azure 発行ファイル設定をダウンロードします。
4. *ステージング場所*を準備します。これは、コンピューター上のネットワーク共有や追加ドライブにすることができます。ステージング場所には、初期コピーを保持するのに十分なディスク領域があることを確認します。たとえば、500 GB のファイル サーバーをバックアップする場合は、ステージング領域が 500 GB 以上あることを確認します (これより少ない領域が使用されます)。ステージング領域は '一時ストレージ' であり、このワークフロー中に一時的に使用されます。
5. 外部 SATA ドライブ ライター、外部 3.5 インチ SATA ドライブ。Import/Export サービスで使用できるのは、3.5 インチ SATA II/III ハード ドライブだけです。8 TB を超えるハード ドライブはサポートされていません。大部分のコンピューターには、SATA II/III ディスクを SATA II/III USB アダプターで外部接続できます。サービスでサポートされている最新のドライブについては、Azure Import/Export のドキュメントをご確認ください。
6. SATA ドライブ ライターが接続されているコンピューターで BitLocker を有効にします。
7. [こちら](http://go.microsoft.com/fwlink/?LinkID=301900&clcid=0x409)から、SATA ドライブ ライターが接続されているコンピューターに Azure Import/Export ツールをダウンロードします。

## ワークフロー
このセクションで提供される情報は、**オフライン バックアップ** ワークフローを完了するためのものなので、このデータを Azure データ センターに配信したり、Azure Storage にアップロードしたりできます。インポート サービスやプロセスの他の側面について質問がある場合は、上記で参照した[インポート サービスの概要](../storage/storage-import-export-service.md)をご覧ください。

### オフライン バックアップを開始する

1. バックアップのスケジュール設定の一部として、次の画面が表示されます (Windows Server、Windows クライアント、SCDPM 上)。

    ![インポート画面](./media/backup-azure-backup-import-export/importscreen.png)

    SCDPM の対応する画面は、次のように表示されます。<br/> ![DPM のインポート画面](./media/backup-azure-backup-import-export/dpmoffline.png)

    各値の説明:

    - **ステージング場所** - これは、初期バックアップ コピーが書き込まれる一時的なストレージの場所を参照します。これは、ネットワーク共有やローカル コンピューターにすることができます。
    - **Azure インポート ジョブ名** - このワークフローの完了の一部として、Azure ポータルで*インポート ジョブ*を作成する必要があります (ドキュメントの後半で説明します)。後で Azure ポータルでも使用する名前を入力します。
    - **Azure 発行設定** - これは、サブスクリプションのプロファイルに関する情報を含む XML ファイルです。サブスクリプションに関連付けられている、セキュリティで保護された資格情報も含まれています。このファイルは[こちら](https://manage.windowsazure.com/publishsettings)からダウンロードできます。発行設定ファイルへのローカル パスを指定します。
    - **Azure サブスクリプション ID** - Azure インポート ジョブを開始する Azure サブスクリプション ID を指定します。複数の Azure サブスクリプションを使用している場合は、インポート ジョブに関連付けられている ID を使用します。
    - **Azure ストレージ アカウント** - このインポート ジョブに関連付ける Azure ストレージ アカウントの名前を入力します。
    - **Azure ストレージ コンテナー** - このジョブのデータのインポート先のストレージ BLOB 名を入力します。

この情報は後続の手順で再入力する必要があるため、すべて別に保存してください。


2. ワークフローが完了したら、Azure Backup MMC で **[今すぐバックアップ]** を選択してオフラインのバックアップ コピーを開始します。初期バックアップが、この手順の一部としてステージング領域に書き込まれます。

    ![今すぐバックアップ](./media/backup-azure-backup-import-export/backupnow.png)

    **[保護グループ]** をクリックし、**[回復ポイントの作成]** オプションを選択して、SCDPM の対応するワークフローを有効にします。次に、**[オンライン保護]** オプションを選択します。

    ![DPM の今すぐバックアップ](./media/backup-azure-backup-import-export/dpmbackupnow.png)

    操作が完了すると、*.AIBBlob* ファイルと *.BaseBlob* ファイルがステージング場所に作成されます。

    ![出力](./media/backup-azure-backup-import-export/opbackupnow.png)

### SATA ドライブを準備する

1. [Microsoft Azure Import/Export ツール](http://go.microsoft.com/fwlink/?linkid=301900&clcid=0x409)を*コピー用コンピューター*にダウンロードします。ステージング場所 (前の手順の) が、次の一連のコマンドを実行するコンピューターからアクセスできることを確認します。必要に応じて、コピー用コンピューターをソース コンピューターと同じにすることができます。

2. *WAImportExport.zip* ファイルを解凍します。*WAImportExport* ツールを実行すると、SATA ドライブがフォーマットされ、SATA ドライブにバックアップ データが書き込まれて暗号化されます。次のコマンドを実行する前に、BitLocker がコンピューターで有効になっていることを確認します。<br/>

    *.\\WAImportExport.exe PrepImport /j:<*ジャーナル ファイル*>.jrn /id: <*セッション ID*> /sk:<*ストレージ アカウント キー*> /BlobType:**PageBlob** /t:<*ターゲット ドライブ文字*> /format /encrypt /srcdir:<*ステージング場所*> /dstdir: <*コピー先 BLOB 仮想ディレクトリ*>/*


| パラメーター | 説明
|-------------|-------------|
| /j:<*ジャーナル ファイル*>| ジャーナル ファイルへのパス。各ドライブには、ジャーナル ファイルが必ず 1 つあります。ターゲット ドライブには、ジャーナル ファイルは存在しません。ジャーナル ファイルの拡張子は .jrn で、このコマンドの実行の一部として作成されます。|
|/id:<*セッション ID*> | セッション ID は*コピー セッション*を識別します。中断されたコピー セッションを正しく復元するために使用されます。コピー セッションでコピーされるファイルは、ターゲット ドライブ上のセッション ID の名前が付いたディレクトリに格納されます。|
| /sk:<*ストレージ アカウント キー*> | データのインポート先となるストレージ アカウントのアカウント キー。これはバックアップ ポリシー/保護グループ作成時に入力されたものと同じにする必要があります。|
| /BlobType | **PageBlob** を指定すると、このワークフローは PageBlob オプションを指定する場合のみ成功します。これは既定のオプションではありません。このコマンドに記述する必要があります。 |
|/t:<*ターゲット ドライブ文字*> | 現在のコピー セッションのターゲットのハード ドライブのドライブ文字 (後ろにコロンが続きません)。|
|/format | ドライブをフォーマットする必要がある場合は、このパラメーターを指定します。それ以外の場合は省略します。ツールがドライブをフォーマットする前に、コンソールから確認を求めるメッセージが表示されます。確認メッセージを非表示にするには、/silentmode パラメーターを指定します。|
|/encrypt | ドライブが BitLocker で暗号化されていないため、ツールで暗号化する必要がある場合は、このパラメーターを指定します。ドライブが既に BitLocker で暗号化されている場合は、このパラメーターを省略して /bk パラメーターを指定し、既存の BitLocker キーを入力します。/format パラメーターを指定する場合も、/encrypt パラメーターを指定する必要があります。 |
|/srcdir:<*ソース ディレクトリ*> | ターゲット ドライブにコピーされるファイルを含むソース ディレクトリ。ここで指定するディレクトリ名が (相対パスではなく) 完全パスであることを確認してください。|
|/dstdir:<*コピー先 BLOB 仮想ディレクトリ*> | Microsoft Azure ストレージ アカウントのコピー先の仮想ディレクトリへのパス。コピー先の仮想ディレクトリや BLOB を指定する場合は、有効なコンテナー名を使用してください。コンテナー名は小文字にする必要があります。このコンテナー名は、バックアップ ポリシー/保護グループ作成時に入力されたものと同じにする必要があります。|

  > [AZURE.NOTE] ジャーナル ファイルは WAImportExport フォルダーに作成され、ワークフロー全体の情報を収集します。このファイルは、Azure ポータルでインポート ジョブを作成するときに必要です。

  ![PowerShell の出力](./media/backup-azure-backup-import-export/psoutput.png)

### Azure ポータルでインポート ジョブを作成する
1. [管理ポータル](https://manage.windowsazure.com/)でストレージ アカウントに移動し、作業ウィンドウで **[インポート/エクスポート]**、**[インポート ジョブの作成]** の順にクリックします。

    ![ポータル](./media/backup-azure-backup-import-export/azureportal.png)

2. ウィザードの手順 1 で、ドライブの準備ができており、ドライブのジャーナル ファイルが使用可能であることを示します。ウィザードのステップ 2. で、このインポート ジョブの担当者の連絡先情報を入力します。
3. ステップ 3. で、前のセクションで取得したドライブのジャーナル ファイルをアップロードします。
4. 手順 4 では、バックアップ ポリシー/保護グループ作成時に入力されたインポート ジョブにわかりやすい名前を入力します。名前に含めることができるのは、アルファベットの小文字、数字、ハイフン、アンダースコアだけです。また、先頭の文字はアルファベットにします。スペースを含めることはできません。ここで入力した名前を使って、進行中および完了後にジョブを追跡します。
5. 次に、データ センターのリージョンを一覧から選択します。データ センターのリージョンに、パッケージの発送先となるデータ センターとその住所が示されます。

    ![DC](./media/backup-azure-backup-import-export/dc.png)

6. ステップ 5. で、返送に利用する宅配業者を一覧から選択し、業者のアカウント番号を入力します。マイクロソフトでは、インポート ジョブの完了後、このアカウントを使用してドライブを返送します。

7. ディスクを発送して問い合わせ番号を入力し、出荷の状態を追跡します。ディスクがデータ センターに到着すると、ストレージ アカウントにコピーされ、状態が更新されます。

    ![完了状態](./media/backup-azure-backup-import-export/complete.png)

### ワークフローの完了
ストレージ アカウントで初期バックアップ データが使用可能になると、Azure Backup エージェントは、データの内容をこのアカウントからマルチテナントのバックアップ ストレージ アカウントにコピーします。次回のスケジュール バックアップで、Azure Backup エージェントは初期バックアップ コピーの上に増分バックアップを実行します。

## 次のステップ
- Azure Import/Export ワークフローに関するご質問は、こちらの[記事](../storage/storage-import-export-service.md)をご覧ください。
- ワークフローに関するご質問は、Azure Backup [FAQ](backup-azure-backup-faq.md) のオフライン バックアップのセクションをご覧ください。

<!---HONumber=AcomDC_0302_2016-->