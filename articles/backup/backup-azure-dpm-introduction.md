<properties
	pageTitle="Azure DPM バックアップの概要 | Microsoft Azure"
	description="Azure Backup サービスを使用した DPM サーバーのバックアップの概要"
	services="backup"
	documentationCenter=""
	authors="Jim-Parker"
	manager="jwhit"
	editor=""/>

<tags
	ms.service="backup"
	ms.workload="storage-backup-recovery"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="06/12/2015"
	ms.author="jimpark"/>

# Azure DPM Backup の概要

この記事では、Microsoft Azure Backup を使用して System Center Data Protection Manager (DPM) サーバーとワークロードを保護する方法について概説します。この記事を読むと次のことが理解できます。

- Azure DPM サーバーのバックアップの仕組み
- スムーズなバックアップ操作を実現するための前提条件
- 一般的に発生するエラーとその対処法
- サポートされるシナリオ

System Center DPM は、ファイルとアプリケーション データをバックアップします。DPM にバックアップされるデータは、テープやディスクに保存することも、Microsoft Azure Backup を使って Azure にバックアップすることもできます。DPM は、Azure Backup と次のように対話します。

- **物理サーバーまたはオンプレミス仮想マシンとしてデプロイされている DPM** — DPM が物理サーバーまたはオンプレミス Hyper-V 仮想マシンとしてデプロイされている場合、データはディスクやテープだけでなく、Azure Backup コンテナーにバックアップすることができます。
- **Azure の仮想マシンとしてデプロイされている DPM** — System Center 2012 R2 Update 3 以降、DPM は Azure 仮想マシンとしてデプロイすることができます。DPM が Azure 仮想マシンとしてデプロイされている場合、DPM Azure 仮想マシンにアタッチされている Azure ディスクにデータをバックアップすることができます。またはデータを Azure Backup コンテナーにバックアップして、データ ストレージをオフロードすることができます。

## DPM サーバーをバックアップする理由

DPM サーバーのバックアップに Azure Backup を使用するビジネス上のメリットは、次のとおりです。

- オンプレミス DPM デプロイメントでは、Azure バックアップはテープへの長期的なデプロイの代替手段として使用できます。
- Azure の DPM デプロイでは、Azure Backup を使用して Azure ディスクからストレージをオフロードし、Azure Backup に古いデータを、ディスクに新しいデータを格納してスケールアップすることができます。

## DPM サーバーのバックアップ動作のしくみ
仮想マシンをバックアップするには、まずデータの特定の時点のスナップショットが必要です。Azure Backup サービスは、スケジュールされた時刻にバックアップ ジョブを開始し、バックアップ拡張機能をトリガーしてスナップショットを作成します。バックアップ拡張機能は、インゲスト VSS サービスと連携して一貫性を実現し、一貫性に達すると、Azure ストレージ サービスの BLOB スナップショット API を呼び出します。これにより、仮想マシンをシャット ダウンすることなく、一貫性のあるディスクのスナップショットが作成されます。

スナップショットが作成されると、データは Azure Backup サービスによってバックアップ コンテナーに転送されます。このサービスは、最新のバックアップから変更されたブロックのみを識別して転送することで、バックアップ ストレージとネットワークの効率を高めます。データ転送が完了すると、スナップショットが削除され、回復ポイントが作成されます。この回復ポイントは、Microsoft Azure 管理ポータルで確認できます。

>[AZURE.NOTE]Linux 仮想マシンでは、ファイル整合性のバックアップのみが可能です。

## 前提条件
DPM データをバックアップするために Azure Backup を準備するには、次のようにします。

1. **バックアップ コンテナーの作成** — Azure Backup コンソールでコンテナーを作成します。
2. **コンテナー資格情報のダウンロード** — Azure Backup で、コンテナーに対して作成した管理証明書をダウンロードします。
3. **Azure Backup エージェントのインストールおよびサーバーの登録** — Azure Backup から、各 DPM サーバーにエージェントをインストールし、バックアップ コンテナーに DPM サーバーを登録します。

### バックアップ コンテナーの作成
Azure 仮想マシンのバックアップを開始するにはまずバックアップ コンテナーを作成する必要があります。資格情報コンテナーは、時間の経過と共に作成されるすべてのバックアップと回復ポイントを格納するエンティティです。コンテナーには、バックアップ対象の仮想マシンに適用されるバックアップ ポリシーも含まれます。

1. [管理ポータル](http://manage.windowsazure.com/)にサインインします。
2. **[新規]** > **[Data Services]** > **[復旧サービス]** > **[バックアップ資格情報コンテナー]** > **[簡易作成]** の順にクリックします。組織のアカウントに複数のサブスクリプションが関連付けられている場合は、バックアップ コンテナーに関連付ける適切なサブスクリプションを選択してください。Azure サブスクリプションごとに複数のバックアップ コンテナーを作成して、保護するデータを整理することができます。
3. **[名前]** ボックスに、コンテナーを識別する表示名を入力します。これは、サブスクリプションごとに一意である必要があります。
4. **[リージョン]** ボックスで、コンテナーのリージョンを選択します。資格情報コンテナーは、保護する仮想マシンと同じリージョンにある必要があります。仮想マシンがさまざまなリージョンにある場合は、リージョンごとにコンテナーを作成します。バックアップ データを格納するストレージ アカウントを指定する必要はありません。バックアップ コンテナーと Azure Backup サービスにより自動的に指定されます。
    > [AZURE.NOTE][サポートされているリージョン](http://azure.microsoft.com/regions/#services)

5. **[サブスクリプション]** ボックスに、バックアップ コンテナーを使用する Azure サブスクリプションを入力します。
6. **[コンテナーの作成]** をクリックします。![バックアップ コンテナーの作成](./media/backup-azure-dpm-introduction/backup_vaultcreate.png)

    バックアップ コンテナーが作成されるまで時間がかかることがあります。ポータルの下部にある状態の通知を監視します。![資格情報コンテナーのトースト通知の作成](./media/backup-azure-dpm-introduction/creating-vault.png)

    コンテナーが正常に作成されたことを示すメッセージが表示され、[復旧サービス] ページに **[アクティブ]** と表示されます。

    ![バックアップ資格情報コンテナーの一覧](./media/backup-azure-dpm-introduction/backup_vaultslist.png)

7. バックアップ コンテナーをクリックして、**[クイック スタート]** ページに進むと、DPM サーバーのバックアップ手順が表示されます。![ダッシュ ボード ページの仮想マシンのバックアップ手順](./media/backup-azure-dpm-introduction/vmbackup-instructions.png)

    > [AZURE.NOTE]コンテナーを作成したら、適切なストレージの冗長オプションが選択されていることを確認してください。詳細については、「[setting the storage redundancy option in the backup vault (バックアップ コンテナーのストレージ冗長オプションの設定)](http://azure.microsoft.com/documentation/articles/backup-azure-backup-create-vault/#azure-backup---storage-redundancy-options)」を参照してください。

### コンテナー資格情報のダウンロード
1. **[復旧サービス]** をクリックし、バックアップ コンテナーをクリックします。**[クイック スタート]** ページで **[コンテナー資格情報のダウンロード]** をクリックして資格情報ファイルをダウンロードし、安全な場所に保存します。資格情報は編集できないので、その場所を開く必要はありません。セキュリティ上の理由から、ファイルのキーは 48 時間後に有効期限が切れます。

2. このファイルを、Azure Backup コンテナーに登録する DPM サーバーから簡単にアクセスできる安全な場所にコピーします。Azure Backup エージェントをインストールするときにこのファイルを選択する必要があります。

### Azure Backup エージェントのインストールとサーバーの登録
エージェント インストール ファイルをダウンロードし、バックアップするデータが含まれる各 DPM サーバーで実行します。エージェントは、**Azure ダウンロード センター**に格納されており、独自のセットアップ処理があります。セットアップを実行すると、エージェントがインストールされ、DPM サーバーがコンテナーに登録されます。以下の点に注意してください。

- エージェントをインストールするには、DPM サーバーに対する管理アクセス許可が必要です。
- 複数の DPM サーバーにインストールする場合は、共有ネットワーク リソースにインストーラー ファイルを配置します。またはグループ ポリシーや、System Center Configuration Manager などの管理製品を使用して、エージェントをインストールすることができます。
- インストールの実行後に、DPM サーバーを再起動する必要はありません。

#### バックアップ エージェントのインストールとサーバーを登録するには

1. **[Azure Backup エージェントのダウンロード]** で Azure Backup コンテナーの **[クイック スタート]** ページから、**[Windows Server または System Center Data Protection Manager または Windows クライアント用]** をクリックします。アプリケーションを、実行する DPM サーバーにダウンロードします。
2. セットアップ ファイル **MARSAgentInstaller.exe** を実行します。サービス条項に同意し、不足している前提条件ソフトウェアがあればインストールを選択します。
3. **[インストール設定]** ページで、**インストール フォルダー**と**キャッシュ場所**を選択します。

    既定のキャッシュ場所フォルダーは、<system drive>:\Program Files\Azure Backup Agent です。このキャッシュ場所で、インストール プロセスは、**Azure Backup Agent** フォルダー内に **Scratch** という名前のフォルダーを作成します。キャッシュ場所には、少なくとも 2.5 GB (または Azure にバックアップするデータ サイズの 10%) の空き領域が必要です。サービス拒否攻撃を防ぐために、キャッシュ ディレクトリにアクセスできるのは、ローカル システム管理者と Administrators グループのメンバーのみとなっています。

4. **[プロキシ構成]** ページで、Azure に接続するエージェントのカスタム プロキシ設定を設定します。どの設定も構成しない場合は、DPM サーバーの既定のインターネット アクセス設定が使用されます。認証が必要なプロキシ サーバーを使用している場合は、このページで詳細を入力する必要があることに注意してください。
5. **[Microsoft Update のオプトイン]** ページで、更新プログラムのチェックを有効にすることをお勧めします。サーバーで自動更新が既に有効になっている場合、この手順はスキップされます。Microsoft Update の設定は、Azure Backup エージェントだけでなく、すべての Microsoft 製品の更新プログラムに適用されることに注意してください。
6. **[インストール]** ページが表示されます。インストール処理では、必要なソフトウェアがインストールされていることが確認され、セットアップが実行されます。処理が終了したら、Azure Backup エージェントが正常にインストールされたことを示すメッセージが表示されます。この時点で、更新プログラムがないかチェックできます。更新プログラムのチェックを自動実行することをお勧めします。
7. **[登録に進む]** をクリックし、サーバーをコンテナーに登録します。
8. **[コンテナーの識別]** ページで、Azure Backup コンテナー内に生成されたコンテナー登録ファイルを選択します。
9. **[暗号化の設定]** ページで、パスフレーズの詳細を指定するか、またはパスフレーズを自動的に生成します。
10. [パスフレーズの生成] をクリックし、続いて [クリップボードにコピー] をクリックします。パスフレーズがクリップボードにコピーされたことを示すメッセージが表示されます。ここでメモ帳を開き、パスフレーズをクリップボードから貼り付けてファイルを保存し、さらにそのファイルを印刷して安全な場所に保管しておくことをお勧めします。[登録] をクリックして、DPM サーバーを Backup コンテナーに登録します。

    > [AZURE.TIP]
11. **[登録]** をクリックします。

    登録が完了すると、DPM のコンソールに Azure Backup が利用可能であることが表示されます。

    Azure Backup は、指定した、または自動的に生成したパスフレーズ (英数字の文字列) を使用して、ソースのデータを常に暗号化します。
    >[AZURE.NOTE]Azure Backup はパスフレーズを保持しないため、紛失してしまうとデータを復元または回復できません。そのため、パスフレーズ キーを外部の場所に保存することを強くお勧めします。

パスフレーズを指定して **[完了]** をクリックすると、エージェントにより運用サーバーがバックアップ コンテナーに登録されます (これには数秒かかります)。コンテナーへの登録が終了すると、すぐに **[サーバー登録]** ページに概要が表示されます。

## 要件 (および制限)

- DPM は、物理サーバーとして、または System Center 2012 SP1 か System Center 2012 R2 にインストールされている Hyper-V 仮想マシンとして実行することができます。さらに、DPM は、System Center 2012 R2 (少なくとも DPM 2012 R2 更新プログラム ロールアップ 3 が適用されているもの) で実行する Azure 仮想マシンとして、または System Center 2012 R2 (少なくとも更新プログラム ロールアップ 5 が適用されているもの) で実行する VMWare の Windows 仮想マシンとして実行することもできます。
- DPM を System Center 2012 SP1 で実行する場合は、System Center Data Protection Manager SP1 用の更新プログラム ロールアップ 2 をインストールする必要があります。この手順は、Azure Backup エージェントをインストールする前に実行する必要があります。
- DPM サーバーには、Windows PowerShell および .Net Framework 4.5 がインストール済みである必要があります。
- DPM は、ほとんどのワークロードを Azure Backup にバックアップできます。サポート対象の詳細な一覧については、次に示す Azure Backup サポートの項目を参照してください。
- Azure Backup に格納されているデータは、"テープにコピー" オプションでは回復できません。
- Azure Backup 機能が有効になっている Azure アカウントを使用する必要があります。アカウントがない場合は、無料試用版のアカウントを数分で作成することができます。[Azure Backup の料金](https://azure.microsoft.com/pricing/details/backup/)を参照してください。
- Azure Backup を使用するには、バックアップ対象のサーバーに Azure Backup エージェントがインストールされていることが必要です。各サーバーには、キャッシュ場所として 2.5 GB のローカル空きストレージ スペースが必要です (推奨は 15 GB です)。
- データは、Azure コンテナー ストレージに格納されます。Azure Backup コンテナーにバックアップできるデータ量に制限はありませんが、データ ソース (仮想マシンやデータベースなど) のサイズは 1.65 TB を超えないようにする必要があります。

Azure へのバックアップがサポートされているファイルの種類は、次のとおりです。

- 暗号化ファイル (完全バックアップのみ)
- 圧縮ファイル (増分バックアップがサポートされる)
- スパース ファイル (増分バックアップがサポートされる)
- 圧縮されたスパース ファイル (スパースとして処理)

次のものはサポートされていません。

- 大文字と小文字を区別するファイル システムのサーバーはサポートされません。
- ハード リンク (スキップされる)
- 再解析ポイント (スキップされる)
- 暗号化されている圧縮ファイル (スキップされる)
- 暗号化されているスパース ファイル (スキップされる)
- 圧縮ストリーム
- スパース ストリーム

>[AZURE.NOTE]System Center 2012 DPM SP1 以降では、Microsoft Azure Backup を使用して、DPM で保護されているワークロードを Azure にバックアップすることができます。

<!---HONumber=62-->