---
title: "Azure Backup: Azure VM のバックアップからファイルとフォルダーを回復する | Microsoft Docs"
description: "Azure 仮想マシンの回復ポイントからファイルを回復します"
services: backup
documentationcenter: dev-center-name
author: pvrk
manager: shivamg
keywords: "アイテム レベルの回復; Azure VM のバックアップからのファイルの回復; Azure VM からのファイルの復元"
ms.assetid: f1c067a2-4826-4da4-b97a-c5fd6c189a77
ms.service: backup
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: storage-backup-recovery
ms.date: 2/6/2017
ms.author: pullabhk;markgal
translationtype: Human Translation
ms.sourcegitcommit: 5c31fcac727a1206cb416cbe7340392a2816729a
ms.openlocfilehash: 93b689c132ec7e391a9107e4e3eb73a48e3ba09d


---
# <a name="recover-files-from-azure-virtual-machine-backup-preview"></a>Azure 仮想マシンのバックアップからファイルを回復する (プレビュー)

Azure Backup は、[Azure VM とディスク](./backup-azure-arm-restore-vms.md)を Azure VM のバックアップから復元する機能を提供します。 この記事では、Azure VM のバックアップからファイルやフォルダーなどのアイテムを回復する方法について説明します。

> [!Note]
> この機能は、Resource Manager モデルを使用してデプロイされ、Recovery Services コンテナーに保護されている Azure VM に対して使用できます。
> 現時点では、Windows Azure VM のバックアップからのファイルの回復はプレビュー段階です。 Linux Azure VM からのファイル回復は準備中です。
現時点では、暗号化された VM のバックアップからのファイルの回復はサポートされていません。
>

## <a name="mount-the-volume-and-copy-files"></a>ボリュームをマウントしてファイルをコピーする

1. [Azure ポータル](http://portal.Azure.com)にサインインします。 関連する Recovery Services コンテナーと必要なバックアップ アイテムを見つけます。

2. [バックアップ項目] ブレードで、**[ファイルの回復 (プレビュー)]** をクリックします。

    ![Recovery Services コンテナーを開く](./media/backup-azure-restore-files-from-vm/open-vault-item.png)

    **[ファイルの回復]** ブレードが開きます。

    ![[ファイルの回復] ブレード](./media/backup-azure-restore-files-from-vm/file-recovery-blade.png)

3. **[回復ポイントの選択]**ドロップ ダウン メニューから、目的のファイルを含む回復ポイントを選択します。 既定では、最新の回復ポイントが既に選択されています。

4. **[Download Executable (実行可能ファイルのダウンロード)]** をクリックして、回復ポイントからファイルをコピーするために使用するソフトウェアをダウンロードします。

  この実行可能ファイルは、ローカル コンピューターと、指定された回復ポイントの間の接続を作成するスクリプトです。

5. ファイルを回復するコンピューターで、実行可能ファイルを実行します。 スクリプトは、管理者資格情報を使用して実行する必要があります。 アクセスが制限されたコンピューターでスクリプトを実行する場合は、以下にアクセスできることを確認します。

    - go.microsoft.com
    - Azure VM のバックアップで使用された Azure エンドポイント
    - 送信ポート 3260

    ![[ファイルの回復] ブレード](./media/backup-azure-restore-files-from-vm/executable-output.png)

    回復ポイントを生成するために使用したマシンと同じ (または互換性のある) オペレーティング システムを使用しているすべてのコンピューターでスクリプトを実行することができます。 互換性のあるオペレーティング システムについては、「[互換性のある OS](backup-azure-restore-files-from-vm.md#compatible-os)」の表を参照してください。 保護されている Azure 仮想マシンで Windows 記憶域スペースを使用している場合は、その仮想マシンで実行可能スクリプトを実行することはできません。 代わりに、Windows 記憶域スペースを使用しているその他のコンピューターで実行可能スクリプトを実行します。 互換性のあるオペレーティング システムのコンピュータで実行可能なスクリプトを実行することをお勧めします。

    ![[ファイルの回復] ブレード](./media/backup-azure-restore-files-from-vm/volumes-attached.png)

### <a name="compatible-os"></a>互換性のある OS

次の表は、サーバーとコンピューターのオペレーティング システムの互換性を示しています。 ファイルを回復するときに、互換性のないオペレーティング システムの間でファイルを復元することはできません。

|サーバー OS | 互換性のあるクライアント OS  |
| --------------- | ---- |
| Windows Server 2012 R2 | Windows 8.1 |
| Windows Server 2012    | Windows 8  |
| Windows Server 2008 R2 | Windows 7   |


### <a name="drive-letter-assignments"></a>ドライブ文字の割り当て

スクリプトを実行すると、オペレーティング システムは新しいボリュームをマウントし、ドライブ文字を割り当てます。 Windows エクスプローラーまたはファイル エクスプローラーを使用してそれらのドライブを参照できます。 ボリュームに割り当てられるドライブ文字は、元の仮想マシンと同じ文字にならない可能性がありますが、ボリューム名は保持されます。 たとえば、元の仮想マシン上のボリュームが "データ ディスク (E:\)" の場合、そのボリュームは、ローカル コンピューターに "データ ディスク ('使用可能な任意のドライブ文字':\)" としてアタッチされる可能性があります。 ファイルまたはフォルダーが表示されるまで、スクリプトの出力に示されているすべてのボリュームを参照します。  


## <a name="closing-the-connection"></a>接続を閉じる

ファイルを識別してローカル ストレージの場所にコピーした後、追加ドライブを削除 (またはマウント解除) します。 ドライブをマウント解除するには、Azure Portal の **[ファイルの回復]** ブレードで **[Unmount Disks (ディスクのマウント解除)]** をクリックします。

![ディスクのマウント解除](./media/backup-azure-restore-files-from-vm/unmount-disks3.png)

ディスクがマウント解除されると、操作が成功したことを通知するメッセージが表示されます。 接続を更新してディスクを解除できるようになるまで数分かかることがあります。

## <a name="windows-storage-spaces"></a>Windows 記憶域スペース

Windows 記憶域スペースは、記憶域を仮想化できるようにする Windows 記憶域のテクノロジです。 Windows 記憶域スペースでは、業界標準のディスクを記憶域プールにグループ化し、それらの記憶域プールの空き容量から仮想ディスク (記憶域スペースと呼びます) を作成できます。

バックアップされた Azure VM で Windows 記憶域スペースを使用している場合は、その VM で実行可能スクリプトを実行することはできません。 代わりに、Windows 記憶域スペースを使用しているその他のコンピューターで実行可能スクリプトを実行します。 互換性のあるオペレーティング システムのコンピュータで実行可能なスクリプトを実行することをお勧めします。

## <a name="troubleshooting"></a>トラブルシューティング

仮想マシンからのファイルの回復中に問題が発生した場合は、次の表で追加情報を確認してください。

| エラー メッセージ/シナリオ | 考えられる原因 | 推奨される操作 |
| ------------------------ | -------------- | ------------------ |
| 実行の出力: "*Exception connecting to the target (ターゲットへの接続例外)*" |スクリプトが回復ポイントにアクセスできません    | コンピューターが前述のアクセス要件を満たしているかどうかを確認します。|  
|    実行の出力: "*ターゲットは iSCSI セッション経由で既にログインされています。*" |    スクリプトは同じコンピューターで既に実行され、ドライブがアタッチされています |    回復ポイントのボリュームは既にアタッチされています。 ボリュームは、元の VM と同じドライブ文字でマウントされないことがあります。 ファイル エクスプローラーで、使用可能なすべてのボリュームを参照してファイルを探してください。 |
| 実行の出力: "*This script is invalid because the disks have been dismounted via portal/exceeded the 12-hr limit. (ディスクがポータルからマウント解除されているか、12 時間制限を超過しているため、 このスクリプトは無効です。)Please download a new script from the portal. (ポータルから新しいスクリプトをダウンロードしてください。)*" |    ディスクがポータルからマウント解除されているか、12 時間制限を超過しています |    この特定の実行可能ファイルは、現在無効であり、実行できません。 その回復ポイントインタイムのファイルにアクセスする場合は、ポータルで新しい実行可能ファイルを取得してください。|
| 実行可能ファイルが実行されたコンピューターで: 新しいボリュームが [マウント解除] ボタンをクリックしてもマウント解除されない |    コンピューター上の ISCSI イニシエーターがターゲットへの接続に応答しないか、接続が更新されず、キャッシュが維持されています |    [マウント解除] ボタンを押した後、数分待ちます。 それでも新しいボリュームがマウント解除されない場合は、すべてのボリュームを参照してください。 これにより、イニシエーターが接続を更新し、ボリュームがマウント解除され、ディスクが使用できないことを示すエラー メッセージが表示されます。|
| 実行の出力: スクリプトは正常に実行されるが、スクリプトの出力で "New volumes attached (新しいボリュームがアタッチされました)" が表示されない |    これは一時的なエラーです    | ボリュームは既にアタッチされています。 エクスプローラーを開いて参照します。 同じコンピューターでスクリプトを毎回実行している場合は、マシンの再起動を検討してください。次回の実行可能ファイルの実行時に一覧が表示されます。 |



<!--HONumber=Feb17_HO1-->


