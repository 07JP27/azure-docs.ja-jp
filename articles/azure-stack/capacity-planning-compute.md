---
title: Azure Stack のためのコンピューティング能力の計画 | Microsoft Docs
description: Azure Stack デプロイのためのコンピューティング能力の計画について説明します。
services: azure-stack
documentationcenter: ''
author: jeffgilb
manager: femila
editor: ''
ms.assetid: ''
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/18/2018
ms.author: jeffgilb
ms.reviewer: prchint
ms.custom: mvc
ms.openlocfilehash: b98879483d35a91810c9e9ab5e0ac81151bde52f
ms.sourcegitcommit: ce526d13cd826b6f3e2d80558ea2e289d034d48f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/19/2018
ms.locfileid: "46369749"
---
# <a name="azure-stack-compute-capacity-planning"></a>Azure Stack コンピューティング能力の計画
[Azure Stack でサポートされる VM サイズ](.\user\azure-stack-vm-sizes.md)は、Azure でサポートされているもののサブセットです。 Azure では、リソース (サーバーのローカルおよびサービス レベル) の過剰消費を防ぐため、多くのベクターに沿ってリソースの制限を適用します。 テナントの消費量にいくつかの制限を適用しないと、あるテナントでリソースが過剰消費された場合に、別のテナントのエクスペリエンスに影響します。 VM からのネットワーク送信の場合、Azure Stack では Azure の制限と一致する帯域幅の上限が設けられます。 ストレージ リソースの場合、テナントによるストレージ アクセスのためのリソースの基本的な過剰消費を防ぐため、Azure Stack にストレージ IOPS 制限が実装されています。  

## <a name="vm-placement-and-virtual-to-physical-core-overprovisioning"></a>VM の配置および物理コアに対する仮想コアのオーバープロビジョニング
Azure Stack には、テナントで、VM 配置のために使用する特定のサーバーを指定する方法はありません。 VM を配置するときの唯一の考慮事項は、その VM の種類に対して十分なメモリがホスト上にあるかどうかです。 Azure Stack ではメモリがオーバーコミットされることはありませんが、コア数のオーバーコミットは許容されます。 配置アルゴリズムでは、物理コアに対して仮想コアがどの程度オーバープロビジョニングされているかを考慮しないため、各ホストの比率が異なる可能性があります。 

Azure では、マルチ VM 運用システムの高可用性を実現するため、VM が複数の障害ドメインに分散される可用性セットに配置されます。 つまり、可用性セットに配置された VM は、次の図に示すように、障害からの回復性を考慮してラックで互いに物理的に分離されています。

![障害ドメインと更新ドメイン](media\azure-stack-capacity-planning\domains.png)


Azure Stack のインフラストラクチャは障害に対する回復性を備えていますが、基盤となっているテクノロジ (フェールオーバー クラスタリング) では、ハードウェア障害が発生した場合にその影響を受ける物理サーバー上の VM に多少のダウンタイムが発生します。 現在、Azure Stack では、Azure との一貫性がある最大 3 つの障害ドメインを含む可用性セットを用意することがサポートされています。 可用性セットに配置された VM は、複数の障害ドメイン (Azure Stack ノード) にできる限り均等に分散させることによって、互いに物理的に分離されます。 ハードウェア障害が発生した場合、障害が発生した障害ドメインの VM は他のノードで再起動されますが、可能であれば、同じ可用性セット内の他の VM とは別の障害ドメインに保持されます。 ハードウェアがオンラインに戻ると、高可用性を維持するために VM の再配置が行われます。

高可用性を実現するために Azure で使用されているもう 1 つの概念は、可用性セット内の更新ドメインです。 更新ドメインは、メンテナンスや再起動が同時に行われる可能性のある、基盤となるハードウェアの論理グループです。 Azure Stack では、VM のホストが更新される前に、クラスター内の他のオンライン ホストに VM がライブ マイグレーションされます。 ホスト更新の際にテナントのダウンタイムは発生しないため、Azure Stack の更新ドメイン機能は、Azure とテンプレートの互換性を保つためにのみ存在します。

## <a name="azure-stack-resiliency-resources"></a>Azure Stack の回復性のあるリソース
Azure Stack 統合システムへ修正プログラムや更新プログラムを適用するため、また、物理的なハードウェア障害に対する回復性を持たせるために、サーバーの合計メモリの一部は予約されており、テナントの仮想マシン (VM) に割り当てて使用することはできません。

サーバーで障害が発生した場合、障害が発生したサーバー上でホストされていた VM は、残りの利用可能なサーバー上で再起動され、利用可能な状態となります。 同様に、修正プログラムや更新プログラムを適用する際は、サーバー上で実行されているすべての VM が他の利用可能なサーバーにライブ マイグレーションされます。 この様な VM の制御または移動は、再起動やマイグレーションを実施可能な予約容量がある場合のみ実現できます。

次の計算では、テナントの VM に利用可能なメモリの合計が算出されます。 このメモリ容量は、Azure Stack スケール ユニット全体に対するものです。

  テナントの VM で利用可能なメモリ = サーバーのメモリ合計 – 回復性のための予約 – Azure Stack インフラストラクチャのオーバーヘッド <sup>1</sup>

  回復性のための予約 = H + R * (N-1) + V * (N-2)

> 各値の説明:
> - H = 単一サーバーのメモリ サイズ
> - N = スケール ユニットのサイズ (サーバーの数)
> - R = OS オーバーヘッドのためのオペレーティング システムの予約<sup>2</sup>
> - V = スケール ユニット内で最大の VM (メモリ サイズ)

  <sup>1</sup> Azure Stack インフラストラクチャのオーバーヘッド = 208 GB

  <sup>2</sup> オーバーヘッドのためのオペレーティング システムの予約 = ノード メモリの 15%。 オペレーティング システムの予約値は概算であり、サーバーおよび一般的なオペレーティング システムのオーバーヘッドの物理メモリ容量によって異なります。

値 V (スケール ユニット内で最大の VM) はテナント VM における最大のメモリ サイズで、動的に変動します。 たとえば、V の値は、7 GB、112 GB、または Azure Stack ソリューションでサポートされるその他の VM のメモリ サイズとなる場合があります。

上記の計算は概算であり、Azure Stack の現行バージョンに基づいて変更される可能性があります。 テナントの VM とサービスをデプロイできるかどうかは、デプロイされるソリューションの詳細に依存します。 この計算例は単なるガイドであり、VM をデプロイできるかどうかを保証するものではありません。



## <a name="next-steps"></a>次の手順
[ストレージ容量の計画](capacity-planning-storage.md)
