---
title: "ポイント対サイトを使用してコンピューターを Azure 仮想ネットワークに接続する: クラシック ポータル | Microsoft Docs"
description: "クラシック ポータルを使用してポイント対サイト VPN ゲートウェイ接続を作成することで、クラシック Azure Virtual Network に安全に接続します。"
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-service-management
ms.assetid: 4f5668a5-9b3d-4d60-88bb-5d16524068e0
ms.service: vpn-gateway
ms.devlang: na
ms.topic: hero-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/08/2017
ms.author: cherylmc
translationtype: Human Translation
ms.sourcegitcommit: cfe4957191ad5716f1086a1a332faf6a52406770
ms.openlocfilehash: ffd5690853a7344c7122940ad9676d1903ba2d4a
ms.lasthandoff: 03/09/2017


---
# <a name="configure-a-point-to-site-connection-to-a-vnet-using-the-classic-portal-classic"></a>クラシック ポータルを使用した VNet へのポイント対サイト接続の構成 (クラシック)
> [!div class="op_single_selector"]
> * [Resource Manager - Azure Portal](vpn-gateway-howto-point-to-site-resource-manager-portal.md)
> * [Resource Manager - PowerShell](vpn-gateway-howto-point-to-site-rm-ps.md)
> * [クラシック - Azure Portal](vpn-gateway-howto-point-to-site-classic-azure-portal.md)
> * [クラシック - クラシック ポータル](vpn-gateway-point-to-site-create.md)
> 
> 

ポイント対サイト (P2S) 構成では、個々のクライアント コンピューターから仮想ネットワークへのセキュリティで保護された接続を作成することができます。 P2S は、SSTP (Secure Socket トンネリング プロトコル) 経由の VPN 接続です。 ポイント対サイト接続は、自宅や会議室など、リモートの場所から VNet に接続する場合や、仮想ネットワークに接続する必要があるクライアントの数が少ない場合に便利です。 P2S 接続に VPN デバイスや公開 IP アドレスは必要ありません。 VPN 接続は、クライアント コンピューターから確立します。

この記事では、クラシック ポータルを使用して、ポイント対サイト接続を備えた VNet をクラシック デプロイ モデルで作成する手順を説明します。 ポイント対サイト接続の詳細については、この記事の最後にある「[ポイント対サイト接続に関してよく寄せられる質問](#faq)」を参照してください。



### <a name="deployment-models-and-methods-for-p2s-connections"></a>P2S 接続のデプロイメント モデルとデプロイ方法
[!INCLUDE [deployment models](../../includes/vpn-gateway-deployment-models-include.md)]

次の表は、2 つのデプロイメント モデルと、P2S 構成で使用可能なデプロイ方法を示しています。 構成手順を説明した記事が利用できるようになったら、表から直接リンクできるようにします。

[!INCLUDE [vpn-gateway-clasic-rm](../../includes/vpn-gateway-table-point-to-site-include.md)]

## <a name="basic-workflow"></a>基本的なワークフロー
![ポイント対サイトの図](./media/vpn-gateway-point-to-site-create/p2sclassic.png "ポイント対サイト")

次の手順では、仮想ネットワークに対してセキュリティで保護されたポイント対サイト接続を作成する方法を説明します。 ポイント対サイト接続の構成は、4 つのセクションに分かれています。 各セクションを構成する順序が重要です。 手順をスキップしたり、先に進んだりしないでください。

* **セクション 1** 仮想ネットワークと VPN ゲートウェイの作成
* **セクション 2** 認証に使用する証明書の作成とアップロード
* **セクション 3** クライアント証明書のエクスポートとインストール
* **セクション 4** VPN クライアントの構成



## <a name="vnetvpn"></a>セクション 1 - 仮想ネットワークと VPN ゲートウェイの作成

最初に Azure サブスクリプションを持っていることを確認します。 Azure サブスクリプションをまだお持ちでない場合は、[MSDN サブスクライバーの特典](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details)を有効にするか、[無料アカウント](https://azure.microsoft.com/pricing/free-trial)にサインアップしてください。

### <a name="part-1-create-a-virtual-network"></a>パート 1: 仮想ネットワークの作成
1. [Azure クラシック ポータル](https://manage.windowsazure.com)にログインします。 以下の手順では、Azure ポータルではなく、クラシック ポータルを使用します。 現時点では、Azure ポータルを使用して P2S 接続を作成することはできません。
2. 画面の左下隅で **[新規]**をクリックします。 ナビゲーション ウィンドウで **[Network Services]** をクリックし、**[Virtual Network]** をクリックします。 **[カスタム作成]** をクリックして、構成ウィザードを開始します。
3. **[仮想ネットワークの詳細]** ページで、次の情報を入力し、右下にある次へ進む矢印をクリックします。
   
   * **[名前]**: 仮想ネットワークの名前を指定します。 たとえば、「VNet1」と入力します。 これは、この VNet に VM をデプロイするときに参照する名前です。
   * **[場所]**: 場所は、リソース (VM) を配置する物理的な場所 (リージョン) に直接関連します。 たとえば、この仮想ネットワークにデプロイする VM を物理的に米国東部に配置する場合は、場所として米国東部を選択します。 仮想ネットワークを作成した後で、その仮想ネットワークに関連付けられたリージョンを変更することはできません。
4. **[DNS サーバーおよび VPN 接続]** ページで次の情報を入力し、右下にある次へ進む矢印をクリックします。
   
   * **[DNS サーバー]**: DNS サーバー名と IP アドレスを入力するか、以前に登録した DNS サーバーをショートカット メニューから選択します。 この設定で、DNS サーバーは作成されません。 この設定では、この仮想ネットワークの名前解決に使用する DNS サーバーを指定することができます。 Azure の既定の名前解決サービスを使用する場合は、このセクションは空白のままにします。
   * **[ポイント対サイト VPN の構成]**: チェック ボックスをオンにします。
5. **[ポイント対サイト接続]** ページで、接続時に VPN が IP アドレスを受け取る際の IP アドレスの範囲を指定します。 指定可能なアドレスの範囲については、いくつかの規則があります。 指定した範囲が、オンプレミス ネットワーク上のどの範囲とも重複しないことを確認することが重要です。
6. 次の情報を入力して、次へ進む矢印をクリックします。
   
   * **[アドレス空間]**: 開始 IP と CIDR (アドレス数) を指定します。
   * **[アドレス空間の追加]**: ネットワーク設計に必要な場合にのみ、アドレス空間を追加します。
7. **[仮想ネットワーク アドレス空間]** ページで、仮想ネットワークに使用するアドレス範囲を指定します。 これらが動的 IP アドレス (DIPS) として、この仮想ネットワークにデプロイする VM や各種ロール インスタンスに割り当てられます。<br><br>オンプレミス ネットワークに使用されている範囲と重複しない範囲を選択することが特に重要です。 仮想ネットワークに使用するオンプレミス ネットワークのアドレス空間から、ネットワーク管理者が IP アドレスの範囲を分割しなければならない可能性があるため、ネットワーク管理者と調整する必要があります。
8. 次の情報を入力し、チェックマークをクリックして仮想ネットワークの作成を開始します。
   
   * **[アドレス空間]**: 開始 IP や数など、この仮想ネットワークで使用する内部 IP アドレスの範囲を追加します。 オンプレミス ネットワークに使用されている範囲と重複しない範囲を選択することが重要です。 
   * **[サブネットの追加]**: 追加サブネットは必須ではありませんが、VM 用に静的 DIP を持つ別のサブネットを作成することをお勧めします。 または、他のロール インスタンスとは分離したサブネットに VM を配置することができます。
   * **[ゲートウェイ サブネットの追加]**: ゲートウェイ サブネットはポイント対サイト VPN に必須です。 クリックして、ゲートウェイ サブネットを追加します。 ゲートウェイ サブネットは仮想ネットワーク ゲートウェイにのみ使用されます。
9. 仮想ネットワークが作成されると、Azure クラシック ポータルの [ネットワーク] ページの **[状態]** に **[作成済み]** と表示されます。 仮想ネットワークが作成されると、動的ルーティング ゲートウェイを作成できます。

### <a name="part-2-create-a-dynamic-routing-gateway"></a>パート 2: 動的ルーティング ゲートウェイの作成
ゲートウェイの種類として、動的ゲートウェイを構成する必要があります。 静的ルーティング ゲートウェイでは、この機能に対応できません。

1. Azure クラシック ポータルの **[ネットワーク]** ページで、作成した仮想ネットワークをクリックし、**[ダッシュボード]** ページに移動します。
2. **[ダッシュボード]** ページの下部にある **[ゲートウェイの作成]**をクリックします。 " **仮想ネットワーク 'VNet1' にゲートウェイを作成しますか?**" というメッセージが表示されます。 **[はい]** をクリックして、ゲートウェイの作成を開始します。 ゲートウェイの作成には最大で 45 分かかる場合があります。

## <a name="generate"></a>セクション 2 - 証明書の生成とアップロード
証明書は、ポイント対サイト VPN の VPN クライアントを認証するために、Azure によって使用されます。 ルート証明書の作成後、(秘密キーではなく) 公開証明書データを、Base-64 でエンコードされた X.509 .cer ファイルとしてエクスポートします。 その後、公開証明書データをルート証明書から Azure にアップロードします。

ポイント対サイトで VNet に接続するすべてのクライアント コンピューターには、クライアント証明書がインストールされている必要があります。 クライアント証明書はルート証明書から生成され、各クライアント コンピューターにインストールされます。 有効なクライアント証明書がインストールされていない状態でクライアントが VNet に接続した場合、認証に失敗します。

このセクションでは、次の手順を実行します。

* ルート証明書の .cer ファイルを取得します。 自己署名ルート証明書を指定することも、エンタープライズ証明書システムを使用することもできます。
* .cer ファイルを Azure にアップロードします。
* クライアント証明書を生成します。

### <a name="root"></a>パート 1: ルート証明書の .cer ファイルの取得


エンタープライズ ソリューションを使用している場合、既存の証明書チェーンを使うことができます。 使用するルート証明書の .cer ファイルを取得します。


エンタープライズ証明書ソリューションを使用していない場合は、自己署名ルート証明書を作成する必要があります。 P2S 認証に必要なフィールドを含む自己署名ルート証明書は、PowerShell を使用して作成できます。 自己署名ルート証明書の作成手順については、「[Create a self-signed root certificate for Point-to-Site connections using PowerShell (PowerShell を使ったポイント対サイト接続用自己署名ルート証明書の作成)](vpn-gateway-certificates-point-to-site.md)」で確認できます。

> [!NOTE]
> 以前は、自己署名ルート証明書を作成してポイント対サイト接続用のクライアント証明書を生成する手段として makecert が推奨されていました。 現在は、PowerShell を使用してそれらの証明書を作成できるようになっています。 PowerShell を使う利点は、SHA-2 証明書を作成できることです。 必要な値については、「[Create a self-signed root certificate for Point-to-Site connections using PowerShell (PowerShell を使ったポイント対サイト接続用自己署名ルート証明書の作成)](vpn-gateway-certificates-point-to-site.md)」を参照してください。
>
>


#### <a name="to-export-the-public-key-for-a-self-signed-root-certificate"></a>自己署名ルート証明書用の公開キーをエクスポートするには

ポイント対サイト接続では、公開キー (.cer) が Azure にアップロードされている必要があります。 次の手順で、自己署名ルート証明書の .cer ファイルをエクスポートしてください。

1. 証明書から .cer ファイルを取得するには、 **certmgr.msc**を開きます。 自己署名ルート証明書を探して右クリックします (通常は 'Current User\Personal\Certificates' にあります)。 **[すべてのタスク]**、**[エクスポート]** の順にクリックします。 **証明書のエクスポート ウィザード**が開きます。
2. ウィザードで **[次へ]** をクリックします。 **[いいえ、秘密キーをエクスポートしません]** を選択して、**[次へ]** をクリックします。
3. **[エクスポート ファイルの形式]** ページで **[Base-64 encoded X.509 (.CER)]** を選択し、**[次へ]** をクリックします。 
4. **[エクスポートするファイル]** で、**[参照]** をクリックして証明書をエクスポートする場所を選択します。 **[ファイル名]**に証明書ファイルの名前を指定します。 その後、 **[次へ]**をクリックします。
5. **[完了]** をクリックして、証明書をエクスポートします。 "**エクスポートに成功しました**" というメッセージが表示されます。 **[OK]** をクリックしてウィザードを閉じます。

### <a name="upload"></a>パート 2: Azure クラシック ポータルへのルート証明書 .cer ファイルのアップロード

信頼された証明書を Azure に追加します。 Base64 でエンコードされた X.509 (.cer) ファイルを Azure に追加すると、このファイルが表すルート証明書を信頼するよう Azure に伝えることになります。 最大 20 個のルート証明書のファイルをアップロードすることができます。 ルート証明書の秘密キーは、Azure にアップロードしません。 .cer ファイルをアップロードすると、Azure は仮想ネットワークに接続するクライアントの認証にそれを使用します。

1. Azure クラシック ポータルで、仮想ネットワークの **[証明書]** ページにある **[ルート証明書のアップロード]** をクリックします。
2. **[証明書のアップロード]** ページで、.cer ルート証明書を参照して、チェックマークをクリックします。

### <a name="createclientcert"></a>パート 3: クライアント証明書の生成
接続するクライアントごとに一意の証明書を生成することも、複数のクライアントに同じ証明書を使用することもできます。 一意のクライアント証明書を生成する利点は、必要に応じて&1; つの証明書を失効させることができる点です。 そうでなければ、すべてのユーザーが同じクライアント証明書を使用していて、1 つのクライアントの証明書を失効させる必要がある場合は、認証にその証明書を使用するすべてのクライアントに新しい証明書を生成してインストールする必要があります。

####<a name="enterprise-certificate"></a>エンタープライズ証明書
- エンタープライズ証明書ソリューションを使用している場合は、"domain name\username" 形式ではなく、共通名の値の形式 "name@yourdomain.com" を使用してクライアント証明書を生成します。
- 発行するクライアント証明書が、使用リストの最初の項目としてスマート カード ログオンなどではなく "クライアント認証" が指定されている "ユーザー" 証明書テンプレートに基づいていることを確認します。証明書を確認するには、クライアント証明書をダブルクリックし、**[詳細]、[拡張キー使用法]** の順に選択して表示します。

####<a name="self-signed-root-root-certificate"></a>自己署名ルート証明書 
自己署名ルート証明書を使用する場合、[PowerShell を使ったクライアント証明書の生成](vpn-gateway-certificates-point-to-site.md#clientcert)に関するページで、ポイント対サイト接続に合ったクライアント証明書を生成する手順を参照してください。


## <a name="installclientcert"></a>セクション 3 - クライアント証明書のエクスポートとインストール

クライアント証明書を生成したら、その証明書を .pfx ファイルとしてエクスポートし、クライアント コンピューターにインストールする必要があります。 各クライアント コンピューターには、認証のためにクライアント証明書が必要です。 クライアント証明書は、自動でも手動でもインストールできます。 次の手順では、手動によるクライアント証明書のエクスポートとインストールについて説明します。

### <a name="export-the-client-certificate"></a>クライアント証明書のエクスポート

1. クライアント証明書をエクスポートするには、 **certmgr.msc**を開きます。 エクスポートするクライアント証明書を右クリックして、**[すべてのタスク]**、**[エクスポート]** の順にクリックします。 **証明書のエクスポート ウィザード**が開きます。
2. ウィザードで **[次へ]** をクリックし、**[はい、秘密キーをエクスポートします]** を選択して、**[次へ]** をクリックします。
3. **[エクスポート ファイルの形式]** ページでは、既定値をそのまま使用します。 その後、 **[次へ]**をクリックします。 
4. **[セキュリティ]** ページでは、秘密キーを保護する必要があります。 パスワードを使用する場合は、この証明書に設定したパスワードを必ず記録しておくか、覚えておいてください。 その後、 **[次へ]**をクリックします。
5. **[エクスポートするファイル]** で、**[参照]** をクリックして証明書をエクスポートする場所を選択します。 **[ファイル名]**に証明書ファイルの名前を指定します。 その後、 **[次へ]**をクリックします。
6. **[完了]** をクリックして、証明書をエクスポートします。

### <a name="install-the-client-certificate"></a>クライアント証明書のインストール

クライアント証明書をインストールするときに、クライアント証明書のエクスポート時に作成されたパスワードが必要になります。

1. *.pfx* ファイルを見つけ、クライアント コンピューターにコピーします。 クライアント コンピューターで、 *.pfx* ファイルをダブルクリックしてインストールします。 **[ストアの場所]** は **[現在のユーザー]** のままにしておき、**[次へ]** をクリックします。
2. **[インポートするファイル]** ページでは、何も変更しないでください。 **[次へ]**をクリックします。
3. **[秘密キーの保護]** ページで、証明書にパスワードを使用した場合はそのパスワード入力するか、証明書をインストールするセキュリティ プリンシパルが正しいことを確認し、**[次へ]** をクリックします。
4. **[証明書ストア]** ページで、既定の場所をそのまま使用し、**[次へ]** をクリックします。
5. **[完了]**をクリックします。 証明書のインストールの **[セキュリティ警告]** で **[はい]** をクリックします。 証明書を生成したので、[はい] をクリックしても問題ありません。 これで証明書がインポートされます。

## <a name="vpnclientconfig"></a>セクション 4 - VPN クライアントの構成
仮想ネットワークに接続するには、VPN クライアントも構成する必要があります。 クライアントが正常に接続するためには、クライアント証明書と適切な VPN クライアント構成パッケージの両方が必要です。 VPN クライアントを構成するには、次の手順を順に実行します。

### <a name="part-1-create-the-vpn-client-configuration-package"></a>パート 1: VPN クライアント構成パッケージの作成
1. Azure クラシック ポータルで、仮想ネットワークの **[ダッシュボード]** ページにアクセスし、右隅にある [概要] メニューに移動します。 VPN クライアント パッケージには、Windows に組み込まれた VPN クライアント ソフトウェアを構成する構成情報が含まれています。 このパッケージでは、追加のソフトウェアはインストールされません。 この設定は、接続先の仮想ネットワークに固有です。 サポートされているクライアント オペレーティング システムの一覧については、この記事の最後にある「[ポイント対サイト接続に関してよく寄せられる質問](#faq)」を参照してください。<br><br>インストール先のクライアントのオペレーティング システムに対応するダウンロード パッケージを選択します。
   
   * 32 ビットのクライアントの場合は、 **[32 ビットのクライアント VPN パッケージのダウンロード]**を選択します。
   * 64 ビットのクライアントの場合は、 **[64 ビットのクライアント VPN パッケージのダウンロード]**を選択します。
2. クライアント パッケージの作成には数分かかります。 パッケージの作成が完了したら、ファイルをダウンロードできます。 ダウンロードした *.exe* ファイルは、ローカル コンピューターに安全に格納することができます。
3. Azure クラシック ポータルで VPN クライアント パッケージを生成してダウンロードした後、仮想ネットワークに接続するクライアント コンピューターにクライアント パッケージをインストールすることができます。 複数のクライアント コンピューターに VPN クライアント パッケージをインストールする場合は、各コンピューターにクライアント証明書がインストールされていることを確認します。

### <a name="part-2-install-the-vpn-configuration-package-on-the-client"></a>パート 2: クライアントへの VPN 構成パッケージのインストール
1. 仮想ネットワークに接続するコンピューターのローカルに構成ファイルをコピーして、.exe ファイルをダブルクリックします。 
2. パッケージがインストールされると、VPN 接続を開始できます。 構成パッケージは Microsoft によって署名されていません。 パッケージは、組織の署名サービスを使用して署名できます。または、[SignTool](http://go.microsoft.com/fwlink/p/?LinkId=699327) を使用してユーザー自身が署名することもできます。 署名なしでパッケージを使用することもできます。 ただし、パッケージが署名されていない場合は、パッケージのインストール時に警告が表示されます。
3. クライアント コンピューターで **[ネットワークの設定]** に移動し、**[VPN]** をクリックします。 接続が一覧で表示されます。 接続先となる仮想ネットワークの名前が、次のように表示されます。 
   
    ![VPN クライアント](./media/vpn-gateway-point-to-site-create/vpn.png "VPN クライアント")

### <a name="part-3-connect-to-azure"></a>パート 3: Azure への接続
1. VNet に接続するには、クライアント コンピューターで [VPN 接続] に移動し、作成した VPN 接続を見つけます。 仮想ネットワークと同じ名前が付いています。 **[接続]**をクリックします。 証明書を使用することを示すポップアップ メッセージが表示される場合があります。 その場合、 **[続行]** をクリックして、昇格された特権を使用します。 
2. **接続**の状態ページで、**[接続]** をクリックして接続を開始します。 **[証明書の選択]** 画面が表示された場合は、表示されているクライアント証明書が接続に使用する証明書であることを確認します。 そうでない場合は、ドロップダウン矢印を使用して適切な証明書を選択し、 **[OK]**をクリックします。
   
    ![VPN クライアント 2](./media/vpn-gateway-point-to-site-create/clientconnect.png "VPN クライアント接続")
3. これで接続が確立されたはずです。
   
    ![VPN クライアント 3](./media/vpn-gateway-point-to-site-create/connected.png "VPN クライアント接続 2")

> [!NOTE]
> エンタープライズ CA ソリューションを使用して発行した証明書を使用している場合に認証の問題が発生したときは、クライアント証明書の認証の順序を確認します。 認証の一覧の順序を確認するには、クライアント証明書をダブルクリックし、**[詳細]、[拡張キー使用法]** の順に選択します。 一覧の最初の項目として "クライアント認証" が表示されていることを確認します。 表示されていない場合は、一覧の最初の項目が "クライアント認証" であるユーザー テンプレートに基づいたクライアント証明書を発行する必要があります。 
>
>

### <a name="part-4-verify-the-vpn-connection"></a>パート 4: VPN 接続の確認
1. VPN 接続がアクティブであることを確認するには、管理者特権でのコマンド プロンプトを開いて、 *ipconfig/all*を実行します。
2. 結果を表示します。 受信した IP アドレスが、VNet の作成時に指定したポイント対サイト接続アドレス範囲内のアドレスのいずれかであることに注意してください。 結果は、次のようになります。

例:

    PPP adapter VNet1:
        Connection-specific DNS Suffix .:
        Description.....................: VNet1
        Physical Address................:
        DHCP Enabled....................: No
        Autoconfiguration Enabled.......: Yes
        IPv4 Address....................: 192.168.130.2(Preferred)
        Subnet Mask.....................: 255.255.255.255
        Default Gateway.................:
        NetBIOS over Tcpip..............: Enabled

## <a name="faq"></a>ポイント対サイト接続に関してよく寄せられる質問

[!INCLUDE [Point-to-Site FAQ](../../includes/vpn-gateway-point-to-site-faq-include.md)]

## <a name="next-steps"></a>次のステップ

接続が完成したら、仮想ネットワークに仮想マシンを追加することができます。 詳細については、[Virtual Machines](https://docs.microsoft.com/azure/#pivot=services&panel=Compute) に関するページを参照してください。 ネットワークと仮想マシンの詳細については、「[Azure と Linux の VM ネットワークの概要](../virtual-machines/virtual-machines-linux-azure-vm-network-overview.md)」を参照してください。


