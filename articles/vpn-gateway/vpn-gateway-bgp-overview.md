<properties
   pageTitle="Azure VPN ゲートウェイを使用した BGP の概要 |Microsoft Azure"
   description="この記事では、Azure VPN ゲートウェイを使用した BGP の概要を説明します。"
   services="vpn-gateway"
   documentationCenter="na"
   authors="yushwang"
   manager="rossort"
   editor=""
   tags=""/>

<tags
   ms.service="vpn-gateway"
   ms.devlang="na"
   ms.topic="get-started-article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="04/26/2016"
   ms.author="yushwang"/>

# Azure VPN ゲートウェイを使用した BGP の概要

この記事では、Azure VPN ゲートウェイの BGP (ボーダー ゲートウェイ プロトコル) サポートの概要を説明します。

## BGP について

BGP は、2 つ以上のネットワーク間でルーティングと到達可能性の情報を交換するためにインターネット上で広く使用されている標準のルーティング プロトコルです。Azure Virtual Networks のコンテキストでは、Azure VPN ゲートウェイとオンプレミスの VPN デバイス (BGP ピアまたは BGP 近隣ノードと呼ばれる) が BGP を使用して "ルート" を交換します。これによって、関連するゲートウェイまたはルーターの可用性と、BGP のプレフィックスが到達できる可能性に関する情報が両方のゲートウェイに伝達されます。また、BGP では、BGP ゲートウェイが特定の BGP ピアから学習したルートを他のすべての BGP ピアに伝達することで、複数のネットワークでトランジット ルーティングを行うこともできます。
 
### BGP を使用する理由

BGP は、Azure のルートベースの VPN ゲートウェイで使用できるオプションの機能です。この機能を有効にするには、オンプレミスの VPN デバイスが BGP をサポートしていることを事前に確認する必要があります。BGP を使用せずに Azure VPN ゲートウェイとオンプレミスの VPN デバイスを使用することもできます。これ (BGP を使用しない方法) は静的ルートを使用するのと同等で、BGP を使用する方法はネットワークと Azure の間で動的ルーティングを使用するのに相当します。

BGP の使用に関して、いくつかの利点と新しい機能があります。

#### 自動的で柔軟なプレフィックスの更新のサポート

BGP を使用する場合は、IPsec S2S VPN トンネル経由で特定の BGP ピアに最小限のプレフィックスを宣言するだけで済みます。オンプレミス VPN デバイスの BGP ピア IP アドレスのホスト プレフィックス (/32) のような小さいプレフィックスも指定できます。どのオンプレミス ネットワーク プレフィックスを Azure にアドバタイズして、Azure 仮想ネットワーク (VNet) にアクセスを許可するかを制御できます。
	
また、既定のルート (0.0.0.0/0) や大規模なプライベート IP アドレス空間 (例: 10.0.0.0/8) など、VNet アドレス プレフィックスがいくつか含まれた大規模なプレフィックスをアドバタイズすることもできます。ただし、このプレフィックスを VNet プレフィックスのいずれかと同じにすることはできませんので注意してください。VNet プレフィックスと同一のルートは拒否されます。

#### BGP ベースの自動フェールオーバーを使用した VNet とオンプレミス サイト間の複数のトンネルのサポート

同じ場所にある複数のオンプレミス VPN デバイスと Azure VNet の間に複数の接続を確立できます。この機能により、2 つのネットワークの間に複数のトンネル (パス) がアクティブ/アクティブ構成で提供されます。トンネルの 1 つが切断された場合は、対応するルートが BGP によって無効にされ、トラフィックが残りのトンネルに自動的に移行されます。
	
次の図は、この高可用性セットアップの単純な例を示しています。
	
![Multiple active paths](./media/vpn-gateway-bgp-overview/multiple-active-tunnels.png)

#### オンプレミスのネットワークと複数の Azure Vnet の間のトランジット ルーティングのサポート

BGP では、接続が直接か間接的かにかかわらず、複数のゲートウェイが異なるネットワークからプレフィックスを学習して伝達することができます。これにより、オンプレミス サイト間または複数の Azure Virtual Networks 間で Azure VPN ゲートウェイを使用したトランジット ルーティングを実行できます。
	
次の図は、Microsoft ネットワーク内の Azure VPN ゲートウェイを通じて 2 つのオンプレミス ネットワーク間でトラフィックをやり取りできる複数のパスを使用したマルチホップ トポロジの例を示しています。

![Multi-hop transit](./media/vpn-gateway-bgp-overview/full-mesh-transit.png)

## BGP についてよく寄せられる質問

#### BGP はすべての Azure VPN Gateway SKU でサポートされていますか。

いいえ、BGP は、Azure の **Standard** および **HighPerformance** VPN Gateway でサポートされています。**Basic** SKU ではサポートされていません。

#### Azure のポリシーベースの VPN ゲートウェイでは BGP を使用できますか。

いいえ、BGP は、ルートベースの VPN ゲートウェイでのみサポートされています。

#### プライベート ASN (自律システム番号) は使用できますか。

はい、オンプレミスのネットワークと Azure 仮想ネットワークの両方に対して独自のパブリック ASN またはプライベート ASN を使用できます。

#### オンプレミスの VPN ネットワークと Azure Vnet の両方に同じ ASN を使用できますか。

いいえ、BGP を使用して接続している場合は、オンプレミスのネットワークと Azure Vnet に異なる ASN を割り当てる必要があります。Azure VPN ゲートウェイには、クロスプレミス接続向けに BGP が有効になっているかどうかにかかわらず、ASN の既定値として 65515 が割り当てられています。VPN ゲートウェイを作成する際に異なる ASN を割り当てて既定値を上書きするか、ゲートウェイの作成後に ASN を変更することができます。対応する Azure ローカル ネットワーク ゲートウェイにオンプレミスの ASN を割り当てる必要があります。



#### Azure VPN ゲートウェイはどのようなアドレス プレフィックスをアドバタイズしますか。

Azure VPN ゲートウェイでは、オンプレミスの BGP デバイスに次のルートをアドバタイズします。

- VNet のアドレス プレフィックス
- Azure VPN ゲートウェイに接続されている各ローカル ネットワーク ゲートウェイのアドレス プレフィックス
- Azure VPN ゲートウェイに接続されている他の BGP ピアリング セッションから学習したルート。ただし、**VNet プレフィックスと重複している既定のルートは除外されます**。

#### VNet 間の接続で BGP を使用できますか。

はい、クロスプレミス接続と VNet 間接続の両方で BGP を使用できます。

#### Azure VPN ゲートウェイで BGP 接続を BGP 以外の接続と混在させることはできますか。

はい、同じ Azure VPN ゲートウェイに対して BGP 接続と非 BGP 接続の両方を混在させることができます。

#### Azure VPN ゲートウェイでは、BGP トランジット ルーティングをサポートしていますか。

はい、BGP トランジット ルーティングはサポートされています。ただし、Azure VPN ゲートウェイは既定のルートを他の BGP ピアに**アドバタイズしません**。複数の Azure VPN ゲートウェイでトランジット ルーティングを有効にするには、中間にあるすべての VNet 接続で BGP を有効にする必要があります。

#### Azure VPN ゲートウェイとオンプレミス ネットワークの間で複数のトンネルを確立することはできますか。

はい、Azure VPN ゲートウェイとオンプレミス ネットワークの間に複数の S2S VPN トンネルを確立することができます。これらのトンネルはすべて Azure VPN ゲートウェイのトンネルの合計数にカウントされる点に注意してください。たとえば、Azure VPN ゲートウェイとオンプレミス ネットワークのいずれかの間に 2 つの冗長トンネルがある場合は、Azure VPN ゲートウェイの合計クォータ (Standard の場合は 10、HighPerformance の場合は 30) から 2 つのトンネルが消費されることになります

#### BGP で 2 つの Azure Vnet の間に複数のトンネルを確立することはできますか。

いいえ、一組の仮想ネットワーク間に冗長トンネルを確立することはできません。

#### Azure VPN ゲートウェイでは、BGP ピア IP にどのようなアドレスが使用されますか。

Azure VPN ゲートウェイでは、仮想ネットワークに対して定義されている GatewaySubnet 範囲から 1 つの IP アドレスを割り当てます。既定では、範囲内で最後から 2 つ目のアドレスが使用されます。たとえば、GatewaySubnet が 10.12.255.0.0/27 で、範囲が 10.42.255.0.0 から 10.42.255.31 となる場合、Azure VPN ゲートウェイの BGP ピア IP アドレスは 10.12.255.30 になります。Azure VPN ゲートウェイの情報を表示すると、この情報を確認できます。

#### VPN デバイスの BGP ピア IP アドレスに関する要件はどんなものですか。

オンプレミスの BGP ピア アドレスを VPN デバイスのパブリック IP アドレスと**同じにすることはできません**。VPN デバイスでは BGP ピア IP に別の IP アドレスを使用してください。デバイスのループバック インターフェイスに割り当てられたアドレスを使用できます。この場所を表している、対応するローカル ネットワーク ゲートウェイにこのアドレスを指定します。

#### BGP を使用する際、ローカル ネットワーク ゲートウェイのアドレス プレフィックスとして何を指定する必要がありますか。

Azure のローカル ネットワーク ゲートウェイでは、オンプレミス ネットワークに初期アドレス プレフィックスが指定されます。BGP を使用する際は、BGP ピア IP アドレスのホスト プレフィックス (/32 プレフィックス) をオンプレミス ネットワークのアドレス空間として割り当てる必要があります。BGP ピア IP アドレスが 10.52.255.254 の場合は、このオンプレミス ネットワークを表しているローカル ネットワーク ゲートウェイの localNetworkAddressSpace として "10.52.255.254/32" を指定します。これにより、Azure VPN ゲートウェイで S2S VPN トンネルを経由する BGP セッションが確立されます。

#### BGP ピアリング セッション向けにオンプレミスの VPN デバイスに何を追加する必要がありますか。

IPsec S2S VPN トンネルを示す Azure BGP ピア IP アドレスのホスト ルートを VPN デバイスに追加する必要があります。たとえば、Azure VPN ピア IP が "10.12.255.30" の場合は、"10.12.255.30" のホスト ルートを VPN デバイスに追加し、対応する IPsec トンネル インターフェイスの次ホップ インターフェイスを指定する必要があります。

## 次のステップ

クロスプレミス接続と VNet 間接続向けに BGP を構成する手順については、「[Getting started with BGP on Azure VPN gateways (Azure VPN ゲートウェイでの BGP の使用)](./vpn-gateway-bgp-resource-manager-ps.md)」を参照してください。

<!---HONumber=AcomDC_0427_2016-->