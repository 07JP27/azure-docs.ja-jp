<properties 
   pageTitle="makecert を使用したポイント対サイト仮想ネットワークのクロスプレミス接続の自己署名証明書の作成 | Microsoft Azure"
   description="この記事では、makecert を使用して、Windows 10 で自己署名証明書を作成する手順について説明します。"
   services="vpn-gateway"
   documentationCenter="na"
   authors="cherylmc"
   manager="carmonm"
   editor=""
   tags="azure-resource-manager"/>
<tags 
   ms.service="vpn-gateway"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="08/22/2016"
   ms.author="cherylmc" />

# ポイント対サイト接続の自己署名証明書の操作

この記事では、**makecert** を使用して自己署名証明書を作成し、そこからクライアント証明書を生成する方法について説明します。以下の手順は、Windows 10 で makecert を使用する方法を示しています。makecert は、P2S 接続と互換性がある証明書を作成できることが確認されています。

P2S 接続では、エンタープライズ証明書ソリューションの使用が推奨されます。クライアント証明書は、共通名の形式 'name@yourdomain.com' ('NetBIOS domain name\\username' 形式ではなく) で発行するようにしてください。

エンタープライズ ソリューションをお持ちでない場合、P2S クライアントが仮想ネットワークに接続するためには自己署名証明書が必要です。makecert は非推奨になっていますが、P2S 接続と互換性がある自己署名証明書を作成するための有効なメソッドです。Microsoft では、自己署名証明書を作成するための別のソリューションを開発中ですが、現時点では makecert の使用をお勧めします。

## 自己署名証明書の作成

makecert は、自己署名証明書を作成する方法の 1 つです。次の手順では、makecert を使用して自己署名証明書を作成する方法を説明します。これらの手順は、デプロイ モデル固有のものではありません。リソース マネージャーとクラシックの両方で有効です。

### 自己署名証明書を作成するには

1. Windows 10 を実行しているコンピューターで、[Windows 10 用 Windows ソフトウェア開発キット (SDK)](https://dev.windows.com/ja-JP/downloads/windows-10-sdk) をダウンロードしてインストールします。

2. インストール後、makecert.exe ユーティリティは C:\\Program Files (x86)\\Windows Kits\\10\\bin<arch> で見つかります。
		
	例: `C:\Program Files (x86)\Windows Kits\10\bin\x64`

3. 次に、コンピューターの個人証明書ストアで証明書を作成し、インストールします。次の例は、P2S を構成するときに Azure にアップロードする、対応する *.cer* ファイルを作成します。管理者として次のコマンドを実行します。*ARMP2SRootCert* と *ARMP2SRootCert.cer* を証明書に使用する名前に置き換えます。<br><br>証明書は Certificates - Current User\\Personal\\Certificates にあります。

    	makecert -sky exchange -r -n "CN=ARMP2SRootCert" -pe -a sha1 -len 2048 -ss My "ARMP2SRootCert.cer"


###  <a name="rootpublickey"></a>公開キーを取得するには

ポイント対サイト接続の VPN ゲートウェイの構成の一部として、ルート証明書の公開キーは、Azure にアップロードされます。

1. 証明書から .cer ファイルを取得するには、**certmgr.msc** を開きます。自己署名ルート証明書を右クリックし、**[すべてのタスク]** をクリックしてから **[エクスポート]** をクリックします。**証明書のエクスポート ウィザード**が開きます。

2. ウィザードで **[次へ]** をクリックし、**[いいえ、秘密キーをエクスポートしません]** を選択して、**[次へ]** をクリックします。

3. **[エクスポート ファイルの形式]** ページで、**[Base-64 encoded X.509 (.CER)]** を選択します。 次に、**[次へ]** をクリックします。

4. **[エクスポートするファイル]** で、**[参照]** をクリックして証明書をエクスポートする場所を選択します。**[ファイル名]** に証明書ファイルの名前を指定します。その後、**[次へ]** をクリックします。

5. **[完了]** をクリックして、証明書をエクスポートします。

 
### 自己署名証明書のエクスポート (省略可能)

自己署名証明書をエクスポートし、安全に保管する必要がある場合があります。必要に応じて、後から別のコンピューターにインストールして、さらに多くのクライアント証明書を生成したり、別の .cer ファイルをエクスポートしたりできます。クライアント証明書がインストールされ、また適切な VPN クライアント設定で構成されているコンピューターはいずれも P2S 経由の仮想ネットワークに接続できます。そのため、クライアント証明書は必要な場合にのみ生成およびインストールし、自己署名証明書は安全に保管するようにしてください。

自己署名証明書を .pfx としてエクスポートするには、ルート証明書を選択し、「[クライアント証明書をエクスポートする](#clientkey)」と同じ手順を実行してエクスポートします。

## クライアント証明書の作成とインストール

自己署名証明書をクライアント コンピューターに直接インストールすることはしません。自己署名証明書からクライアント証明書を生成し、生成したクライアント証明書をエクスポートして、クライアント コンピューターにインストールします。これらの手順は、デプロイ モデル固有のものではありません。リソース マネージャーとクラシックの両方で有効です。

### パート 1 - 自己署名証明書からクライアント証明書を生成する

次の手順は、自己署名証明書からクライアント証明書を生成する 1 つの方法を段階的に説明するものです。同じ証明書から複数のクライアント証明書を生成できます。その後、各クライアント証明書をエクスポートし、クライアント コンピューターにインストールできます。

1. 自己署名証明書の作成に使用した同じコンピューターで、管理者としてコマンド プロンプトを開きます。

2. この例では、"ARMP2SRootCert" は、生成した自己署名証明書を指します。
	- *"ARMP2SRootCert"* を、クライアント証明書を生成している自己署名ルートの名前に変更します。
	- *ClientCertificateName* を、クライアント証明書を生成する名前に変更します。


	クライアント証明書を生成するには、サンプルを変更して実行します。変更せずに下の例を実行すると、ルート証明書 ARMP2SRootCert から生成された個人用証明書ストアに ClientCertificateName という名前のクライアント証明書が作成されます。

    	makecert.exe -n "CN=ClientCertificateName" -pe -sky exchange -m 96 -ss My -in "ARMP2SRootCert" -is my -a sha1

4. 証明書はすべて、コンピューターの 'Certificates - Current User\\Personal\\Certificates' ストアに保存されます。この手順に基づいて、必要な数のクライアント証明書を生成することができます。

### <a name="clientkey"></a>パート 2 - クライアント証明書をエクスポートする

1. クライアント証明書をエクスポートするには、**certmgr.msc** を開きます。エクスポートするクライアント証明書を右クリックして、**[すべてのタスク]**、**[エクスポート]** の順にクリックします。**証明書のエクスポート ウィザード**が開きます。

2. ウィザードで **[次へ]** をクリックし、**[はい、秘密キーをエクスポートします]** を選択して、**[次へ]** をクリックします。

3. **[エクスポート ファイルの形式]** ページでは、既定値をそのまま使用します。その後、**[次へ]** をクリックします。
 
4. **[セキュリティ]** ページでは、秘密キーを保護する必要があります。パスワードを使用する場合は、この証明書に設定したパスワードを必ず記録しておくか、覚えておいてください。その後、**[次へ]** をクリックします。

5. **[エクスポートするファイル]** で、**[参照]** をクリックして証明書をエクスポートする場所を選択します。**[ファイル名]** に証明書ファイルの名前を指定します。その後、**[次へ]** をクリックします。

6. **[完了]** をクリックして、証明書をエクスポートします。

### パート 3 - クライアント証明書をインストールする

ポイント対サイト接続を使用して、仮想ネットワークに接続する各クライアントには、クライアント証明書がインストールされている必要があります。この証明書は必要な VPN 構成パッケージに追加されます。次の手順では、クライアント証明書の手動インストールについて説明します。

1. *.pfx* ファイルを見つけ、クライアント コンピューターにコピーします。クライアント コンピューターで、*.pfx* ファイルをダブルクリックしてインストールします。**[ストアの場所]** は **[現在のユーザー]** のままにしておき、**[次へ]** をクリックします。

2. **[インポートするファイル]** ページでは、何も変更しないでください。**[次へ]** をクリックします。

3. **[秘密キーの保護]** ページで、証明書にパスワードを使用した場合はそのパスワード入力するか、証明書をインストールするセキュリティ プリンシパルが正しいことを確認し、**[次へ]** をクリックします。

4. **[証明書ストア]** ページで、既定の場所をそのまま使用し、**[次へ]** をクリックします。

5. **[完了]** をクリックします。証明書のインストールの **[セキュリティ警告]** で **[はい]** をクリックします。これで証明書がインポートされます。

## 次のステップ

引き続きポイント対サイト構成を使用します。

- **Resource Manager** デプロイ モデルの手順については、「[PowerShell を使用した VNet へのポイント対サイト接続の構成](vpn-gateway-howto-point-to-site-rm-ps.md)」をご覧ください。
- **クラシック** デプロイ モデルの手順については、「[クラシック ポータルを使用する VNet へのポイント対サイト VPN 接続の構成](vpn-gateway-point-to-site-create.md)」をご覧ください。

<!---HONumber=AcomDC_0831_2016-->