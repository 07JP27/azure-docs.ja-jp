---
title: "ポイント対サイト接続の自己署名証明書の作成: Azure | Microsoft Docs"
description: "この記事では、makecert を使用して、Windows 10 で自己署名証明書を作成する手順について説明します。"
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 27b99f7c-50dc-4f88-8a6e-d60080819a43
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 02/15/2017
ms.author: cherylmc
translationtype: Human Translation
ms.sourcegitcommit: 4c8fc5b20416d59eccdf34aaea95ed158d9c04fa
ms.openlocfilehash: a3965a149fa62e5630d2b9940d4940308991aed1
ms.lasthandoff: 02/16/2017


---
# <a name="working-with-self-signed-certificates-for-point-to-site-connections"></a>ポイント対サイト接続の自己署名証明書の操作
この記事では、**makecert** を使って自己署名証明書を作成し、自己署名証明書からクライアント証明書を生成する方法について説明します。 P2S 接続の場合、証明書の望ましい方法は、エンタープライズ証明書ソリューションを使うことです。 "NetBIOS ドメイン名\ユーザー名" の形式ではなく、共通名の値の形式 'name@yourdomain.com', を使ってクライアント証明書を発行してください。

エンタープライズ ソリューションをお持ちでない場合、P2S クライアントが仮想ネットワークに接続するためには自己署名証明書が必要です。 PowerShell を使って証明書を作成することもできますが、PowerShell で生成される証明書には、P2S 認証のために Azure が必要とする必須フィールドが含まれていません。 makecert は、P2S 接続と互換性がある証明書を作成できることが確認されています。 makecert は、P2S 構成での使用については廃止されていません。

## <a name="create-a-self-signed-certificate"></a>自己署名証明書の作成
次の手順では、makecert を使用して自己署名証明書を作成する方法を説明します。 これらの手順は、デプロイ モデル固有のものではありません。 リソース マネージャーとクラシックの両方で有効です。

### <a name="to-create-a-self-signed-certificate"></a>自己署名証明書を作成するには
1. Windows 10 を実行しているコンピューターで、[Windows 10 用 Windows ソフトウェア開発キット (SDK)](https://dev.windows.com/en-us/downloads/windows-10-sdk) をダウンロードしてインストールします。
2. インストール後、makecert.exe ユーティリティは 'C:\Program Files (x86)\Windows Kits\10\bin\<arch>' で見つかります。 管理者としてコマンド プロンプトを開き、makecert ユーティリティの場所に移動します。 以下の例を使用できます。

        cd C:\Program Files (x86)\Windows Kits\10\bin\x64

3. コンピューターの個人証明書ストアで証明書を作成し、インストールします。 次の例は、P2S を構成するときに Azure にアップロードする、対応する *.cer* ファイルを作成します。 'ARMP2SRootCert' と 'ARMP2SRootCert.cer' を証明書に使う名前に置き換えます。<br><br>証明書は 'Current User\Personal\Certificates' にあります。
   
        makecert -sky exchange -r -n "CN=ARMP2SRootCert" -pe -a sha1 -len 2048 -ss My "ARMP2SRootCert.cer"

### <a name="a-namerootpublickeyato-obtain-the-public-key"></a><a name="rootpublickey"></a>公開キーを取得するには
ポイント対サイト接続の VPN ゲートウェイの構成の一部として、ルート証明書の公開キーは、Azure にアップロードされます。 

1. 証明書から .cer ファイルを取得するには、 **certmgr.msc**を開きます。 自己署名ルート証明書を探して右クリックします (通常は 'Current User\Personal\Certificates' にあります)。 **[すべてのタスク]**、**[エクスポート]** の順にクリックします。 **証明書のエクスポート ウィザード**が開きます。
2. ウィザードで **[次へ]** をクリックします。 **[いいえ、秘密キーをエクスポートしません]** を選択して、**[次へ]** をクリックします。
3. **[エクスポート ファイルの形式]** ページで **[Base-64 encoded X.509 (.CER)]** を選択し、**[次へ]** をクリックします。 
4. **[エクスポートするファイル]** で、**[参照]** をクリックして証明書をエクスポートする場所を選択します。 **[ファイル名]**に証明書ファイルの名前を指定します。 その後、 **[次へ]**をクリックします。
5. **[完了]** をクリックして、証明書をエクスポートします。 "**エクスポートに成功しました**" というメッセージが表示されます。 **[OK]** をクリックしてウィザードを閉じます。

### <a name="export-the-self-signed-certificate-optional"></a>自己署名証明書のエクスポート (省略可能)
自己署名証明書をエクスポートし、安全に保管する必要がある場合があります。 必要に応じて、後から別のコンピューターにインストールして、さらに多くのクライアント証明書を生成したり、別の .cer ファイルをエクスポートしたりできます。 クライアント証明書がインストールされ、また適切な VPN クライアント設定で構成されているコンピューターはいずれも P2S 経由の仮想ネットワークに接続できます。 そのため、クライアント証明書は必要な場合にのみ生成およびインストールし、自己署名証明書は安全に保管するようにしてください。

自己署名証明書を .pfx としてエクスポートするには、ルート証明書を選択し、「 [クライアント証明書をエクスポートする](#clientkey) 」と同じ手順を実行してエクスポートします。

## <a name="create-and-install-client-certificates"></a>クライアント証明書の作成とインストール
自己署名証明書をクライアント コンピューターに直接インストールすることはしません。 自己署名証明書からクライアント証明書を生成し、 生成したクライアント証明書をエクスポートして、クライアント コンピューターにインストールします。 これらの手順は、デプロイ モデル固有のものではありません。 リソース マネージャーとクラシックの両方で有効です。

### <a name="part-1---generate-a-client-certificate-from-a-self-signed-certificate"></a>パート 1 - 自己署名証明書からクライアント証明書を生成する
次の手順は、自己署名証明書からクライアント証明書を生成する&1; つの方法を段階的に説明するものです。 同じ証明書から複数のクライアント証明書を生成できます。 その後、各クライアント証明書をエクスポートし、クライアント コンピューターにインストールできます。 

1. 自己署名証明書の作成に使用した同じコンピューターで、管理者としてコマンド プロンプトを開きます。
2. クライアント証明書を生成するには、サンプルを変更して実行します。
    * *"ARMP2SRootCert"* を、クライアント証明書を生成している自己署名ルートの名前に変更します。 必ずルート証明書の名前を使用してください。これは、自己署名ルートの作成時に指定した 'CN=' の値です。
    * *ClientCertificateName* を、クライアント証明書を生成する名前に変更します。<br><br>変更せずに下の例を実行すると、ルート証明書 ARMP2SRootCert から生成された個人用証明書ストアに ClientCertificateName という名前のクライアント証明書が作成されます。

            makecert.exe -n "CN=ClientCertificateName" -pe -sky exchange -m 96 -ss My -in "ARMP2SRootCert" -is my -a sha1


### <a name="a-nameclientkeyapart-2---export-a-client-certificate"></a><a name="clientkey"></a>パート 2 - クライアント証明書をエクスポートする                                                                                                                        

1. クライアント証明書をエクスポートするには、 **certmgr.msc**を開きます。 エクスポートするクライアント証明書を右クリックして、**[すべてのタスク]**、**[エクスポート]** の順にクリックします。 **証明書のエクスポート ウィザード**が開きます。
2. ウィザードで **[次へ]** をクリックし、**[はい、秘密キーをエクスポートします]** を選択して、**[次へ]** をクリックします。
3. **[エクスポート ファイルの形式]** ページでは、既定値をそのまま使用します。 その後、 **[次へ]**をクリックします。 
4. **[セキュリティ]** ページでは、秘密キーを保護する必要があります。 パスワードを使用する場合は、この証明書に設定したパスワードを必ず記録しておくか、覚えておいてください。 その後、 **[次へ]**をクリックします。
5. **[エクスポートするファイル]** で、**[参照]** をクリックして証明書をエクスポートする場所を選択します。 **[ファイル名]**に証明書ファイルの名前を指定します。 その後、 **[次へ]**をクリックします。
6. **[完了]** をクリックして、証明書をエクスポートします。    

### <a name="part-3---install-a-client-certificate"></a>パート 3 - クライアント証明書をインストールする
ポイント対サイト接続を使用して、仮想ネットワークに接続する各クライアントには、クライアント証明書がインストールされている必要があります。 この証明書は必要な VPN 構成パッケージに追加されます。 次の手順では、クライアント証明書の手動インストールについて説明します。

1. *.pfx* ファイルを見つけ、クライアント コンピューターにコピーします。 クライアント コンピューターで、 *.pfx* ファイルをダブルクリックしてインストールします。 **[ストアの場所]** は **[現在のユーザー]** のままにしておき、**[次へ]** をクリックします。
2. **[インポートするファイル]** ページでは、何も変更しないでください。 **[次へ]**をクリックします。
3. **[秘密キーの保護]** ページで、証明書にパスワードを使用した場合はそのパスワード入力するか、証明書をインストールするセキュリティ プリンシパルが正しいことを確認し、**[次へ]** をクリックします。
4. **[証明書ストア]** ページで、既定の場所をそのまま使用し、**[次へ]** をクリックします。
5. **[完了]**をクリックします。 証明書のインストールの **[セキュリティ警告]** で **[はい]** をクリックします。 証明書を生成したので、[はい] をクリックしても問題ありません。 これで証明書がインポートされます。

## <a name="next-steps"></a>次のステップ
引き続きポイント対サイト構成を使用します。 

* **Resource Manager** デプロイ モデルの手順については、「 [PowerShell を使用した VNet へのポイント対サイト接続の構成](vpn-gateway-howto-point-to-site-rm-ps.md)」をご覧ください。 
* **クラシック** デプロイ モデルの手順については、「 [クラシック ポータルを使用する VNet へのポイント対サイト VPN 接続の構成](vpn-gateway-point-to-site-create.md)」をご覧ください。


