<properties 
   pageTitle="makecert を使用したポイント対サイト VPN Gateway のクロスプレミス構成の自己署名証明書の作成 |Microsoft Azure"
   description="この記事では、makecert を使用して、Windows 10 で自己署名ルート証明書を作成する手順について説明します。"
   services="vpn-gateway"
   documentationCenter="na"
   authors="cherylmc"
   manager="carmonm"
   editor=""
   tags="azure-resource-manager"/>
<tags 
   ms.service="vpn-gateway"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="infrastructure-services"
   ms.date="04/26/2016"
   ms.author="cherylmc" />

# ポイント対サイト構成の自己署名ルート証明書の操作

以下のタスクでは、makecert を使用してルート証明書を作成し、ルート証明書からクライアント証明書を生成します。以下の手順は、Windows 10 で makecert を使用する方法を示しています。

## 自己署名ルート証明書の作成

makecert は、自己署名ルート証明書を作成する方法の 1 つです。次の手順では、makecert を使用して自己署名ルート証明書を作成する方法を説明します。これらの手順は、デプロイ モデル固有のものではありません。リソース マネージャーとクラシックの両方で有効です。

### 自己署名ルート証明書を作成するには

1. Windows 10 を実行しているコンピューターで、[Windows 10 用 Windows ソフトウェア開発キット (SDK)](https://dev.windows.com/ja-JP/downloads/windows-10-sdk) をダウンロードしてインストールします。

2. インストール後、makecert.exe ユーティリティは C:\\Program Files (x86)\\Windows Kits\\10\\bin<arch> で見つかります。
		
	例:
	
		C:\Program Files (x86)\Windows Kits\10\bin\x64\makecert.exe

3. 次に、コンピューターの個人証明書ストアでルート証明書を作成し、インストールします。次の例では、対応する *.cer* ファイルが作成されます (このファイルは後でアップロードします)。次のコマンドを管理者として実行します。*RootCertificateName* は、証明書に使用する名前です。

	注: 何も変更せずに次の例を実行すると、ルート証明書と、対応する *RootCertificateName.cer* ファイルが作成されます。.cer ファイルはコマンドを実行したディレクトリにあります。証明書は Current User\\Personal\\Certificates にあります。

    	makecert -sky exchange -r -n "CN=RootCertificateName" -pe -a sha1 -len 2048 -ss My "RootCertificateName.cer"

	>[AZURE.NOTE] クライアント証明書の生成元となるルート証明書を作成したので、この証明書を秘密キーと共にエクスポートし、回復できる安全な場所に保存します。

## クライアント証明書の生成、エクスポート、インストール

自己署名ルート証明書からクライアント証明書を生成し、そのクライアント証明書をエクスポートしてインストールできます。以下の手順は、デプロイ モデル固有のものではありません。リソース マネージャーとクラシックの両方で有効です。

### 自己署名ルート証明書からクライアント証明書を生成するには

次の手順は、自己署名のルート証明書からクライアント証明書を生成する 1 つの方法を段階的に説明するものです。同じルート証明書から複数のクライアント証明書を生成できます。その後、各クライアント証明書をエクスポートし、クライアント コンピューターにインストールできます。

1. 自己署名のルート証明書の作成に使用した同じコンピューターで、管理者としてコマンド プロンプトを開きます。

2. クライアント証明書ファイルを保存するディレクトリに移動します。*RootCertificateName* は、生成した自己署名ルート証明書を指します。下の例 (RootCertificateName を自分のルート証明書の名前に変更します) を実行すると、個人用証明書ストアに "ClientCertificateName" という名前のクライアント証明書が作成されます。

3. 次のコマンドを入力します。

    	makecert.exe -n "CN=ClientCertificateName" -pe -sky exchange -m 96 -ss My -in "RootCertificateName" -is my -a sha1

4. 証明書はすべて、コンピューターの Current User\\Personal\\Certificates ストアに保存されます。この手順に基づいて、必要な数のクライアント証明書を生成することができます。

### クライアント証明書をエクスポートするには

1. クライアント証明書をエクスポートするには、*certmgr.msc* を使用します。エクスポートするクライアント証明書を右クリックして、**[すべてのタスク]**、**[エクスポート]** の順にクリックします。証明書のエクスポート ウィザードが開きます。

2. ウィザードで **[次へ]** をクリックし、**[はい、秘密キーをエクスポートします]** を選択して、**[次へ]** をクリックします。

3. **[エクスポート ファイルの形式]** ページでは、既定値をそのまま使用します。その後、**[次へ]** をクリックします。
 
4. **[セキュリティ]** ページでは、秘密キーを保護する必要があります。パスワードを使用する場合は、この証明書に設定したパスワードを必ず記録しておくか、覚えておいてください。**[次へ]** をクリックします。

5. **[エクスポートするファイル]** で、**[参照]** をクリックして証明書をエクスポートする場所を選択します。**[ファイル名]** に証明書ファイルの名前を指定します。その後、**[次へ]** をクリックします。

6. **[完了]** をクリックして、証明書をエクスポートします。

### クライアント証明書をインストールするには

ポイント対サイト接続を使用して、仮想ネットワークに接続する各クライアントには、クライアント証明書がインストールされている必要があります。この証明書は必要な VPN 構成パッケージに追加されます。次の手順では、クライアント証明書の手動インストールについて説明します。

1. *.pfx* ファイルを見つけ、クライアント コンピューターにコピーします。クライアント コンピューターで、*.pfx* ファイルをダブルクリックしてインストールします。**[ストアの場所]** は **[現在のユーザー]** のままにしておき、**[次へ]** をクリックします。

2. **[インポートするファイル]** ページでは、何も変更しないでください。**[次へ]** をクリックします。

3. **[秘密キーの保護]** ページで、証明書にパスワードを使用した場合はそのパスワード入力するか、証明書をインストールするセキュリティ プリンシパルが正しいことを確認し、**[次へ]** をクリックします。

4. **[証明書ストア]** ページで、既定の場所をそのまま使用し、**[次へ]** をクリックします。

5. **[完了]** をクリックします。証明書のインストールの **[セキュリティ警告]** で **[はい]** をクリックします。これで証明書がインポートされます。

## 次のステップ

引き続きポイント対サイト構成を使用します。

- **リソース マネージャー** デプロイ モデルの手順については、「[PowerShell を利用し、仮想ネットワークへのポイント対サイト接続を構成する](vpn-gateway-howto-point-to-site-rm-ps.md)」をご覧ください。 
- **クラシック** デプロイ モデルの手順については、「[VNet へのポイント対サイト VPN 接続の構成](vpn-gateway-point-to-site-create.md)」をご覧ください。

<!---HONumber=AcomDC_0427_2016-->