<properties 
	pageTitle="SQL Database V12 へのアップグレードの計画と準備をする" 
	description="Azure SQL Database V12 へのアップグレードに関連する準備作業と制限について説明します。" 
	services="sql-database" 
	documentationCenter="" 
	authors="MightyPen" 
	manager="jeffreyg" 
	editor=""/>


<tags 
	ms.service="sql-database" 
	ms.workload="sql-database" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="03/05/2015" 
	ms.author="genemi"/>


# Azure SQL Database V12 へのアップグレードの計画と準備をする


<!--
GeneMi、2015 年 3 月 5 日 木曜日 20 時 06 分
タイトルから  'Azure' を削除します。
-->


このトピックでは、Azure SQL データベースをバージョン V11 から V12 にアップグレードするために必要な、計画と準備について説明します。


V12 へのアップグレードをサポートする新しい [Azure ポータル](http://portal.azure.com/)が使用できます。


> [AZURE.NOTE]
> プレビューへのアップグレードには、テスト データベース、データベースのコピー、新しいデータベースを使用すると便利です。ビジネスで利用している本番データベースの場合は、プレビュー期間が終了するまで待つことをお勧めします。<br/><br/>
> バージョン ファミリ V12 では、地理的なリージョンがプレビュー状態にあるか GA 状態にあるかを確認できます。「[What's new in SQL Database V12 (SQL Database V12 の新機能)](http://azure.microsoft.com/documentation/articles/sql-database-preview-whats-new/#V12AzureSqlDbPreviewGaTable)」のリージョン表をご覧ください。


次の表は、V12 に関する他のヘルプ トピックの一覧とその説明です。


| タイトルとリンク | コンテンツの説明 |
| :--- | :--- |
| [SQL データベース V12 の新機能](http://azure.microsoft.com/documentation/articles/sql-database-preview-whats-new/) | V12 によって Azure SQL データベースが Microsoft SQL Server 2014 に機能的にどれくらい近づいたかについて説明します。 |
| [チュートリアル: 最新の SQL データベースの更新プログラムの V12 (プレビュー) にサインアップする](http://azure.microsoft.com/documentation/articles/sql-database-preview-sign-up/) | Azure SQL データベースを最新のプレビューにアップグレードする場合に実行する必要がある手順について説明します。 |
| [最新の SQL データベースの更新プログラムの V12 (プレビュー) を作成する](http://azure.microsoft.com/documentation/articles/sql-database-preview-create/) | 最新プレビューの新機能が含まれている新しい Azure SQL データベースを作成する方法について説明します。空のデータベースだけでなく、さまざまなオプションも説明します。 |
| [最新の SQL データベースの更新プログラムの V12 (プレビュー) にアップグレードする](http://azure.microsoft.com/documentation/articles/sql-database-preview-upgrade/) | Azure SQL データベースを最新のプレビューにアップグレードする方法について説明します。アップグレードは永続的なものであり元に戻せないため、最初にデータベースのバックアップが必要となることを説明します。 |


## A. 事前の計画


次のサブセクションでは、Azure SQL データベースを V12 にアップグレードする操作を行う前に理解しておく内容と、決定しておく必要がある項目について説明します。

### A.1 バージョンの明確化


このドキュメントで取り扱うのは、Microsoft Azure SQL データベースのバージョン V11 から V12 へのアップグレードです。正式には、バージョン番号は次の 2 つのような値になります。これらは Transact-SQL ステートメント **SELECT @@version;** によって取得できます。


- 11.0.9228.18 *(V11)*
- 12.0.2000.8 *(または少し高い、V12)*


### A.2 サービス階層の計画


V12 から使用する場合、Azure SQL データベースは Basic、Standard、Premium のサービス階層のみをサポートします。V12 では、Web と Business サービス階層はサポートされません。そのため、現在 Web または Business サービス階層の Azure SQL をアップグレードする場合、新しいサービス階層を設定する必要があります。


Basic、Standard、Premium サービス階層の詳細については、次をご覧ください。


- [SQL データベース Web/Business データベースを新しいサービス階層にアップグレードする](http://azure.microsoft.com/documentation/articles/sql-database-upgrade-new-service-tiers/)
- [Azure SQL データベースの料金](http://azure.microsoft.com/pricing/details/sql-database/)


### A.3 Geo レプリケーションの構成を確認する


Azure SQL データベースを Geo レプリケーション用に構成している場合、現在の構成を文書化しておき、アップグレードの準備捜査を開始する前に、Geo レプリケーションを停止する必要があります。アップグレードが完了したら、Geo レプリケーション用にデータベースを再構成する必要があります。


ソースには手を加えずに、データベースのコピーでテストを行うという方針になります。


### A.4 アップグレードによる置き換えと新しいサーバーへのデータベースのコピー


V11 から V12 に、Azure SQL データベースをアップグレードするために選択できる 2 つの手法があります。


- アップグレードによる置き換え:この処理が完了すると、V11 データベースはなくなります。SQL データベース サーバーは V12 になります。
- V12 サーバーへのデータベースのコピー:この処理では V11 データベースが影響を受けることがなく、V12 Azure SQL データベース サーバー上に V11 データベースのコピーが作成されます。 <br/> クライアント コードがデータベースにアクセスするために使用していた DNS 情報では V11 にアクセスできなくなるため、V11 データベースにアクセスするには DNS 情報の編集が必要になります。


## B. 準備操作


計画が完了したら、次のサブセクションで説明されているアクション手順を実行して、最終的なアップグレード フェーズの準備を行うことができます。


最終的なアップグレード フェーズの詳細な説明は、このヘルプ トピックの上部からリンクされているヘルプ トピックに記載してあります。


### B.1 サービス階層のアクション


V12 では、Web と Business サービスの料金レベルはサポートされません。


V11 Azure SQL データベースが Web または Business データベースのいずれかである場合は、アップグレード処理の際にサポートされる階層へのデータベースの切り替えが通知されます。お使いのデータベースのワークロードの履歴に合った階層にアップグレードすることをお勧めします。ただし、必要に応じて、サポートされる任意の階層を選択できます。


アップグレード前に V11 データベースを Web や Business 階層から切り替えておけば、アップグレード中に必要となる手順を減らすことができます。この操作は Azure ポータルから実行できます。


切り替え先のサービス階層が分からない場合は、最初は Standard 階層の S0 レベルを選択しておくと便利です。


### B.2 アップグレード時に Geo レプリケーションを中断する


データベースで Geo レプリケーションが有効になっていると、V12 へのアップグレードを実行できません。最初にデータベースを再構成して、Geo レプリケーションの使用を停止する必要があります。


アップグレードが完了したら、データベースを構成して、Geo レプリケーションを再度使用できます。


## <a id="limitations"></a>C. V12 へのアップグレード中とアップグレード後の制限事項


このセクションでは、Azure SQL Database V12 へのアップグレードに関連した制限事項について説明します。


### C.1 V12 のプレビュー ポータル


次の 2 つの Azure 管理ポータルの最初のもののみが V12 データベースをサポートします。


- [http://portal.azure.com/](http://portal.azure.com/)
 - この新しいポータルはプレビューの状態で、まだ一般公開 (GA) の状態ではありません。<br/><br/>
- [http://manage.windowsazure.com/](http://manage.windowsazure.com/)
 - この以前のポータルは、V12 をサポートするためには更新されません。


Visual Studio 2013 (VS2013) で Azure SQL データベースに接続することを推奨します。 VS2013 は、次のようなタスクに使用できます。


- T-SQL ステートメントの実行。
- スキーマの設計。
- オンラインまたはオフラインでのデータベースの開発。


代わりに、VS2013 の無償ですべての機能を備えたバージョンである [Visual Studio Community 2013](https://www.visualstudio.com/ja-jp/news/vs2013-community-vs.aspx/) で接続することもできます。


以前の Azure 管理ポータルでは、データベース ページで **[Visual Studio で開く]** をクリックしてコンピューター上で VS2013 を起動し、Azure SQL データベースに接続できます。


代わりに、[CU6](http://support.microsoft.com/kb/3031047/) を含む SQL Server Management Studio (SSMS) 2014 を使用して Azure SQL データベースに接続することもできます。詳細についてはこのブログの投稿をご覧ください。<br/>[Azure SQL データベースのクライアント ツーリングの更新](http://azure.microsoft.com/blog/2014/12/22/client-tooling-updates-for-azure-sql-database/).


### C.2 V12 へアップグレード *during*の制限事項

次の表は、アップグレード処理中に影響する制限事項の説明です。


| 制限事項 | 説明 |
| :--- | :--- |
| アップグレードの実行時間 | サイズが 50 GB を超えるような非常に大きなデータベースの場合は、アップグレード処理に最大で 24 時間かかることがあります。 |
| DNS エントリの更新プログラムの遅延 | アップグレードの完了後は、クライアント アプリケーションからの接続により、システムが V12 データベースの DNS エントリを更新するのに数分かかります。 |
| データベースを作成できない | アップグレードの処理中は、ターゲットの V12 Azure SQL データベース サーバー上にデータベースを作成する次のアクションは実行できません。 <p></p> * 新しいデータベースの作成 <br/> * サーバーへのデータベースのコピー <br/> * 削除したデータベースの復元 <br/> * 特定の時点へのデータベースの復元 <br/><br/> ただし、V12 プレビュー期間が終了するまでには、アップグレード時における、特定の時点への復元機能がサポートされる予定です。 |
| Geo レプリケーションなし | V11 からのアップグレードを実行している最中の V12 サーバーでは Geo レプリケーションはサポートされません。 |
| アラート ルール | V12 データベースにアラート ルールは追加できません。 |


### C.3 V12 へのアップグレード *after*の制限事項

次の表は、アップグレード処理後に影響する制限事項の説明です。


| 制限事項 | 説明 |
| :--- | :--- |
| DNS から V11 データベース | V11 を新しい V12 サーバーにコピーすることによってアップグレードを完了した後は、クライアント コードが接続に使用する DNS 情報は V12 データベースを参照します。 <p> </p> V11 データベースを参照し直すには、クライアント コードが使用する DNS 情報を編集する必要があります。 |
| V11 に戻すことはできない | 置き換えによるアップグレードの後は、元に戻したり取り消したりすることはできません。 |
| Web または Business 階層 | アップグレードを開始すると、新しい V12 データベースでは Web や Business サービス階層を認識したり、受け付けたりできなくなります。 |
| Azure ポータルの料金レベル カードに記載されていない 50% 割引 | プレビュー期間中は、最新の Azure SQL Database プレビュー更新プログラム (V12) に登録したデータベースに対する 50% のプレビュー割引* があります。プレビュー ポータルのサービス料金レベル ブレードに割引が表示されていない場合でも、割引は強制的に適用されます。<br/><br/> 50% 割引は、すべての地理的リージョンで **2015 年 3 月 31 日**まで有効です。この期日にすべてのリージョンで期限切れになります。割引は、一般公開 (GA) 状態が発表されていないリージョンでも有効です。<br/><br/> (* 最新の Azure SQL Database 更新プログラム V12 機能の使用は、ライセンス契約 (例: Enterprise Agreement、Microsoft Azure 契約、マイクロソフト オンライン サブスクリプション契約) に定められたプレビューの規定に従うものとします。また、「[Microsoft Azure プレビューの追加使用条件](http://azure.microsoft.com/support/legal/preview-supplemental-terms/)」が適用される場合があります。プレビュー期間中は、このプレビューに登録したすべてのデータベースに対して、Microsoft (または該当する場合は販売店) による課金が行われます。料金は一般公開 (GA) 段階の半額となっており、50% のプレビュー割引で提供しています。プレビュー期間とそれに伴うプレビュー料金割引が終了する 30 日前に、Microsoft からメールによる通知をお送りします。) |


### C.4 V12 へのアップグレード *after*のエクスポートとインポート


[Azure Web ポータル](http://portal.azure.com/)を使用して V12 データベースをエクスポート、インポートできます。または、次のいずれかのツールを使用してエクスポートまたはインポートすることもできます。


- SQL Server Management Studio (SSMS)
- Visual Studio 2013
- Data-Tier Application Framework (DacFx)


ただし、これらのツールを使用するには、まずそれぞれの最新の更新プログラムをインストールし、新しい V12 の機能が確実にサポートされるようにする必要があります。


- [SQL Server Management Studio 2014 用の累積更新プログラム 6](http://support2.microsoft.com/kb/3031047)
- [Visual Studio 2013 の SQL Server データベース用の 2015年 2 月の更新プログラム](https://msdn.microsoft.com/data/hh297027)
- [Azure SQL データベース V12 用の 2015 年 2月のData-Tier Application Framework (DacFx)](http://www.microsoft.com/download/details.aspx?id=45886)


> [AZURE.NOTE] 上記のツールへのリンクが、2015 年 3 月 2 日以降に更新されました。これらのツールの新しい更新プログラムを使用することをお勧めします。


#### C.4.1 bacpac ファイルに関するインポートの一時的な問題


 (2015 年 2 月 18 日、水曜日現在)


V12 にアップグレードした Azure SQL Database サーバーからの bacpac ファイルのエクスポートに関して、既知の問題があります。エクスポートした bacpac ファイルに、script_deployment_databases という名前の誤ったオブジェクトが含まれています。この誤ったオブジェクトを含む bacpac ファイルは、SQL Server Management Studio (SSMS)、SqlPackage.exe、Data-Tier Application Framework (DacFx) API のどのツールを使用してもインポートできません。


一方、Azure Web ポータルを使用すると、このような bacpac ファイルを Azure SQL Database にインポートできます。この問題は、2015 年 2 月 27 日、金曜日に影響を受けるツールの更新を含めて完全に解決される予定です。それまでは、既にエクスポートした、ファイル名の拡張子が .bacpac であるファイルについてさらにサポートが必要な場合は、Microsoft サポートにお問い合わせください。


エクスポートの問題に加えて、最近バージョン V12 にアップグレードした中の限られた数のサーバーとユーザーに、bacpac ファイルをインポートするときに別のエラーが発生する可能性があります。アクセス権限に関連したこのエラーは一時的名ものであり、サーバーが影響を受けた場合も通常は 1 日以内に解決します。この問題も、2015 年 2 月 23 日の週に完全に解決される予定です。それまでの間、インポート操作を再実行すると成功する場合があります。Azure SQL Database への bacpac ファイルのインポートに関してさらにサポートが必要な場合は、Microsoft サポートにお問い合わせください。


Microsoft サポートに問い合わせる場合の手順は次のとおりです。


1. Azure ポータルにアクセスします。
2. 右上に表示されているアカウント名を右クリックします。
3. 表示されたコンテキスト メニューで、サポートが必要なアイテムをクリックします。
 - 通常、アイテムには **[Microsoft サポートに問い合わせる]** または **[ヘルプとサポート]** というラベルが付いています。


> [AZURE.NOTE] (2015 年 3 月 2 日)
> 
> この C.4.1 のセクションで説明されている問題は解決されました。お客様が処理するために必要な特別な知識やアクションはありません。
> 
> 通常は、bacpac ファイルの古さに関係なく、自動化されたインポート/エクスポートが機能します。
> 
> DacFx を使用して bacpac ファイルを処理するお客様は、更新されたツールをダウンロードしてください。ダウンロード リンクは、セクション C.4 で使用できます。


### C.5 削除した V11 データベースを V12 に復元する

次のシナリオでは、削除した V11 Azure SQL データベースを V12 Azure SQL データベース サーバーに復元します。

1. V11 Azure SQL データベース サーバーを利用していることを前提としています。 <br/> そのサーバーには、使用されなくなった Web と Business サービス階層があります。
2. データベースを削除します。
3. サーバーを V12 にアップグレードします。
4. 次に、データベースをサーバーに復元します。 <br/> それによってデータベースは V12 にアップグレードされ、Standard サービス階層の S0 レベルに設定されます。
5. S0 が適していない場合は、任意のサービス階層にデータベースを切り替えることができます。



## D. エラーの解決

何らかの理由で、アップグレードでエラーが発生した場合は、V11 データベースがそのまま有効なり、通常と同じように利用できます。


## 関連リンク

- Microsoft Azure [プレビュー機能](http://azure.microsoft.com/services/preview/)


<!--Anchors-->
[小見出し 1]: #subheading-1
<!--HONumber=47-->
