<properties
	pageTitle="クイック スタート ガイド: Machine Learning Recommendations API | Microsoft Azure"
	description="Azure Machine Learning Recommendations - クイック スタート ガイド"
	services="cognitive-services"
	documentationCenter=""
	authors="luiscabrer"
	manager="paulettm"
	editor="cgronlun"/>

<tags
	ms.service="cognitive-services"
	ms.workload="data-services"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="05/24/2016"
	ms.author="luisca"/>

#  ビルドの種類とモデルの品質 #

<a name="TypeofBuilds"></a>
## 使用すべき推奨ビルドの種類 ##

現時点では、*Recommendation* ビルドと *FBT* ビルドの 2 種類のビルドがサポートされています。これらはそれぞれ異なるアルゴリズムを使用してビルドされます。また、互いに異なる長所を備えています。

<a name="RecommendationBuild"></a>
### Recommendation ビルド タイプ ###

*Recommendation* ビルド タイプでは、行列因子分解を使用して推奨を提供します。短いバージョンでは、ユーザーのトランザクションを使用して、各項目を説明する[潜在的な特徴](https://en.wikipedia.org/wiki/Latent_variable)ベクトルを生成します。これらの潜在的なベクトルを使って類似した項目を比較します。

ある電子機器ストアでの購入に基づいてモデルをトレーニングするとします。スコア付け時に Lumia 650 フォンを入力としてモデルに付与すると、Lumia 650 フォンを購入する可能性が高い人によって購入される傾向のある一連の項目が返されます。これらの項目は相補的でないことに注意してください。たとえばこの例では、Lumia 650 を好きな人が他のスマートフォンを好きな可能性もあるため、Lumia 650 ではない他のスマートフォンが返されることがあります。

Recommendation ビルドには魅力的な機能が 2 つあります。

-	コールド項目の配置がサポートされます。

 *コールド項目*とは、使用頻度の高くない項目を指す用語です。たとえば、新しい高性能 Lumia フォンの出荷を受け付けたばかりだとします。過去に販売実績がないため、システムは、トランザクションのみに基づいてこの製品の推奨を提示することができません。これは、システムが製品自体の情報から学習する必要があることを意味します。

 コールド項目の配置を使用する場合、カタログ内の各項目について特徴情報を指定する必要があります。カタログの最初の数行は次のようになります (特徴がキーと値の形式であることに注意)。

> 6CX-00001,Surface Pro2, Surface, Type=Hardware, Storage=128GB, Memory=4G, Manufacturer=Microsoft

> 73H-00013,Wake Xbox 360,Gaming, Type=Software, Language=English, Rating=Mature

> WAH-0F05,Minecraft Xbox 360,Gaming, * Type=Software, Language=Spanish, Rating=Youth

> ...

 さらに、ビルド パラメーターを設定する際に、次のように設定する必要があります。

| ビルド パラメーター | メモ
|------------------     |-----------
|useFeaturesInModel | true に設定します。推奨モデルを強化するために特徴を使用するかどうかを示します。 
|allowColdItemPlacement | true に設定します。推奨事項が特徴の類似性を使用してコールド項目もプッシュするかどうかを示します。
| modelingFeatureList | 推奨事項を強化するために推奨事項のビルドに使用される、特徴名のコンマ区切りの一覧。たとえば上記の例では "Language,Storage" です。

-	ユーザー推奨がサポートされます。

 Recommendation ビルドでは、[ユーザー推奨](https://westus.dev.cognitive.microsoft.com/docs/services/Recommendations.V4.0/operations/56f30d77eda5650db055a3dd)がサポートされています。これは、ユーザーのトランザクションの履歴を使用することで、そのユーザーに合わせた推奨を提供できることを意味します。ユーザー推奨を行うために、ユーザー ID やそのユーザーの最近のトランザクション履歴を指定できます。

 ユーザー推奨を利用する典型的な例として、ユーザーが初めてストア/サイトのウェルカム ページにログインしたときが挙げられます。ここで、特定のユーザーを対象とするコンテンツを宣伝できます。
 
 また、ユーザーによる支払いの際に Recommendation ビルド タイプを利用したい場合もあります。この時点では、顧客が購入しようとしている項目の一覧があるため、その時点での買い物かごに基づいた推奨を提供するチャンスです。

<a name="FBTBuild"></a>
### FBT ビルド タイプ ###

*FBT* は、Frequently-Bought-Together (よく一緒に購入されている品目) の略です。FBT ビルドでは、2 つまたは 3 つの異なる製品が同時に購入された回数をカウントする分析が行われます。その後、類似関数 (共起、Jaccard、Lift) に基づいてそのセットが並べ替えられます。

Jaccard と Lift は共起を正規化する方法だと考えてください。これは、項目は実際にシード項目と一緒に購入された場合にのみ返されることを意味します。

Lumia 650 フォンの例では、あるスマートフォン X は、それが Lumia 650 フォンと同じセッションで購入された場合にのみ返されます。このようなケースは可能性が低いため、Lumia 650 用の画面保護シートや電源アダプターなど、Lumia 650 に対し補完的な項目が返されることが予想されます。

現在、ユーザー ID とタイムスタンプが同じであるトランザクションで 2 つの項目が発生した場合に、これらは同じセッションで購入されたと想定されます。

現時点の FBT ビルドでは、コールド項目はサポートされていません。その名前が示すとおり、同じトランザクション内で実際に 2 つの項目が購入されることを想定しているためです。FBT ビルドでは項目のセット (トリプレット) を返すことができますが、入力として単一のシード項目を受け取るため、個人に合わせた推奨はサポートされていません。

<a name="SelectBuild"></a>
## 最適なビルドを選択する方法 ##

上記のガイダンスは、Recommendation ビルドと FBT ビルドのどちらを使用すべきかを判断するうえで十分だと思われますが、どちらのビルドも使用できる場合には、確かな答えにはなりません。また、FBT ビルド タイプを使用する必要があるとわかっている場合でも、類似関数として Jaccard と Lift のどちらを使用するかを決める必要があります。

2 つの異なるビルドから選択する最善の方法は、現実の世界で実際にテスト (オンライン評価) して、それぞれのビルドのコンバージョン率を追跡することです。コンバージョン率は、推奨のクリックまたは推奨の提示からの実際の購入数に基づいて測定できます。また、これらのさまざまな推奨が提示された場合の実際の売上額に基づいて測定することもできます。コンバージョン率のメトリックは、ビジネス目標に応じて選択できます。

場合によっては、運用環境で実行する前にモデルをオフラインで評価する必要があります。オフライン評価はオンライン評価の代わりにはなりませんが、メトリックとして役に立ちます。

<a name="OfflineEvaluation"></a>
## オフライン評価  ##

オフライン評価の目的は、推奨の精度 (推奨される項目のいずれかを実際に購入するユーザーの数) と推奨の多様性 (推奨される項目の実際の数) を予測することです。精度と多様性のメトリック評価の一環として、システムはユーザーのサンプルを探します。その後、これらのユーザーのトランザクションをトレーニング データセットとテスト データセットの 2 つのグループに分割します。

> 注:
>
> オフライン メトリックを使用するには、使用状況データにタイムスタンプが含まれている必要があります (トレーニング データセットとテスト データセットの間で正確に使用状況を分割するために時刻のデータが必要なため)。

> また、オフライン評価では、小規模な使用状況ファイルに対する結果は得られません。これは単に評価を十分なデータに基づいて行う必要があるためです。テスト データセット内に少なくとも 1,000 個の使用状況ポイントがあることを想定しています。

<a name="Precision"></a>
### K の精度 ###
次の表は、K の精度によるオフライン評価の出力を表しています。

| K | 1 | 2 | 3 | 	4 | 	5
|---|---|---|---|---|---|
|割合 |	13\.75 |	18\.04 | 21 |	24\.31 |	26\.61
|テスト中のユーザー |	10,000 |	10,000 |	10,000 |	10,000 |	10,000
|考慮されるユーザー |	10,000 |	10,000 |	10,000 |	10,000 |	10,000
|考慮されないユーザー |	0 |	0 |	0 |	0 |	0

#### K
上記の表では、*K* は顧客に提示された推奨の数を表しています。このため、この表は "テスト期間中に顧客に提示された推奨が 1 つだけの場合、実際にその推奨を購入したのはユーザーの 13.75% のみである" と解釈できます (このモデルは購入データを使用してトレーニングされたと仮定)。これは、"1 の精度" は 13.75 であると言い換えることもできます。

顧客に提示される項目が多いほど、顧客が推奨された項目を購入する確率も高くなっていることがわかります。上記の実験では、この確率は推奨される項目が 5 つの場合に 26.61% であり、ほぼ 2 倍になっています。

#### 割合
提示された K 個の推奨のうち少なくとも 1 つの推奨を操作したユーザーの割合です。この割合は、少なくとも 1 つの推奨を操作したユーザーの数を、考慮されるユーザーの合計で割ることによって計算します (考慮されるユーザーの定義を参照)。

#### テスト中のユーザー
テスト データセット中のユーザーの合計数です。

#### 考慮されるユーザー
ユーザーは、トレーニング データセットを使用して生成されたモデルに基づいて、システムが少なくとも K 個の項目を推奨した場合にのみ考慮されます。

#### 考慮されないユーザー
考慮されないすべてのユーザーを表します。これは、推奨された項目を K 個以上受け取らなかったユーザーです。

考慮されないユーザー = テスト中のユーザー – 考慮されるユーザー

<a name="Diversity"></a>
### 多様性 ###
多様性のメトリックでは、推奨された項目の種類を測定できます。次の表は、多様性によるオフライン評価の出力を表しています。

|百分位のバケット |	0 ～ 90| 90 ～ 99| 99 ～ 100
|------------------|--------|-------|---------
|割合 | 34\.258 | 55\.127| 10\.615


推奨された項目の合計: 100,000

推奨された一意の項目: 954

#### 百分位のバケット
百分位のバケットはそれぞれ、範囲によって表されます (最小値 0 と最大値 100 の間)。値が 100 に近い項目は最も人気のある項目であり、値が 0 に近い項目は最も人気のない項目です。たとえば、百分位のバケットが 99 ～ 100 の場合、割合の値は 10.6 です。これは、推奨の 10.6% が上位 1% の最も人気のある項目を返したことを意味します。百分位のバケットでは、最小値は範囲に含まれており、100 を除いて最大値は範囲に含まれていません。
#### 推奨された一意の項目
評価のために返された個別の項目の数。
#### 推奨された項目の合計
推奨された項目の合計数 (一部重複の可能性あり)。


<a name="ImplementingEvaluation"></a>
### オフライン評価を取得する方法 ###
精度と多様性のオフライン メトリックは、どちらのビルドを使用するかを選択する際に役に立つ場合があります。オフライン メトリックを取得するには、次のことを実行する必要があります。

ビルド時に FBT ビルド パラメーターまたは Recommendation ビルド パラメーターをそれぞれ設定する際に、
1.	enableModelingInsights ビルド パラメーターを true に設定します。

2.	必要に応じて *splitterStrategy* (*RandomSplitter* または *LastEventSplitter*) を選択することもできます。*RandomSplitter* は、特定の *randomSplitterParameters* テスト パーセントとランダム シード値に基づいて、使用状況データをトレーニング セットとテスト セットに分割します。*LastEventSplitter* は、各ユーザーの最後のトランザクションに基づいて、使用状況データをトレーニング セットとテスト セットに分割します。

これにより、トレーニング用のデータのサブセットのみを使用したビルドがトリガーされます。残りのデータは評価メトリックを計算するために使用されます。ビルドの完了後に評価の出力を取得するには、[Get build metrics API](https://westus.dev.cognitive.microsoft.com/docs/services/Recommendations.V4.0/operations/573e43bb3e9d4627a8c4bd3e/console) を呼び出し、それぞれの *modelId* と *buildId* を渡すだけで済みます。

 以下は、この記事で実行したサンプル評価の JSON 出力です。


    {
     "Result": {
     "precisionItemRecommend": null,
     "precisionUserRecommend": {
      "precisionMetrics": [
        {
          "k": 1,
          "percentage": 13.75,
          "usersInTest": 10000,
          "usersConsidered": 10000,
          "usersNotConsidered": 0
        },
        {
          "k": 2,
          "percentage": 18.04,
          "usersInTest": 10000,
          "usersConsidered": 10000,
          "usersNotConsidered": 0
        },
        {
          "k": 3,
          "percentage": 21.0,
          "usersInTest": 10000,
          "usersConsidered": 10000,
          "usersNotConsidered": 0
        },
        {
          "k": 4,
          "percentage": 24.31,
          "usersInTest": 10000,
          "usersConsidered": 10000,
          "usersNotConsidered": 0
        },
        {
          "k": 5,
          "percentage": 26.61,
          "usersInTest": 10000,
          "usersConsidered": 10000,
          "usersNotConsidered": 0
        }
      ],
      "error": null
    },
    "diversityItemRecommend": null,
    "diversityUserRecommend": {
      "percentileBuckets": [
        {
          "min": 0,
          "max": 90,
          "percentage": 34.258
        },
        {
          "min": 90,
          "max": 99,
          "percentage": 55.127
        },
        {
          "min": 99,
          "max": 100,
          "percentage": 10.615
        }
      ],
      "totalItemsRecommended": 100000,
      "uniqueItemsRecommended": 954,
      "uniqueItemsInTrainSet": null,
      "error": null
      }
     },
    "Id": 1,
    "Exception": null,
    "Status": 5,
    "IsCanceled": false,
    "IsCompleted": true,
    "CreationOptions": 0,
    "AsyncState": null,
    "IsFaulted": false
    }

<!---HONumber=AcomDC_0601_2016-->