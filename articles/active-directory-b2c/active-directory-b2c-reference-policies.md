---
title: "Azure Active Directory B2C: 組み込みのポリシー | Microsoft Docs"
description: "Azure Active Directory B2C の拡張可能なポリシー フレームワークと、さまざまなポリシー タイプの作成方法に関するトピック。"
services: active-directory-b2c
documentationcenter: 
author: sama
manager: mbaldwin
editor: bryanla
ms.assetid: 0d453e72-7f70-4aa2-953d-938d2814d5a9
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/26/2017
ms.author: sama
ms.translationtype: HT
ms.sourcegitcommit: bde1bc7e140f9eb7bb864c1c0a1387b9da5d4d22
ms.openlocfilehash: 2b92d8343918075f1469c5b8cc0b042e5f418382
ms.contentlocale: ja-jp
ms.lasthandoff: 07/21/2017

---
# <a name="azure-active-directory-b2c-built-in-policies"></a>Azure Active Directory B2C: 組み込みのポリシー


Azure Active Directory (Azure AD) B2C の拡張可能なポリシー フレームワークは、このサービスの中核となる強みです。 ポリシーには、サインアップ、サインイン、プロファイル編集などのコンシューマーの ID エクスペリエンスが完全に記述されています。 たとえば、サインアップのポリシーを使用して次の設定を構成し、動作を制御できます。

* コンシューマーがアプリケーションにサインアップするために使用できるアカウントの種類 (Facebook などのソーシャル アカウント、または電子メール アドレスなどのローカル アカウント)
* サインアップ中にコンシューマーから収集される属性 (名、郵便番号、靴のサイズなど)
* Azure Multi-Factor Authentication の使用
* すべてのサインアップ ページの外観
* ポリシーの実行が完了したときにアプリケーションが受信する情報 (トークン内で要求として明示される)

テナント内でさまざまな種類のポリシーを複数作成し、必要に応じてそれらをアプリケーションで使用できます。 ポリシーは、アプリケーション間で再利用することができます。 この柔軟性により、開発者は最小限のコード変更で、またはコードをまったく変更せずにコンシューマーの ID エクスペリエンスを定義および変更できます。

ポリシーは、簡単な開発者インターフェイスを使用して入手できます。 アプリケーションは (要求でポリシー パラメーターを渡す) 標準の HTTP 認証要求を使用してポリシーをトリガーし、カスタマイズされたトークンを応答として受信します。 たとえば、サインアップ ポリシーを呼び出す要求とサインイン ポリシーを呼び出す要求の唯一の違いは、"p" クエリ文字列パラメーターで使用されるポリシー名です。

```

https://login.microsoftonline.com/contosob2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e      // Your registered Application ID
&redirect_uri=https%3A%2F%2Flocalhost%3A44321%2F    // Your registered Reply URL, url encoded
&response_mode=form_post                            // 'query', 'form_post' or 'fragment'
&response_type=id_token
&scope=openid
&nonce=dummy
&state=12345                                        // Any value provided by your application
&p=b2c_1_siup                                       // Your sign-up policy

```

```

https://login.microsoftonline.com/contosob2c.onmicrosoft.com/oauth2/v2.0/authorize?
client_id=2d4d11a2-f814-46a7-890a-274a72a7309e      // Your registered Application ID
&redirect_uri=https%3A%2F%2Flocalhost%3A44321%2F    // Your registered Reply URL, url encoded
&response_mode=form_post                            // 'query', 'form_post' or 'fragment'
&response_type=id_token
&scope=openid
&nonce=dummy
&state=12345                                        // Any value provided by your application
&p=b2c_1_siin                                       // Your sign-in policy

```

ポリシー フレームワークの詳細については、[Enterprise Mobility and Security ブログにある Azure AD B2C に関するこのブログの投稿](http://blogs.technet.com/b/ad/archive/2015/11/02/a-look-inside-azuread-b2c-with-kim-cameron.aspx)を参照してください。

## <a name="create-a-sign-up-or-sign-in-policy"></a>サインアップまたはサインイン ポリシーを作成する
このポリシーは、コンシューマーのサインアップおよびサインイン エクスペリエンスの両方を 1 つの構成で処理します。 コンシューマーは、状況に応じて正しいパス (サインアップまたはサインイン) に誘導されます。 

このポリシーはまた、正常なサインアップまたはサインインが実行された後にアプリケーションが受信するトークンの内容も記述します。 サインアップまたはサインイン ポリシーのサンプル コードは、[この記事で入手できます](active-directory-b2c-devquickstarts-web-dotnet-susi.md)。  サインアップ ポリシーおよびサインイン ポリシーの代わりに、このポリシーを使用することをお勧めします。  

1. [最初に、次の手順に従って Azure Portal の B2C 機能ブレードに移動します](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade)。

2. **[Sign-up or sign-in policies] (サインアップまたはサインイン ポリシー)** を選択します。

3. ブレードの上部にある **[+ 追加]** を選択します。

4. **[名前]** によって、アプリケーションで使用されるサインアップ ポリシー名が決定されます。 たとえば、「**SiUpIn**」と入力します。

5. **[ID プロバイダー]** を選択してから、**[Email signup] (電子メール サインアップ)** を選択します。 必要に応じて、既に構成されている場合はソーシャル ID プロバイダーを選択することもできます。 **[OK]**をクリックします。

6. **[サインアップ属性]** を選択します。 ここで、サインアップ中にコンシューマーから収集する属性を選択します。 たとえば、**[国/リージョン]**、**[表示名]**、および **[Postal Code] (郵便番号)** を選択します。 **[OK]**をクリックします。

7. **[アプリケーション クレーム]** を選択します。 ここで、正常なサインアップまたはサインイン エクスペリエンスの後にアプリケーションに送り返されるトークンで返してほしい要求を選択します。 たとえば、**[表示名]**、**[ID プロバイダー]**、**[Postal Code] (郵便番号)**、**[User is new] (ユーザーは新規)**、および **[User's Object ID] (ユーザーのオブジェクト ID)** を選択します。

8. **[作成]**を選択します。 作成したポリシーが **[Sign-up or sign-in policies] (サインアップまたはサインイン ポリシー)** ブレードに **B2C_1_SiUpIn** として表示されることに注意してください (**B2C\_1\_** フラグメントは自動的に追加されます)。

9. **[B2C_1_SiUpIn]** を選択することによってポリシーを開きます。

10. **[アプリケーション]** ドロップダウン メニューで、**[Contoso B2C app] (Contoso B2C アプリ)** を選択します。 **[Reply URL / Redirect URI] (応答 URL/リダイレクト URI)** ドロップダウン メニューで、`https://localhost:44321/` を選択します。

11. **[今すぐ実行]** を選択します。 新しいブラウザー タブが開き、サインアップまたはサインイン コンシューマー エクスペリエンスを実行できます。
    
    > [!NOTE]
    > ポリシーの作成と更新が有効になるまで、最大で 1 分間かかります。
    > 
    > 

## <a name="create-a-sign-up-policy"></a>サインアップ ポリシーを作成する
アプリケーションでサインアップを有効にするには、サインアップ ポリシーを作成する必要があります。 このポリシーは、サインアップ中にコンシューマーが体験するエクスペリエンスと、正常なサインアップの後にアプリケーションが受信するトークンの内容を記述します。

1. [最初に、次の手順に従って Azure Portal の B2C 機能ブレードに移動します](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade)。

2. **[サインアップ ポリシー]** を選択します。

3. ブレードの上部にある **[+ 追加]** を選択します。

4. **[名前]** によって、アプリケーションで使用されるサインアップ ポリシー名が決定されます。 たとえば、「**SiUp**」と入力します。

5. **[ID プロバイダー]** を選択してから、**[Email signup] (電子メール サインアップ)** を選択します。 必要に応じて、既に構成されている場合はソーシャル ID プロバイダーを選択することもできます。 **[OK]**をクリックします。

6. **[サインアップ属性]** を選択します。 ここで、サインアップ中にコンシューマーから収集する属性を選択します。 たとえば、**[国/リージョン]**、**[表示名]**、および **[Postal Code] (郵便番号)** を選択してから、**[OK]** をクリックします。

7. **[アプリケーション クレーム]** を選択します。 ここで、正常なサインアップ エクスペリエンスの後にアプリケーションに送り返されるトークンで返してほしい要求を選択します。 たとえば、**[表示名]**、**[ID プロバイダー]**、**[Postal Code] (郵便番号)**、**[User is new] (ユーザーは新規)**、および **[User's Object ID] (ユーザーのオブジェクト ID)** を選択します。

8. **[作成]**を選択します。 作成されたポリシーが **[サインアップ ポリシー]** ブレードに **B2C_1_SiUp** として表示されることに注意してください (**B2C\_1\_** フラグメントは自動的に追加されます)。

9. **[B2C_1_SiUp]** を選択することによってポリシーを開きます。

10. **[アプリケーション]** ドロップダウンで **[Contoso B2C app] (Contoso B2C アプリ)** を、また **[Reply URL / Redirect URI] (応答 URL/リダイレクト URI)** ドロップダウンで `https://localhost:44321/` を選択します。

11. **[今すぐ実行]** を選択します。 新しいブラウザー タブが開き、アプリケーションへのサインアップのコンシューマー エクスペリエンスを確認できます。
    
    > [!NOTE]
    > ポリシーの作成と更新が有効になるまで、最大で 1 分間かかります。
    > 
    > 

## <a name="create-a-sign-in-policy"></a>サインイン ポリシーを作成する
アプリケーションでサインインを有効にするには、サインイン ポリシーを作成する必要があります。 このポリシーは、サインイン中にコンシューマーが体験するエクスペリエンスと、正常なサインインの後にアプリケーションが受信するトークンの内容を記述します。

1. [最初に、次の手順に従って Azure Portal の B2C 機能ブレードに移動します](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade)。

2. **[サインイン ポリシー]** を選択します。

3. ブレードの上部にある **[+ 追加]** を選択します。

4. **[名前]** によって、アプリケーションで使用されるサインイン ポリシー名が決定されます。 たとえば、「**SiIn**」と入力します。

5. **[ID プロバイダー]** を選択してから、**[ローカル アカウント サインイン]** を選択します。 必要に応じて、既に構成されている場合はソーシャル ID プロバイダーを選択することもできます。 **[OK]**をクリックします。

6. **[アプリケーション クレーム]** を選択します。 ここで、正常なサインイン エクスペリエンスの後にアプリケーションに送り返されるトークンで返してほしい要求を選択します。 たとえば、**[表示名]**、**[ID プロバイダー]**、**[Postal Code] (郵便番号)**、および **[User's Object ID] (ユーザーのオブジェクト ID)** を選択し、**[OK]** をクリックします。

7. **[作成]**を選択します。 作成されたポリシーが **[サインイン ポリシー]** ブレードに **B2C_1_SiIn** として表示されることに注意してください (**B2C\_1\_** フラグメントは自動的に追加されます)。

8. **[B2C_1_SiIn]** をクリックすることによってポリシーを開きます。

9. **[Reply URL / Redirect URI] (応答 URL/リダイレクト URI)** ドロップダウン メニューで、**[Contoso B2C app] (Contoso B2C アプリ)** および `https://localhost:44321/` を選択します。

10. **[今すぐ実行]** を選択します。 新しいブラウザー タブが開き、アプリケーションへのサインインのコンシューマー エクスペリエンスを確認できます。
    
    > [!NOTE]
    > ポリシーの作成と更新が有効になるまで、最大で 1 分間かかります。
    > 
    > 

## <a name="create-a-profile-editing-policy"></a>プロファイル編集ポリシーを作成する
アプリケーションでプロファイル編集を有効にするには、プロファイル編集ポリシーを作成する必要があります。 このポリシーは、プロファイル編集中にコンシューマーが体験するエクスペリエンスと、正常な完了の後にアプリケーションが受信するトークンの内容を記述します。

1. 最初に、[次の手順に従って Azure Portal の B2C 機能ブレードに移動します](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade)。

1. **[プロファイル編集ポリシー]** を選択します。

2. ブレードの上部にある **[+ 追加]** を選択します。

3. **[名前]** によって、アプリケーションで使用されるプロファイル編集ポリシー名が決定されます。 たとえば、「**SiPe**」と入力します。

4. **[ID プロバイダー]** を選択してから、**[ローカル アカウント サインイン]** を選択します。 必要に応じて、既に構成されている場合はソーシャル ID プロバイダーを選択することもできます。 **[OK]**をクリックします。

5. **[プロファイルの属性]** を選択します。 ここで、コンシューマーが表示および編集できる属性を選択します。 たとえば、**[国/リージョン]**、**[表示名]**、および **[Postal Code] (郵便番号)** を選択してから、**[OK]** を選択します。

6. **[アプリケーション クレーム]** を選択します。 ここで、正常なプロファイル編集エクスペリエンスの後にアプリケーションに送り返されるトークンで返してほしい要求を選択します。 たとえば、**[表示名]** および **[Postal Code] (郵便番号)** を選択します。

8. **[作成]**を選択します。 作成されたポリシーが **[プロファイル編集ポリシー]** ブレードに **B2C_1_SiPe** として表示されることに注意してください (**B2C\_1\_** フラグメントは自動的に追加されます)。

9. **[B2C_1_SiPe]** を選択することによってポリシーを開きます。

10. **[アプリケーション]** ドロップダウン メニューで、**[Contoso B2C app] (Contoso B2C アプリ)** を選択します。 **[Reply URL / Redirect URI] (応答 URL/リダイレクト URI)** ドロップダウン メニューで、`https://localhost:44321/` を選択します。

11. **[今すぐ実行]** を選択します。 新しいブラウザー タブが開き、アプリケーションでプロファイル編集のコンシューマー エクスペリエンスを確認できます。
    
    > [!NOTE]
    > ポリシーの作成と更新が有効になるまで、最大で 1 分間かかります。
    > 
    > 

## <a name="create-a-password-reset-policy"></a>パスワードのリセット ポリシーを作成する
アプリケーションできめ細かなパスワード リセットを有効にするには、パスワード リセット ポリシーを作成する必要があります。 [Azure Active Directory B2C: [コンシューマー向けにセルフサービス パスワードのリセットをセットアップする]](active-directory-b2c-reference-sspr.md) で指定されているテナント全体のパスワード リセット オプションがサインイン ポリシーにもそのまま適用できることに注意してください。 

このポリシーは、コンシューマーがパスワード リセット中に体験するエクスペリエンスと、パスワードが正常にリセットされた後にアプリケーションが受信するトークンの内容を記述します。

1. [最初に、次の手順に従って Azure Portal の B2C 機能ブレードに移動します。](active-directory-b2c-app-registration.md#navigate-to-the-b2c-features-blade)

2. **[Password reset policies (パスワード リセット ポリシー)]** を選択します。

3. ブレードの上部にある **[+ 追加]** を選択します。

4. **[名前]** によって、アプリケーションで使用されるパスワード リセット ポリシーの名前が決定されます。 たとえば、「**SSPR**」と入力します。

5. **[ID プロバイダー]** を選択してから、**[Reset password using email address] (電子メール アドレスを使用してパスワードをリセットする)** を選択します。 **[OK]**をクリックします。

6. **[アプリケーション クレーム]** を選択します。 ここで、正常なパスワード リセット エクスペリエンスの後にアプリケーションに送り返されるトークンで返してほしい要求を選択します。 たとえば、**[表示名]** と **[User's Object ID] (ユーザーのオブジェクト ID)** を選択します。

7. **[作成]**を選択します。 作成されたポリシーが **[Password reset policies (パスワード リセット ポリシー)]** ブレードに **B2C_1_SSPR** として表示されることに注意してください (**B2C\_1\_** フラグメントは自動的に追加されます)。

8. **[B2C_1_SSPR]** をクリックすることによってポリシーを開きます。

9. **[アプリケーション]** ドロップダウン メニューで、**[Contoso B2C app] (Contoso B2C アプリ)** を選択します。 **[Reply URL / Redirect URI] (応答 URL/リダイレクト URI)** ドロップダウン メニューで、`https://localhost:44321/` を選択します。

10. **[今すぐ実行]** を選択します。 新しいブラウザー タブが開き、アプリケーションでパスワード リセットのコンシューマー エクスペリエンスを確認できます。
    
    > [!NOTE]
    > ポリシーの作成と更新が有効になるまで、最大で 1 分間かかります。
    > 
    > 

## <a name="frequently-asked-questions"></a>よく寄せられる質問

### <a name="how-do-i-link-a-sign-up-or-sign-in-policy-with-a-password-reset-policy"></a>サインアップまたはサインイン ポリシーをパスワード リセット ポリシーにリンクするにはどうすればよいですか?
サインアップまたはサインイン ポリシーを (ローカル アカウントで) 作成すると、エクスペリエンスの最初のページに **[Forgot password?] (パスワードを忘れた場合)** リンクが表示されます。 このリンクをクリックしても、パスワード リセット ポリシーは自動的にはトリガーされません。 

代わりに、エラー コード **`AADB2C90118`** がアプリに返されます。 アプリは、特定のパスワード リセット ポリシーを呼び出すことによって、このエラー コードを処理する必要があります。 詳細については、[ポリシーをリンクする方法を示すサンプル](https://github.com/AzureADQuickStarts/B2C-WebApp-OpenIDConnect-DotNet-SUSI)を参照してください。

### <a name="should-i-use-a-sign-up-or-sign-in-policy-or-a-sign-up-policy-and-a-sign-in-policy"></a>サインアップまたはサインイン ポリシーと、サインアップ ポリシーおよびサインイン ポリシーのどちらを使用すればよいですか?
サインアップ ポリシーおよびサインイン ポリシーより、サインアップまたはサインイン ポリシーを使用することをお勧めします。  

サインアップまたはサインイン ポリシーは、サインイン ポリシーより多くの機能を備えています。 また、ページ UI のカスタマイズを使用したり、ローカライズのより適切なサポートを受けたりすることもできます。 

ポリシーをローカライズする必要がなく、必要なのはブランドのマイナーなカスタマイズ機能だけであり、それにパスワード リセットを組み込みたい場合は、サインイン ポリシーをお勧めします。

## <a name="next-steps"></a>次のステップ
* [トークン、セッション、およびシングル サインオンの構成](active-directory-b2c-token-session-sso.md)
* [コンシューマーのサインアップ時の電子メール検証の無効化](active-directory-b2c-reference-disable-ev.md)


