---
title: Microsoft Azure Data Box に SMB 経由でデータをコピーする | Microsoft Docs
description: データ コピー サービス経由でお客様の Azure Data Box にデータをコピーする方法について説明します
services: databox
author: alkohli
ms.service: databox
ms.subservice: pod
ms.topic: tutorial
ms.date: 01/24/2019
ms.author: alkohli
ms.openlocfilehash: 9d271642a432d8a149fbe468087a0598c91e7c36
ms.sourcegitcommit: 644de9305293600faf9c7dad951bfeee334f0ba3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/25/2019
ms.locfileid: "54902381"
---
# <a name="tutorial-use-data-copy-service-to-directly-ingest-data-into-azure-data-box-preview"></a>チュートリアル:データ コピー サービスを使用して直接 Azure Data Box にデータを取り込む (プレビュー)

このチュートリアルでは、中間ホストを介さずデータ コピー サービスを使用してデータを取り込む方法について説明します。 データ コピー サービスは、Data Box 上でローカルに動作し、SMB 経由でお客様の NAS デバイスに接続して、Data Box にデータをコピーします。

データ コピー サービスの用途:

- 中間ホストが必ずしも利用できないネットワーク接続ストレージ (NAS) 環境。
- データのインジェストとアップロードに数週間かかる小さなファイル。 このサービスを利用すると、インジェストとアップロードにかかる時間を大幅に短縮できます。

このチュートリアルで学習する内容は次のとおりです。

> [!div class="checklist"]
> * 前提条件
> * Data Box にデータをコピーする


## <a name="prerequisites"></a>前提条件

開始する前に次の点を確認します。

1. [Azure Data Box の設定に関するチュートリアル](data-box-deploy-set-up.md)を完了していること。
2. Data Box の受け取りが済んでいて、ポータル内での注文の状態が **[配信済み]** であること。
3. お客様がデータ コピーのために接続するソース NAS デバイスの資格情報があること。
4. 高速ネットワークに接続していること。 10 GbE 接続を少なくとも 1 つ利用することを強くお勧めします。 10 GbE 接続を利用できない場合は、1 GbE データ リンクを使用します。ただし、コピー速度は低下します。

## <a name="copy-data-to-data-box"></a>Data Box にデータをコピーする

NAS に接続したら、次の手順はデータをコピーすることです。 データのコピーを開始する前に、次の考慮事項を確認してください。

- データをコピーするときは、データのサイズが、「[Azure Storage および Data Box の制限に関する記事](data-box-limits.md)」に記載されているサイズ制限に従っていること確認してください。
- Data Box によってアップロードされているデータが、Data Box の外部で別のアプリケーションによって同時にアップロードされた場合、アップロード ジョブ エラーやデータの破損が生じる可能性があります。
- データ コピー サービスによる読み取りの過程でデータが頻繁に変更されている場合、エラーやデータの破損が生じる可能性があります。

データ コピー サービスを使用してデータをコピーするには、ジョブを作成する必要があります。 以下の手順に従って、データをコピーするジョブを作成します。

1. お客様の Data Box のローカル Web UI で、**[管理]、[データのコピー]** の順に移動します。
2. **[データのコピー]** ページで **[作成]** をクリックします。

    ![**[データのコピー]** ページで **[作成]** をクリックする](media/data-box-deploy-copy-data-via-copy-service/click-create.png)

3. **[構成と開始]** ダイアログ ボックスで、次のように入力します。
    
    |フィールド                          |値    |
    |-------------------------------|---------|
    |ジョブ名                       |ジョブの一意の名前を 230 文字未満で指定します。 \<、\>、\|、\?、\*、\\、\:、\/、\\ の各文字は、ジョブの名前には使用できません。         |
    |ソースの場所                |データ ソースの SMB パスを `\\<ServerIPAddress>\<ShareName>` 形式または `\\<ServerName>\<ShareName>` 形式で指定します。        |
    |ユーザー名                       |データ ソースにアクセスするための `\\<DomainName><UserName>` 形式のユーザー名。        |
    |パスワード                       |データ ソースにアクセスするためのパスワード。           |
    |コピー先ストレージ アカウント    |データのアップロード先となるターゲット ストレージ アカウントをドロップダウン リストから選択します。         |
    |Destination storage type (コピー先のストレージの種類)       |ブロック BLOB、ページ BLOB、Azure Files のいずれかから、ターゲット ストレージの種類を選択します。        |
    |コピー先コンテナー/共有    |お客様のコピー先ストレージ アカウントにおけるデータのアップロード先となるコンテナーまたは共有の名前を入力します。 この名前には、共有名またはコンテナー名を使用できます。 たとえば、`myshare` または `mycontainer` です。 クラウドの `sharename\directory_name` 形式または `containername\virtual_directory_name` 形式で入力することもできます。        |
    |パターンに一致するファイルのコピー    | 次の 2 つの方法で、ファイル名の一致パターンを入力します。<ul><li>**ワイルドカード式を使用する** - ワイルドカード式でサポートされるのは `*` と `?` だけです。 たとえば、`*.vhd` という式は、拡張子が .vhd であるすべてのファイルと一致します。 同様に、`*.dl?` は、拡張子が `.dl` または `.dll` であるすべてのファイルと一致します。 また、`*foo` は、名前が `foo` で終わるすべてのファイルと一致します。<br>ワイルドカード式はフィールドに直接入力することができます。 フィールドに入力された値は、既定でワイルドカード式として扱われます。</li><li>**正規表現を使用する** - POSIX ベースの正規表現がサポートされます。 たとえば、正規表現 `.*\.vhd` は、拡張子が `.vhd` であるすべてのファイルと一致します。 正規表現には、`<pattern>` を直接 `regex(<pattern>)` として指定します。 <li>正規表現の詳細については、[正規表現言語のクイック リファレンス](https://docs.microsoft.com/dotnet/standard/base-types/regular-expression-language-quick-reference)を参照してください。</li><ul>|
    |ファイルの最適化              |有効にすると、取り込み時に 1 MB 未満のファイルが圧縮されます。 これにより、小さなファイルのデータをより高速にコピーできるようになります。 ファイル数がディレクトリ数を大幅に超えている場合は、時間を大幅に節約できます。        |
 
4. **[開始]** をクリックします。 入力が検証され、検証が成功した場合にジョブが開始されます。 ジョブが開始されるまでに､数分かかる場合があります。

    ![[ジョブの構成と開始] ダイアログ ボックスからジョブを開始する](media/data-box-deploy-copy-data-via-copy-service/configure-and-start.png)

5. 指定した設定のジョブが作成されます。 チェック ボックスをオンにしたうえで、ジョブの一時停止と再開、取り消し、再起動を実行できます。

    ![[データのコピー] ページでジョブを管理する](media/data-box-deploy-copy-data-via-copy-service/select-job.png)
    
    - ピーク時に NAS リソースに影響が生じる場合は、このジョブを一時停止できます。

        ![ジョブを一時停止する](media/data-box-deploy-copy-data-via-copy-service/pause-job.png)

        ピーク時を避けて後からジョブを再開することができます。

        ![ジョブを再開する](media/data-box-deploy-copy-data-via-copy-service/resume-job.png)

    - ジョブはいつでも取り消すことができます。

        ![ジョブを取り消す](media/data-box-deploy-copy-data-via-copy-service/cancel-job.png) ジョブを取り消す際には確認が必要です。

        ![ジョブの取り消しを確認する](media/data-box-deploy-copy-data-via-copy-service/confirm-cancel-job.png)

        ジョブの取り消しを確定した場合でも、既にコピーされたデータは削除されません。 お客様が自分の Data Box にコピーしたデータを削除するには、デバイスをリセットします。

        ![デバイスをリセットする](media/data-box-deploy-copy-data-via-copy-service/reset-device.png)

        >[!NOTE]
        > 大きいファイルのコピー中にジョブを取り消しまたは一時停止した場合、一部だけがコピーされた状態となります。 これらのファイルは同じ状態で Azure にアップロードされます。 取り消しまたは一時停止を試みる際は、お客様のファイルが適切にコピーされたことを確認してください。 ファイルを確認するには、SMB 共有を調べるか、BOM ファイルをダウンロードします。

    - ネットワーク障害などの一時的なエラーが原因で、不意にジョブが失敗した場合、それを再起動することができます。 正常な完了やエラーありの完了など、最終状態に達したジョブを再起動することはできません。 エラーの原因としては、ファイルの名前付けまたはファイル サイズの問題が考えられます。 これらのエラーはログに記録されますが、完了したジョブを再起動することはできません。

        ![失敗したジョブを再起動する](media/data-box-deploy-copy-data-via-copy-service/restart-failed-job.png)

        エラーが発生した場合や、ジョブを再起動できない場合は、エラー ログをダウンロードして、ログ ファイルでエラーを調べます。 問題を修正した後、ファイルをコピーするためのジョブを新しく作成できます。 [SMB 経由でファイルをコピー](data-box-deploy-copy-data.md)することもできます。
    
    - このリリースでは、ジョブを削除することはできません。
    
    - ジョブは無制限に作成できますが、特定の一時点に並列で実行できるジョブは最大 10 個です。
    - ファイルの最適化を有効にした場合、コピーのパフォーマンスを高めるために、小さなファイルが取り込み時に圧縮されます。 その場合、圧縮ファイル (GUID が名前) が表示されます。 このファイルはアップロード中に解凍されるため、削除してはいけません。

6. ジョブの進行中、**[データのコピー]** ページでは:

    - **[状態]** 列で、コピー ジョブの状態を確認できます。 状態は次のいずれかになります。
        - **実行中**
        - **失敗**
        - **成功**
        - **一時停止中**
        - **一時停止**
        - **キャンセル中**
        - **Canceled**
        - **完了 (エラーあり)**
    - **[ファイル]** 列で、コピーされている全ファイルの数とサイズを確認できます。
    - **[処理済み]** 列で、処理されたファイルの数とサイズを確認できます。
    - **[詳細]** 列の **[表示]** をクリックすると、ジョブの詳細が表示されます。
    - コピー処理中にエラーが発生したことを **[エラー数]** 列が示している場合は、**[エラー ログ]** 列に移動し、エラー ログをダウンロードしてトラブルシューティングを行います。

コピー ジョブが完了するのを待ちます。 一部のエラーは **[接続とコピー]** ページのログにしか記録されないので、エラーなくコピー ジョブが完了したことを確認してから次の手順に進んでください。

![エラーがない **[接続とコピー]** ページ](media/data-box-deploy-copy-data-via-copy-service/verify-no-errors-on-connect-and-copy.png)

データの整合性を保証するため、データがコピーされるときにインラインでチェックサムが計算されます。 コピーが完了したら、デバイスで使用済み領域と空き領域を確認します。
    
![ダッシュボードで空き領域と使用済み領域を確認する](media/data-box-deploy-copy-data-via-copy-service/verify-used-space-dashboard.png)

コピー ジョブが完了したら、**発送準備**に進むことができます。

>[!NOTE]
> コピー ジョブの進行中に発送準備を行うことはできません。

## <a name="next-steps"></a>次の手順

このチュートリアルでは、Azure Data Box に関する次のようなトピックについて説明しました。

> [!div class="checklist"]
> * 前提条件
> * Data Box にデータをコピーする


次のチュートリアルに進み、お客様の Data Box を Microsoft に返送する方法を学習してください。

> [!div class="nextstepaction"]
> [Azure Data Box を Microsoft に発送する](./data-box-deploy-picked-up.md)

