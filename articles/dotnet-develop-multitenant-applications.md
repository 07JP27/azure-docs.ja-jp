<properties linkid="develop-net-architecture-multi-tenant-web-application" urlDisplayName="Multi-Tenant Web Application Pattern" pageTitle="Multi-Tenant Web Application Pattern - Azure Architecture" metaKeywords="" description="Find architectural overviews and design patterns that describe how to implement a multi-tenant web application on Azure." metaCanonical="" services="" documentationCenter=".NET" title="Multitenant Applications in Azure" authors="" solutions="" manager="" editor="" />

<tags ms.service="active-directory" ms.workload="identity" ms.tgt_pltfrm="na" ms.devlang="dotnet" ms.topic="article" ms.date="01/01/1900" ms.author="" />

<div>
<div class="left-nav">
<div class="static-nav">
<ul>
<li class="menu-nodejs-compute"><a href="/ja-jp/develop/net/compute/">コンピューティング</a></li>
<li class="menu-nodejs-data"><a href="/ja-jp/develop/net/data/">データ サービス</a></li>
<li class="menu-nodejs-appservices"><a href="/ja-jp/develop/net/app-services/">アプリケーション サービス</a></li>
<li><a href="/ja-jp/develop/net/reference/">リファレンス</a></li>
<li><a href="/ja-jp/develop/net/guidance/">ガイダンス</a></li>
<li><a href="/ja-jp/develop/net/architecture/">アーキテクチャ</a></li>
<li><a href="/ja-jp/develop/net/samples/">サンプル</a></li>
<li><a href="/ja-jp/develop/net/end-to-end-Apps/">シナリオに基づいたチュートリアル</a></li>
</ul>
<ul class="links">
<li class="forum"><a href="/ja-jp/support/forums/">フォーラム</a></li>
</ul>
</div>

<div class="floating-nav jump-to"><br />
<ul>
<li>このセクションの内容 (ジャンプ先): </li>
<li><a href="/ja-jp/develop/net/architecture/#overviews">アプリケーションのアーキテクチャの概要</a></li>
<li><strong>アプリケーション パターン: マルチテナント アプリケーション</strong></li>
<li><a href="/ja-jp/develop/net/architecture/load-testing-pattern/">アプリケーション パターン: ロード テスト</a></li>
<li><a href="/ja-jp/develop/net/architecture/#designpatterns">設計パターン</a></li>
</ul>
</div>

</div>

</div>

# Azure 上のマルチテナント アプリケーション

マルチテナント アプリケーションは共有リソースであり、個別のユーザーつまり "テナント" からは独自のアプリケーションであるかのように見えます。マルチテナント アプリケーションに適した一般的なシナリオは、アプリケーションのすべてのユーザーがユーザー エクスペリエンスをカスタマイズしたいと考えているが、基本的なビジネス要件は同じというものです。大規模なマルチテナント アプリケーションの例は、Office 365、Outlook.com、visualstudio.com です。

アプリケーション プロバイダーの観点から、マルチテナント方式の主なメリットは運用とコストの効率にあります。アプリケーションの 1 つのバージョンで、多くのテナント/顧客のニーズを満たすことができるため、監視、パフォーマンスのチューニング、ソフトウェアのメンテナンス、データのバックアップなどのシステム管理タスクを統合することが可能です。

次に挙げているのは、プロバイダーの観点から最も重要な目標と要件です。

-   **プロビジョニング**: アプリケーション用に新しいテナントをプロビジョニングできる必要があります。テナントが多数あるマルチテナント アプリケーションでは通常、セルフサービス プロビジョニングを可能にすることで、このプロセスを自動化する必要があります。
-   **保守容易性**: アプリケーションのアップグレードおよびその他の保守作業は、複数のテナントによるそのアプリケーションの使用中に実行できる必要があります。
-   **[監視]**: アプリケーションを常時監視することで、問題をすべて特定してトラブルシューティングできる必要があります。各テナントによるアプリケーションの使用状況も監視できる必要があります。

適切に実装されたマルチテナント アプリケーションでは、ユーザーに次のようなメリットがあります。

-   **分離**: 個々のテナントの活動は他のテナントによるアプリケーションの使用には影響しません。テナント間で相互のデータにアクセスすることはできません。各テナントからはアプリケーションを排他的に使用しているように見えます。
-   **可用性**: 個々のテナントにとって、多くの場合は SLA に定義されている保証下で、アプリケーションが常に使用できることが必要です。やはり、他のテナントの活動がアプリケーションの可用性に影響することはありません。
-   **拡張性**: アプリケーションの規模は個々のテナントのニーズに合わせて調整されます。他のテナントの存在と活動がアプリケーションのパフォーマンスに影響することはありません。
-   **コスト**: コストは専用のシングルテナント アプリケーションを実行するよりも低くなります。マルチテナント方式ではリソースを共有できるためです。
-   **カスタマイズ性**: 個々のテナントに合わせてアプリケーションをさまざまな方法でカスタマイズできます。機能の追加や削除、色やロゴの変更、独自のコードやスクリプトの追加などが可能です。

要するに、拡張性の高いサービスを提供するための考慮事項が多数ありながら、多くのマルチテナント アプリケーション間に共通する目標と要件も多数あります。一部の目標と要件はシナリオに固有のものではなく、それらの重要性がシナリオによって変わります。マルチテナント アプリケーションのプロバイダーとして、そのほかにも目標と要件が生じます。たとえば、テナントの目標と要件の達成、収益性、課金、複数のサービス レベル、プロビジョニング、保守容易性の監視、自動化などです。

マルチテナント アプリケーションのその他の設計上の考慮事項の詳細については、「[Hosting a Multi-Tenant Application on Azure (Azure 上のマルチテナント アプリケーションのホスト)][Hosting a Multi-Tenant Application on Azure (Azure 上のマルチテナント アプリケーションのホスト)]」を参照してください。

Azure には、マルチテナント システムの設計時に発生する主要な問題に対処できる、多数の機能が用意されています。

**分離:**

-   ホスト ヘッダー内の SSL 通信の有無で Web サイト テナントを分割する。
-   クエリ パラメーター別に Web サイト テナントを分割する。
-   worker ロールで Web サービスを実行する。
    -   ワーカー ロールは通常、アプリケーションのバックエンドでデータを処理します。
    -   Web ロールは通常、アプリケーションのフロントエンドとして動作します。

**ストレージ**

SQL Azure データベースや Azure ストレージ サービスのようなデータ管理。たとえば、大量の非構造化データを保存するためのテーブル サービスがあります。また、大量の非構造化テキストまたはバイナリ データ (ビデオ、オーディオ、画像など) を保存するための BLOB サービスもあります。

-   SQL データベース内のマルチテナント データをセキュリティで保護する。SQL Server へのテナント単位のログインに適しています。
-   Azure テーブルをアプリケーション リソース用に使用する。コンテナー レベルのアクセス ポリシーを指定することでアクセス許可を調整できます。共有のアクセス署名で保護されたリソース用に新しい URL を発行する必要はありません。
-   Azure キューをアプリケーション リソース用に使用する。Azure キューは、テナントの処理を扱うために一般的に使用するだけでなく、プロビジョニングまたは管理に必要な処理を分散させるためにも使用できます。
-   Service Bus キューをアプリケーション リソース用に使用して、処理を共有サービスにプッシュする。1 つのキューを使用して、各テナントのサービスの送り側には、データをそのキューにプッシュするアクセス許可 (ACS から発行されるクレームから派生) のみ与え、サービスの受け側には、複数のテナントからのデータをキューからプルするアクセス許可のみ与えることができます。

**接続とセキュリティ サービス**

-   Azure Service Bus は、アプリケーション間のメッセージ インフラストラクチャで、拡張性および復元性を向上させるために疎結合方式でメッセージ交換を行います。

**ネットワーク サービス**

Azure には、認証をサポートし、ホステッド アプリケーションの管理性を向上させる、複数のネットワーク サービスが用意されています。それらのサービスは次のとおりです。

-   Azure 仮想ネットワークでは、Azure 上で仮想プライベート ネットワーク (VPN) をプロビジョニングして管理でき、VPN を内部設置型の IT インフラストラクチャにセキュリティで保護された方法で接続することもできます。
-   Virtual Network Traffic Manager を使用すると、(同一データセンターで実行されているか、世界各地に点在するデータセンターで実行されているかに関係なく) 複数の Azure ホステッド サービス間で着信トラフィックを負荷分散できます。
-   Azure Active Directory (Azure AD) は、クラウド アプリケーションに ID 管理機能およびアクセス制御機能を提供する最新の REST ベースのサービスです。Azure AD をアプリケーション リソース用に使用すると、コードから認証および承認の機能を除外しつつ、Web アプリケーションおよびサービスにアクセスするユーザーの認証および権限承認を簡単に行えるようになります。
-   Azure Service Bus では、分散型およびハイブリッド型アプリケーション用に、セキュリティで保護されたメッセージングおよびデータ フローの機能が用意されています。たとえば、複雑なファイアウォールやセキュリティ インフラストラクチャを使用することなく、Azure ホスト型アプリケーションと内部設置型アプリケーションおよびサービスとのセキュリティで保護された通信が可能です。サービス バス リレーをアプリケーション リソース用に使用すると、サービスをテナントに属するエンドポイントとして公開できます (たとえば、内部設置型のようにシステム外でのホストが可能です)。または、サービスをテナント専用にプロビジョニングできます (テナント固有の機密データをサービス間で移動するためです)。

**リソースのプロビジョニング**

Azure には、アプリケーション用に新しいテナントをプロビジョニングするための、多数の方法が用意されています。テナントが多数あるマルチテナント アプリケーションでは通常、セルフサービス プロビジョニングを可能にすることで、このプロセスを自動化する必要があります。

-   worker ロールを使用すると、テナント リソースごとにプロビジョニングおよびプロビジョニング解除したり (新しいテナントのサインアップやキャンセル時など)、計測用にメトリックを収集したりできます。さらに、一定のスケジュールに従ったスケーリングや、主要業績評価指標のしきい値の超過に応じたスケーリングを管理することもできます。この同じロールは、ソリューションへの更新とアップグレードのプッシュにも使用できます。
-   Azure BLOB を使用すると、新しいテナント用にコンピューティングまたは事前初期化済みのストレージ リソースをプロビジョニングできます。同時に、コンピューティング サービス パッケージ、VHD イメージなどのリソースを保護するための、コンテナー レベルのアクセス ポリシーを設定することもできます。
-   テナント用に SQL データベース リソースをプロビジョニングする方法は次のとおりです。

    -   スクリプト内の DDL、またはアセンブリ内のリソースとして埋め込まれた DLL
    -   プログラムでデプロイする SQL Server 2008 R2 DAC パッケージ
    -   マスター参照データベースからのコピー
    -   データベースのインポートとエクスポートによるファイルからの新しいデータベースのプロビジョニング



<!--links-->

  [Hosting a Multi-Tenant Application on Azure (Azure 上のマルチテナント アプリケーションのホスト)]: http://msdn.microsoft.com/ja-jp/library/hh534480.aspx
