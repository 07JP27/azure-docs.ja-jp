---
title: "Azure IoT Hub Device Provisioning Service へのデバイスのアクセスを管理する方法 | Microsoft Docs"
description: "Azure Portal で DPS サービスへのデバイスのアクセスを取り消す方法"
services: iot-dps
keywords: 
author: JimacoMS
ms.author: v-jamebr
ms.date: 12/22/2017
ms.topic: article
ms.service: iot-dps
documentationcenter: 
manager: timlt
ms.devlang: na
ms.custom: mvc
ms.openlocfilehash: 6f1dad648b228163219c8f722eed3897f4ba4d22
ms.sourcegitcommit: 48fce90a4ec357d2fb89183141610789003993d2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/12/2018
---
# <a name="how-to-revoke-device-access-to-your-provisioning-service-in-the-azure-portal"></a>Azure Portal でプロビジョニング サービスへのデバイスのアクセスを取り消す方法

IoT ソリューションなどの重要なシステムでは、デバイスの資格情報を適切に管理することが極めて重要です。 このようなシステムでは、デバイスの資格情報 (SAS トークンと X.509 証明書のいずれでも) が侵害された場合にデバイスのアクセスを取り消す方法について明確なプランを立てることが最善の方法です。 この記事では、プロビジョニングの段階でデバイスのアクセスを取り消す方法について説明します。

デバイスをプロビジョニングした後に IoT ハブへのデバイスのアクセスを取り消す方法については、 「[デバイスの無効化](https://docs.microsoft.com/azure/iot-hub/iot-hub-devguide-identity-registry#disable-devices)」をご覧ください。

> [!NOTE] 
> アクセスを取り消すデバイスの再試行ポリシーに注意してください。 たとえば、無限に再試行するポリシーを持つデバイスでは、プロビジョニング サービスへの登録が継続的に試行され、サービス リソースが消費されて、パフォーマンスに影響を及ぼす可能性があります。

## <a name="blacklist-devices-with-an-individual-enrollment-entry"></a>個別登録エントリを持つデバイスをブラックリストに追加する

個別登録は、単一のデバイスに適用され、(実際の TPM または仮想 TPM 内の) X.509 証明書や SAS トークンを構成証明メカニズムとして使用できます  (SAS トークンを構成証明メカニズムとして使用するデバイスは、個別登録でのみプロビジョニングできます)。個別登録を持つデバイスをブラックリストに追加するには、デバイスの登録エントリを無効にするか削除します。 

- デバイスをブラックリストに一時的に追加するには、デバイスの登録エントリを無効にします。 

    1. Azure Portal にログインし、左側のメニューにある **[すべてのリソース]** をクリックします。
    2. リソースの一覧から、デバイスをブラックリストに追加するプロビジョニング サービスをクリックします。
    3. 目的のプロビジョニング サービスで、**[Manage enrollments]\(登録の管理\)** をクリックし、**[Individual Enrollments]\(個別登録)** タブを選択します。
    4. ブラックリストに追加するデバイスの登録エントリをクリックして開きます。 
    5. 登録リストのエントリの下部にある **[無効にする]** をクリックし、**[保存]** をクリックします。  

        ![ポータルで個別登録エントリを無効にする](./media/how-to-revoke-device-access-portal/disable-individual-enrollment.png)
    
- デバイスをブラックリストに永続的に追加するには、デバイスの登録エントリを削除します。

    1. Azure Portal にログインし、左側のメニューにある **[すべてのリソース]** をクリックします。
    2. リソースの一覧から、デバイスをブラックリストに追加するプロビジョニング サービスをクリックします。
    3. 目的のプロビジョニング サービスで、**[Manage enrollments]\(登録の管理\)** をクリックし、**[Individual Enrollments]\(個別登録)** タブを選択します。
    4. ブラックリストに追加するデバイスの登録エントリの横にあるボックスをオンにします。 
    5. ウィンドウの上部の **[削除する]** をクリックし、次に **[はい]** をクリックして登録の削除を確定します。 

        ![ポータルで個別登録エントリを削除する](./media/how-to-revoke-device-access-portal/delete-individual-enrollment.png)
    
    6. アクションが完了すると、個別登録の一覧からエントリが削除されたことがわかります。  

## <a name="blacklist-an-x509-intermediate-or-root-ca-certificate-using-an-enrollment-group"></a>登録グループを使用して、X.509 中間 CA 証明書または X.509 ルート CA 証明書をブラックリストに追加する

X.509 証明書は通常、信頼する証明書チェーンに配置されます。 チェーン内のいずれかの段階にある証明書が侵害されると、信頼が崩れるため、侵害された証明書をブラックリストに追加し、この証明書を含むすべてのチェーン内のダウン ストリーム デバイスがデバイス プロビジョニング サービスでプロビジョニングされないようにする必要があります。 X.509 証明書の詳細情報と、プロビジョニング サービスでの X.509 証明書の使用方法については、「[X.509 証明書](./concepts-security.md#x509-certificates)」をご覧ください。 

登録グループは、同じ中間 CA またはルート CA によって署名された X.509 証明書の構成証明メカニズムを共有するデバイスのエントリです。 登録グループ エントリの構成は、中間 CA またはルート CA に関連付けられた X.509 証明書と、証明書チェーン内に X.509 証明書を持つデバイスが共有する構成値 (ツインの状態や IoT ハブ接続など) を使用して行います。 証明書をブラックリストに追加するには、証明書の登録グループを無効にするか削除します。

- 証明書をブラックリストに一時的に追加するには、証明書の登録グループを無効にします。 

    1. Azure Portal にログインし、左側のメニューにある **[すべてのリソース]** をクリックします。
    2. リソースの一覧から、署名証明書をブラックリストに追加するプロビジョニング サービスをクリックします。
    3. 目的のプロビジョニング サービスで、**[Manage enrollments]\(登録の管理\)** をクリックし、**[Enrollment Groups]\(登録グループ\)** タブを選択します。
    4. ブラックリストに追加する証明書の登録グループをクリックして開きます。
    5. 登録グループ エントリの左上にある **[グループの編集]** をクリックします。
    6. 登録エントリを無効にするには、**[エントリの有効化]** スイッチで **[無効にする]** を選択し、**[保存]** をクリックします。  

        ![ポータルで登録グループ エントリを無効にする](./media/how-to-revoke-device-access-portal/disable-enrollment-group.png)

    
- 証明書をブラックリストに永続的に追加するには、証明書の登録グループを削除します。

    1. Azure Portal にログインし、左側のメニューにある **[すべてのリソース]** をクリックします。
    2. リソースの一覧から、デバイスをブラックリストに追加するプロビジョニング サービスをクリックします。
    3. 目的のプロビジョニング サービスで、**[Manage enrollments]\(登録の管理\)** をクリックし、**[Enrollment Groups]\(登録グループ\)** タブを選択します。
    4. ブラックリストに追加する証明書の登録グループの横にあるボックスをオンにします。 
    5. ウィンドウの上部の **[削除する]** をクリックし、次に **[はい]** をクリックして登録グループの削除を確定します。 

        ![ポータルで登録グループ エントリを削除する](./media/how-to-revoke-device-access-portal/delete-enrollment-group.png)

    6. アクションが完了すると、登録グループの一覧からエントリが削除されたことがわかります。  

> [!NOTE]
> 証明書の登録グループを削除しても、証明書チェーンの上位のルート証明書や別の中間証明書に有効な登録グループが存在する場合、証明書チェーン内にその証明書を持つデバイスでは引き続き登録が可能です。

## <a name="blacklist-specific-devices-in-an-enrollment-group"></a>登録グループ内の特定のデバイスをブラックリストに追加する

X.509 構成証明メカニズムを実装するデバイスでは、デバイスの証明書チェーンと秘密キーを使用して認証を行います。 デバイスがデバイス プロビジョニング サービスに接続され、認証されると、サービスはまずデバイスの資格情報と一致する個別の登録を探してから、登録グループを探し、デバイスをプロビジョニングできるかどうかを判別します。 サービスでデバイスの無効な個別登録が見つかった場合、デバイスの証明書チェーンに中間 CA またはルート CA の有効な登録グループが存在しても、デバイスは接続されません。 登録グループの個別のデバイスをブラックリストに追加するには、次の手順を実行します。

1. Azure Portal にログインし、左側のメニューにある **[すべてのリソース]** をクリックします。
2. リソースの一覧から、ブラックリストに追加するデバイスの登録グループを含むプロビジョニング サービスをクリックします。
3. 目的のプロビジョニング サービスで、**[Manage enrollments]\(登録の管理\)** をクリックし、**[Individual Enrollments]\(個別登録)** タブを選択します。
4. 上部にある **[追加]** をクリックします。 
5. デバイスのセキュリティ メカニズムに **X.509** を選択し、デバイスの証明書をアップロードします。 これは、デバイスにインストールされる署名付きのエンドエンティティ証明書です。デバイスはこの証明書を使用して認証用の証明書を生成します。
6. デバイスの **IoT Hub デバイス ID** を入力します。 
7. 登録エントリを無効にするには、**[エントリの有効化]** スイッチで **[無効にする]** を選択します。 
8. **[Save]** をクリックします。 登録の作成に成功すると、**[個々の登録]** タブにデバイスが表示されます。 

    ![ポータルで個別登録エントリを無効にする](./media/how-to-revoke-device-access-portal/disable-individual-enrollment.png)




