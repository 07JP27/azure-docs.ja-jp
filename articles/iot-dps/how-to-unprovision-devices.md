---
title: "Azure IoT Hub Device Provisioning サービスによって登録されたデバイスをプロビジョニング解除する方法 | Microsoft Docs"
description: "DPS サービスによって登録されたデバイスを Azure Portal でプロビジョニング解除する方法"
services: iot-dps
keywords: 
author: JimacoMS
ms.author: v-jamebr
ms.date: 01/08/2018
ms.topic: article
ms.service: iot-dps
documentationcenter: 
manager: timlt
ms.devlang: na
ms.custom: mvc
ms.openlocfilehash: 83ed72c0f2eb342c372ef97e5443d60eab1e2174
ms.sourcegitcommit: 817c3db817348ad088711494e97fc84c9b32f19d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/20/2018
---
# <a name="how-to-unprovision-devices-enrolled-by-your-provisioning-service"></a>プロビジョニング サービスによって登録されたデバイスをプロビジョニング解除する方法

デバイス プロビジョニング サービスによってプロビジョニングされたデバイスをプロビジョニング解除する必要が生じる場合があります。 たとえば、デバイスが売却されたり、別の IoT Hub に移動されたり、紛失、盗難、その他の理由で侵害された場合などです。 

一般に、デバイスのプロビジョニング解除には 2 つの手順が含まれます。

1. プロビジョニング サービスへのデバイスのアクセスを取り消します。 アクセスを一時的に取り消すか永続的に取り消すかに応じて、または、X.509 構成証明メカニズムの場合は既存の登録グループの階層に応じて、登録エントリの無効化または削除を行います。 
 
   - ポータルを使用してデバイスのアクセスを取り消す方法については、[デバイスのアクセスの取り消し](how-to-revoke-device-access-portal.md)に関する記事をご覧ください。
   - いずれかのプロビジョニング サービス SDK を使用してプログラムでデバイスのアクセスを取り消す方法については、[サービス SDK を使用したデバイスの登録の管理](how-to-manage-enrollments-sdks.md)に関する記事をご覧ください。

2. デバイスがプロビジョニングされた IoT Hub の ID レジストリで、デバイスのエントリを無効化または削除します。 詳細については、Azure IoT Hub での[デバイス ID の管理](https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-devguide-identity-registry#disable-devices)に関するドキュメントをご覧ください。 

デバイスをプロビジョニング解除するための実際の手順は、デバイスが使用している構成証明メカニズムによって異なります。

TPM 構成証明または自己署名のリーフ証明書 (証明書チェーンなし) による X.509 構成証明を使用するデバイスは、個別登録エントリを使用してプロビジョニングされます。 これらのデバイスでは、エントリを削除してプロビジョニング サービスへのデバイスのアクセスを永続的に取り消すか、または、エントリを無効にしてアクセスを一時的に取り消し、後でデバイスがプロビジョニングされた IoT Hub の ID レジストリでデバイスを削除または無効化してフォローアップすることができます。

X.509 構成証明では、登録グループを使用してデバイスをプロビジョニングすることもできます。 登録グループは署名証明書 (中間 CA 証明書またはルート CA 証明書) を使用して構成され、証明書チェーン内のその証明書を使用して、プロビジョニング サービスへのデバイスのアクセスを制御します。 プロビジョニング サービスの登録グループと X.509 証明書の詳細については、「[X.509 証明書](concepts-security.md#x509-certificates)」をご覧ください。 

登録グループを使用してプロビジョニングされているデバイスの一覧を表示するには、登録グループの詳細を表示します。 これは、各デバイスがどの IoT Hub に対してプロビジョニングされているかを把握するための簡単な方法です。 デバイスの一覧を表示するには、次のようにします。 

1. Azure Portal にログインし、左側のメニューにある **[すべてのリソース]** をクリックします。
2. リソースの一覧で、目的のプロビジョニング サービスをクリックします。
3. 目的のプロビジョニング サービスで、**[Manage enrollments]\(登録の管理\)** をクリックし、**[Enrollment Groups]\(登録グループ\)** タブを選択します。
4. 登録グループをクリックして開きます。

   ![ポータルで登録グループ エントリを表示する](./media/how-to-unprovision-devices/view-enrollment-group.png)

登録グループに関しては、2 つのシナリオが考えられます。

- 登録グループを使用してプロビジョニングされているすべてのデバイスをプロビジョニング解除するには、最初に登録グループを無効にして、その署名証明書をブラックリストに追加する必要があります。 その後で、登録グループのプロビジョニング済みデバイスの一覧を使用して、対応する IoT Hub の ID レジストリから各デバイスを無効化または削除できます。 すべてのデバイスを対応する IoT Hub から無効化または削除した後で、必要に応じて登録グループを削除できます。 ただし、登録グループを削除した場合、1 つまたは複数のデバイスの証明書チェーンの上位に署名証明書に対して有効な登録グループがあると、そのデバイスの再登録が可能になります。 
- 登録グループから 1 つのデバイスだけをプロビジョニング解除するには、最初に、そのリーフ (デバイス) 証明書に対して無効化された個別登録を作成する必要があります。 これにより、そのデバイスのプロビジョニング サービスへのアクセスが取り消されますが、チェーン内に登録グループの署名証明書を持つ他のデバイスは引き続きアクセスを許可されます。 その後、登録グループの詳細でプロビジョニング済みデバイスの一覧を使用して、デバイスがどの IoT Hub に対してプロビジョニングされているかを確認し、そのハブの ID レジストリからデバイスを無効化または削除することができます。 デバイスに対して無効化された個別登録を削除しないでください。 削除した場合、登録グループを使用してそのデバイスを再登録することが可能になります。 










