<properties 
	pageTitle="ビジネス プロセスの作成" 
	description="ビジネス プロセスの作成" 
	authors="stepsic-microsoft-com" 
	manager="dwrede" 
	editor="" 
	services="app-service-logic" 
	documentationCenter=""/>


<tags
	ms.service="app-service-logic"
	ms.workload="web"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="02/24/2015"
	ms.author="stepsic"/>

# フロー アプリおよび API アプリを使用したビジネス プロセスの開発

基本フローは既に作成済みですが、今回は、フロー アプリを使用して、本格的なビジネス フローを作成します。この記事では、以下の重要なトピックについて説明します。

- 条件付きロジック (特定の条件が満たされた場合にのみアクションを起こすなど) の追加とループの追加
- BizTalk API Apps
- コード ビューを使用したフローの編集
- さまざまな種類のトリガー

最初に、ここをクリックして、基本的なフローが既に記入されている項目をサブスクリプションに作成します。このフローを作成したら、編集するために [トリガーとアクション] をクリックします。

## 条件付きロジックの追加とループの追加

基本フローは正常に機能しても、いくつかの問題があります。最初に、最上位のツイートのみが電子メールで送信され、キーワードに一致したすべてのツイートが送信されるわけではないという問題があります。項目の一覧に対してあるアクションを繰り返し実行するには、"repeat" プロパティを使用します。

### 繰り返しの実行

繰り返しは、項目の一覧を受け取り、その一覧にある各項目に対してアクションを実行します。繰り返しを使用するには、アクションの上部にある円形の矢印アイコンをクリックします。テキスト ボックスが開いたら、次のように入力します。

    @triggers().outputs.body

これにより、基本フローと同様に、ツイートの一覧が出力されます。次に、アクション内でツイートを実際に使用するために、メッセージを次に置き換えます。

    @repeatItem().message

"repeatItem()" は、一覧にある各要素を渡す関数です。チェック マークをクリックします。

### 条件付き

このフローには、まだ大量の電子メールを送信する問題があります。この場合は、ロジックを追加して、一定数のフォロワーを持つ人物がツイートした場合にのみ電子メールを受け取るようにすることができます。これを行うには、アクションの上部にある、ひし形のアイコンをクリックします。

テキスト ボックスに、次のように入力します。

    @greaterThan(repeatItem().person.followers, 1000)

ここには repeatItem() 関数がありますが、greaterThan() という新しい関数も示されています。この関数は、2 つの値を比較して、最初の値が 2 番目の値を超える場合にのみ、アクションの実行を許可します。フォロワー数を取得する構文に注目してください。関心のあるプロパティごとにドットを追加し、その後にプロパティ名を追加しています。チェック マークをクリックして条件を追加します。

## BizTalk API Apps

Azure では、いくつかの異なるカテゴリの API アプリを使用できます。Twitter と Office 365 は今回のシナリオに最適なコネクタですが、BizTalk で提供されるさまざまな API アプリもフローで活用することができます。

右側のウィンドウにある XXXXXX サービスをクリックします。クリックすると、BizTalk が提供するそのサービスがデザイナーに追加されます。

### アクション間のデータの受け渡し

フローで複数のアクションを使用するには、アクション間でデータを受け渡す必要があります。これを行うには、actions() 関数を使用します。

XXXXXX アクションを追加したら、次のように入力します。

    @actions(‘SendMail’).outputs.YYYYYY

この場合、SendMail アクションの出力から YYYYYY プロパティがフローされます。アクションの名前は、そのアクションのアイコンのすぐ下に常時表示されています。同様に、そのアクションのすべての出力が、このボックスの下部に表示されています。

## コード ビューを使用したフローの編集

フローの定義は、デザイナーを使用するだけでなく、手動で直接編集することもできます。これを行うには、コマンド バーにある [コード ビュー] をクリックします。フル エディターが開き、先ほど編集したフローの定義が表示されます。

テキスト エディターを使用すると、特定の操作を簡単に実行できます。たとえば、同じフロー内の任意の数のアクションをコピーして貼り付けることができます (この操作はフロー間でも実行できます)。また、簡単にフロー内のセクション全体を一度に追加または削除することもできます。

### パラメーター

[コード ビュー] でのみ公開される機能もいくつかありますが、その 1 つがパラメーターです。パラメーターを使用すると、フロー全体で値を簡単に再利用できます。たとえば、1 つの電子メール アドレスを複数のアクションに含める必要がある場合に、そのアドレスをパラメーターにすることができます。

パラメーターを定義するには、パラメーターの {} オブジェクトに移動し、その内部に "emailAddress" : { "type" : "string", "defaultValue" : "me@example.com" } を追加します。

次に、電子メールを送信するアクションまでスクロールします。その場所には、電子メールの入力が表示されています。電子メールを次のコードに置き換えます。

    @parameters(‘emailAddress’)

パラメーターは、よく変更する可能性がある値を抜き出すための優れた手段です。

## さまざまな種類のトリガー

フローを開始するには、いくつかの異なる方法があります。どの方法も動作が少しずつ異なるため、自分のシナリオに適した方法を選択するようにしてください。

### ポーリング トリガー

一部のトリガーは、API アプリを一定の間隔でチェックします。この間隔は定義できますが、"triggerState" というフィールドを渡す必要もあります。トリガーの状態は、トリガーの呼び出しに渡される情報です。それにより、トリガーは前回のチェック時に返した状態を把握します。通常、トリガーの状態は文字列になります。

    @triggers().outputs.body.triggerState

### コールバック トリガー

他のトリガーは、新しい要求がある場合に、フローをコールバックします。この場合、フローのコールバック URI をトリガーに指定する必要があります。このコピーを取得するには、フローに移動したときに [設定] 画面の [プロパティ] ブレードからアクセス エンドポイントをコピーします。

### 手動での呼び出し

3 番目は、手動でフローを実行する方法です。ポータルにある [実行] をクリックすると、フローが開始されます。

<!--HONumber=54-->